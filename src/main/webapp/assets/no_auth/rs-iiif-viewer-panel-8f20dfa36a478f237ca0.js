(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{1305:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var i=t(11),r=t(1),a=t(16),o=t(19),s=t(162),l=t(34),c=t(56),p=t(23),u=t(61),I=t(1244),g=t(2341),m=function(e){function IIIFViewerPanel(n,t){var i=e.call(this,n,t)||this;return i.cancellation=new l.Cancellation,i.queryingCancellation=i.cancellation.derive(),i.listenToEvents=function(){i.cancellation.map(s.listen({eventType:g.AddImagesForObjectEvent,target:i.props.id})).observe({value:function(e){var n,t=i.props.query,r=u.SparqlUtil.parseQuery(t),a=u.SparqlClient.setBindings(r,((n={}).subject=p.Rdf.iri(e.data.objectIri),n));u.SparqlClient.select(a).map((function(n){var t=n.results;return{iri:e.data.objectIri,images:t.bindings.map((function(e){return e.image.value}))}})).onValue((function(n){s.trigger({eventType:g.AddObjectImagesEvent,source:i.props.id,targets:[i.props.id],data:{objectIri:e.data.objectIri,imageIris:n.images}})}))}})},i.state={},i}return i.__extends(IIIFViewerPanel,e),IIIFViewerPanel.prototype.componentDidMount=function(){this.queryImages(),this.listenToEvents()},IIIFViewerPanel.prototype.componentDidUpdate=function(e){a.isEqual(this.props,e)||this.queryImages()},IIIFViewerPanel.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},IIIFViewerPanel.prototype.queryImages=function(){var e=this,n=this.context.semanticContext,t=this.props,i=t.query,r=t.iris,s=t.repositories,l=void 0===s?[n.repository]:s,c=u.SparqlUtil.parseQuery(i),I=r.map((function(e){var n,t=u.SparqlClient.setBindings(c,((n={}).subject=p.Rdf.iri(e),n)),i=l.map((function(n){return u.SparqlClient.select(t,{context:{repository:n}}).map((function(n){var t=n.results;return{iri:e,images:t.bindings.map((function(e){return e.image.value}))}}))}));return o.zip(i)}));this.queryingCancellation=this.cancellation.deriveAndCancel(this.queryingCancellation),this.queryingCancellation.map(o.combine(I)).onValue((function(n){var t=[];a.flatten(n).forEach((function(e){var n=e.iri,i=e.images;t.push({objectIri:n,images:i})})),e.setState({imageOrRegion:t})}))},IIIFViewerPanel.prototype.render=function(){var e=this.state.imageOrRegion;return e?r.createElement(I.ImageRegionEditorComponentMirador,i.__assign({},this.props,{imageOrRegion:e})):null},IIIFViewerPanel}(c.Component);n.IIIFViewerPanel=m,n.default=m}}]);
//# sourceMappingURL=rs-iiif-viewer-panel-8f20dfa36a478f237ca0.js.map