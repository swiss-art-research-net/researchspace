(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{1251:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(11),i=r(1),n=r(19),a=r(16),s=r(1213),u=r(10),l=r(34),p=r(56),c=r(63),d=r(23),m=r(116),f=r(1210),h=r(214),v=r(116),y=r(162),S=r(1553),g=r(1825),P=r(2227),b=r(2232),F=r(1827),C=r(2233),V=r(1951),w=r(1952),E=r(1951),I=r(1236),j=r(1217),R=r(2229),D=r(1947),T=r(1620),A=h.BrowserPersistence.adapter(),L=function(e){function ResourceEditorForm(t,r){var a=e.call(this,t,r)||this;return a.cancellation=new l.Cancellation,a.unmounted=!1,a.mapChildren=function(e){return i.Children.map(e,(function(e){if(!h.isValidChild(e))return e;if(h.componentHasType(e,ResourceEditorForm))return e;if("button"===e.type){switch(e.props.name){case"reset":return i.cloneElement(e,{disabled:!a.initialState||a.state.submitting,onClick:a.onReset});case"submit":return i.cloneElement(e,{disabled:!a.canSubmit(),onClick:a.onSubmit});case"delete":return i.cloneElement(e,{disabled:!a.canSubmit(),onClick:a.onRemove});case"load-state":var t;return[i.createElement("input",{ref:function(e){return t=e},type:"file",style:{display:"none"},onChange:a.onChangeLoadData}),i.cloneElement(e,{onClick:function(){return a.onLoadData(t)}})];case"save-state":return i.cloneElement(e,{onClick:a.onSaveData})}return e}return h.componentHasType(e,I.RecoverNotification)?i.cloneElement(e,{recoveredFromStorage:a.state.recoveredFromStorage,discardRecoveredData:function(){return a.resetFormData()}}):e.props.children?i.cloneElement(e,{},h.universalChildren(a.mapChildren(e.props.children))):e}))},a.onReset=function(e){e.preventDefault(),e.stopPropagation(),a.resetFormData()},a.onSubmit=function(e){e.preventDefault(),e.stopPropagation();var t=a.form.validate(a.state.model);if(g.readyToSubmit(t,S.FieldError.isPreventSubmit)){a.setState((function(e){return{model:t,submitting:!0}}));var r=a.initialState.model;a.form.finalize(a.state.model).flatMap((function(e){return a.persistence.persist(r,e).map((function(){return a.props.addToDefaultSet?f.addToDefaultSet(e.subject,a.props.id):n.constant(!0)})).map((function(){return e}))})).observe({value:function(e){a.resetStorage(),a.unmounted||a.setState({model:e,submitting:!1});var t=!a.initialState.model||S.CompositeValue.isPlaceholder(a.initialState.model.subject);D.performFormPostAction({postAction:a.props.postAction,subject:e.subject,eventProps:{isNewSubject:t,sourceId:a.props.id},queryParams:D.getPostActionUrlQueryParams(a.props)})},error:function(e){a.unmounted||a.setState({submitting:!1}),m.addNotification({level:"error",message:"Failed to submit the form"},e)}})}else a.setState((function(e){return{model:t,submitting:!1}}))},a.onRemove=function(){var e=a.initialState.model.subject;a.persistence.remove(a.initialState.model).observe({value:function(){D.performFormPostAction({postAction:a.props.postAction,subject:e,eventProps:{isNewSubject:!1,isRemovedSubject:!0,sourceId:a.props.id},queryParams:D.getPostActionUrlQueryParams(a.props)})},error:function(){}})},a.onSaveData=function(){var e=b.computeValuePatch(S.FieldValue.empty,a.state.model),t=a.props.formId,r=JSON.stringify({formId:t,valuePatch:e}),o=new Blob([r]),i=t+"-"+u().format()+".json";s.saveAs(o,i)},a.onChangeLoadData=function(e){if(e&&e.target.files){var t=e.target.files[0];e.target.value="",a.cancellation.map(function loadTextFileFromInput(e){return n.stream((function(t){var r=new FileReader;return r.onload=function(e){t.emit(e.target.result),t.end()},r.onerror=function(e){t.error(e),t.end()},r.readAsText(e),function(){1===r.readyState&&r.abort()}}))}(t)).observe({value:function(e){var t=JSON.parse(e);if(t.formId===a.props.formId){var r=b.applyValuePatch(a.state.model,t.valuePatch);a.setState({model:r})}},error:function(e){a.setState({error:e})}})}},a.onLoadData=function(e){e.click()},a.saveToStorage=function(e){if(a.browserPersistenceEnabled()&&a.initialState){var t=b.computeValuePatch(a.initialState.model,e);A.set(a.computePersistentId(),t)}},a.loadFromStorage=function(){if(a.browserPersistenceEnabled())try{return A.get(a.computePersistentId())}catch(e){console.warn(e)}return null},a.resetStorage=function(){a.browserPersistenceEnabled()&&A.remove(a.computePersistentId())},a.browserPersistenceEnabled=function(){return Boolean(a.props.browserPersistence)},a.getFormId=function(){return a.props.formId?a.props.formId:c.getCurrentResource().value},a.persistence=function normalizePersistenceMode(e,t){if(!e)return new C.LdpPersistence;if(F.isTriplestorePersistence(e))return e;var r="string"==typeof e?{type:e}:e,i=o.__assign({repository:t},r);switch(i.type){case"sparql":return new V.SparqlPersistence(i);case"client-side-sparql":return new w.RawSparqlPersistence(i);case"ldp":return new C.LdpPersistence(i);default:var n=i;return console.warn("Unknown from persistence type '"+n.type+"', using LDP as fallback"),new C.LdpPersistence}}(a.props.persistence,"default"),a.state={model:void 0,submitting:!1},a}return o.__extends(ResourceEditorForm,e),ResourceEditorForm.prototype.componentDidMount=function(){var e=this;this.persistence instanceof E.SparqlPersistence&&this.validateFields(),this.props.id&&this.cancellation.map(y.listen({target:this.props.id,eventType:R.FormRemoveResource})).observe({value:function(t){t.data.iri===e.props.subject&&e.onRemove()}})},ResourceEditorForm.prototype.componentWillUnmount=function(){this.cancellation.cancelAll(),this.unmounted=!0},ResourceEditorForm.prototype.validateFields=function(){var e=o.__spreadArrays(getInvalidFields(this.props.fields),this.validateNestedFormsFields(this.props.children));if(e.length){var t=a.uniqBy(e,"id").map((function(e){return'"'+e.id+'"'})).join(", ");this.setState({error:"The fields ["+t+"] don't have INSERT or DELETE patterns"})}},ResourceEditorForm.prototype.validateNestedFormsFields=function(e){var t=this,r=[];return i.Children.forEach(e,(function(e){if(h.isValidChild(e)&&(h.componentHasType(e,j.CompositeInput)&&(r=r.concat(getInvalidFields(e.props.fields))),e.props.children)){var o=t.validateNestedFormsFields(e.props.children);r=r.concat(o)}})),r},ResourceEditorForm.prototype.render=function(){var e=this;if(this.state.error)return i.createElement(v.ErrorNotification,{errorMessage:this.state.error});var t={ref:function(t){e.form=t},fields:this.props.fields,model:this.state.model||S.FieldValue.fromLabeled({value:getSubject(this.props)}),newSubjectTemplate:this.props.newSubjectTemplate,onLoaded:function(t){var r=e.props.initializeModel?e.props.initializeModel(t):t;e.initialState={model:r,submitting:!1,recoveredFromStorage:!1};var o=e.applyCachedData(e.initialState.model),i=o.model,n=o.recoveredFromStorage;e.setState({model:i,recoveredFromStorage:n,submitting:!1})},onChanged:function(t){e.setState({model:t})},onUpdated:function(t){e.setState({modelState:t}),e.initialState&&t===S.DataState.Ready&&e.saveToStorage(e.state.model)},debug:this.props.debug};return i.createElement(P.SemanticForm,t,this.mapChildren(this.props.children))},ResourceEditorForm.prototype.applyCachedData=function(e){var t=this.loadFromStorage(),r=b.applyValuePatch(e,t);return r!==e&&S.FieldValue.isComposite(r)?{model:r,recoveredFromStorage:!0}:{model:e,recoveredFromStorage:!1}},ResourceEditorForm.prototype.canSubmit=function(){return this.initialState&&!this.state.submitting&&this.state.modelState===S.DataState.Ready&&g.readyToSubmit(this.state.model,S.FieldError.isPreventSubmit)},ResourceEditorForm.prototype.resetFormData=function(){var e=this.initialState;this.props.initializeModel&&(e={model:this.props.initializeModel(e.model),submitting:!1,recoveredFromStorage:!1}),this.resetStorage(),this.setState(e)},ResourceEditorForm.prototype.computePersistentId=function(){return this.getFormId()+":"+c.getCurrentResource().value},ResourceEditorForm.inputKind=T.InputKind.SemanticForm,ResourceEditorForm}(p.Component);function getSubject(e){var t=e.subject;return"string"==typeof t&&(t=d.Rdf.iri(t)),t||d.Rdf.iri("")}function getInvalidFields(e){return e.filter((function(e){return!e.insertPattern||!e.deletePattern}))}t.ResourceEditorForm=L,t.default=L},1827:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(43),i=r(1553);function isPlaceholderComposite(e){return i.FieldValue.isComposite(e)&&i.CompositeValue.isPlaceholder(e.subject)}t.isTriplestorePersistence=function isTriplestorePersistence(e){return e&&"object"==typeof e&&"function"==typeof e.persist},t.computeModelDiff=function computeModelDiff(e,t){var r=[];return collectCompositeDiff(isPlaceholderComposite(e)?i.FieldValue.empty:e,isPlaceholderComposite(t)?i.FieldValue.empty:t,r),r};var n=o.List();function collectCompositeDiff(e,t,r){if(i.FieldValue.isComposite(e)){if(i.CompositeValue.isPlaceholder(e.subject))throw new Error("Cannot compute diff with placeholder base composite");e.fields.forEach((function(o,a){var s=e.definitions.get(a),u=function getFieldValues(e,t){if(i.FieldValue.isEmpty(e))return n;var r=e.fields.get(t);return r?r.values:n}(t,a);collectFieldDiff(e.subject,s,o.values,u,r)}))}if(i.FieldValue.isComposite(t)){if(i.CompositeValue.isPlaceholder(t.subject))throw new Error("Cannot compute diff with placeholder changed composite");t.fields.forEach((function(o,a){if(i.FieldValue.isEmpty(e)||!e.fields.has(a)){var s=t.definitions.get(a);collectFieldDiff(t.subject,s,n,o.values,r)}}))}}function collectFieldDiff(e,t,r,o,n){var a=r.filterNot((function(e){return i.FieldValue.isAtomic(e)&&e.isForcedDefault})).map(i.FieldValue.asRdfNode).filter((function(e){return void 0!==e})).toSet(),s=o.map(i.FieldValue.asRdfNode).filter((function(e){return void 0!==e})).toSet(),u=a.subtract(s).toArray(),l=s.subtract(a).toArray();(u.length>0||l.length>0)&&n.push({subject:e,definition:t,deleted:u,inserted:l});var p=pickComposites(r),c=pickComposites(o);p.forEach((function(e,t){collectCompositeDiff(e,c.get(t)||i.FieldValue.empty,n)})),c.forEach((function(e,t){p.has(t)||collectCompositeDiff(i.FieldValue.empty,e,n)}))}function pickComposites(e){var t=new Map;return e.forEach((function(e){i.FieldValue.isComposite(e)&&!i.CompositeValue.isPlaceholder(e.subject)&&t.set(e.subject.value,e)})),t}},1950:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(61);t.parseQueryStringAsUpdateOperation=function parseQueryStringAsUpdateOperation(e){if(e){var t=o.SparqlUtil.parseQuery(e);if("update"===t.type)return t;throw new Error("Specified deletePattern or insertPattern is not an update query.")}},t.withNamedGraph=function withNamedGraph(e,t){return t&&e.updates.forEach((function(e){return e.graph=t})),e},t.addInsertIntoGraph=function addInsertIntoGraph(e,t){return e.updates.forEach((function(e){var r=e;"insertdelete"===r.updateType&&(r.insert=[{type:"graph",name:t,triples:r.insert[0].triples}])})),e}},1951:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(19),i=r(36),n=r(43),a=r(61),s=r(1553),u=r(1952),l=function(){function SparqlPersistence(e){void 0===e&&(e={}),this.config=e}return SparqlPersistence.prototype.persist=function(e,t){var r=this.config,s=r.repository,l=void 0===s?"default":s,p=r.targetGraphIri,c=r.targetInsertGraphIri,d=u.RawSparqlPersistence.createFormUpdateQueries(e,t,p,c),m=n.List(d).map(a.SparqlUtil.serializeQuery).flatten(),f=i.post("/form-persistence/sparql").type("application/json").query({repository:l}).send(m);return o.fromNodeCallback((function(e){return f.end((function(t,r){return e(t,r.body)}))})).toProperty()},SparqlPersistence.prototype.remove=function(e){return this.persist(e,s.FieldValue.empty)},SparqlPersistence}();t.SparqlPersistence=l},1952:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(43),i=r(19),n=r(61),a=r(1553),s=r(1950),u=r(1827),l=function(){function RawSparqlPersistence(e){void 0===e&&(e={}),this.config=e}return RawSparqlPersistence.prototype.persist=function(e,t){var r=RawSparqlPersistence.createFormUpdateQueries(e,t,this.config.targetGraphIri,this.config.targetInsertGraphIri);if(0===r.size)return i.constant(void 0);r.forEach((function(e){console.log(n.SparqlUtil.serializeQuery(e))}));var o=this.config.repository,a={repository:void 0===o?"default":o};return i.zip(r.map((function(e){return n.SparqlClient.executeSparqlUpdate(e,{context:a})})).toArray()).map((function(){})).toProperty()},RawSparqlPersistence.prototype.remove=function(e){return this.persist(e,a.FieldValue.empty)},RawSparqlPersistence.createFormUpdateQueries=function(e,t,r,i){var a=u.computeModelDiff(e,t);return o.List(a).filter((function(e){var t=e.definition;return Boolean(t.insertPattern&&t.deletePattern)})).map((function(e){var t=e.definition,a=e.subject,u=e.inserted,l=e.deleted,p=s.withNamedGraph(s.parseQueryStringAsUpdateOperation(t.deletePattern),r),c=s.parseQueryStringAsUpdateOperation(t.insertPattern);return function createFieldUpdateQueries(e,t,r,i,a){var s=o.List();if(0===a.length&&0===i.length)return s;var paramterize=function(t,r){return n.SparqlClient.setBindings(t,{subject:e,value:r})};t&&(s=s.concat(a.map((function(e){return paramterize(t,e)}))));r&&(s=s.concat(i.map((function(e){return paramterize(r,e)}))));return s}(a,p,i?s.addInsertIntoGraph(c,i):s.withNamedGraph(c,r),u,l)})).filter((function(e){return e.size>0})).flatten().toList()},RawSparqlPersistence}();t.RawSparqlPersistence=l},2227:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(11),n=r(1),a=r(35),s=r(19),u=r(34),l=r(116),p=r(327),c=r(1553),d=r(2228),m=r(1218);r(1358),function(e){e[e.None=0]="None",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed"}(o||(o={}));var f=function(e){function SemanticForm(t,r){var i=e.call(this,t,r)||this;return i.cancellation=new u.Cancellation,i.loadingState=o.None,i.updateModel=function(e){if(i.pendingModel=e(i.pendingModel),!c.FieldValue.isComposite(i.pendingModel))throw new Error("CompositeValue.updateValue returned non-composite");i.props.onChanged(i.pendingModel)},i.onCompositeMounted=function(e){i.input=e},i.handler=d.CompositeInput.makeHandler({definition:void 0,baseInputProps:{fields:i.props.fields||[],newSubjectTemplate:i.props.newSubjectTemplate,children:i.props.children}}),i}return i.__extends(SemanticForm,e),SemanticForm.prototype.componentDidMount=function(){this.pendingModel=this.props.model},SemanticForm.prototype.componentWillReceiveProps=function(e){e.model!==this.props.model&&(this.pendingModel=e.model)},SemanticForm.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticForm.prototype.componentDidUpdate=function(e){var t=this.input?this.input.dataState():c.DataState.Loading,r=!(this.props.model===e.model&&this.lastDataState===t);this.lastDataState=t,r&&(this.props.onUpdated&&this.props.onUpdated(t),this.props.debug&&console.log("["+o[this.loadingState]+"] "+c.DataState[t],asDebugJSObject(this.props.model)),this.loadingState===o.None&&t===c.DataState.Loading?(this.loadingState=o.Loading,this.props.debug&&console.log("[-> "+o[this.loadingState]+"]")):this.loadingState===o.Loading&&t===c.DataState.Ready&&c.FieldValue.isComposite(this.props.model)&&(this.loadingState=o.Completed,this.props.debug&&console.log("[-> "+o[this.loadingState]+"]"),this.props.onLoaded(this.props.model)))},SemanticForm.prototype.validate=function(e){var t=this.handler.validate(e);if(!c.FieldValue.isComposite(t))throw new Error("Expected to return either composite or empty value from CompositeInput.validate");return t},SemanticForm.prototype.finalize=function(e){return this.handler.finalize(e,c.FieldValue.empty).flatMap((function(e){return c.FieldValue.isComposite(e)?s.constant(e):s.constantError(new Error("Expected CompositeValue as finalize result"))})).toProperty()},SemanticForm.prototype.render=function(){if(c.FieldValue.isEmpty(this.props.model))return n.createElement(p.Spinner);var e=this.props.model.errors.some((function(e){return e.kind===c.ErrorKind.Configuration}));return a.div({className:"semantic-form"},n.createElement(d.CompositeInput,{ref:this.onCompositeMounted,handler:this.handler,fields:this.props.fields||[],newSubjectTemplate:this.props.newSubjectTemplate,dataState:c.DataState.Ready,updateValue:this.updateModel,value:this.props.model,children:e?n.createElement(l.ErrorNotification,{title:"Errors in form configuration"},n.createElement(m.FormErrors,{model:this.props.model})):this.props.children}),this.props.debug?a.pre({},JSON.stringify(asDebugJSObject(this.props.model),null,2)):null)},SemanticForm}(n.Component);function asDebugJSObject(e){switch(e.type){case c.EmptyValue.type:return{type:c.EmptyValue.type};case c.AtomicValue.type:return{type:c.AtomicValue.type,value:e.value.toString(),label:e.label,errors:e.errors.toArray()};case c.CompositeValue.type:return{type:c.CompositeValue.type,subject:e.subject.toString(),fields:e.fields.map((function(e){return{values:e.values.map(asDebugJSObject).toArray(),errors:e.errors.toArray()}})).toObject()}}}t.SemanticForm=f,t.default=n.createFactory(f)},2228:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(11);o.__exportStar(r(1619),t),o.__exportStar(r(1631),t),o.__exportStar(r(2226),t),o.__exportStar(r(1217),t);var i=r(1228);t.AutocompleteInput=i.AutocompleteInput,t.AutocompleteInputProps=i.AutocompleteInputProps;var n=r(1229);t.CheckboxInput=n.CheckboxInput,t.CheckboxInputProps=n.CheckboxInputProps;var a=r(1253);t.ChecklistInput=a.ChecklistInput,t.ChecklistInputProps=a.ChecklistInputProps,t.ChecklistType=a.ChecklistType;var s=r(1230);t.DatePickerInput=s.DatePickerInput,t.DatePickerInputProps=s.DatePickerInputProps,t.DatePickerMode=s.DatePickerMode;var u=r(1254);t.FormSwitch=u.FormSwitch,t.FormSwitchProps=u.FormSwitchProps;var l=r(1231);t.FormSwitchCase=l.FormSwitchCase,t.FormSwitchCaseProps=l.FormSwitchCaseProps;var p=r(1232);t.HiddenInput=p.HiddenInput,t.HiddenInputProps=p.HiddenInputProps;var c=r(1233);t.PlainTextInput=c.PlainTextInput,t.PlainTextInputProps=c.PlainTextInputProps;var d=r(1234);t.SelectInput=d.SelectInput,t.SelectInputProps=d.SelectInputProps;var m=r(1235);t.TreePickerInput=m.TreePickerInput,t.TreePickerInputProps=m.TreePickerInputProps},2232:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(43),i=r(23),n=r(1553);function computeValuePatch(e,t){if(n.FieldValue.isEmpty(t))return null;if(e.type!==t.type)return asPatch(t);switch(e.type){case n.AtomicValue.type:var r=t;return e.value.equals(r.value)&&e.label===r.label?null:asPatch(r);case n.CompositeValue.type:return function computeCompositePatch(e,t){if(!equalRdfTerms(e.discriminator,t.discriminator))return asPatch(t);var r={},o={},a=!1,visit=function(e,t,i){if(!r[e])if(r[e]=!0,!t&&i){var s=i.values.map(asPatch).toArray();o[e]={baseLength:s.length,values:s},a=!0}else if(t&&i){var u=function computeFieldPatch(e,t){var r=t.values.map((function(t,r){return computeValuePatch(e.values.get(r,n.FieldValue.empty),t)})).toArray();return{baseLength:e.values.size,values:r}}(t,i);u.values.some((function(e){return null!==e}))&&(o[e]=u,a=!0)}};return e.fields.forEach((function(e,r){return visit(r,e,t.fields.get(r))})),t.fields.forEach((function(t,r){return visit(r,e.fields.get(r),t)})),a?{type:n.CompositeValue.type,subject:i.turtle.serialize.nodeToN3(t.subject),fields:o}:null}(e,t)}n.FieldValue.unknownFieldType(e)}function equalRdfTerms(e,t){return e?t?e.equals(t):!e:!t}function asPatch(e){switch(e.type){case n.EmptyValue.type:return null;case n.AtomicValue.type:return{type:n.AtomicValue.type,value:i.turtle.serialize.nodeToN3(e.value),label:e.label};case n.CompositeValue.type:return{type:n.CompositeValue.type,subject:i.turtle.serialize.nodeToN3(e.subject),discriminator:e.discriminator?i.turtle.serialize.nodeToN3(e.discriminator):void 0,fields:e.fields.map((function(e){var t=e.values.map(asPatch).toArray();return{baseLength:t.length,values:t}})).toObject()}}n.FieldValue.unknownFieldType(e)}function applyValuePatch(e,t){if(!t)return e;switch(e.type){case n.EmptyValue.type:var r=asValue(t);return n.FieldValue.isComposite(r)?n.CompositeValue.set(r,{subject:i.Rdf.iri("")}):r;case n.AtomicValue.type:if(t.type===n.AtomicValue.type)return asValue(t);break;case n.CompositeValue.type:if(t.type===n.CompositeValue.type)return function applyCompositePatch(e,t){var r=t.discriminator?tryDeserializeN3(t.discriminator):void 0;if(!equalRdfTerms(e.discriminator,r))return asValue(t);if(!t.fields)return e;var i=e.fields.map((function(e,r){var i=t.fields[r];return i?function applyFieldPatch(e,t){if(!Array.isArray(t.values))return e;var r=t.values.map((function(t,r){var o=e.values.get(r,n.FieldValue.empty);return t?applyValuePatch(o,t):o}));return n.FieldState.set(e,{values:o.List(r)})}(e,i):e})).toMap();return n.CompositeValue.set(e,{fields:i})}(e,t)}return e}function asValue(e){switch(e.type){case n.AtomicValue.type:var t=tryDeserializeN3(e.value);if(t&&(t.isLiteral()||t.isIri())&&(void 0===e.label||"string"==typeof e.label))return{type:n.AtomicValue.type,value:t,label:e.label,errors:n.FieldError.noErrors};break;case n.CompositeValue.type:var r=tryDeserializeN3(e.subject);if(r&&r instanceof i.Rdf.Iri){var a=Object.keys(e.fields).map((function(t){var r=e.fields[t],i=r&&Array.isArray(r.values)?r.values.map((function(e){return e?asValue(e):n.FieldValue.empty})):[];return[t,{values:o.List(i),errors:n.FieldError.noErrors}]})),s=e.discriminator?tryDeserializeN3(e.discriminator):void 0;return{type:n.CompositeValue.type,definitions:o.Map(),subject:r,discriminator:s,fields:o.Map(a),errors:n.FieldError.noErrors}}}return n.FieldValue.empty}function tryDeserializeN3(e){try{return i.turtle.deserialize.n3ValueToRdf(e)}catch(t){return void console.warn("Encountered invalid N3 value while applying form patch",e)}}t.computeValuePatch=computeValuePatch,t.applyValuePatch=applyValuePatch},2233:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=r(43),i=r(19),n=r(16),a=r(34),s=r(36),u=r(61),l=r(118),p=r(216),c=r(1553),d=r(1950),m=r(1827),f=function(){function LdpPersistence(e){void 0===e&&(e={}),this.config=e}return LdpPersistence.prototype.persist=function(e,t){if(c.FieldValue.isEmpty(t))return c.FieldValue.isEmpty(e)||c.CompositeValue.isPlaceholder(e.subject)?i.constant(void 0):this.deleteSubjectContainer(e.subject);var r=m.computeModelDiff(c.FieldValue.empty,t);return this.persistModelUpdates(t.subject,r)},LdpPersistence.prototype.remove=function(e){return new l.LdpService(p.VocabPlatform.FormContainer.value,this.config).deleteResource(e.subject)},LdpPersistence.prototype.persistModelUpdates=function(e,t){var r=this.createFormConstructQueries(t);return this.sendConstructsToBackend(e,r.toArray())},LdpPersistence.prototype.createFormConstructQueries=function(e){var t=this;return o.List(e.filter((function(e){return e.definition.insertPattern})).map((function(e){var r=d.parseQueryStringAsUpdateOperation(e.definition.insertPattern);return t.createFieldConstructQueries(r,e.inserted,e.subject)}))).filter((function(e){return e.size>0})).flatten().toList()},LdpPersistence.prototype.createFieldConstructQueries=function(e,t,r){var i=o.List();if(!e)return i;var a={type:"query",prefixes:{},queryType:"CONSTRUCT"},s=e.updates;if(1!==s.length)return i;var l=s.pop();a.template=l.insert.filter((function(e){return"bgp"===e.type})).reduce((function(e,t){return e.concat(n.cloneDeep(t).triples)}),new Array),a.where=n.cloneDeep(l.where);return a&&(i=i.concat(t.map((function(e){return function(e,t){return u.SparqlClient.setBindings(e,{subject:r,value:t})}(a,e)})))),i},LdpPersistence.prototype.sendConstructsToBackend=function(e,t){var r=t.map(u.SparqlUtil.serializeQuery),o=s.post("/form-persistence/ldp").type("application/json").query({iri:this.getTargetLdpResource(e),repository:this.getTargetRepository()}).send(r);return a.requestAsProperty(o).map((function(){}))},LdpPersistence.prototype.deleteSubjectContainer=function(e){var t=s.delete("/form-persistence/ldp").type("application/json").query({iri:this.getTargetLdpResource(e),repository:this.getTargetRepository()}).send();return a.requestAsProperty(t).map((function(){}))},LdpPersistence.prototype.getTargetLdpResource=function(e){var t=this.config.containerIri;return t||e.value+"/container"},LdpPersistence.prototype.getTargetRepository=function(){var e=this.config.repository;return void 0===e?"default":e},LdpPersistence}();t.LdpPersistence=f}}]);
//# sourceMappingURL=semantic-form-d984833e26919348bd17.js.map