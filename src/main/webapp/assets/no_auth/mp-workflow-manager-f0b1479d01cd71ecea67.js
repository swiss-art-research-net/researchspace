(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{1295:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(11),r=n(1),i=n(1559),s=n(19),l=n(34),u=n(56),f=n(23),c=n(1294),p=n(116),w=n(327),d=n(1473);!function(e){e[e.Loading=0]="Loading",e[e.Updating=1]="Updating",e[e.Ready=2]="Ready"}(a||(a={}));var g=function(e){function WorkflowManagerComponent(t,n){var o=e.call(this,t,n)||this;return o.cancellation=new l.Cancellation,o.loadingCancellation=o.cancellation.derive(),o.assigneeQueryingCancellation=o.cancellation.derive(),o.originalWorkflowGraphs=new Map,o.initialWorkflowState=c.WorkflowState.empty,o.workflowService=new c.WorkflowService,o.onSubmit=function(){o.setState({status:a.Updating});var e=o.props.iris.map((function(e){var t=o.state.workflowState,n=o.originalWorkflowGraphs.get(e);return o.workflowService.updateWorkflowInstantiation({workflowIri:f.Rdf.iri(e),originalGraph:n,workflowState:t})}));o.cancellation.map(s.zip(e)).observe({value:function(){o.setState({status:a.Ready}),p.addNotification({level:"success",message:"The workflow instantiations has been updated."}),o.fetchWorkflowInstantiations(o.props)},error:function(e){console.error(e),o.setState({status:a.Ready}),p.addNotification({level:"error",message:"Error occurred while updating the workflow instantiations."})}})},o.state={workflowState:c.WorkflowState.empty,steps:[],assignees:[],status:a.Ready},o}return o.__extends(WorkflowManagerComponent,e),WorkflowManagerComponent.prototype.componentDidMount=function(){this.fetchWorkflowInstantiations(this.props)},WorkflowManagerComponent.prototype.componentWillReceiveProps=function(e){this.props!==e&&(this.loadingCancellation.cancelAll(),this.initialWorkflowState=c.WorkflowState.empty,this.originalWorkflowGraphs.clear(),this.setState({workflowState:c.WorkflowState.empty,steps:[],assignees:[],status:a.Ready}),this.fetchWorkflowInstantiations(e))},WorkflowManagerComponent.prototype.componentDidUpdate=function(e,t){var n=this.state,a=n.workflowState,r=n.assignees;a.step&&!a.step.equals(t.workflowState.step)&&this.updateAssignees(),r!==t.assignees&&this.setState((function(e){var t=e.workflowState,n=e.assignees.find((function(e){return e.iri.equals(t.assignee)}));return{workflowState:o.__assign(o.__assign({},t),{assignee:n?n.iri:void 0})}}))},WorkflowManagerComponent.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},WorkflowManagerComponent.prototype.fetchWorkflowInstantiations=function(e){var t=this,n=e.iris,o=e.definition;if(n.length){this.setState({status:a.Loading});var r=n.map((function(e){return t.workflowService.queryWorkflowInstantiation(e).map((function(n){return t.originalWorkflowGraphs.set(e,n),t.workflowService.deserializeWorkflowState(f.Rdf.iri(e),n)}))})),i=s.zip(r).flatMap((function(e){var n=1===e.length?e[0]:c.WorkflowState.empty;return t.initialWorkflowState=n,t.workflowService.queryWorkflowSteps({definition:o,currentStep:n.step}).map((function(e){return{steps:e,workflowState:n}}))}));this.loadingCancellation=this.cancellation.deriveAndCancel(this.loadingCancellation),this.loadingCancellation.map(i).observe({value:function(e){var n=e.steps,o=e.workflowState;return t.setState({workflowState:o,steps:n,error:void 0,status:a.Ready})},error:function(e){return t.setState({error:e,status:a.Ready})}})}},WorkflowManagerComponent.prototype.updateAssignees=function(){var e=this;this.setState({status:a.Loading});var t=this.state,n=t.workflowState,o=t.steps.find((function(e){return e.iri.equals(n.step)})),r=o?o.assigneeQuery:void 0;r?(this.assigneeQueryingCancellation=this.cancellation.deriveAndCancel(this.assigneeQueryingCancellation),this.assigneeQueryingCancellation.map(this.workflowService.queryWorkflowAssignees({query:r,newStep:n.step,workflowInstantiations:this.props.iris.map(f.Rdf.iri)})).observe({value:function(t){return e.setState({assignees:t,status:a.Ready})},error:function(t){return e.setState({error:t,status:a.Ready})}})):this.setState({assignees:[],status:a.Ready})},WorkflowManagerComponent.prototype.renderStepSelect=function(){var e=this,t=this.state,n=t.workflowState.step,s=t.steps,l=t.status,u=s.map((function(e){var t=e.iri,n=e.label;return{value:t.value,label:n}}));return r.createElement("div",{className:d.state},r.createElement("label",null,"Step"),r.createElement(i.default,{value:n?n.value:"",options:u,onChange:function(t){return e.setState((function(e){var n=t?f.Rdf.iri(t.value):void 0;return{workflowState:o.__assign(o.__assign({},e.workflowState),{step:n})}}))},disabled:this.props.readonly||l!==a.Ready}))},WorkflowManagerComponent.prototype.renderAssigneeSelect=function(){var e=this,t=this.state,n=t.workflowState.assignee,s=t.assignees,l=t.status,u=s.map((function(e){var t=e.iri,n=e.label;return{value:t.value,label:n}}));return r.createElement("div",{className:d.assignee},r.createElement("label",null,"Assignee"),r.createElement(i.default,{value:n?n.value:"",options:u,onChange:function(t){return e.setState((function(e){var n=t?f.Rdf.iri(t.value):void 0;return{workflowState:o.__assign(o.__assign({},e.workflowState),{assignee:n})}}))},disabled:this.props.readonly||l!==a.Ready}))},WorkflowManagerComponent.prototype.render=function(){var e=this,t=this.state,n=t.workflowState,o=t.error,i=t.status;if(o)return r.createElement(p.ErrorNotification,{errorMessage:o});var s=!c.WorkflowState.isEqual(this.initialWorkflowState,n);return r.createElement("div",{className:d.workflow},this.renderStepSelect(),this.renderAssigneeSelect(),this.props.readonly?null:r.createElement("button",{type:"button",className:"btn btn-success "+d.submitButton,disabled:!n.step||!s||i!==a.Ready,onClick:this.onSubmit},"Assign"),!this.props.readonly&&s?r.createElement("button",{type:"button",className:"btn text-danger "+d.resetButton,onClick:function(){return e.setState({workflowState:e.initialWorkflowState})},disabled:i!==a.Ready},r.createElement("small",null,r.createElement("i",{className:"fa fa-times"})," reset")):null,i===a.Loading?r.createElement(w.Spinner,{className:d.spinner}):null)},WorkflowManagerComponent}(u.Component);t.WorkflowManagerComponent=g,t.default=g}}]);
//# sourceMappingURL=mp-workflow-manager-f0b1479d01cd71ecea67.js.map