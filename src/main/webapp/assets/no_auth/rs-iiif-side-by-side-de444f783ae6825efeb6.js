(window.webpackJsonp=window.webpackJsonp||[]).push([[318],{1299:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var i=n(11),o=n(1),r=n(35),a=n(16),d=n(19),s=n(33),u=n(56),p=n(23),m=n(116),c=n(327),f=n(1847),l=n(1846),h=n(2337),g=n(1699),S=n(2339),y=n(2340),v=function(t){function SideBySideComparison(e,n){var i=t.call(this,e,n)||this;return i.requests=d.pool(),i.miradorElementId=a.uniqueId("mirador_"),i.state={loading:!0},i.requests.flatMapLatest((function(t){return t.isJust?i.loadMiradorConfig(t.get()):d.never()})).onValue((function(t){var e=t.imagesMetadata,n=t.miradorConfig;return i.setState({loading:!1,imagesMetadata:e,miradorConfig:n})})).onError((function(t){return i.setState({loading:!1,error:t})})),i}return i.__extends(SideBySideComparison,t),SideBySideComparison.prototype.loadMiradorConfig=function(t){var e=this;return this.gatherImageMetadata(t).map((function(t){return{imagesMetadata:t,miradorConfig:e.createMiradorConfig(t)}}))},SideBySideComparison.prototype.gatherImageMetadata=function(t){var e=t.repositories,n=l.getIIIFServerUrl(t.iiifServerUrl),i=t.selection.map((function(t){return"string"==typeof t?p.Rdf.iri(t):t})).map((function(i){return f.queryIIIFImageOrRegion(i,t.imageIdPattern,e).flatMap((function(t){var e=l.constructServiceRequestUri(n,t.imageId);return l.queryImageBounds(n,t.imageId).flatMap((function(n){return g.LdpRegionService.search(t.imageIRI).flatMap((function(i){return h.createManifest([{baseIri:t.iri,imageIri:t.imageIRI,imageServiceUri:e,canvasSize:n}]).map((function(e){return{manifest:e,imageInfo:t,annotations:i}}))}))}))}))}));return d.zip(i)},SideBySideComparison.prototype.createMiradorConfig=function(t){var e=a.keyBy(t,(function(t){return t.imageInfo.iri.value})),n=new I(e);return{id:this.miradorElementId,layout:chooseMiradorLayout(t.length),saveSession:!1,data:t.map((function(t){return{manifestUri:t.manifest["@id"],location:"",manifestContent:t.manifest}})),annotationEndpoint:{name:"ResearchSpace annotation endpoint",module:"AdapterAnnotationEndpoint",options:{endpoint:n}},windowObjects:t.map((function(t){return{loadedManifest:t.manifest["@id"],viewType:"ImageView",sidePanel:!1,canvasControls:{annotations:{annotationState:"on",annotationCreation:!0}}}})),annotationBodyEditor:{module:"researchspaceAnnotationBodyEditor",options:{}},jsonStorageEndpoint:{name:"Dummy JSON Storage",module:"DummyJSONStorage",options:{}}}},SideBySideComparison.prototype.componentDidMount=function(){this.requests.plug(d.constant(s.Just(this.props)))},SideBySideComparison.prototype.componentWillUnmount=function(){this.requests.plug(d.constant(s.Nothing())),y.removeMirador(this.miradorInstance,this.miradorElement)},SideBySideComparison.prototype.shouldComponentUpdate=function(t,e){return e.loading!==this.state.loading||!a.isEqual(t,this.props)},SideBySideComparison.prototype.render=function(){return r.div({style:{position:"relative",width:"100%",height:"100%"}},this.renderContent())},SideBySideComparison.prototype.renderContent=function(){var t=this;return this.state.loading?o.createElement(c.Spinner):this.state.error?o.createElement(m.ErrorNotification,{errorMessage:this.state.error}):r.div({ref:function(e){t.miradorElement=e,t.renderMirador(e)},id:this.miradorElementId,className:"mirador",style:{width:"100%",height:"100%",position:"relative"}})},SideBySideComparison.prototype.renderMirador=function(t){var e=this;this.state&&this.state.miradorConfig&&t&&(y.removeMirador(this.miradorInstance,t),this.miradorInstance=y.renderMirador({targetElement:t,miradorConfig:this.state.miradorConfig,onInitialized:function(t){y.scrollToRegions(t,(function(t){var n=t.index;return e.state.imagesMetadata[n].imageInfo.viewport}))}}))},SideBySideComparison.defaultProps={repositories:["default"]},SideBySideComparison}(u.Component);function chooseMiradorLayout(t){var e={type:"column"};if(t<=1)return e;var n=Math.max(1,Math.floor(Math.sqrt(t))),i=Math.ceil(t/n),o=t-i*(n-1);e.children=[];for(var r=0;r<n;r++){var a={type:"row",children:[]};e.children.push(a);for(var d=r===n-1?o:i,s=0;s<d;s++)a.children.push({type:"column"})}return e}e.SideBySideComparison=v,e.chooseMiradorLayout=chooseMiradorLayout;var I=function(t){function SideBySideAnnotationEndpoint(e){var n=t.call(this,{})||this;return n.metadataByIri=e,n}return i.__extends(SideBySideAnnotationEndpoint,t),SideBySideAnnotationEndpoint.prototype.search=function(t){var e=this.metadataByIri[t.value];return e&&e.imageInfo.isRegion?d.constant(e.annotations.filter((function(e){return e["@id"]===t.value}))):d.constant(e.annotations)},SideBySideAnnotationEndpoint}(S.LdpAnnotationEndpoint);e.c=v,e.f=o.createFactory(e.c),e.default=e.c}}]);
//# sourceMappingURL=rs-iiif-side-by-side-de444f783ae6825efeb6.js.map