(window.webpackJsonp=window.webpackJsonp||[]).push([[356],{1417:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),o=a(19),i=a(16);a(645),a(1260),a(643),a(644),a(1261),a(642),a(3025),a(1272),a(1418),a(336),a(646),a(662),a(647),a(663),a(648);var r,s=a(1),l=a(35),p=a(3026),c=a(72),u=a(664),d=a(63),g=a(23),m=a(331),v=a(633),h=a(2243),S=a(117),b=a(214),y=a(636),f=a(142),E=a(116),C=s.createFactory(c.Button),k=s.createFactory(c.ButtonToolbar),A=s.createFactory(c.ButtonGroup);!function(e){e[e.HTMLMIXED=0]="HTMLMIXED",e[e.MPHHANDLEBARS=1]="MPHHANDLEBARS",e[e.HANDLEBARS=2]="HANDLEBARS",e[e.NONE=3]="NONE"}(r||(r={}));var x=b.BrowserPersistence.adapter(),T=function(e){function PageEditorComponent(t,a){var c=e.call(this,t,a)||this;c.isDeleteBtnDisabled=function(){var e=c.state,t=e.saving,a=e.storageStatus,n=e.pageSource;return t||!n.appId||!a.some((function(e){return e.appId===n.appId&&e.writable}))},c.onEditorDidMount=function(e){c.editor=e},c.onClickDeleteBtn=function(){c.navigationListenerUnsubscribe&&c.navigationListenerUnsubscribe(),c.pageInfo=[{appId:c.state.pageSource.appId,iri:c.props.iri.value,revision:c.state.pageSource.revision}];var onHide=function(){return S.getOverlaySystem().hide("deletion-confirmation")},e={message:"Do you really want to delete this template?",onHide,onConfirm:function(e){onHide(),e&&c.deletePage()}};S.getOverlaySystem().show("deletion-confirmation",s.createElement(y.ConfirmationDialog,e))},c.deletePage=function(){m.PageService.deleteTemplateRevisions(c.pageInfo).observe({value:function(e){e&&d.navigateToUrl(f("/")).observe({})},error:function(e){c.setState({loading:!0});S.getOverlaySystem().show("page-saving-error",s.createElement(S.OverlayDialog,{onHide:function(){S.getOverlaySystem().hide("page-saving-error"),c.setState({saving:!1})},type:"modal",title:"Error while deleting the page",show:!0},l.div({}),l.div({},s.createElement(E.ErrorPresenter,{error:e})),C({bsStyle:"success",className:"pull-right",onClick:function(){S.getOverlaySystem().hide("page-saving-error"),c.setState({saving:!1})}},"Ok")))}})},c.loadPageSource=function(e){c.setState({loading:!0});var t=m.PageService.loadTemplateSource(e);t.onError((function(e){403===e&&(window.location.href="/login")})),o.combine({pageSource:t,storageStatus:m.PageService.getStorageStatus()}).observe({value:function(e){var t=e.pageSource,a=e.storageStatus,n=h.chooseDefaultTargetApp(a,t.appId);c.setState({pageSource:t,storageStatus:a,targetApp:n,saving:!1,loading:!1},(function(){c.editor.focus()}))}})},c.onPageContentChange=function(e,t,a){c.navigationListenerUnsubscribe||(c.navigationListenerUnsubscribe=d.navigationConfirmation("Changes you made to the page will not be saved."))},c.onSave=function(e){void 0===e&&(e={}),c.navigationListenerUnsubscribe&&c.navigationListenerUnsubscribe();var t=c.state,a=t.pageSource,n=t.targetApp;c.setState({saving:!0}),m.PageService.save({iri:c.props.iri.value,targetAppId:n,sourceAppId:"string"==typeof a.appId?a.appId:void 0,sourceRevision:"string"==typeof a.revision?a.revision:void 0,rawContent:c.editor.getValue()}).onValue((function(t){c.setState({saving:!1}),d.navigateToResource(c.props.iri,e).onValue((function(e){return e}))})).onError((function(e){S.getOverlaySystem().show("page-saving-error",s.createElement(S.OverlayDialog,{onHide:function(){S.getOverlaySystem().hide("page-saving-error"),c.setState({saving:!1})},type:"modal",title:"Error while saving the page",show:!0},l.div({}),[l.div({},e),C({bsStyle:"success",className:"pull-right",onClick:function(){S.getOverlaySystem().hide("page-saving-error"),c.setState({saving:!1})}},"Ok")]))}))},c.onCancel=function(){d.navigateToResource(c.props.iri).onValue((function(e){return e}))},c.getSyntaxChoices=function(){return s.createElement(p.RadioGroup,{name:"syntaxType",selectedValue:c.state.activeSyntax,onChange:c.onSyntaxChange},l.div({className:"template-types"},"Syntax highlight: ",i.reduce(c.radioGroupEntries,(function(e,t){return e.push(l.label({key:t.label,style:{marginRight:"10px"}},s.createElement(p.Radio,{value:t.type,title:t.label}),t.label)),e}),new Array)))},c.onSyntaxChange=function(e){c.editor.setOption("mode",c.getSyntaxMode(e)),x.update("mp-internal-page-editor",{activeSyntax:e}),c.setState({activeSyntax:e})},c.getSyntaxMode=function(e){var t;switch(e){case r.HTMLMIXED:t={name:"mph-handlebars",base:"text/html"};break;case r.MPHHANDLEBARS:t={name:"mph-handlebars-tags"};break;case r.HANDLEBARS:t={name:"handlebars"};break;case r.NONE:t={name:"null"}}return t},c.applicableTemplateLinks=function(e,t){return 0===e.length?l.span({}):k.apply(void 0,n.__spreadArrays([{},A({},"Applicable Templates:")],i.map(e,(function(e){return A(t===e?{style:{backgroundColor:"#FFC857"},title:"This template will currently be applied."}:{},s.createElement(v.ResourceLink,{resource:g.Rdf.iri(e),action:v.ResourceLinkAction.edit},e))}))))};var u=x.get("mp-internal-page-editor").activeSyntax;return c.state={pageSource:{appId:void 0,revision:void 0,source:"",definedByApps:[],applicableTemplates:[],appliedTemplate:void 0,includes:[]},storageStatus:[],saving:!1,loading:!1,activeSyntax:void 0!==u?u:r.HTMLMIXED},c.radioGroupEntries=[{type:r.HTMLMIXED,label:"Mixed HTML"},{type:r.MPHHANDLEBARS,label:"Backend Templates"},{type:r.HANDLEBARS,label:"Client Templates"},{type:r.NONE,label:"None"}],c}return n.__extends(PageEditorComponent,e),PageEditorComponent.prototype.componentWillUnmount=function(){this.navigationListenerUnsubscribe&&this.navigationListenerUnsubscribe()},PageEditorComponent.prototype.componentDidMount=function(){this.loadPageSource(this.props.iri.value)},PageEditorComponent.prototype.componentWillReceiveProps=function(e){this.loadPageSource(e.iri.value)},PageEditorComponent.prototype.render=function(){var e=this,t={foldGutter:this.state.activeSyntax!==r.NONE,textAreaClassName:["form-control"],matchTags:{bothTags:!0},matchBrackets:!0};return l.div({className:"page-editor"},l.div({className:"page-breadcrumb"}),l.div({className:"page"},l.div({className:"page__body"},this.includeLinks(this.state.pageSource.includes),this.state.pageSource.source||0!==this.state.pageSource.source.length?k({},A({},"Applicable Templates: This resource does already have a direct corresponding page and as such no templates will be applied.")):this.applicableTemplateLinks(this.state.pageSource.applicableTemplates,this.state.pageSource.appliedTemplate),this.isTemplateApplied(this.props.iri,this.state.pageSource)?k({},A({},["None of the computed templates is used. The system's default template ",s.createElement(v.ResourceLink,{key:"def",resource:g.Rdf.iri("Template:"+g.vocabularies.rdfs.Resource.value),style:{backgroundColor:"#FFC857"}},"Template:rdfs:Resource")," has been applied."])):null,this.renderAppSelector(),s.createElement(u.UnControlled,{className:"template-editor",editorDidMount:this.onEditorDidMount,value:this.state.pageSource.source,onChange:this.onPageContentChange,options:n.__assign(n.__assign({},t),{mode:this.getSyntaxMode(this.state.activeSyntax),indentWithTabs:!1,indentUnit:2,tabSize:2,viewportMargin:1/0,lineNumbers:!0,lineWrapping:!0,gutters:this.state.activeSyntax!==r.NONE?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:["CodeMirror-linenumbers"],extraKeys:{"Ctrl-S":function(){return e.onSave()},"Cmd-S":function(){return e.onSave()}}})}),this.getSyntaxChoices(),k({className:"pull-right template-cancel-save"},C({bsStyle:"default",disabled:this.state.saving,onClick:this.onCancel},"Cancel"),C({bsStyle:"danger",disabled:this.isDeleteBtnDisabled(),onClick:this.onClickDeleteBtn},"Delete Page"),C({bsStyle:"primary",onClick:function(){return e.onSave()},disabled:this.state.saving},this.state.saving?l.span({},"Saving",l.i({className:"fa fa-cog fa-spin"})):"Save & View"),C({bsStyle:"success",onClick:function(){return e.onSave({action:v.ResourceLinkAction[v.ResourceLinkAction.edit]})},disabled:this.state.saving},"Save")))))},PageEditorComponent.prototype.isTemplateApplied=function(e,t){return!e.value.startsWith("Template:")&&-1===t.applicableTemplates.indexOf(t.appliedTemplate)&&t.appliedTemplate==="Template:"+g.vocabularies.rdfs.Resource.value},PageEditorComponent.prototype.renderAppSelector=function(){var e=this,t=this.state,a=t.storageStatus,n=t.pageSource,o=t.targetApp;return s.createElement(h.StorageSelector,{className:"page-editor__app-selector",allApps:a,sourceApps:n.definedByApps,targetApp:o,onChange:function(t){return e.setState({targetApp:t})}})},PageEditorComponent.prototype.includeLinks=function(e){return 0===e.length?null:k.apply(void 0,n.__spreadArrays([{},A({},"Includes:")],i.map(e,(function(e){return A({},s.createElement(v.ResourceLink,{resource:g.Rdf.iri(e["@id"]),action:v.ResourceLinkAction.edit},e["@id"]))}))))},PageEditorComponent}(s.Component);t.PageEditor=s.createFactory(T),t.default=T},3025:function(e,t,a){!function(e){"use strict";e.defineSimpleMode("mph-handlebars-tags",{start:[{regex:/\[\[!--/,push:"dash_comment",token:"comment"},{regex:/\[\[!/,push:"comment",token:"comment"},{regex:/\[\[/,push:"handlebars",token:"tag"}],handlebars:[{regex:/\]\]/,pop:!0,token:"tag"},{regex:/"(?:[^\\]|\\.)*?"/,token:"string"},{regex:/'(?:[^\\]|\\.)*?'/,token:"string"},{regex:/>|[#\/]([A-Za-z_]\w*)/,token:"keyword"},{regex:/(?:else|this)\b/,token:"keyword"},{regex:/\d+/i,token:"number"},{regex:/=|~|@|true|false/,token:"atom"},{regex:/(?:\.\.\/)*(?:[A-Za-z_][\w\.]*)+/,token:"variable-2"}],dash_comment:[{regex:/--\]\]/,pop:!0,token:"comment"},{regex:/./,token:"comment"}],comment:[{regex:/\]\]/,pop:!0,token:"comment"},{regex:/./,token:"comment"}]}),e.defineMode("mph-handlebars",(function(t,a){var n=e.getMode(t,"mph-handlebars-tags");return a&&a.base?e.multiplexingMode(e.multiplexingMode(e.getMode(t,a.base),{open:"[[",close:"]]",mode:n,parseDelimiters:!0}),{open:"query='",close:"'",mode:e.getMode(t,"application/sparql-query")}):handlebars})),e.defineMIME("text/x-handlebars-template","handlebars")}(a(28),a(643),a(644),a(1262))}}]);
//# sourceMappingURL=mp-internal-page-editor-4a4e746ab36fa9a2d7ed.js.map