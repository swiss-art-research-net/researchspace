(window.webpackJsonp=window.webpackJsonp||[]).push([[383],{1447:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=r(1),s=r(1),o=r(20),l=r(33),i=r(72),u=r(3133),c=r(16),p=r(61),y=r(63),d=r(56),g=r(34),h=r(216),m=r(122),S=r(121),f=r(1238),E=r(117),v=r(631),b=r(636),x=r(3150),q=r(3151),C=r(2235),Q=r(1221),w=r(1450);r(1451);var P=function(e){function SparqlQueryEditor(t,r){var a=e.call(this,t,r)||this;return a.cancellation=new g.Cancellation,a.executeQuery=function(e){a.setState({isExecuting:!0});try{var t=p.SparqlUtil.parseQuery(e);switch(a.addRecentQueries(e),t.type){case"query":a.sendSparqlQuery(t,t.queryType);break;case"update":a.confirmAndExecuteSparqlUpdate(t)}}catch(e){var r=c.startsWith(e.message,"Parse error")?"Query Syntax Error. "+e.message:e.message;a.setState({isExecuting:!1,alertState:l.Just({alert:v.AlertType.DANGER,message:r})})}},a.sendSparqlQuery=function(e,t){p.SparqlClient.sparqlQuery(e,p.SparqlClient.stringToSparqlQueryForm[t],a.getQueryContext()).onAny((function(e){if("value"===e.type)a.yasr.setResponse(e.value),a.setState({alertState:l.Nothing(),isExecuting:!1});else if("error"===e.type){var t=e;a.setState({isExecuting:!1,alertState:l.Just({alert:v.AlertType.DANGER,message:t.value.statusText?t.value.statusText:t.value.message})})}}))},a.executeSparqlUpdate=function(e){p.SparqlClient.executeSparqlUpdate(e,a.getQueryContext()).onValue((function(e){a.setState({alertState:l.Nothing(),isExecuting:!1}),a.yasr.setResponse("SPARQL Update Operation executed!")})).onError((function(e){a.setState({isExecuting:!1,alertState:l.Just({alert:v.AlertType.DANGER,message:e.message})})}))},a.getQueryContext=function(){var e=a.state.selectedRepository?{repository:a.state.selectedRepository}:void 0;return{context:n.__assign(n.__assign({},a.context.semanticContext),e)}},a.addRecentQueries=function(e){var t=a.state.selectedRepository||void 0;a.context.queryEditorContext.setQuery(e,{repository:t})},a.state={isExecuting:!1,alertState:l.Nothing(),selectedRepository:y.getCurrentUrl().search(!0).repository},a}return n.__extends(SparqlQueryEditor,e),SparqlQueryEditor.prototype.render=function(){var e=this;return a.createElement(i.Row,{className:w.sparqlQueryEditor},a.createElement(i.Col,{componentClass:"div",md:12},a.createElement(C.SparqlEditor,{ref:function(t){return e.editor=t},backdrop:this.state.isExecuting,query:this.state.query,onChange:function(t){e.context.queryEditorContext.setQuery(t.value,{silent:!0}),e.setState({query:t.value})},autocompleters:["variables","prefixes"],persistent:function(){return"sparqlEndpoint"}}),this.state.alertState.map((function(e){return s.createElement(v.Alert,e)})).getOrElse(null),a.createElement("div",{className:"form-inline "+w.controls},a.createElement(f.HasPermission,{permission:S.Permissions.queryEditorSelectEndpoint},this.renderRepositorySelector()),a.createElement(f.HasPermission,{permission:S.Permissions.toLdp("container",h.VocabPlatform.QueryTemplateContainer,"create","owner")},a.createElement(i.Button,{className:"btn-grey",onClick:function(){return E.getOverlaySystem().show(R.KEY,a.createElement(R,{query:e.state.query,onHide:function(){return E.getOverlaySystem().hide(R.KEY)}}))}},"Save")),a.createElement(i.Button,{bsStyle:"primary",disabled:this.state.isExecuting,onClick:function(){return e.executeQuery(e.state.query)}},this.state.isExecuting?"Executing...":"Execute")),a.createElement("div",{ref:function(t){return e.resultHolder=t},style:{visibility:this.state.isExecuting?"hidden":"visible"}})))},SparqlQueryEditor.prototype.renderRepositorySelector=function(){var e=this,t=[];return this.state.repositoryStatus?(t.push(a.createElement("option",{key:"@empty",value:""},"(from context)")),this.state.repositoryStatus.forEach((function(e,r){return t.push(a.createElement("option",{key:r,disabled:!e,value:r},r))}))):t.push(a.createElement("option",{key:"@loading",value:""},"Loading...")),a.createElement("span",{className:w.repositorySelector},a.createElement("label",null,"Repository:",a.createElement(i.FormControl,{componentClass:"select",className:w.repositorySelectorDropdown,value:this.state.selectedRepository,onChange:function(t){return e.setState({selectedRepository:t.target.value})}},t)))},SparqlQueryEditor.prototype.componentDidMount=function(){var e=this,t=o.findDOMNode(this.resultHolder);delete u.plugins.table,delete u.plugins.pivot,delete u.plugins.gChart,delete u.plugins.leaflet,u.registerOutput("yasrTable",(function(e){return q.YASRTable(e)})),this.yasr=u(t,{outputPlugins:["rawResponse","yasrTable","boolean","error"],output:"yasrTable",useGoogleCharts:!1,persistency:{results:!1}});var r=this.context.queryEditorContext,n=r.getQuery(),a=n.getOrElse(this.editor.getQuery().value);n.isNothing&&r.setQuery(a,{silent:!0}),this.setState({query:a}),y.getCurrentUrl().hasSearch("query")&&this.executeQuery(a),this.cancellation.map(r.queryChanges).onValue((function(t){var r=t.query,n=t.repository;e.setState({alertState:l.Nothing(),query:r.getOrElse(void 0),selectedRepository:n.getOrElse("")})})),this.cancellation.map(m.getRepositoryStatus()).onValue((function(t){return e.setState({repositoryStatus:t})}))},SparqlQueryEditor.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SparqlQueryEditor.prototype.confirmAndExecuteSparqlUpdate=function(e){var t=this,r=this.getQueryContext().context,hideDialog=function(){return E.getOverlaySystem().hide("update-confirmation")},n={message:'Do you want to execute the UPDATE operations on the "'+r.repository+'" repository?',onHide:function(){hideDialog(),t.setState({isExecuting:!1})},onConfirm:function(r){hideDialog(),r?t.executeSparqlUpdate(e):t.setState({isExecuting:!1})}};E.getOverlaySystem().show("update-confirmation",s.createElement(b.ConfirmationDialog,n))},SparqlQueryEditor.contextTypes=n.__assign(n.__assign({},d.ContextTypes),Q.ContextTypes),SparqlQueryEditor}(s.Component);t.SparqlQueryEditor=P;var R=function(e){function SaveQueryModal(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(SaveQueryModal,e),SaveQueryModal.prototype.render=function(){var e=this.props,t=e.onHide,r=e.query;return a.createElement(i.Modal,{show:!0,onHide:t,bsSize:"large"},a.createElement(i.Modal.Header,{closeButton:!0},a.createElement(i.Modal.Title,null,"Save Query")),a.createElement(i.Modal.Body,null,a.createElement(d.SemanticContextProvider,{repository:"assets"},a.createElement(x.QueryTemplate,{defaultQuery:r}))))},SaveQueryModal.KEY="SparqlQueryEditor-SaveQuery",SaveQueryModal}(s.Component);t.default=P},3150:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);n.__exportStar(r(2264),t),n.__exportStar(r(1289),t)},3151:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=r(1),s=r(35),o=r(20),l=r(1625),i=r(33),u=r(3152),c=r(7),p=r(1559),y=r(61),d=r(1690);t.YASRTable=function YASRTable(e){var t,r=!1,g=10;return{name:"Table",draw:function(){var u={showLabels:r,resultsPerPage:g,onChangeShowLabels:function(e){return r=e},onChangeResultsPerPage:function(e){return g=e}},h=e.resultsContainer[0];t&&(o.unmountComponentAtNode(t),t.parentElement===h&&h.removeChild(t)),t=document.createElement("div"),h.appendChild(t),o.render(a.createElement(function table(e){return function(t){function class_1(e,r){var n=t.call(this,e,r)||this;return n.toggleLabel=function(){n.setState((function(e,t){return{showLabels:!e.showLabels}}))},n.state={showLabels:e.showLabels,resultsPerPage:e.resultsPerPage},n}return n.__extends(class_1,t),class_1.prototype.componentDidUpdate=function(e,t){var r=this.state,n=r.showLabels,a=r.resultsPerPage;n!==t.showLabels&&this.props.onChangeShowLabels(n),a!==t.resultsPerPage&&this.props.onChangeResultsPerPage(a)},class_1.prototype.render=function(){var t=this,r=this.state.resultsPerPage,n=Boolean(this.state.showLabels),o=a.createElement(d.Table,{key:"sparql-endpoint-result-table",data:l.Right(y.SparqlClient.sparqlJsonToSelectResult(e)),numberOfDisplayedRows:i.Nothing(),layout:i.Just({options:{resultsPerPage:r},tupleTemplate:i.Nothing(),showLabels:n,prefetchLabels:n}),showLiteralDatatype:!0,showCopyToClipboardButton:!0}),u=n?"Fetch Labels: ON":"Fetch Labels: OFF",g=n?"btn-success":"btn-danger";return s.div({className:"sparql-endpoint-result-table"},s.button({key:"sparql-endpoint-label-toogle-button",className:c("pull-right btn",g),onClick:this.toggleLabel},u),a.createElement(p.default,{value:r,options:[{value:10,label:"10"},{value:20,label:"20"},{value:25,label:"25"},{value:100,label:"100"}],onChange:function(e){return t.setState({resultsPerPage:e.value})},clearable:!1,className:"pull-right",style:{width:70,marginRight:10}}),o)},class_1}(a.Component)}(e.results.getAsJson()),u),t)},canHandleResults:function(){return e.results&&e.results.getVariables&&e.results.getVariables()&&e.results.getVariables().length>0},getPriority:function(){return 10},getDownloadInfo:function(){if(e.results){var t=e.results.getAsJson();return t?{getContent:function(){return u(t)},filename:"queryResults.csv",contentType:"text/csv",buttonTitle:"Download as CSV"}:null}return null}}}}}]);
//# sourceMappingURL=mp-sparql-query-editor-92c482cd40b1a8a74107.js.map