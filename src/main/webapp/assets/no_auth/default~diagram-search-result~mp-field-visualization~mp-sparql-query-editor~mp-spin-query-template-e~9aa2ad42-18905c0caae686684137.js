(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{1689:function(e,n,r){Object.defineProperty(n,"__esModule",{value:!0});var t=r(11),a=r(19),i=r(43),u=r(16),l=r(23),o=r(61),s=r(140),c=r(1553);function canRestoreLabel(e){return(null===e.label||void 0===e.label)&&e.value&&e.value.isIri()}function restoreLabel(e){return canRestoreLabel(e)?s.getLabel(e.value).map((function(n){return t.__assign(t.__assign({},e),{label:n})})):a.constant(e)}function normalizeValueDatatype(e){return e instanceof l.Rdf.Literal&&!e.language?l.Rdf.literal(e.value,l.XsdDataTypeValidation.replaceDatatypeAliases(e.datatype)):e}n.validate=function validate(e,n,r,t){if(!c.FieldValue.isAtomic(t)||i.is(r,t))return a.later(0,t);var u=n.constraints.map((function(n){return o.SparqlUtil.parseQueryAsync(n.validatePattern).flatMap((function(e){return o.SparqlTypeGuards.isQuery(e)&&"ASK"===e.queryType?a.constant(e):a.constantError(new Error("validatePattern is not an ASK query"))})).map((function(n){return o.SparqlClient.setBindings(n,{subject:e,value:t.value})})).flatMap((function(e){return o.SparqlClient.ask(e)})).map((function(e){return{constraint:n,success:e,error:void 0}})).flatMapErrors((function(e){return a.constant({constraint:n,success:!1,error:e})}))}));return a.zip(u).map((function(e){var n=t.errors.filter((function(e){return e.kind!==c.ErrorKind.Validation})).toList();return c.AtomicValue.set(t,{errors:n.concat(e.filter((function(e){return!e.success})).map((function(e){return{kind:c.ErrorKind.Validation,message:e.error?"Failed to validate value: "+e.error:e.constraint.message}})))})}))},n.queryValues=function queryValues(e,n,r,t){return e?o.SparqlUtil.parseQueryAsync(e).map((function(e){if(t&&!u.isEmpty(t)){var r=t.map((function(e){return{subject:e}}));return r.push({subject:n}),o.SparqlClient.prepareParsedQuery(r)(e)}return n?o.SparqlClient.setBindings(e,{subject:n}):e})).flatMap((function(e){return o.SparqlClient.select(e,r)})).map((function(e){return e.results.bindings.map((function(e){return{value:e.value,label:e.label?e.label.value:void 0,binding:e}})).filter((function(e){return void 0!==e.value})).map((function(e){return c.SparqlBindingValue.set(e,{value:normalizeValueDatatype(e.value),binding:e.binding})})).map(restoreLabel)})).flatMap((function(e){return e.length>0?a.zip(e):a.constant([])})).toProperty():a.constant([])},n.canRestoreLabel=canRestoreLabel,n.restoreLabel=restoreLabel}}]);
//# sourceMappingURL=default~diagram-search-result~mp-field-visualization~mp-sparql-query-editor~mp-spin-query-template-e~9aa2ad42-18905c0caae686684137.js.map