(window.webpackJsonp=window.webpackJsonp||[]).push([[467],{1541:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),r=n(16),a=n(19),i=n(2389),l=n(72),c=n(2392),s=n(1609),u=n(2391),p=n(2394),d=n(1),m=n(23),f=n(36),h=n(61),k=n(61),v=n(34),B=n(1211),g=n(56),y=n(1632),E=n(328),b=n(327),_=n(1754),T=n(3534),x=n(3535),R=n(3536),w=n(3537),D=n(1216),I=n(3538),C=[{queries:{isEmptyFirstParagraph:function(e,t){return 1===e.value.document.nodes.size&&t.type===_.Block.empty&&""===t.text}}},c.default({placeholder:"Write your narrative",when:"isEmptyFirstParagraph"})],L=function(e){function TextEditor(t,n){var i=e.call(this,t,n)||this;return i.cancellation=new v.Cancellation,i.templateSelection=i.cancellation.derive(),i.state={value:s.Value.fromJS({document:{nodes:[{object:"block",type:_.Block.empty}]}}),title:"Narrative Title",anchorBlock:null,availableTemplates:{},loading:!0,saving:!1},i.onChange=function(e){var t=e.value;i.setState({value:t})},i.getTypes=function(e){return k.SparqlClient.select("SELECT DISTINCT ?type WHERE { <"+e.value+"> a ?type}").map((function(e){return e.results.bindings.map((function(e){return e.type}))}))},i.findTemplatesForResource=function(e){return i.getTypes(e).map((function(e){return i.props.resourceTemplates.filter((function(t){return"any"===t.type||r.find(e,(function(e){return e.value===t.type}))}))}))},i.onResourceDrop=function(e){return function(t){var n=i.editorRef.current;n.moveToRangeOfNode(e).setBlocks({type:_.Block.embed,data:{attributes:{src:t.value}}}),i.templateSelection=i.cancellation.deriveAndCancel(i.templateSelection),i.templateSelection.map(i.findTemplatesForResource(t)).observe({value:function(o){var a=i.state.availableTemplates;a[t.value]=o;var l=r.first(o);i.setState({availableTemplates:a},(function(){n.moveToRangeOfNode(e).setBlocks({type:_.Block.embed,data:{attributes:{src:t.value,type:_.RESOURCE_MIME_TYPE,template:l.id}}})}))}})}},i.emptyBlock=function(e){return d.createElement("div",o.__assign({},e.attributes),i.props.readonly?e.children:d.createElement(y.DropArea,{shouldReactToDrag:function(e){return e.value!==i.props.documentIri},dropMessage:"Drop here to add item to the narrative.",onDrop:i.onResourceDrop(e.node)},e.children))},i.renderTextBlock=function(e,t){var n=t.node.data.get("attributes",{});return d.createElement(e,o.__assign(o.__assign({},t.attributes),n),t.children)},i.renderBlock=function(e,t,n){var r=e.node.type,a=e.attributes,l=e.children;switch(r){case _.Block.empty:return i.emptyBlock(e);case _.Block.embed:return d.createElement(I.ResourceBlock,o.__assign({},a,e,{resourceTemplates:i.props.resourceTemplates}));case _.Block.p:case _.Block.h1:case _.Block.h2:case _.Block.h3:return i.renderTextBlock(r,e);case _.Block.ol:case _.Block.ul:case _.Block.li:return d.createElement(r,a,l);case _.Inline.externalLink:return d.createElement(R.ExternalLink,o.__assign({},e,{editor:t}));case _.Inline.internalLink:return d.createElement(w.InternalLink,o.__assign({},e,{editor:t}));default:return n()}},i.renderMark=function(e,t,n){var o=e.children,r=e.mark.type,a=e.attributes;switch(r){case _.MARK.strong:case _.MARK.em:case _.MARK.u:case _.MARK.s:return d.createElement(r,a,o);default:return n()}},i.onKeyDown=function(e,t,n){var o=t.value;u.default("enter",e)?o.selection.isCollapsed&&o.endBlock.type===_.Block.li&&""===o.endBlock.text?t.unwrapBlock(_.Block.ol).unwrapBlock(_.Block.ul).setBlocks(_.DEFAULT_BLOCK):o.selection.isCollapsed&&o.selection.start.isAtEndOfNode(o.endBlock)&&o.endBlock.type!==_.Block.li?t.insertBlock(_.DEFAULT_BLOCK):n():u.default("tab",e)?(e.preventDefault(),o.selection.end.isInNode(o.document.nodes.last())?t.moveToEndOfBlock().insertBlock(_.DEFAULT_BLOCK):t.moveToStartOfNextBlock()):n()},i.onFocus=function(){},i.onDocumentLoad=function(e){var t,n=e[0],o=e[1],l=new p.default({rules:T.SLATE_RULES,defaultBlock:_.Block.p,parseHtml:function(e){var n=(new DOMParser).parseFromString(e,"text/html"),o=n.title,r=n.body;return t=o,r}}).deserialize(o,{toJSON:!0}),c=l.document.nodes.filter((function(e){return"block"===e.object&&e.type===_.Block.embed})).reduce((function(e,t){var n=t.data.attributes.src;return e[n]=i.findTemplatesForResource(m.Rdf.iri(n)),e}),{});r.isEmpty(c)?i.setState({value:s.Value.fromJS(l),fileName:n,loading:!1,title:t}):a.combine(c).onValue((function(e){return i.setState({value:s.Value.fromJS(l),fileName:n,loading:!1,title:t,availableTemplates:e})}))},i.onDocumentSave=function(){i.setState({saving:!0});var e=i.state,t=e.value,n=e.title,o=new p.default({rules:T.SLATE_RULES}),r=i.wrapInHtml(n,o.serialize(t)),a=new Blob([r]),l=i.state.fileName||n.replace(/[^a-z0-9_\-]/gi,"_")+".html",c=new File([a],l),s=h.SparqlUtil.parseQuery(i.props.resourceQuery),u=h.SparqlUtil.serializeQuery(k.SparqlClient.setBindings(s,{__label__:m.Rdf.literal(n)}));i.cancellation.map(i.getFileManager().uploadFileAsResource({file:c,storage:i.props.storage,generateIriQuery:i.props.generateIriQuery,resourceQuery:u,contextUri:"http://www.researchspace.org/instances/narratives",fileNameHack:!0})).observe({value:function(e){i.setState({documentIri:e.value,saving:!1})},error:function(e){console.log("error"),console.log(e)}})},i.editorRef=d.createRef(),i.state.loading=!!t.documentIri,i.state.documentIri=t.documentIri,i}return o.__extends(TextEditor,e),TextEditor.prototype.componentDidMount=function(){if(this.props.documentIri){var e=m.Rdf.iri(this.props.documentIri);this.cancellation.map(this.fetchDocument(e)).observe({value:this.onDocumentLoad,error:function(e){return console.error(e)}})}},TextEditor.prototype.componentDidUpdate=function(){var e,t=this.state,n=t.value,o=t.anchorBlock,r=n.anchorBlock;(null===(e=n.anchorBlock)||void 0===e?void 0:e.type)===_.Block.li&&(r=n.document.getFurthestBlock(n.anchorBlock.key)),o!==r&&this.setState({anchorBlock:r})},TextEditor.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},TextEditor.prototype.render=function(){var e=this;return this.state.loading?d.createElement(b.Spinner,{spinnerDelay:0}):d.createElement("div",{className:D.narrativeHolder},this.props.readonly?null:d.createElement(x.Toolbar,{saving:this.state.saving,value:this.state.value,anchorBlock:this.state.anchorBlock,editor:this.editorRef,options:this.state.availableTemplates,onDocumentSave:this.onDocumentSave}),d.createElement("div",{className:D.sidebarAndEditorHolder},d.createElement("div",{className:D.titleHolder},this.state.documentIri?d.createElement(E.Draggable,{iri:this.state.documentIri},d.createElement("span",{className:D.draggableGripper,title:"drag narrative"},d.createElement("i",{className:"rs-icon rs-icon-drag_points"}))):null,d.createElement(l.FormGroup,{bsClass:""+D.titleInput},d.createElement(l.FormControl,{value:this.state.title,type:"text",readOnly:this.props.readonly,onChange:function(t){return e.setState({title:t.target.value})},placeholder:"Please enter document title"}))),d.createElement("div",{className:D.editorContainer},d.createElement(i.Editor,{ref:this.editorRef,readOnly:this.props.readonly,spellCheck:!1,value:this.state.value,renderMark:this.renderMark,renderNode:this.renderBlock,onKeyDown:this.onKeyDown,onDrop:function(){},onFocus:this.onFocus,schema:_.schema,onChange:this.onChange,plugins:C}))))},TextEditor.prototype.getFileManager=function(){var e=this.context.semanticContext.repository;return new B.FileManager({repository:e})},TextEditor.prototype.fetchDocument=function(e){var t=this;return this.getFileManager().getFileResource(e).flatMap((function(e){var n=B.FileManager.getFileUrl(e.fileName,t.props.storage);return v.requestAsProperty(f.get(n).accept("text/html")).map((function(t){return[e.fileName,t.text]}))})).toProperty()},TextEditor.prototype.wrapInHtml=function(e,t){return'<html>\n  <head>\n    <meta charset="utf-8" />\n    <title>'+e+"</title>\n  </head>\n  <body>"+t+"</body>\n</html>"},TextEditor.defaultProps={resourceTemplates:[],storage:"runtime",resourceQuery:'\n      PREFIX mp: <http://www.researchspace.org/resource/system/>\n      PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n      PREFIX crmdig: <http://www.ics.forth.gr/isl/CRMdig/>\n      PREFIX rso: <http://www.researchspace.org/ontology/>\n\n      CONSTRUCT {\n        ?__resourceIri__ a crm:E33_Linguistic_Object,\n                crmdig:D1_Digital_Object,\n                rso:Semantic_Narrative.\n\n        ?__resourceIri__ mp:fileName ?__fileName__.\n        ?__resourceIri__ mp:mediaType "text/html".\n        ?__resourceIri__ rdfs:label ?__label__ .\n      } WHERE {}\n    ',generateIriQuery:'\n      SELECT ?resourceIri WHERE {\n        BIND(URI(CONCAT(STR(?__contextUri__), "/", ?__fileName__)) as ?resourceIri)\n      }\n    '},TextEditor}(g.Component);t.TextEditor=L,t.default=L},1754:function(e,t,n){var o,r;Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),i=n(1609);t.RESOURCE_MIME_TYPE="researchspace/resource",t.MARK={strong:"strong",em:"em",u:"u",s:"s"},t.Block={empty:"empty",embed:"embed",p:"p",h1:"h1",h2:"h2",h3:"h3",ul:"ul",ol:"ol",li:"li"},t.DEFAULT_BLOCK=t.Block.empty,t.Inline={externalLink:"externalLink",internalLink:"internalLink"},t.TextAlignment={left:"left",right:"right",center:"center",justify:"justify"},t.isTextBlock=function isTextBlock(e){if(e){var n=e.type;return n===t.Block.p||n===t.Block.h1||n===t.Block.h2||n===t.Block.h3}return!1},t.schema={document:{nodes:[{match:a.values(t.Block).map((function(e){return{type:e}})),min:1}],normalize:function(e,n){var o=n.code,r=n.node,a=n.index;switch(o){case"child_min_invalid":var l=i.Block.create(t.Block.empty);return e.insertNodeByKey(r.key,a,l)}}},inlines:(o={},o[t.Inline.externalLink]={nodes:[{match:{object:"text"}}]},o[t.Inline.internalLink]={nodes:[{match:{object:"text"}}]},o),blocks:(r={},r[t.Block.embed]={isVoid:!0},r[t.Block.p]={nodes:[{match:[{object:"text",text:function(e){return""!==e}},{object:"inline",nodes:[{match:{object:"text"}}]}]}],normalize:function(e,n){switch(console.log("error in schema"),console.log(n.code),n.code){case"child_text_invalid":return console.log("adding empty node"),void e.setNodeByKey(n.node.key,t.Block.empty)}}},r[t.Block.h1]={nodes:[{match:{object:"text"}}]},r[t.Block.h2]={nodes:[{match:{object:"text"}}]},r[t.Block.h3]={nodes:[{match:{object:"text"}}]},r[t.Block.ol]={nodes:[{match:{type:t.Block.li}}]},r[t.Block.ul]={nodes:[{match:{type:t.Block.li}}]},r[t.Block.empty]={nodes:[{match:{object:"text",text:function(e){return""===e}}}],normalize:function(e,n){switch(n.code){case"child_text_invalid":return console.log("changing empty to block"),void e.setNodeByKey(n.node.key,t.Block.p)}}},r)}},3534:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(16),r=n(1),a=n(120),i=n(1754);function getAttributesAsReactProps(e){for(var t={},n=0;n<e.attributes.length;n++){var o=e.attributes.item(n),r="style"===o.name?a.ModuleRegistry.parseReactStyleFromCss(o.value):o.value;t[o.name]=r}return t}t.SLATE_RULES=[{deserialize:function(e,t){if(e.nodeType===Node.ELEMENT_NODE&&"a"===e.tagName.toLowerCase()){var n={},r=getAttributesAsReactProps(e);return o.isEmpty(r)||(n.attributes=r),{object:"inline",type:r.type===i.RESOURCE_MIME_TYPE?i.Inline.internalLink:i.Inline.externalLink,data:n,nodes:t(e.childNodes)}}},serialize:function(e,t){if("inline"===e.object&&(e.type===i.Inline.externalLink||e.type===i.Inline.internalLink))return r.createElement("a",e.data.get("attributes",{}),t)}},{deserialize:function(e,t){if(e.nodeType===Node.ELEMENT_NODE){var n=e.tagName.toLowerCase();if(i.Block[n]||i.MARK[n]){var r={},a=getAttributesAsReactProps(e);return o.isEmpty(a)||(r.attributes=a),{object:i.Block[n]?"block":"mark",type:n,data:r,nodes:t(e.childNodes)}}}},serialize:function(e,t){if("block"===e.object&&i.Block[e.type]||"mark"===e.object&&i.MARK[e.type])return e.type===i.Block.embed?r.createElement(e.type,e.data.get("attributes",{})):r.createElement(e.type,e.data.get("attributes",{}),t)}}]},3535:function(e,t,n){var o,r,a,i;Object.defineProperty(t,"__esModule",{value:!0});var l=n(11),c=n(1),s=n(72),u=n(1609),p=n(43),d=n(1754),m=n(1216);t.BLOCK_TO_ICON=((o={})[d.Block.empty]="fa-plus",o[d.Block.embed]="fa-file-code-o",o[d.Block.p]="fa-paragraph",o[d.Block.h1]="fa-header",o[d.Block.h2]="fa-header",o[d.Block.h3]="fa-header",o[d.Block.ol]="fa-list-ol",o[d.Block.ul]="fa-list-ul",o[d.Block.li]="fa-list",o);var f=((r={})[d.Block.empty]="Placeholder",r[d.Block.embed]="Resource",r[d.Block.p]="Paragraph",r[d.Block.h1]="Heading 1",r[d.Block.h2]="Heading 2",r[d.Block.h3]="Heading 3",r[d.Block.ol]="Numbered List",r[d.Block.ul]="Bulleted List",r[d.Block.li]="List Item",r),h=((a={})[d.TextAlignment.left]="fa-align-left",a[d.TextAlignment.right]="fa-align-right",a[d.TextAlignment.center]="fa-align-center",a[d.TextAlignment.justify]="fa-align-justify",a),k=((i={})[d.MARK.s]="fa-strikethrough",i[d.MARK.u]="fa-underline",i[d.MARK.em]="fa-italic",i[d.MARK.strong]="fa-bold",i),v=function(e){function Toolbar(){var t=null!==e&&e.apply(this,arguments)||this;return t.isTextSelectionActionDisabled=function(){return!d.isTextBlock(t.props.anchorBlock)||t.props.value.selection.isCollapsed},t.onMarkClick=function(e,n){e.preventDefault(),t.props.editor.current.toggleMark(n)},t.markButton=function(e){var n=t.hasMark(e),o="fa "+k[e];return c.createElement(s.Button,{active:n,disabled:t.isTextSelectionActionDisabled(),onMouseDown:function(n){return t.onMarkClick(n,e)}},c.createElement("i",{className:o,"aria-hidden":!0}))},t.hasMark=function(e){return t.props.value.activeMarks.some((function(t){return t.type===e}))},t.alignTextButton=function(e){var n=t.hasAlignment(e),o="fa "+h[e];return c.createElement(s.Button,{active:n,disabled:!d.isTextBlock(t.props.anchorBlock),onMouseDown:function(n){return t.onAlignClick(n,e)}},c.createElement("i",{className:o,"aria-hidden":!0}))},t.onAlignClick=function(e,n){var o,r;e.preventDefault();var a=t.props,i=a.editor,l=a.anchorBlock,c={};n!==(null===(r=null===(o=l.data.get("attributes",{}))||void 0===o?void 0:o.style)||void 0===r?void 0:r.textAlign)&&(c={style:{textAlign:n,whiteSpace:n===d.TextAlignment.justify?"pre-line":void 0}});var s=l.setIn(["data","attributes"],c);i.current.setBlocks(s)},t.hasAlignment=function(e){var n,o,r=t.props.anchorBlock;return!!r&&(null===(o=null===(n=r.data.get("attributes"))||void 0===n?void 0:n.style)||void 0===o?void 0:o.textAlign)===e},t.externalLinkButton=function(){return c.createElement(s.Button,{onMouseDown:t.onExternalLinkClick,disabled:t.isTextSelectionActionDisabled()},c.createElement("i",{className:"fa fa-external-link","aria-hidden":!0}))},t.onExternalLinkClick=function(e){e.preventDefault();var n=t.props,o=n.editor;if(n.value.selection.isCollapsed){var r=u.Text.create({text:"link"});o.current.insertInline({type:d.Inline.externalLink,nodes:p.List.of(r)})}else o.current.wrapInline({type:d.Inline.externalLink})},t.internalLinkButton=function(){return c.createElement(s.Button,{onMouseDown:t.onInternalLinkClick,disabled:t.isTextSelectionActionDisabled()},c.createElement("i",{className:"fa fa-chain","aria-hidden":!0}))},t.onInternalLinkClick=function(e){e.preventDefault();var n=t.props,o=n.editor;if(n.value.selection.isCollapsed){var r=u.Text.create({text:"link"});o.current.insertInline({type:d.Inline.internalLink,nodes:p.List.of(r)})}else o.current.wrapInline({type:d.Inline.internalLink})},t.onResourceTemplateSelected=function(e){var n=t.props.anchorBlock.data.get("attributes");t.props.editor.current.setBlocks({type:d.Block.embed,data:{attributes:l.__assign(l.__assign({},n),{template:e,style:{}})}})},t}return l.__extends(Toolbar,e),Toolbar.prototype.render=function(){var e,t=this.props.saving;return c.createElement(s.ButtonToolbar,{className:m.toolbar},c.createElement(s.ButtonGroup,null,c.createElement(s.Button,{bsStyle:"success",onClick:this.props.onDocumentSave,disabled:t},c.createElement("i",{className:t?"fa fa-spinner fa-pulse fa-fw":"fa fa-floppy-o","aria-hidden":"true"}),"  Save")),c.createElement(s.ButtonGroup,null,(null===(e=this.props.anchorBlock)||void 0===e?void 0:e.type)===d.Block.embed?c.createElement(B,{options:this.props.options[this.props.anchorBlock.data.get("attributes").src],anchorBlock:this.props.anchorBlock,onSelect:this.onResourceTemplateSelected}):c.createElement(g,l.__assign({},this.props,{sidebar:!1}))),c.createElement(s.ButtonGroup,null,this.markButton(d.MARK.strong),this.markButton(d.MARK.em),this.markButton(d.MARK.u),this.markButton(d.MARK.s)),c.createElement(s.ButtonGroup,null,this.alignTextButton(d.TextAlignment.left),this.alignTextButton(d.TextAlignment.center),this.alignTextButton(d.TextAlignment.right),this.alignTextButton(d.TextAlignment.justify)),c.createElement(s.ButtonGroup,null,this.internalLinkButton(),this.externalLinkButton()))},Toolbar}(c.Component);t.Toolbar=v;var B=function(e){function ResourceDropdown(){var t=null!==e&&e.apply(this,arguments)||this;return t.actionButton=function(e){return function(n){var o=e.id===n.id;return c.createElement(s.MenuItem,{key:n.id,eventKey:n.id,active:o,onSelect:t.onSelect},c.createElement("span",{className:m.dropdownMenuItem},c.createElement("span",null,n.label)))}},t.onSelect=function(e,n){n.preventDefault(),t.props.onSelect(e)},t}return l.__extends(ResourceDropdown,e),ResourceDropdown.prototype.render=function(){var e=this.props,t=e.options,n=e.anchorBlock;if(t){var o=n.data.get("attributes").template,r=t.find((function(e){return e.id===o}));return r?c.createElement(s.Dropdown,{id:"blocks",pullRight:!0},c.createElement(s.Dropdown.Toggle,null,c.createElement("span",{className:m.dropdownMenuItem},r.label)),c.createElement(s.Dropdown.Menu,null,t.map(this.actionButton(r)))):null}return null},ResourceDropdown}(c.Component),g=function(e){function BlockDropdown(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasBlock=function(e){return t.props.value.blocks.some((function(t){return t.type===e}))},t.onBlockButtonClick=function(e,n){n.preventDefault();var o=t.props,r=o.editor,a=o.anchorBlock;if(e===d.Block.ol||e===d.Block.ul){var i=t.hasBlock(d.Block.li),l=a.type===e;i&&l?r.current.moveToRangeOfNode(a).unwrapBlock(e).setBlocks(d.DEFAULT_BLOCK):i?r.current.moveToRangeOfNode(a).unwrapBlock(a.type).wrapBlock(e):r.current.setBlocks(d.Block.li).wrapBlock(e).moveToEndOfText().focus()}else{i=t.hasBlock(d.Block.li);var c=t.hasBlock(e);i?r.current.moveToRangeOfNode(a).unwrapBlock(a.type).setBlocks(c?d.DEFAULT_BLOCK:e):r.current.moveToRangeOfNode(a).setBlocks(c?d.DEFAULT_BLOCK:e).moveToEndOfBlock().focus()}},t.actionButton=function(e){var n,o=(null===(n=t.props.anchorBlock)||void 0===n?void 0:n.type)===e;return c.createElement(s.MenuItem,{eventKey:e,active:o,onSelect:t.onBlockButtonClick},t.actionDescription(e))},t.actionDescription=function(e){return c.createElement("span",{className:m.dropdownMenuItem},t.actionIcon(e),c.createElement("span",null,f[e]))},t}return l.__extends(BlockDropdown,e),BlockDropdown.prototype.actionIcon=function(e){var n="fa "+t.BLOCK_TO_ICON[e],o=e===d.Block.h1?"1":e===d.Block.h2?"2":e===d.Block.h3?"3":"";return c.createElement("span",{className:m.dropdownMenuItemIcon},c.createElement("i",{className:n,"aria-hidden":"true"}),o)},BlockDropdown.prototype.render=function(){var e=this.props,t=e.sidebar,n=e.anchorBlock,o=n?n.type:d.Block.empty;return c.createElement(s.Dropdown,{id:"blocks",pullRight:!0},c.createElement(s.Dropdown.Toggle,{bsSize:t?"xsmall":null,className:t?m.sidebarDropdown:""},t?this.actionIcon(o):this.actionDescription(o)),c.createElement(s.Dropdown.Menu,null,this.actionButton(d.Block.p),c.createElement(s.MenuItem,{divider:!0}),this.actionButton(d.Block.h1),this.actionButton(d.Block.h2),this.actionButton(d.Block.h3),c.createElement(s.MenuItem,{divider:!0}),this.actionButton(d.Block.ol),this.actionButton(d.Block.ul)))},BlockDropdown}(c.Component);t.BlockDropdown=g;var y=function(e){function ActionDropdown(){return null!==e&&e.apply(this,arguments)||this}return l.__extends(ActionDropdown,e),ActionDropdown.prototype.render=function(){switch(this.props.type){case"block":return c.createElement(g,l.__assign({},this.props.props));case"resource":return null}},ActionDropdown}(c.PureComponent);t.ActionDropdown=y},3536:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),r=n(1),a=n(20),i=n(72),l=n(1754),c=n(1216),s=function(e){function ExternalLink(t){var n=e.call(this,t)||this;n.onHrefSaved=function(e){e.preventDefault();var t=n.props.node.setIn(["data","attributes"],{href:n.state.href});n.props.editor.moveToStartOfNode(t).setInlines(t),n.setState({edit:!1})},n.onUnlink=function(e){e.preventDefault();var t=n.props,o=t.editor,r=t.node;o.moveToRangeOfNode(r).focus().unwrapInline(l.Inline.externalLink)},n.onOverlayShown=function(){n.state.edit&&a.findDOMNode(n.inputRef.current).focus()},n.onEdit=function(){return n.setState({edit:!0})},n.getPopoverTarget=function(){return a.findDOMNode(n.aRef.current)},n.aRef=r.createRef(),n.inputRef=r.createRef(),n.popoverRef=r.createRef();var o=t.node.data.get("attributes",{}).href||"";return n.state={href:o,edit:""===o},n}return o.__extends(ExternalLink,e),ExternalLink.prototype.onClick=function(e){e.preventDefault()},ExternalLink.prototype.render=function(){var e=this,t=this.props,n=t.attributes,a=t.children,l=t.editor,s=t.node,u=l.value.selection.isCollapsed&&l.value.inlines.contains(s),p=s.data.get("attributes",{}),d=!p.href,m=u||d;return r.createElement("span",{style:{position:"relative"}},r.createElement(i.Overlay,{container:document.body,target:this.getPopoverTarget,placement:"top",show:m,onEntered:this.onOverlayShown},r.createElement(i.Popover,{id:"external-link-popover",placement:"top",contentEditable:!1},r.createElement("div",{className:c.linkPopover,ref:this.popoverRef},this.state.edit?r.createElement(i.FormControl,{type:"text",value:this.state.href,ref:this.inputRef,placeholder:"enter link",onChange:function(t){return e.setState({href:t.target.value})}}):r.createElement("div",{className:c.externalLinkHolder},r.createElement("a",o.__assign({},p),s.text)),r.createElement(i.ButtonGroup,null,this.state.edit?r.createElement(i.Button,{bsClass:"btn-success",onMouseDown:this.onHrefSaved,disabled:""===this.state.href},r.createElement("i",{className:"fa fa-floppy-o","aria-hidden":"true"})):r.createElement(i.Button,{bsClass:"btn-grey",onMouseDown:this.onEdit},r.createElement("i",{className:"fa fa-pencil","aria-hidden":"true"})),r.createElement(i.Button,{bsClass:"btn-grey",onMouseDown:this.onUnlink},r.createElement("i",{className:"fa fa-chain-broken","aria-hidden":"true"})))))),r.createElement("a",o.__assign({},n,p,{className:c.externalLink,ref:this.aRef,onClick:this.onClick}),a))},ExternalLink}(r.Component);t.ExternalLink=s},3537:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),r=n(1),a=n(20),i=n(72),l=n(633),c=n(1632),s=n(1754),u=n(1216),p=function(e){function InternalLink(t){var n=e.call(this,t)||this;return n.onUnlink=function(e){e.preventDefault();var t=n.props,o=t.editor,r=t.node;o.moveToRangeOfNode(r).focus().unwrapInline(s.Inline.internalLink)},n.onResourceDrop=function(e){var t=n.props.node.setIn(["data","attributes"],{href:e.value,type:s.RESOURCE_MIME_TYPE});n.props.editor.moveToStartOfNode(t).setInlines(t)},n.getPopoverTarget=function(){return a.findDOMNode(n.aRef.current)},n.aRef=r.createRef(),n}return o.__extends(InternalLink,e),InternalLink.prototype.onClick=function(e){e.preventDefault()},InternalLink.prototype.render=function(){var e=this.props,t=e.attributes,n=e.children,a=e.editor,s=e.node,p=a.value.selection.isCollapsed&&a.value.inlines.contains(s),d=s.data.get("attributes",{}),m=!d.href,f=p||m;return r.createElement("span",o.__assign({},t,{className:u.internalLink}),r.createElement(i.Overlay,{container:document.body,target:this.getPopoverTarget,placement:"top",show:f},r.createElement(i.Popover,{id:"internal-link-popover",placement:"top",contentEditable:!1},r.createElement("div",{className:u.linkPopover},r.createElement(c.DropArea,{onDrop:this.onResourceDrop,dropMessage:"Drop here resource from Clipboard to make a link.",alwaysVisible:m},m?null:r.createElement(l.ResourceLinkComponent,{key:d.href,iri:d.href})),r.createElement(i.Button,{bsClass:"btn-grey",onMouseDown:this.onUnlink},r.createElement("i",{className:"fa fa-chain-broken","aria-hidden":"true"}))))),r.createElement("a",o.__assign({},t,d,{ref:this.aRef,onClick:this.onClick}),n))},InternalLink}(r.Component);t.InternalLink=p},3538:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),r=n(1),a=n(16),i=n(72),l=n(7),c=n(23),s=n(630),u=n(327),p=n(1216),d=function(e){function ResourceBlock(){var t=null!==e&&e.apply(this,arguments)||this;return t.getProps=function(){return t.props},t.getTemplateConfig=function(e){return a.find(t.props.resourceTemplates,(function(t){return t.id===e}))},t.onTemplateRendered=function(e){var n,o=null===(n=t.props.node.data.get("attributes"))||void 0===n?void 0:n.template,r=t.getTemplateConfig(o);e&&(null==r?void 0:r.resizable)&&(t.resizeObserver&&t.resizeObserver.disconnect(),t.resizeObserver=new MutationObserver((function(n,o){var r=t.getProps(),a=r.node,i=r.editor,l=a.data.get("attributes",{}),c=l.style||{};c.height===e.offsetHeight&&c.width===e.offsetWidth||(l.style=l.style||{},l.style.height=e.offsetHeight,l.style.width=e.offsetWidth,i.moveToRangeOfNode(a).setBlocks(a))})),t.resizeObserver.observe(e,{attributes:!0,attributeFilter:["style"]}))},t}return o.__extends(ResourceBlock,e),ResourceBlock.prototype.componentWillUnmount=function(){this.resizeObserver&&this.resizeObserver.disconnect()},ResourceBlock.prototype.render=function(){var e,t=this.props,n=t.node,a=t.editor,d=n.data.get("attributes",{}),m=this.getTemplateConfig(d.template);if(m){var f=d.style||{};m.defaults&&(!f.height&&m.defaults.height&&(f.height=m.defaults.height),!f.width&&m.defaults.width&&(f.width=m.defaults.width)),m.resizable?(f.resize="both",f.overflow="auto"):f.flex=1;var h=a.value.selection.isCollapsed&&a.value.endBlock===n;return r.createElement("div",o.__assign({},this.props.attributes,{className:l(p.resourceBlock,(e={},e[p.resourceBlockActive]=h,e))}),r.createElement("div",{style:o.__assign(o.__assign({},f),{padding:10}),ref:this.onTemplateRendered},r.createElement(s.TemplateItem,{componentProps:{style:{height:"100%",width:"100%"}},template:{source:m.template,options:{iri:c.Rdf.iri(d.src)}}})))}return r.createElement(i.Well,null,r.createElement(u.Spinner,null))},ResourceBlock}(r.Component);t.ResourceBlock=d}}]);
//# sourceMappingURL=rs-text-editor-a00b998a7e204becf170.js.map