(window.webpackJsonp=window.webpackJsonp||[]).push([[489],{1348:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=r(1),n=r(35),s=r(16),o=r(19),u=r(33),l=r(2224),c=r(23),f=r(34),h=r(63),S=r(56),g=r(162),p=r(116),d=r(1738),m=r(2225),R=r(1569),v=r(2926),y=function(e){function SemanticSearch(t,r){var i=e.call(this,t,r)||this;i.cancellation=new f.Cancellation,i.savingState=i.cancellation.derive(),i.loadingResults=i.cancellation.derive(),i.activeResultOperations=0,i.getDefaultDatasets=function(e){return s.filter(e,(function(e){return e.isDefault}))},i.getDefaultAlignments=function(e){var t=s.map(i.getDefaultDatasets(e),(function(e){return s.find(e.alignments,(function(e){return e.isDefault}))}));return s.isEmpty(t)?u.Nothing():u.Just(s.head(t))},i.mapAlignemnts=function(e){return e.map((function(e){var t=e.iri,r=e.label,a=e.isDefault;return{iri:c.Rdf.iri(t),label:r,isDefault:a}}))},i.useInExtendedFcFrSearch=function(e){return i.setState({extendedSearch:u.Just(e),facetStructure:null})},i.setBaseQuery=function(e){i.setState((function(t){return i.listenForResultsLoading(),{baseQuery:e,facetStructure:e.map((function(e){return t.facetStructure})).getOrElse(null),hasFacet:!!e.isJust&&t.hasFacet,resultQuery:e,resultsLoaded:!1,isConfigurationEditable:!e.isJust}}))},i.setBaseQueryStructure=function(e){if(e!==i.state.baseQueryStructure)if(e.isJust){var t=s.cloneDeep(e.get());i.setState({baseQueryStructure:u.Just(t),resultState:{}}),i.saveStateIntoHistory({search:t,facet:i.state.facetStructure,result:{},datasets:i.state.selectedDatasets,alignment:i.state.selectedAlignment,graphScopeSearch:i.state.graphScopeStructure})}else i.setState({baseQueryStructure:u.Nothing(),isConfigurationEditable:!0}),i.clearCurrentHistoryItem()},i.setFacetStructure=function(e){var t=s.cloneDeep(e);i.setState({facetStructure:t}),i.saveStateIntoHistory({search:i.state.baseQueryStructure.getOrElse(void 0),facet:t,result:i.state.resultState,datasets:i.state.selectedDatasets,alignment:i.state.selectedAlignment,graphScopeSearch:i.state.graphScopeStructure})},i.setFacetedQuery=function(e){i.listenForResultsLoading(),i.setState({resultQuery:u.Just(e),hasFacet:!0,resultsLoaded:!1})},i.setFacetActions=function(e){i.setState({facetActions:e})},i.setDomain=function(e){i.setState({domain:u.Just(e)})},i.setAvailableDomains=function(e){i.setState({availableDomains:u.Just(e)})},i.setSelectedDatasets=function(e){return i.setState({selectedDatasets:e})},i.setSelectedAlignment=function(e){return i.setState({selectedAlignment:e})},i.setVisualizationContext=function(e){return i.setState({visualizationContext:e})},i.setSearchProfileStore=function(e){i.setState({searchProfileStore:u.Just(e)})},i.setGraphScopeStructure=function(e){i.setState({graphScopeStructure:e}),i.saveStateIntoHistory({search:i.state.baseQueryStructure.getOrElse(void 0),facet:i.state.facetStructure,result:i.state.resultState,datasets:i.state.selectedDatasets,alignment:i.state.selectedAlignment,graphScopeSearch:e})},i.setGraphScopeResults=function(e){i.setState({graphScopeResults:e})},i.getStateFromHistory=function(e,t){void 0===t&&(t={});var r=t.reload||void 0===i.serializedState?h.getCurrentUrl().query(!0).semanticSearch:i.serializedState;if("string"!=typeof r)return u.Nothing();try{var a=l.decompressFromEncodedURIComponent(r),n=JSON.parse(a),s=m.unpackState(n),o=new m.Deserializer(e).deserializeState(s);return u.Just(o)}catch(e){return t.reload&&p.addNotification({level:"warning",message:"Error restoring search state"}),console.error("Error restoring search state: ",e),u.Nothing()}},i.saveStateIntoHistory=function(e){var t,r=i.state.searchProfileStore.map((function(e){return i.getStateFromHistory(e)})).getOrElse(u.Nothing()),a=m.serializeSearch(e.search||r.map((function(e){return e.search})).getOrElse(void 0),e.facet||r.map((function(e){return e.facet})).getOrElse(void 0),e.result,e.datasets,e.alignment,e.graphScopeSearch);if(a!==i.serializedState){i.serializedState=a,i.savingState.cancelAll(),i.savingState=i.cancellation.derive();var n=h.getCurrentUrl().clone();n.removeSearch("semanticSearch").addSearch(((t={}).semanticSearch=a,t)),i.savingState.map(o.constant(n)).onValue((function(e){window.history.replaceState({},"",e.toString())}))}},i.notifyResultLoading=function(e){i.activeResultOperations++;var t=e.task;i.loadingResults.map(t).observe({value:function(t){i.activeResultOperations--,"count"===e.type&&"number"==typeof t&&(i.resultCount=t),0===i.activeResultOperations&&i.setState({resultsLoaded:!0})}})},i.updateResultState=function(e,t){i.setState((function(r){var i,n=r.resultState;return{resultState:a.__assign(a.__assign({},n),(i={},i[e]=a.__assign(a.__assign({},n[e]),t),i))}}),(function(){return i.saveStateIntoHistory({search:i.state.baseQueryStructure.getOrElse(void 0),facet:i.state.facetStructure,result:i.state.resultState,datasets:i.state.selectedDatasets,alignment:i.state.selectedAlignment,graphScopeSearch:i.state.graphScopeStructure})}))};var n=i.availableDatasets(t);return i.state={domain:u.Nothing(),availableDomains:u.Nothing(),baseQuery:u.Nothing(),baseQueryStructure:u.Nothing(),resultQuery:u.Nothing(),searchProfileStore:u.Nothing(),extendedSearch:u.Nothing(),hasFacet:!1,resultState:{},availableDatasets:n,selectedDatasets:i.getDefaultDatasets(n),selectedAlignment:i.getDefaultAlignments(n),isConfigurationEditable:!0,visualizationContext:u.Nothing(),graphScopeStructure:u.Nothing(),graphScopeResults:u.Nothing()},i}return a.__extends(SemanticSearch,e),SemanticSearch.prototype.makeSearchContext=function(){return{baseQuery:this.state.baseQuery,useInExtendedFcFrSearch:this.useInExtendedFcFrSearch,extendedSearch:this.state.extendedSearch,baseQueryStructure:this.state.baseQueryStructure,resultsStatus:{loaded:this.state.resultsLoaded,count:this.resultCount},facetStructure:u.fromNullable(this.state.facetStructure),facetActions:u.fromNullable(this.state.facetActions),baseConfig:this.props,domain:this.state.domain,availableDomains:this.state.availableDomains,setDomain:this.setDomain,setAvailableDomains:this.setAvailableDomains,setBaseQuery:this.setBaseQuery,setBaseQueryStructure:this.setBaseQueryStructure,setSearchProfileStore:this.setSearchProfileStore,setFacetStructure:this.setFacetStructure,setFacetedQuery:this.setFacetedQuery,setFacetActions:this.setFacetActions,resultQuery:this.state.resultQuery,searchProfileStore:this.state.searchProfileStore,bindings:{},notifyResultLoading:this.notifyResultLoading,resultState:this.state.resultState,updateResultState:this.updateResultState,selectedDatasets:this.state.selectedDatasets,selectedAlignment:this.state.selectedAlignment,setSelectedDatasets:this.setSelectedDatasets,setSelectedAlignment:this.setSelectedAlignment,isConfigurationEditable:this.state.isConfigurationEditable,availableDatasets:this.state.availableDatasets,visualizationContext:this.state.visualizationContext,setVisualizationContext:this.setVisualizationContext,graphScopeStructure:this.state.graphScopeStructure,setGraphScopeStructure:this.setGraphScopeStructure,graphScopeResults:this.state.graphScopeResults,setGraphScopeResults:this.setGraphScopeResults}},SemanticSearch.prototype.componentDidMount=function(){var e=this;this.props.searchProfile&&this.cancellation.map(v.createSearchProfileStore(this.props,this.props.searchProfile)).onValue((function(t){var r=e.getStateFromHistory(t,{reload:!0});e.setState((function(e){return{selectedDatasets:r.map((function(e){return e.datasets})).getOrElse(e.selectedDatasets),selectedAlignment:r.chain((function(e){return e.alignment})).orElse((function(){return e.selectedAlignment})),searchProfileStore:u.Just(t),baseQueryStructure:r.chain((function(e){return u.fromNullable(e.search)})),facetStructure:r.chain((function(e){return u.fromNullable(e.facet)})).getOrElse(void 0),resultState:r.map((function(e){return e.result})).getOrElse({}),graphScopeStructure:r.map((function(e){return e.graphScopeSearch})).getOrElse(e.graphScopeStructure)}}))})),g.trigger({eventType:g.BuiltInEvents.ComponentLoaded,source:this.props.id})},SemanticSearch.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticSearch.prototype.availableDatasets=function(e){var t=this;return u.fromNullable(e.datasetsConfig).map((function(e){return e.datasets})).getOrElse([]).map((function(e){var r=e.iri,a=e.label,i=e.silent,n=e.alignments,s=e.isDefault,o=r||"http://www.researchspace.org/ontology#default";return{iri:c.Rdf.iri(o),alignments:t.mapAlignemnts(n),silent:i||!1,label:a,isDefault:s}}))},SemanticSearch.prototype.listenForResultsLoading=function(){this.loadingResults=this.cancellation.deriveAndCancel(this.loadingResults),this.activeResultOperations=0,this.resultCount=void 0},SemanticSearch.prototype.render=function(){return i.createElement(R.SemanticSearchContext.Provider,{value:this.makeSearchContext()},n.div({},this.props.children))},SemanticSearch.prototype.clearCurrentHistoryItem=function(){this.savingState.cancelAll();var e=h.getCurrentUrl();"semanticSearch"in e.query(!0)&&window.history.replaceState({},"",e.clone().removeQuery("semanticSearch").toString())},SemanticSearch.defaultProps={optimizer:"blazegraph",categories:d.DefaultTextPattern(),searchProfile:{categoriesQuery:d.DefaultSearchProfileCategoriesQuery,relationsQuery:d.DefaultSearchProfileRelationsQuery,defaultProfile:d.DefaultProfile},limit:d.ResultLimit,selectorMode:"stack"},SemanticSearch}(S.Component);t.SemanticSearch=y,t.default=y},2926:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(33),i=r(16),n=r(23),s=r(2927),o=r(1630),u=r(1822),l=function(){function SearchProfileStore(e,t){var r=this;if(this.rangesFor=function(e){return r.categories.filter((function(t){return r.relations.some((function(r){return r.hasDomain.iri.equals(e.iri)&&r.hasRange.iri.equals(t.iri)}))||i.includes(u.getCategoryTypes(r._config,t),"text")}))},this._availableProfiles=t,this._profile=this.availableProfiles.first(),o.isQuerySearchProfileConfig(e.searchProfile)){var a=e.searchProfile;a.defaultProfile&&(this._profile=this._availableProfiles.get(n.Rdf.fullIri(a.defaultProfile)))}this._config=e}return Object.defineProperty(SearchProfileStore.prototype,"availableProfiles",{get:function(){return this._availableProfiles},enumerable:!0,configurable:!0}),Object.defineProperty(SearchProfileStore.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0}),Object.defineProperty(SearchProfileStore.prototype,"categories",{get:function(){return this._profile.categories},enumerable:!0,configurable:!0}),Object.defineProperty(SearchProfileStore.prototype,"domains",{get:function(){return this.filterCategories((function(e){return e.hasDomain}))},enumerable:!0,configurable:!0}),Object.defineProperty(SearchProfileStore.prototype,"relations",{get:function(){return this._profile.relations},enumerable:!0,configurable:!0}),Object.defineProperty(SearchProfileStore.prototype,"ranges",{get:function(){return this.filterCategories((function(e){return e.hasRange}))},enumerable:!0,configurable:!0}),SearchProfileStore.prototype.relationsFor=function(e){var t=e.domain,r=void 0===t?a.Nothing():t,i=e.range,n=void 0===i?a.Nothing():i;return this.relations.filter((function(e){var t=r.map((function(t){return e.hasDomain.iri.equals(t.iri)})).getOrElse(!0),a=n.map((function(t){return e.hasRange.iri.equals(t.iri)})).getOrElse(!0);return t&&a}))},SearchProfileStore.prototype.filterCategories=function(e){var t=this;return this.categories.filter((function(r){return t.relations.some((function(t){return e(t).iri.equals(r.iri)}))}))},SearchProfileStore}();t.SearchProfileStore=l,t.createSearchProfileStore=function createSearchProfileStore(e,t){return o.isQuerySearchProfileConfig(t)?s.fetchSearchProfilesQuery(t).map((function(t){return new l(e,t)})):s.fetchSearchProfilesInline(t).map((function(t){return new l(e,t)}))},t.default=l},2927:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),i=r(43),n=r(1630),s=r(61),o=r(23),u=r(1944),l=r(1738);function constructCategoryFromInline(e){return{iri:o.Rdf.fullIri(e.iri),label:e.label,thumbnail:e.thumbnail,color:e.color,description:e.label,tuple:{iri:o.Rdf.fullIri(e.iri),label:o.Rdf.literal(e.label),thumbnail:e.thumbnail?o.Rdf.literal(e.thumbnail):void 0}}}function constructCategoriesFromBindings(e){return e.map(constructCategoryBromBinding).groupBy((function(e){return e.iri})).toOrderedMap().map((function(e){return e.first()}))}function constructCategoryBromBinding(e){var t=e[n.RELATION_PROFILE_VARIABLES.THUMBNAIL_PROJECTION_VAR];return{iri:e[n.RELATION_PROFILE_VARIABLES.CATEGORY_PROJECTION_VAR],label:e[n.RELATION_PROFILE_VARIABLES.LABEL_PROJECTION_VAR].value,description:e[n.RELATION_PROFILE_VARIABLES.DESCRIPTION_PROJECTION_VAR].value,thumbnail:t?t.value:void 0,tuple:e}}t.fetchSearchProfilesQuery=function fetchSearchProfilesQuery(e){return a.combine([s.SparqlClient.select(e.categoriesQuery),s.SparqlClient.select(e.relationsQuery)],(function(e,t){var r=function constructCategories(e){return i.List(e).groupBy((function(e){return e[n.RELATION_PROFILE_VARIABLES.PROFILE_PROJECTION_VAR]})).map(constructCategoriesFromBindings).toMap()}(e.results.bindings),a=function constructRelations(e,t){return i.List(e).groupBy((function(e){return e[n.RELATION_PROFILE_VARIABLES.PROFILE_PROJECTION_VAR]})).map((function(e,r){return function constructRelationsFromBindings(e,t){return e.map((function(e){return function constructRelationBromBinding(e,t){var r=e[n.RELATION_PROFILE_VARIABLES.RELATION_PROJECTION_VAR];return{iri:r,label:e[n.RELATION_PROFILE_VARIABLES.LABEL_PROJECTION_VAR].value,description:e[n.RELATION_PROFILE_VARIABLES.DESCRIPTION_PROJECTION_VAR].value,hasRange:t.get(e[n.RELATION_PROFILE_VARIABLES.RELATION_RANGE_PROJECTION_VAR]),hasDomain:t.get(e[n.RELATION_PROFILE_VARIABLES.RELATION_DOMAIN_PROJECTION_VAR]),tuple:e,hashCode:function(){return r.hashCode()},equals:function(e){return r.equals(e.iri)}}}(e,t)})).groupBy((function(e){var t=e.iri,r=e.hasDomain,a=e.hasRange;return u.RelationKey.key({iri:t,domain:r.iri,range:a.iri})})).toOrderedMap().map((function(e){return e.first()}))}(e,t.get(r))})).toMap()}(t.results.bindings,r);return r.mapEntries((function(e){var t=e[0],r=e[1];return[t,{iri:t,label:t.value,categories:r,relations:a.get(t)}]}))})).toProperty()},t.fetchSearchProfilesInline=function fetchSearchProfilesInline(e){var t=function constructCategoriesFromInline(e){return i.List(e).map(constructCategoryFromInline).groupBy((function(e){return e.iri})).toOrderedMap().map((function(e){return e.first()}))}(e.categories),r=function constructRelationsFromInline(e,t){return i.List(e).map((function(e){return function constructRelationFromInline(e,t){var r=o.Rdf.fullIri(e.iri);return{iri:r,label:e.label,description:e.label,hasDomain:t.get(o.Rdf.fullIri(e.hasDomain)),hasRange:t.get(o.Rdf.fullIri(e.hasRange)),tuple:{iri:o.Rdf.fullIri(e.iri),label:o.Rdf.literal(e.label)},hashCode:function(){return r.hashCode()},equals:function(e){return r.equals(e.iri)}}}(e,t)})).groupBy((function(e){var t=e.iri,r=e.hasDomain,a=e.hasRange;return u.RelationKey.key({iri:t,domain:r.iri,range:a.iri})})).toOrderedMap().map((function(e){return e.first()}))}(e.relations,t),n=o.Rdf.fullIri(l.DefaultInlineProfile),s={iri:n,label:n.value,description:n.value,tuple:{iri:n},categories:t,relations:r},c=i.Map([[n,s]]);return a.constant(c)}}}]);
//# sourceMappingURL=semantic-search-fc9d262eddf64ddc25a4.js.map