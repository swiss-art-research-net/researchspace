(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{2344:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(33),l=n(16),s=n(19),c=n(1559),u=n(61),p=n(1562),a=n(122),f=n(1848);var d,m=function(e){function FieldSelection(t,n){var m=e.call(this,t,n)||this;return m.repositories=a.getRepositoryStatus().map((function(e){return e.keySeq().toArray()})),m.fieldsSelection=function(e){return i.createElement("div",{style:{height:400}},i.createElement(c.default,{ref:function(e){return m.fieldSelection=e},multi:m.props.multiSelection,clearable:!0,onChange:m.onFieldSelectionChange(e),options:e.map((function(e){return{value:e.iri,label:p.getPreferredLabel(e.label)}})),value:m.state.selectedFields,placeholder:m.props.placeholder}))},m.onFieldSelectionChange=function(e){return function(t){if(m.fieldSelection.closeMenu(),m.setState({selectedFields:t}),function isMultiSelection(e){return e.multiSelection}(m.props)){var n=t,r=e.filter((function(e){return l.some(n,(function(t){var n=t.value;return e.iri===n}))}));m.props.onSave(r)}else{var i=e.find((function(e){return t.value===e.iri}));m.props.onSave(i)}}},m.fetchFields=function(e){var t=e.record,n=e.types;m.setState({fields:o.Nothing()}),m.getExistingFieldsForRecord(t,n).onValue((function(e){return m.setState({fields:o.Just(e)})}))},m.getExistingFieldsForRecord=function(e,t){return m.getFieldsForRecord(e,t).flatMap((function(e){return s.combine(e.map((function(e){return m.checkField(e).map((function(t){return[e,t]}))})))})).map((function(e){return e.filter((function(e){return e[1]})).map((function(e){return e[0]}))})).toProperty()},m.checkField=function(e){return m.props.fieldFilter?m.props.fieldFilter(e):m.repositories.flatMap((function(t){return s.combine(t.map((function(t){return m.executeFieldTestForRepository(e,t)})))})).map(l.some).toProperty()},m.executeFieldTestForRepository=function(e,t){var n=u.SparqlUtil.parseQuerySync(e.selectPattern),r={prefixes:n.prefixes,type:"query",queryType:"ASK",where:n.where};return u.SparqlClient.ask(u.SparqlClient.setBindings(r,{subject:m.props.record}),{context:{repository:t}})},m.FIELDS_QUERY=u.SparqlUtil.Sparql(d||(d=r.__makeTemplateObject(["\n    SELECT ?field {\n    ?field <http://www.researchspace.org/resource/system/fields/domain> ?__type__ .\n    <http://www.researchspace.org/resource/system/fieldDefinitionContainer> <http://www.w3.org/ns/ldp#contains> ?field .\n    }\n  "],["\n    SELECT ?field {\n    ?field <http://www.researchspace.org/resource/system/fields/domain> ?__type__ .\n    <http://www.researchspace.org/resource/system/fieldDefinitionContainer> <http://www.w3.org/ns/ldp#contains> ?field .\n    }\n  "]))),m.getFieldsForRecord=function(e,t){return u.SparqlClient.select(u.SparqlClient.prepareParsedQuery(t.map((function(e){return{__type__:e}})))(m.FIELDS_QUERY),{context:{repository:"assets"}}).map((function(e){return e.results.bindings.map((function(e){return e.field}))})).flatMap((function(e){return s.combine(e.map((function(e){return f.getArgumentsFieldDefinition(e)})))})).toProperty()},m.state={fields:o.Nothing(),selectedFields:t.multiSelection?[]:null},m}return r.__extends(FieldSelection,e),FieldSelection.prototype.componentDidMount=function(){this.fetchFields(this.props)},FieldSelection.prototype.componentWillReceiveProps=function(e){l.isEqual(e,this.props)||this.fetchFields(e)},FieldSelection.prototype.render=function(){var e=this;return this.state.fields.map((function(t){return l.isEmpty(t)?i.createElement("p",null,"'No applicable field for the record'"):e.fieldsSelection(t)})).getOrElse(i.createElement("p",null,"Loading fields ... "))},FieldSelection}(i.Component);t.FieldSelection=m}}]);
//# sourceMappingURL=default~rs-premise~rs-simple-assertion-082ec9948bdfbadadc23.js.map