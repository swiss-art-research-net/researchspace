(window.webpackJsonp=window.webpackJsonp||[]).push([[499],{1509:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(35),i=n(33),s=n(16),c=n(7),l=n(1991),u=n(72),d=n(162),p=n(23),m=n(1212),h=n(61),S=n(56),g=n(117),f=n(1601),v=n(214),y=n(1581),E=n(1606),j=n(1822),C=n(1824),D=n(1630),I=n(1738),x=n(3390),T=n(1511),R=n(3391),_=n(1569),N=n(1851),b=n(3392),B=n(3394),O=n(2364),w=n(3395),k=n(2365),A=p.Rdf.iri("http://help.researchspace.org/resource/SolrFullTextSearchSyntax");function SearchClause(e){var t=e.clause,n=e.id,r=e.children,o=n+"-searchClause-"+t.uniqueId;return a.createElement("div",{id:o,className:T.searchClause},r)}var F=function(e){function QueryBuilder(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(QueryBuilder,e),QueryBuilder.prototype.render=function(){var e=this;return a.createElement(_.SemanticSearchContext.Consumer,null,(function(t){return a.createElement(Q,r.__assign({},e.props,{context:t}))}))},QueryBuilder}(S.Component),Q=function(e){function QueryBuilderInner(t){var n=e.call(this,t)||this;return n.renderSearch=function(e,t,r){void 0===r&&(r=!1);var o=s(e.conjuncts).map((function(r){return[n.isActiveClause(r.conjunctIndex,t)?n.renderActiveSearchClause(t,!1,r):n.renderFullClause(e.domain,r,t),a.createElement("div",{className:T.andSeparator},"AND")]})).flatten().initial().value();n.isNewConjunct(e,t)&&(o=o.concat([a.createElement("div",{className:T.andSeparator},"AND"),n.renderActiveSearchClause(t,!1)]));var i=n.state.isSearchCollapsed;return a.createElement("div",null,r?null:n.searchSummary(e),a.createElement("div",{className:T.searchArea,style:{display:i?"none":null}},o))},n.searchSummary=function(e){var t,r=n.state.isSearchCollapsed;return a.createElement("div",{className:T.searchSummaryHolder},s.isUndefined(e)?null:a.createElement("i",{className:c((t={},t[T.searchExpand]=r,t[T.searchCollapse]=!r,t)),onClick:n.onSearchToggle}),a.createElement(O.default,{search:e}))},n.onSearchToggle=function(){return n.setState((function(e){return{isSearchCollapsed:!e.isSearchCollapsed}}))},n.renderFullClause=function(e,t,r){return E.matchConjunct({Relation:function(t){return n.renderRelationClause(e,t,r)},Text:function(t){return n.renderTextClause(e,t)}})(t)},n.renderRelationClause=function(e,t,r){return a.createElement("div",null,a.createElement(SearchClause,{id:n.props.context.baseConfig.id,clause:t},n.renderDomain(e),n.renderRelation(t.relation,t),n.renderRange(t.range,t),n.renderSimpleTerms(t),n.addDisjunctionButton(t),n.addConjunctionButton(t),n.removeConjunctionButton(t)),n.renderNestedTerms(t.disjuncts,r))},n.renderTextClause=function(e,t){return a.createElement("div",null,a.createElement(SearchClause,{id:n.props.context.baseConfig.id,clause:t},n.renderDomain(e),n.textSearchRelationPlaceholder(),n.renderSimpleTerms(t),n.addDisjunctionButton(t),n.addConjunctionButton(t),n.removeConjunctionButton(t)))},n.renderDomain=function(e,t){void 0===t&&(t=!1);var r=x.renderResource(n.props.categoryViewTemplate,e,(function(){}),T.selectedDomain);return t?n.withoutEdit(R.EditKinds.Domain)(r):n.withEdit(R.EditKinds.Domain)(r)},n.renderRange=function(e,t){return n.withEdit(R.EditKinds.Range,t)(x.renderResource(n.props.categoryViewTemplate,e,(function(){}),T.selectedRange))},n.renderRelation=function(e,t){return n.withEdit(R.EditKinds.Relation,t)(x.renderResource(n.props.relationViewTemplate,e,(function(){}),T.selectedRelation))},n.renderSimpleTerms=function(e){return s.filter(e.disjuncts,(function(e){return e.kind!==E.EntityDisjunctKinds.Search})).map(n.renderSimpleTerm(e))},n.renderSimpleTerm=function(e){return function(t){return n.withEdit(R.EditKinds.Disjunct,e,t)(a.createElement("div",{className:T.selectedTerm},j.disjunctToString(t)))}},n.renderNestedTerms=function(e,t){return e.map((function(e){return n.renderNestedTerm(e,t)}))},n.renderNestedTerm=function(e,t){switch(e.kind){case E.EntityDisjunctKinds.Search:return n.renderNestedSearch(e,t)}},n.renderNestedSearch=function(e,t){return a.createElement("div",{className:T.nestedSearchHolder},a.createElement("div",{className:T.whereSeparator},"WHERE"),n.renderSearch(e.value,t,!0))},n.addDisjunctionButton=function(e){return a.createElement("div",{className:T.addDisjunctButton,onClick:function(t){n.state.store.addDisjunction(e),d.trigger({eventType:N.SearchOrDisjunctSelected,source:n.props.id})}},"or")},n.addConjunctionButton=function(e){return a.createElement("div",{className:T.addConjunctButton,onClick:function(t){n.state.store.addConjunction(e),d.trigger({eventType:N.SearchAndConjunctSelected,source:n.props.id})}},"and")},n.removeConjunctionButton=function(e){return a.createElement("button",{className:c("btn","btn-link",T.removeConjunctButton),onClick:function(t){return n.state.store.removeConjunction(e)}},"remove")},n.removeActiveConjunctionButton=function(){return a.createElement("button",{className:c("btn","btn-link",T.removeConjunctButton),onClick:function(e){return n.state.store.resetEditMode()}},"cancel")},n.withEdit=function(e,t,r){return function(o){return a.createElement("div",{className:T.itemHolder},o,a.createElement("span",{className:c("fa fa-times-circle fa-lg",T.editButton),onClick:function(){return n.state.store.edit(e,t,r)}}))}},n.withoutEdit=function(e,t,n){return function(e){return a.createElement("div",{className:T.itemHolder},e)}},n.renderExtendedDomainSelection=function(e){return a.createElement("div",{className:T.searchClause},n.categorySelection(e.domains,T.domainSelection,n.state.store.selectExtendedDomain,"search domain category selection"),n.relationSelectorPlaceholder(),n.renderRange(e.range,null),n.renderSimpleTerm(null)(e.disjunct),n.removeActiveConjunctionButton())},n.renderExtendedRelationSelection=function(e){return a.createElement("div",{className:T.searchClause},n.renderDomain(e.domain),n.relationSelector(e.relations,n.state.store.selectExtendedRelation),n.renderRange(e.range,null),n.renderSimpleTerm(null)(e.disjunct),n.removeActiveConjunctionButton())},n.relationSelection=function(e,t){return a.createElement("div",{className:T.searchClause},n.renderDomain(e.domain,t),n.relationSelector(e.relations,n.state.store.selectRelation),n.renderRange(e.range),n.removeActiveConjunctionButton())},n.textSearchRelationPlaceholder=function(){return a.createElement("div",{className:T.relationPlaceholder},"... text search ...")},n.textDisjunctSelector=function(e){e.range.iri.toString();var t=D.getConfigPatternForCategory(n.props.context.baseConfig,e.range.iri),r=t&&t.helpPage?p.Rdf.fullIri(t.helpPage):t&&!1===t.escapeLuceneSyntax?A:void 0;return a.createElement("div",{className:T.searchBasedTermSelectorHolder},a.createElement(B.default,{onSelect:n.onTextTermSelect,helpPage:r}))},n.onTextTermSelect=function(e){n.state.store.selectTerm("text")(e)},n.resourceTermSelector=function(e){return a.createElement(f.AutoCompletionInput,r.__assign({className:T.resourceSelector},n.prepareAutoCompletionInputConfig(e)))},n.placeTermSelector=function(e){var t=a.createElement(u.Tooltip,null,"Search for places by map region");return a.createElement(u.OverlayTrigger,{placement:"bottom",overlay:t},a.createElement("button",{className:c("btn btn-default",T.mapSelectionButton),onClick:n.showMapSelection}))},n.showMapSelection=function(){var onHide=function(){return g.getOverlaySystem().hide("map-selection")};g.getOverlaySystem().show("map-selection",a.createElement(g.OverlayDialog,{show:!0,type:"lightbox",title:"Set selection on map",onHide},a.createElement(w.default,{suggestionConfig:n.props.geoSelector,onCancel:onHide,onSelect:n.onSearchAreaSelected})))},n.onSearchAreaSelected=function(e){switch(e.type){case k.SelectType.Box:n.state.store.selectTerm("place")(e.box);break;case k.SelectType.Circle:n.state.store.selectTerm("place")(e.circle)}g.getOverlaySystem().hide("map-selection")},n.hierarchyTermSelector=function(e){return a.createElement(y.SemanticTreeInput,r.__assign({className:T.hierarchySelector},n.prepareHierarchySelectorInputConfig(e)))},n.dateTermSelector=function(e){var t=n.props.id;return a.createElement(b.default,{onSelect:function(e){n.state.store.selectTerm("date-range")(e),d.trigger({eventType:N.SearchDateFormatSubmitted,source:t})},onOpen:function(){return d.trigger({eventType:N.SearchSelectDateFormatOpened,source:t})},onChange:function(e){return d.trigger({eventType:N.SearchDateFormatSelected,source:t,data:e})}})},n.droppableConfig=function(e){return{query:n.setClauseBindings(e,"\n        ASK {\n          {\n            ?value a|<http://www.wikidata.org/prop/direct/P31> $__range__ .\n          } UNION {\n            ?value a "+p.vocabularies.VocabPlatform.Set+" .\n          } UNION {\n            ?value a sp:Query .\n          }\n        }\n      "),styles:{enabled:{border:"solid 1px green"},disabled:{border:"solid 1px red"}},components:{disabledHover:a.createElement("span",null,e.range.label,", any set or saved search is required")}}},n.selectResourceTerm=function(e){return function(t,r,a,o){s.includes(t.value,"container/queryContainer")?m.QueryService().getQuery(t).onValue((function(t){return n.state.store.selectTerm(e)({query:h.SparqlUtil.parseQuerySync(t.value),label:t.label})})):n.state.store.selectTerm(e)({iri:t,label:r,description:a,tuple:o})}},n.relationSelectorPlaceholder=function(){return a.createElement("div",{className:T.relationPlaceholder},"... related to")},n.categorySelection=function(e,t,r,o){return a.createElement(x.default,{mode:n.props.context.baseConfig.selectorMode,tupleTemplate:n.props.categoryViewTemplate,resources:e,className:t,itemClassName:T.categorySelectionItem,label:o,actions:{selectResource:function(e){r(e),d.trigger({eventType:N.CategoryOrRelationSelected,source:n.props.id,data:e.iri.value})}}})},n.nestedSearchButton=function(e){var t=a.createElement(u.Tooltip,null,"Search for ",l.noun(e.label).pluralize()," related to...");return a.createElement(u.OverlayTrigger,{placement:"bottom",overlay:t},a.createElement("button",{className:c("btn btn-default",T.nestedSearchButton),onClick:n.state.store.selectSubSearchTerm},a.createElement("span",{style:{position:e.thumbnail?"absolute":"relative"},className:T.magnifierIcon}),e.thumbnail?a.createElement("img",{src:e.thumbnail}):null))},n.getTreeSelectorConfigForRelation=function(e){var t=n.props,r=t.treeSelectorRelations,a=t.treeSelector,o=t.treeSelectorCategories;return s.has(r,e.iri.toString())?r[e.iri.toString()]:s.has(o,e.hasRange.iri.toString())?o[e.hasRange.iri.toString()]:a},n.getResourceSelectorConfigForRelation=function(e){var t=n.props,r=t.resourceSelector,a=t.resourceSelectorRelations,o=t.resourceSelectorCategories;return s.has(a,e.iri.toString())?a[e.iri.toString()]:s.has(o,e.hasRange.iri.toString())?o[e.hasRange.iri.toString()]:r},n.state={store:null,searchState:null,search:i.Nothing(),isSearchCollapsed:!1},n}return r.__extends(QueryBuilderInner,e),QueryBuilderInner.prototype.componentDidMount=function(){this.props.context.searchProfileStore.isJust&&this.initSearch(this.props,this.props.context)},QueryBuilderInner.prototype.componentWillReceiveProps=function(e){var t=e.context;s.isEqual(t,this.props.context)||this.initSearch(e,t)},QueryBuilderInner.prototype.initSearch=function(e,t){var n=this;t.searchProfileStore.map((function(r){var a=n.state.store,o=t.extendedSearch.map((function(e){return n.props.context.extendedSearch.map((function(t){return!s.isEqual(t,e)})).getOrElse(!0)})).getOrElse(!1);a&&!o||(a=new R.SearchStore(r,t.baseConfig,e.projectionVariable,t.baseQueryStructure,t.extendedSearch),n.setState({store:a}),a.currentSearchState.onValue((function(e){return n.setState({searchState:e})})),a.currentSearch.onValue((function(e){n.setState({search:e}),e.isJust&&n.props.context.setDomain(e.get().domain),n.props.context.setBaseQueryStructure(e)})),a.currentSearchQuery.onValue(n.props.context.setBaseQuery))}))},QueryBuilderInner.prototype.renderChild=function(){var e=this.props.children;if(!e)return null;var t=a.Children.only(e);if(!v.isValidChild(t))throw new Error("Expected a single component as a child");var n=c(t.props.className,{invisible:!(this.state.searchState&&"domain-selection"===this.state.searchState.kind)});return a.cloneElement(t,{className:n})},QueryBuilderInner.prototype.render=function(){return a.createElement("div",{className:T.searchAreaHolder},this.renderChild(),this.renderSearchArea(),this.state.search.isJust?a.createElement("hr",null):null)},QueryBuilderInner.prototype.renderSearchArea=function(){return this.state.search.isJust&&this.props.context.searchProfileStore.isJust?this.renderSearch(this.state.search.get(),this.state.searchState):this.state.searchState&&this.props.context.searchProfileStore.isJust?a.createElement("div",{className:T.searchArea},this.renderSearchState(this.state.searchState)):null},QueryBuilderInner.prototype.renderSearchState=function(e){return"domain-selection"===e.kind?a.createElement("div",null,this.searchSummary(),this.domainSelection(e)):"extended-domain-selection"===e.kind?this.renderExtendedDomainSelection(e):"extended-relation-selection"===e.kind?this.renderExtendedRelationSelection(e):a.createElement("div",{className:T.searchClauseArea},this.renderActiveSearchClause(e,!1))},QueryBuilderInner.prototype.isNewConjunct=function(e,t){return!!t&&(s.head(e.conjuncts).conjunctIndex.length===t.conjunctIndex.length&&e.conjuncts.length<=s.last(t.conjunctIndex))},QueryBuilderInner.prototype.isActiveClause=function(e,t){return!!t&&s.isEqual(t.conjunctIndex,e)},QueryBuilderInner.prototype.renderActiveSearchClause=function(e,t,n){switch(e.kind){case"range-selection":return this.rangeSelection(e,t);case"relation-selection":return this.relationSelection(e,t);case"term-selection":return this.termSelection(e,t,n);case"text-term-selection":return this.textTermSelection(e,n,t)}},QueryBuilderInner.prototype.domainSelection=function(e){return this.categorySelection(e.domains,T.domainSelection,this.state.store.selectDomain,"search domain category selection")},QueryBuilderInner.prototype.rangeSelection=function(e,t){return o.div({className:T.searchClause},this.renderDomain(e.domain,t),this.relationSelectorPlaceholder(),this.categorySelection(e.ranges,T.rangeSelection,this.state.store.selectRange,"search range category selection"),this.removeActiveConjunctionButton())},QueryBuilderInner.prototype.termSelection=function(e,t,n){return[a.createElement("div",{className:T.searchClauseHolder},a.createElement("div",{className:T.searchClause},this.renderDomain(e.domain,t),this.renderRelation(e.relation,n),this.renderRange(e.range,n),n?this.renderSimpleTerms(n):null,this.removeActiveConjunctionButton()),a.createElement("div",{className:T.activeTerm},this.termSelector(e,t)),n?this.renderNestedTerms(n.disjuncts,e):null)]},QueryBuilderInner.prototype.textTermSelection=function(e,t,n){return[a.createElement("div",{className:T.searchClauseHolder},a.createElement("div",{className:T.searchClause},this.renderDomain(e.domain,n),this.textSearchRelationPlaceholder(),t?this.renderSimpleTerms(t):null,this.removeActiveConjunctionButton()),a.createElement("div",{className:T.activeTerm},this.textDisjunctSelector(e)))]},QueryBuilderInner.prototype.termSelector=function(e,t){if(s.includes(e.termKind,"nested-search"))return this.nestedSearch(e);if(s.includes(e.termKind,"date-range"))return a.createElement("div",{className:T.searchBasedTermSelectorHolder},this.dateTermSelector(e));var n=e.range.label,r="Find "+l.noun(n).article()+" "+n+": ";return a.createElement("div",{className:T.searchBasedTermSelectorHolder},a.createElement("div",{className:T.searchBasedTermSelector},a.createElement("span",{className:T.searchBasedTermSelectorLabel},r),this.searchBasedTermSelector(e),s.includes(e.termKind,"place")?this.placeTermSelector(e):null,t?null:this.nestedSearchButton(e.range)))},QueryBuilderInner.prototype.searchBasedTermSelector=function(e){return s.includes(e.termKind,"hierarchy")?this.hierarchyTermSelector(e):this.resourceTermSelector(e)},QueryBuilderInner.prototype.nestedSearch=function(e){return a.createElement("div",{className:T.nestedSearchHolder},a.createElement("div",{className:T.whereSeparator},"WHERE"),this.renderActiveSearchClause(e.state,!0))},QueryBuilderInner.prototype.prepareHierarchySelectorInputConfig=function(e){var t=this,n=this.getTreeSelectorConfigForRelation(e.relation),r=this.isLightweightTreeConfig(n)?y.createDefaultTreeQueries(n):n;return s.assign(s.cloneDeep(r),{rootsQuery:this.multiDatasetQuery(e,r.rootsQuery),childrenQuery:this.multiDatasetQuery(e,r.childrenQuery),parentsQuery:this.multiDatasetQuery(e,r.parentsQuery),searchQuery:this.multiDatasetQuery(e,r.searchQuery),droppable:this.droppableConfig(e),onSelectionChanged:function(e){var n=y.TreeSelection.leafs(e);if(0!==n.size){var r=n.first(),a=r.iri,o=r.label;t.selectResourceTerm("hierarchy")(a,o.value,o.value,{}),d.trigger({eventType:N.SearchTreeInputSelected,source:t.props.id,data:a.value})}},allowForceSuggestion:!0})},QueryBuilderInner.prototype.multiDatasetQuery=function(e,t){return h.SparqlUtil.serializeQuery(C.generateQueryForMultipleDatasets(this.setClauseBindingsParsed(e,t),this.props.context.selectedDatasets,this.props.context.baseConfig.datasetsConfig))},QueryBuilderInner.prototype.prepareAutoCompletionInputConfig=function(e){var t=this,n=this.getResourceSelectorConfigForRelation(e.relation),r=n.query,a=n.defaultQuery,o=n.noSuggestionsTemplate,i=n.suggestionTupleTemplate,s=n.escapeLuceneSyntax;return{query:this.multiDatasetQuery(e,r),defaultQuery:a?this.multiDatasetQuery(e,a):void 0,droppable:this.droppableConfig(e),templates:{empty:o,suggestion:i,displayKey:function(e){return e[D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_LABEL].value}},valueBindingName:D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_IRI,labelBindingName:D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_LABEL,searchTermVariable:D.RESOURCE_SEGGESTIONS_VARIABLES.SEARCH_TERM_VAR,actions:{onSelected:function(e){return t.selectResourceTerm("resource")(e[D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_IRI],e[D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_LABEL].value,e[D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_LABEL].value,e)}},escapeLuceneSyntax:s,allowForceSuggestion:!0}},QueryBuilderInner.prototype.setClauseBindingsParsed=function(e,t){var n,r,a,o=h.SparqlUtil.parseQuery(t),i=C.tryGetRelationPatterns(this.props.context.baseConfig,e.relation).find((function(e){return"resource"===e.kind}));if(i){a=h.SparqlUtil.parsePatterns(i.queryPattern,o.prefixes);var c=new h.VariableRenameBinder(D.SEMANTIC_SEARCH_VARIABLES.RESOURCE_VAR,D.RESOURCE_SEGGESTIONS_VARIABLES.SUGGESTION_IRI);a.forEach((function(e){return c.pattern(e)}))}else a=h.SparqlUtil.parsePatterns(I.DefaultResourceSelectorRelationPattern,o.prefixes);new h.PatternBinder(D.SEMANTIC_SEARCH_VARIABLES.RELATION_PATTERN_VAR,a).sparqlQuery(o);var l=s.assign(((n={})[D.SEMANTIC_SEARCH_VARIABLES.RELATION_VAR]=e.relation.iri,n[D.SEMANTIC_SEARCH_VARIABLES.DOMAIN_VAR]=e.domain.iri,n[D.SEMANTIC_SEARCH_VARIABLES.RANGE_VAR]=e.range.iri,n),((r={})[D.SEMANTIC_SEARCH_VARIABLES.SELECTED_ALIGNMENT]=this.props.context.selectedAlignment.map((function(e){return e.iri})).getOrElse(void 0),r));return h.SparqlClient.setBindings(o,l)},QueryBuilderInner.prototype.setClauseBindings=function(e,t){return h.SparqlUtil.serializeQuery(this.setClauseBindingsParsed(e,t))},QueryBuilderInner.prototype.relationSelector=function(e,t){var n=this;return a.createElement(x.default,{mode:this.props.context.baseConfig.selectorMode,tupleTemplate:this.props.relationViewTemplate,resources:e.mapKeys((function(e){return e.value.iri})).toOrderedMap(),className:T.relationSelector,label:"search relation selection",actions:{selectResource:function(e){t(e),d.trigger({eventType:N.CategoryOrRelationSelected,source:n.props.id,data:e.iri.value})}}})},QueryBuilderInner.prototype.isLightweightTreeConfig=function(e){return!s.has(e,"rootsQuery")},QueryBuilderInner.defaultProps={categoryViewTemplate:I.CategoryViewTemplate,relationViewTemplate:I.RelationViewTemplate,resourceSelector:{query:I.DefaultResourceSelectorQuery(),suggestionTupleTemplate:I.DefaultResourceSelectorSuggestionTemplate,noSuggestionsTemplate:I.DefaultResourceSelectorNoSuggestionsTemplate},projectionVariable:"subject",treeSelectorRelations:[],treeSelectorCategories:[]},QueryBuilderInner}(a.Component);t.default=F},2365:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(20);n(1248);var i,s=n(1919),c=n(1922),l=n(1732),u=n(2197),d=n(2194),p=n(1806),m=n(1731),h=n(1805),S=n(1931),g=n(1807),f=n(1644),v=n(1583),y=n(1925),E=n(3396),j=n(2166),C=n(16),D=n(7),I=n(1516);!function(e){e[e.Box=0]="Box",e[e.Circle=1]="Circle"}(i=t.SelectType||(t.SelectType={}));var x="researchspace-map-selection",T=function(e){function OLMapSelection(t){var n=e.call(this,t)||this;return n.geometryFunction=function(e,t){t||(t=new f.default(null));var n=e[0],r=e[1];return t.setCoordinates([[n,[n[0],r[1]],r,[r[0],n[1]],n]]),t},n.state={selectionTool:i.Box},n}return r.__extends(OLMapSelection,e),OLMapSelection.prototype.componentDidMount=function(){var e=this;this.vectorSource=new l.default({wrapX:!1});var t=new m.default({fill:new g.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new h.default({color:"#ffcc33",width:2}),image:new S.default({radius:7,fill:new g.default({color:"#ffcc33"})})}),n=new p.default({source:this.vectorSource,style:t});this.view=new c.default({center:v.default.fromLonLat([0,0],void 0),zoom:3}),this.map=new s.default({target:o.findDOMNode(this.refs[x]),layers:[new d.default({source:new u.default}),n],controls:y.default.defaults({attributionOptions:{collapsible:!1}}),view:this.view}),this.updateCurrentDraw(),this.vectorSource.on("change",(function(t){e.vectorSource.getFeatures().length>0&&e.updateSelection()}))},OLMapSelection.prototype.componentWillReceiveProps=function(e){e.zoomTo&&(this.view.setCenter(v.default.transform([e.zoomTo.long,e.zoomTo.lat],"EPSG:4326","EPSG:3857")),this.view.setZoom(e.zoomTo.zoomLevel))},OLMapSelection.prototype.transformToWGS84=function(e){return v.default.transform(e,"EPSG:3857","EPSG:4326")},OLMapSelection.prototype.wrapLongitudeOL=function(e){var t=e[0],n=e[1];return[this.wrapLong(t),n]},OLMapSelection.prototype.wrapLongitude=function(e){var t=e.lat,n=e.long;return{lat:t,long:this.wrapLong(n)}},OLMapSelection.prototype.wrapLong=function(e){for(;e>180;)e-=360;for(;e<-180;)e+=360;return e},OLMapSelection.prototype.updateSelection=function(){var e,t=this.vectorSource.getFeatures()[0];switch(this.state.selectionTool){case i.Box:var n=t.getGeometry().getCoordinates()[0],r=C.map(n,this.transformToWGS84),a={lat:r[0][1],long:r[0][0]},o={lat:r[2][1],long:r[2][0]},s={lat:C.minBy([a,o],(function(e){return e.lat})).lat,long:C.minBy([a,o],(function(e){return e.long})).long},c={lat:C.maxBy([a,o],(function(e){return e.lat})).lat,long:C.maxBy([a,o],(function(e){return e.long})).long};c.long-s.long>=360&&(c.long=180,s.long=-180),e={type:i.Box,box:{southWest:this.wrapLongitude(s),northEast:this.wrapLongitude(c)}};break;case i.Circle:var l=t.getGeometry(),u=l.getCenter(),d=l.getRadius(),p=this.transformToWGS84([u[0]+d,u[1]]),m=new j.default(6378137),h=this.transformToWGS84(u),S=m.haversineDistance(h,p),g=this.wrapLongitudeOL(h);e={type:i.Circle,circle:{center:{lat:g[1],long:g[0]},distance:S/1e3}}}this.props.onSelect(e)},OLMapSelection.prototype.updateCurrentDraw=function(){var e=this;this.currentDraw&&this.map.removeInteraction(this.currentDraw),this.currentDraw=new E.default({source:this.vectorSource,type:this.state.selectionTool===i.Box?"LineString":"Circle",geometryFunction:this.state.selectionTool===i.Box?this.geometryFunction:void 0,maxPoints:2,wrapX:!1}),this.currentDraw.on("drawstart",(function(t){return e.vectorSource.clear()})),this.map.addInteraction(this.currentDraw)},OLMapSelection.prototype.componentDidUpdate=function(e,t){t.selectionTool!==this.state.selectionTool&&this.updateCurrentDraw()},OLMapSelection.prototype.setSelectionTool=function(e){this.setState(C.assign({},this.state,{selectionTool:e}))},OLMapSelection.prototype.render=function(){var e,t,n=this,r=this.state.selectionTool;return a.createElement("div",{className:I.body},a.createElement("div",{className:I.tools},a.createElement("div",{className:I.btnsWrap,role:"group"},a.createElement("button",{onClick:function(){return n.setSelectionTool(i.Box)},className:D(I.toolsBtnSquare,(e={},e[I.btnActive]=r===i.Box,e))}),a.createElement("button",{onClick:function(){return n.setSelectionTool(i.Circle)},className:D(I.toolsBtnCircle,(t={},t[I.btnActive]=r===i.Circle,t))}))),a.createElement("div",{className:I.map,ref:x}))},OLMapSelection}(a.Component);t.OLMapSelection=T,t.default=T},3390:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(1),i=n(20),s=n(7),c=n(16),l=n(33),u=n(1559),d=n(630),p=n(1510),m=function(e){function StackSelector(t,n){var r=e.call(this,t,n)||this;return r.focusItem=function(e){r.setState({focusedOption:l.Just(e)})},r.handleKeyDown=function(e){switch(e.keyCode){case 13:r.state.focusedOption.map(r.props.actions.selectResource);break;case 38:r.focusPreviousOption();break;case 40:case 9:r.focusNextOption()}e.preventDefault()},r.focusNextOption=function(){r.setState((function(e){return{focusedOption:e.focusedOption.map((function(e){var t=r.props.resources.keySeq(),n=t.indexOf(e.iri)+1,a=t.size===n?t.first():t.get(n);return r.props.resources.get(a)}))}}))},r.focusPreviousOption=function(){r.setState((function(e){return{focusedOption:e.focusedOption.map((function(e){var t=r.props.resources.keySeq(),n=t.indexOf(e.iri)-1,a=0===t.size?t.get(t.size-1):t.get(n);return r.props.resources.get(a)}))}}))},r.state={focusedOption:l.Nothing()},r}return r.__extends(StackSelector,e),StackSelector.prototype.componentDidMount=function(){this.setState({focusedOption:l.fromNullable(this.props.resources.first())})},StackSelector.prototype.componentDidUpdate=function(){var e=this;this.state.focusedOption.map((function(t){return e.refs[t.iri.value].focus()}))},StackSelector.prototype.render=function(){var e=this,t=this.props,n=t.tupleTemplate,r=t.className,o=t.resources,i=t.actions,c=t.itemClassName,l=t.label,u=o.map((function(t){return a.createElement("li",{key:t.iri.value,ref:t.iri.value,className:s("btn",p.itemHolder,c),tabIndex:0,"aria-label":t.label,role:"option",onMouseOver:function(){return e.focusItem(t)},onClick:function(n){return e.props.actions.selectResource(t)}},renderResource(n,t,i.selectResource))}));return a.createElement("ul",{role:"listbox",tabIndex:0,"aria-label":l,onKeyDown:this.handleKeyDown,className:s(p.itemSelector,r)},u.toArray())},StackSelector}(o.Component),h=function(e){function DropdownSelector(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSelectMounted=function(e){e&&i.findDOMNode(e).setAttribute("aria-label",t.props.label)},t}return r.__extends(DropdownSelector,e),DropdownSelector.prototype.render=function(){var e=this.props,t=e.tupleTemplate,n=e.className,r=e.resources,o=e.actions,i=e.itemClassName;return a.createElement(u.default,{ref:this.onSelectMounted,className:s(p.itemSelector,p.dropdown,n),autofocus:!0,openOnFocus:!0,value:null,options:r.toArray(),optionRenderer:function(e){return renderResource(t,e,o.selectResource,i)},onChange:function(e){return o.selectResource(e)}})},DropdownSelector}(o.Component);function renderResource(e,t,n,r){var o=c.assign({},t.tuple,t);return a.createElement(d.TemplateItem,{template:{source:e,options:o},componentProps:{className:r}})}t.renderResource=renderResource;var S=function(e){function ItemSelector(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(ItemSelector,e),ItemSelector.prototype.render=function(){return"dropdown"===this.props.mode?a.createElement(h,r.__assign({},this.props)):a.createElement(m,r.__assign({},this.props))},ItemSelector}(o.Component);t.ItemSelector=S,t.default=S},3391:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(33),o=n(16),i=n(214),s=n(1606),c=n(1822),l=n(1824);!function(e){e[e.Domain=0]="Domain",e[e.Range=1]="Range",e[e.Relation=2]="Relation",e[e.Disjunct=3]="Disjunct"}(r=t.EditKinds||(t.EditKinds={}));var u=function(){function SearchStore(e,t,n,l,u){var d=this;this._searchProperty=i.Action(),this._searchStateProperty=i.Action(),this._counter=0,this.domains=function(){return d.filterOnlySupportedCategories(d._profileStore.domains)},this.rangesFor=function(e){return d.filterOnlySupportedCategories(d._profileStore.rangesFor(e))},this.filterOnlySupportedCategories=function(e){return e.filterNot((function(e){var t=o.intersection(SearchStore.SupportedCategoryTypes,c.getCategoryTypes(d.config,e));return o.isEmpty(t)}))},this.extendedValueToDisjunct=function(e){return d.isResourceExtendedDisjunct(e)?{kind:s.EntityDisjunctKinds.Resource,value:e,conjunctIndex:[0],disjunctIndex:[0,0]}:{kind:s.EntityDisjunctKinds.SavedSearch,value:{query:e.query,label:e.label},conjunctIndex:[0],disjunctIndex:[0,0]}},this.isResourceExtendedDisjunct=function(e){return o.has(e,"iri")},this.selectExtendedDomain=function(e){d.searchState=o.assign({},d._searchState,{kind:"extended-relation-selection",domain:e,relations:d._profileStore.relationsFor({domain:a.Just(e),range:a.Just(d._searchState.range)})})},this.selectExtendedRelation=function(e){var t=d._searchState;d.search=a.Just({domain:t.domain,conjuncts:[{kind:s.ConjunctKinds.Relation,range:t.range,relation:e,conjunctIndex:[0],disjuncts:[t.disjunct]}]}),d.searchState=null},this.edit=function(e,t,n){if(e===r.Domain)return d.search=a.Nothing(),void(d.searchState={kind:"domain-selection",domains:d.domains()});if(t||n){var i=d._search.get().domain;switch(e){case r.Range:if(t.conjunctIndex.length>1){var s=d.getConjunctByIndex(d._search.get(),o.dropRight(t.conjunctIndex,2));if(d.removeConjunction(t),d._search.isJust)d.addConjunction(d._search.get().conjuncts[0]),d.selectRange(s.range),d.selectRelation(s.relation),d.selectSubSearchTerm();else(c=o.clone([0,0])).push(0),d.searchState={kind:"term-selection",termKind:["nested-search"],domain:i,range:s.range,relation:s.relation,conjunctIndex:[0],disjunctIndex:[0,0],state:{kind:"range-selection",domain:s.range,ranges:d.rangesFor(s.range),conjunctIndex:c}}}else d.removeConjunction(t),d._search.isJust?d.addConjunction(d._search.get().conjuncts[0]):d.selectDomain(i);break;case r.Relation:if(t.conjunctIndex.length>1){s=d.getConjunctByIndex(d._search.get(),o.dropRight(t.conjunctIndex,2));if(d.removeConjunction(t),d._search.isJust)d.addConjunction(d._search.get().conjuncts[0]),d.selectRange(s.range),d.selectRelation(s.relation),d.selectSubSearchTerm(),d.selectRange(t.range);else(c=o.clone([0,0])).push(0),d.searchState=d._selectRange({kind:"term-selection",termKind:["nested-search"],domain:i,range:s.range,relation:s.relation,conjunctIndex:[0],disjunctIndex:[0,0],state:{kind:"relation-selection",domain:s.range,conjunctIndex:c,range:void 0,relations:void 0}},t.range)}else d.removeConjunction(t),d._search.isJust?(d.addConjunction(d._search.get().conjuncts[0]),d.selectRange(t.range)):(d.selectDomain(i),d.selectRange(t.range));break;case r.Disjunct:if(t.conjunctIndex.length>1){var c;s=d.getConjunctByIndex(d._search.get(),o.dropRight(t.conjunctIndex,2));if(d.removeDisjunct(t,n),d._search.isJust)0===t.disjuncts.length?(d.addConjunction(d._search.get().conjuncts[0]),d.selectRange(s.range),d.selectRelation(s.relation),d.selectSubSearchTerm(),d.selectRange(t.range),d.selectRelation(t.relation)):d.addDisjunction(t);else(c=o.clone([0,0])).push(0),d.searchState=d._selectRelation({kind:"term-selection",termKind:["nested-search"],domain:i,range:s.range,relation:s.relation,conjunctIndex:[0],disjunctIndex:[0,0],state:{kind:"relation-selection",domain:s.range,range:t.range,conjunctIndex:c,relations:void 0}},t.relation)}else d.removeDisjunct(t,n),t.disjuncts.length>0?d.addDisjunction(t):d._search.isJust?(d.addConjunction(d._search.get().conjuncts[0]),d.selectRange(t.range),d.selectRelation(t.relation)):(d.selectDomain(i),d.selectRange(t.range),d.selectRelation(t.relation))}}else switch(e){case r.Range:d.isNestedSearch(d._searchState)?d.selectSubSearchTerm():d.selectDomain(d._searchState.domain);break;case r.Relation:d.selectRange(d._searchState.range)}},this.selectDomain=function(e){d.searchState={kind:"range-selection",domain:e,ranges:d.rangesFor(e),conjunctIndex:[0]}},this.selectRange=function(e){var t=d._searchState;d.searchState=d._selectRange(t,e)},this._selectRange=function(e,t){var n=d.getDeepestActiveState(e);if(o.includes(c.getCategoryTypes(d.config,t),"text"))return d.updateNestedState(e,d.selectTextDisjunctState(n,t));var r=d.selectRelationState(n,t);if(1===r.relations.size){var a=r.relations.first();r=d.selectTermState(r,a)}return d.updateNestedState(e,r)},this.isNestedSearch=function(e){return"term-selection"===e.kind&&o.isEqual(e.termKind,["nested-search"])},this.selectRelation=function(e){var t=d._searchState;d.searchState=d._selectRelation(t,e)},this._selectRelation=function(e,t){var n=d.getDeepestActiveState(e);return d.updateNestedState(e,d.selectTermState(n,t))},this.selectTermState=function(e,t){var n=e.conjunctIndex,r=o.clone(n);return r.push(0),o.assign({},e,{kind:"term-selection",termKind:d.getRelationDisjunctKinds(t),relation:t,disjunctIndex:r})},this.getConjunctType=function(e){return"text-term-selection"===e.kind?s.ConjunctKinds.Text:s.ConjunctKinds.Relation},this.getDisjunctType=function(e,t,n){if("text-term-selection"===e.kind)return s.TextDisjunctKind;if(n.iri&&o.includes(n.iri.value,"container/setContainer"))return s.EntityDisjunctKinds.Set;if(n.query)return s.EntityDisjunctKinds.SavedSearch;switch(t){case"resource":case"hierarchy":return s.EntityDisjunctKinds.Resource;case"date-range":return n.dateFormat;case"place":return n.center?s.SpatialDisjunctKinds.Distance:s.SpatialDisjunctKinds.BoundingBox}},this.getDisjunctValue=function(e){return e.dateFormat?e.value:e},this.selectTerm=function(e){return function(t){var n=d._searchState,r=(n.domain,n.range),i=n.conjunctIndex;if(d._search.isJust)if(o.isEqual(n.termKind,["nested-search"]))d.search=a.Just(d.updateNestedSearchTerm(d._search.get(),n,t,e));else{var c=d.getConjunctByIndex(d._search.get(),i);if(c)c.disjuncts.push({kind:d.getDisjunctType(n,e,t),value:d.getDisjunctValue(t),disjunctIndex:d.newDisjunctIndex(c)}),d.search=d._search;else{var l=d.getSearchBaseForConjunct(d._search.get(),i),u={uniqueId:d._counter++,kind:d.getConjunctType(n),range:r,conjunctIndex:i,disjuncts:[]};u.kind===s.ConjunctKinds.Relation&&(u.relation=n.relation),u.disjuncts.push({kind:d.getDisjunctType(n,e,t),disjunctIndex:d.newDisjunctIndex(u),value:d.getDisjunctValue(t)}),l.conjuncts.push(u),d.search=d._search}}else d.search=a.Just(d.createInitialSearch(d._searchState,t,e));d.searchState=null}},this.updateNestedSearchTerm=function(e,t,n,r){var a=t.state,i=d.getConjunctByIndex(e,t.conjunctIndex);if(i){var c=d.newDisjunctIndex(i);return(l=o.clone(c)).push(0),(u={uniqueId:d._counter++,kind:d.getConjunctType(a),range:a.range,relation:a.relation,conjunctIndex:l,disjuncts:[]}).disjuncts.push({kind:d.getDisjunctType(a,r,n),disjunctIndex:d.newDisjunctIndex(u),value:n}),i.disjuncts.push({kind:s.EntityDisjunctKinds.Search,value:{domain:a.domain,conjuncts:[u]},disjunctIndex:c}),e}var l,u={kind:s.ConjunctKinds.Relation,range:t.range,relation:t.relation,conjunctIndex:t.conjunctIndex,disjuncts:[]};c=d.newDisjunctIndex(u);(l=o.clone(c)).push(0);var p={uniqueId:d._counter++,kind:d.getConjunctType(a),range:a.range,relation:a.relation,conjunctIndex:l,disjuncts:[]};return p.disjuncts.push({kind:d.getDisjunctType(t,r,n),disjunctIndex:d.newDisjunctIndex(p),value:d.getDisjunctValue(n)}),u.disjuncts.push({kind:s.EntityDisjunctKinds.Search,disjunctIndex:c,value:{domain:a.domain,conjuncts:[p]}}),e.conjuncts.push(u),e},this.createInitialSearch=function(e,t,n,r){void 0===r&&(r=1);var a=o.includes(e.termKind,"nested-search");return{domain:e.domain,conjuncts:[{uniqueId:d._counter++,kind:"text-term-selection"===e.kind?s.ConjunctKinds.Text:s.ConjunctKinds.Relation,range:e.range,relation:e.relation,conjunctIndex:o.fill(Array(r),0),disjuncts:[{kind:a?s.EntityDisjunctKinds.Search:d.getDisjunctType(e,n,t),value:a?d.createInitialSearch(e.state,t,n,r+2):d.getDisjunctValue(t),disjunctIndex:o.fill(Array(r+1),0)}]}]}},this.selectSubSearchTerm=function(){var e=d._searchState,t=e.range,n=e.disjunctIndex,r=o.clone(n);r.push(0),d.searchState=o.assign({},d._searchState,{kind:"term-selection",termKind:["nested-search"],state:{kind:"range-selection",domain:t,ranges:d.rangesFor(t),conjunctIndex:r}})},this.addConjunction=function(e){var t=d.getSearchBaseForConjunct(d._search.get(),e.conjunctIndex),n=t.domain,r=t.conjuncts,a=o.clone(o.last(r).conjunctIndex);a[a.length-1]=r.length,d.searchState={kind:"range-selection",domain:n,ranges:d.rangesFor(n),conjunctIndex:a}},this.addDisjunction=function(e){switch(e.kind){case s.ConjunctKinds.Relation:d.addRelationDisjunction(e);break;case s.ConjunctKinds.Text:d.addTextDisjunction(e)}},this.removeConjunction=function(e){d.getSearchBaseForConjunct(d._search.get(),e.conjunctIndex).conjuncts.splice(o.last(e.conjunctIndex),1),d.normalizeSearch(d._search.get()),o.isEmpty(d._search.get().conjuncts)?(d.searchState={kind:"domain-selection",domains:d.domains()},d.search=a.Nothing()):d.search=d._search},this.removeDisjunct=function(e,t){e.disjuncts.splice(o.last(t.disjunctIndex),1),d.normalizeSearch(d._search.get()),o.isEmpty(d._search.get().conjuncts)?(d.searchState={kind:"domain-selection",domains:d.domains()},d.search=a.Nothing()):d.search=d._search},this.resetEditMode=function(){d._search.isNothing?d.searchState={kind:"domain-selection",domains:d.domains()}:d.searchState=null},this.normalizeSearch=function(e){var t=o.reject(e.conjuncts,(function(e){return o.isEmpty(e.disjuncts)||o.isEmpty(d.removeNestedEmptyDisjuncts(e.disjuncts))}));d.updateConjunctIndexes(t),d._search.get().conjuncts=t,d.search=d._search},this.removeNestedEmptyDisjuncts=function(e){return o.reject(e,(function(e){return e.kind===s.EntityDisjunctKinds.Search&&(o.isEmpty(e.value.conjuncts)||d.isEmptyConjuncts(e.value.conjuncts))}))},this.isEmptyConjuncts=function(e){return o.every(e,(function(e){return o.isEmpty(e.disjuncts)}))},this.updateConjunctIndexes=function(e,t){void 0===t&&(t=[]),o.forEach(e,(function(e,n){var r=o.clone(t);r.push(n),e.conjunctIndex=r,o.forEach(e.disjuncts,(function(e,t){var n=o.clone(r);n.push(t),e.disjunctIndex=n,"search"===e.kind&&d.updateConjunctIndexes(e.value.conjuncts,n)}))}))},this.addRelationDisjunction=function(e){var t=d._search.get().domain,n=e.range,r=e.relation;d.searchState={kind:"term-selection",termKind:d.getRelationDisjunctKinds(r),domain:t,range:n,relation:r,conjunctIndex:e.conjunctIndex,disjunctIndex:d.newDisjunctIndex(e)}},this.addTextDisjunction=function(e){var t=d._search.get().domain,n=e.range;d.searchState={kind:"text-term-selection",domain:t,range:n,conjunctIndex:e.conjunctIndex,disjunctIndex:d.newDisjunctIndex(e)}},this.newDisjunctIndex=function(e){var t=o.clone(e.conjunctIndex);return t.push(e.disjuncts.length),t},this.getSearchBaseForConjunct=function(e,t){if(t.length<=1)return e;var n=e.conjuncts[t[0]].disjuncts[t[1]];return n?d.getSearchBaseForConjunct(n.value,t.slice(2)):null},this.getConjunctByIndex=function(e,t){var n=d.getSearchBaseForConjunct(e,t);return n?n.conjuncts[o.last(t)]:null},this.config=t,this.projectionVariable=n,this._profileStore=e,u.isJust?(this.search=a.Nothing(),this.searchState={kind:"extended-domain-selection",domains:this.domains(),range:u.get().range,disjunct:this.extendedValueToDisjunct(u.get().value)}):l.isJust?(this.searchState=null,this.search=l):(this.search=l,this.searchState={kind:"domain-selection",domains:this.domains()})}return Object.defineProperty(SearchStore.prototype,"searchState",{set:function(e){this._searchState=e,this._searchStateProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(SearchStore.prototype,"currentSearchState",{get:function(){return this._searchStateProperty.$property},enumerable:!0,configurable:!0}),Object.defineProperty(SearchStore.prototype,"search",{set:function(e){this._search=e,this._searchProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(SearchStore.prototype,"currentSearch",{get:function(){return this._searchProperty.$property},enumerable:!0,configurable:!0}),Object.defineProperty(SearchStore.prototype,"currentSearchQuery",{get:function(){var e=this;return this._searchProperty.$property.map((function(t){return t.map((function(t){return l.generateSelectQuery(e.config,e.projectionVariable,t)}))}))},enumerable:!0,configurable:!0}),SearchStore.prototype.updateNestedState=function(e,t){var n=o.clone(e),r=this.getDeepestActiveState(n);return o.assign(r,t),n},SearchStore.prototype.getDeepestActiveState=function(e){return this.isNestedSearch(e)?this.getDeepestActiveState(e.state):e},SearchStore.prototype.selectTextDisjunctState=function(e,t){var n=this._searchState.conjunctIndex,r=o.clone(n);return r.push(0),o.assign({},e,{kind:"text-term-selection",range:t,disjunctIndex:r})},SearchStore.prototype.selectRelationState=function(e,t){this._searchState.conjunctIndex;var n=this._profileStore.relationsFor({domain:a.Just(e.domain),range:a.Just(t)});return o.assign({},e,{kind:"relation-selection",range:t,relations:n})},SearchStore.prototype.getRelationDisjunctKinds=function(e){return c.getCategoryTypes(this.config,e.hasRange)},SearchStore.SupportedCategoryTypes=["resource","hierarchy","date-range","text","place","set"],SearchStore}();t.SearchStore=u},3392:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(33),i=n(7),s=n(1559),c=n(72),l=n(16),u=n(1606),d=n(3393),p=n(2363),m=n(1513),h=function(e){function DateFormatSelectorComponent(t){var n=e.call(this,t)||this;return n.initialState={showSelectorDropdown:!1,dateFormat:o.Nothing(),value:o.Nothing()},n.showDateInput=function(e){return a.createElement("div",{className:m.inputHolder},n.dateInput({kind:e}),a.createElement("button",{className:i("btn","btn-primary"),onClick:n.onSelect},"Select"))},n.onSelect=function(){n.props.onSelect({dateFormat:n.state.dateFormat.get(),value:n.state.value.get()})},n.simpleDate=function(){return[a.createElement(d.SimpleDateInput,{autoFocus:!0,onSelected:n.setSimpleDate})]},n.setSimpleDate=function(e){return n.setState({value:o.Just(e)})},n.dateRange=function(){return[a.createElement(d.SimpleDateInput,{key:"date-range-begin",autoFocus:!0,onSelected:n.setDateRangeBegin}),a.createElement("span",{className:m.dateSeparator},"to"),a.createElement(d.SimpleDateInput,{key:"date-range-end",onSelected:n.setDateRangeEnd})]},n.setDateRangeBegin=function(e){return n.setState((function(t){return{value:o.Just({begin:e,end:t.value.map((function(e){return e.end})).getOrElse(null)})}}))},n.setDateRangeEnd=function(e){return n.setState((function(t){return{value:o.Just({begin:t.value.map((function(e){return e.begin})).getOrElse(null),end:e})}}))},n.dateDeviation=function(){return[a.createElement(d.SimpleDateInput,{key:"date-deviation-date",autoFocus:!0,onSelected:n.setDateDeviationDate}),a.createElement("span",{className:m.dateSeparator},"±"),a.createElement(c.FormGroup,null,a.createElement(c.FormControl,{key:"date-deviation",type:"number",className:m.deviationInput,placeholder:"Days",required:!0,onChange:n.setDateDeviation,value:n.state.value.map((function(e){return e.deviation})).getOrElse(void 0)}))]},n.setDateDeviationDate=function(e){return n.setState((function(t){return{value:o.Just({date:e,deviation:t.value.map((function(e){return e.deviation})).getOrElse(null)})}}))},n.setDateDeviation=function(e){var t=e.target.value;n.setState((function(e){return{value:o.Just({date:e.value.map((function(e){return e.date})).getOrElse(null),deviation:t})}}))},n.year=function(){return[a.createElement(p.YearInput,{key:"year",autoFocus:!0,onChange:n.setYear})]},n.setYear=function(e){return n.setState({value:o.Just(e)})},n.yearRange=function(){return[a.createElement(p.YearInput,{key:"year-range-begin",autoFocus:!0,onChange:n.setYearRangeBegin}),a.createElement("span",{className:m.dateSeparator},"to"),a.createElement(p.YearInput,{key:"year-range-end",onChange:n.setYearRangeEnd})]},n.setYearRangeBegin=function(e){return n.setState((function(t){return{value:o.Just({begin:e,end:t.value.map((function(e){return e.end})).getOrElse(null)})}}))},n.setYearRangeEnd=function(e){return n.setState((function(t){return{value:o.Just({begin:t.value.map((function(e){return e.begin})).getOrElse(null),end:e})}}))},n.yearDeviation=function(){return[a.createElement(p.YearInput,{key:"year-deviation-year",autoFocus:!0,onChange:n.setYearDeviationYear}),a.createElement("span",{className:m.dateSeparator},"±"),a.createElement(c.FormGroup,null,a.createElement(c.FormControl,{key:"year-deviation",type:"number",className:m.deviationInput,placeholder:"Years",required:!0,value:n.state.value.map((function(e){return e.deviation})).getOrElse(void 0),onChange:n.setYearDeviation}))]},n.setYearDeviationYear=function(e){return n.setState((function(t){return{value:o.Just({year:e,deviation:t.value.map((function(e){return e.deviation})).getOrElse(null)})}}))},n.setYearDeviation=function(e){var t=e.target.value;n.setState((function(e){return{value:o.Just({year:e.value.map((function(e){return e.year})).getOrElse(null),deviation:t})}}))},n.dateSelectorDropdown=function(){var e=l.keys(u.TemporalDisjunctKinds).map((function(e){return{value:e,label:e}}));return a.createElement(s.default,{className:i(m.dateFormatSelect),options:e,value:n.state.dateFormat.getOrElse(void 0),clearable:!1,onOpen:function(){n.props.onOpen&&n.props.onOpen()},onChange:n.selectDateFormat.bind(n),optionRenderer:n.dateSelectorOptions,valueRenderer:n.dateSelectorOptions,placeholder:"Select Date or Range Type"})},n.state=n.initialState,n}return r.__extends(DateFormatSelectorComponent,e),DateFormatSelectorComponent.prototype.render=function(){var e=this;return a.createElement("div",{className:m.holder},this.dateSelectorDropdown(),this.state.dateFormat.map((function(t){return e.showDateInput(t)})).getOrElse(a.createElement("span",null)))},DateFormatSelectorComponent.prototype.dateInput=function(e){return u.matchTemporalDisjunct({Date:this.simpleDate,DateRange:this.dateRange,DateDeviation:this.dateDeviation,Year:this.year,YearRange:this.yearRange,YearDeviation:this.yearDeviation})(e)},DateFormatSelectorComponent.prototype.selectDateFormat=function(e){this.setState(l.assign({},this.initialState,{dateFormat:o.Just(e.value)})),this.props.onChange&&this.props.onChange(e.value)},DateFormatSelectorComponent.prototype.dateSelectorOptions=function(e){var t=a.createElement("div",null,a.createElement("span",{className:m.dateFormatSelect__ddMmYyyy},"DD"),a.createElement("span",{className:m.dateFormatSelect__ddMmYyyy},"MM"),a.createElement("span",{className:m.dateFormatSelect__ddMmYyyy},"YYYY")),n=a.createElement("span",{className:m.dateFormatSelect__yyyyAcBc},"year"),r={kind:e.value};return u.matchTemporalDisjunct({Date:function(){return a.createElement("div",{className:m.dateFormatSelect__option},t)},DateRange:function(){return a.createElement("div",{className:m.dateFormatSelect__option},t,a.createElement("span",{className:m.dateSeparator},"to"),t)},DateDeviation:function(){return a.createElement("div",{className:m.dateFormatSelect__option},t,a.createElement("span",{className:m.dateSeparator},"±"),a.createElement("span",{className:m.dateFormatSelectDdMmYyyyDateDeviation},"days"))},Year:function(){return a.createElement("div",{className:m.dateFormatSelect__option},n)},YearRange:function(){return a.createElement("div",{className:m.dateFormatSelect__option},n,a.createElement("span",{className:m.dateSeparator},"to"),n)},YearDeviation:function(){return a.createElement("div",{className:m.dateFormatSelect__option},n,a.createElement("span",{className:m.dateSeparator},"±"),a.createElement("span",{className:m.dateFormatSelectDdMmYyyyYearDeviation},"years"))}})(r)},DateFormatSelectorComponent}(a.Component);t.DateFormatSelectorComponent=h,t.default=h},3393:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(7),i=n(10),s=n(72),c=n(16),l=n(1512),u=function(e){function SimpleDateInput(t,n){var r=e.call(this,t,n)||this;return r.onDayChange=function(e){var t=e.target.value;if(r.state.day!==t){var n=parseInt(t);r.setState({day:t,dayIsValid:c.isNaN(n)||n<1||n>31?"error":"success"})}},r.onMonthChange=function(e){r.setState({month:e.target.value})},r.onYearChange=function(e){r.setState({year:e.target.value})},r.triggerOnSelected=function(e){var t=e.day,n=e.month,a=e.year;if(!c.isEmpty(t)&&!c.isEmpty(n)&&!c.isEmpty(a)){var o=parseInt(n)-1;r.props.onSelected(i({day:t,month:o,year:a}))}},r.state={day:"",dayIsValid:void 0,month:"",monthIsValid:void 0,year:"",yearIsValid:void 0},r}return r.__extends(SimpleDateInput,e),SimpleDateInput.prototype.render=function(){return a.createElement("div",{className:l.holder},a.createElement(s.FormGroup,{validationState:this.state.dayIsValid},a.createElement(s.FormControl,{className:o("form-control",l.day),autoFocus:this.props.autoFocus,value:this.state.day,onChange:this.onDayChange,type:"number",min:"1",max:"31",placeholder:"DD",required:!0})),a.createElement(s.FormGroup,{validationState:this.state.monthIsValid},a.createElement(s.FormControl,{className:o("form-control",l.month),value:this.state.month,onChange:this.onMonthChange,type:"number",min:"1",max:"12",placeholder:"MM",required:!0})),a.createElement(s.FormGroup,{validationState:this.state.yearIsValid},a.createElement(s.FormControl,{className:o("form-control",l.year),value:this.state.year,onChange:this.onYearChange,type:"number",placeholder:"YYYY",required:!0})))},SimpleDateInput.prototype.componentWillUpdate=function(e,t){this.triggerOnSelected(t)},SimpleDateInput}(a.PureComponent);t.SimpleDateInput=u,t.default=u},3394:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(16),i=n(72),s=n(63),c=n(1514),l=function(e){function TextSelection(t,n){var r=e.call(this,t,n)||this;return r.isButtonDisabled=function(){return o.isEmpty(r.state.textValue)},r.onValueChange=function(e){return r.setState({textValue:e.target.value})},r.submitText=function(e){return r.props.onSelect(r.state.textValue)},r.onKeyUp=function(e){13===e.keyCode&&r.submitText(e)},r.state={textValue:"",helpUrl:""},t.helpPage&&s.constructUrlForResource(t.helpPage).onValue((function(e){return r.setState({helpUrl:e.valueOf()})})),r}return r.__extends(TextSelection,e),TextSelection.prototype.render=function(){return a.createElement("div",{className:c.holder},this.props.helpPage?a.createElement("a",{href:this.state.helpUrl,target:"_blank"},a.createElement("i",{className:c.helpQuestionCircle})):null,a.createElement(i.FormGroup,{className:c.inputGroup},a.createElement(i.FormControl,{value:this.state.textValue,autoFocus:!0,onChange:this.onValueChange,onKeyUp:this.onKeyUp,placeholder:"text"})),a.createElement(i.Button,{bsStyle:"primary",disabled:this.isButtonDisabled(),onClick:this.submitText},"Find Text"))},TextSelection}(a.PureComponent);t.TextSelection=l,t.default=l},3395:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(1),i=n(139),s=n(1601),c=n(2365),l=n(1517),u=function(e){function MapSelectionOverlay(t,n){var r=e.call(this,t,n)||this;return r.confirmSelection=function(){r.props.onSelect(r.state.selection)},r.onAreaSelected=function(e){r.setState(i({},r.state,{selection:e}))},r.state={selection:void 0,zoomToOptions:void 0},r}return r.__extends(MapSelectionOverlay,e),MapSelectionOverlay.prototype.showPlaceSelector=function(){var e=this;return a.createElement(s.AutoCompletionInput,{query:this.props.suggestionConfig.query,templates:{},actions:{onSelected:function(t){e.setState(i({},e.state,{zoomToOptions:{lat:Number(t.lat.value),long:Number(t.long.value),zoomLevel:10}}))}},placeholder:"Search for place"})},MapSelectionOverlay.prototype.render=function(){return a.createElement("div",{className:l.mapSelection},a.createElement("div",{className:l.search},this.showPlaceSelector()),a.createElement(c.OLMapSelection,{onSelect:this.onAreaSelected,zoomTo:this.state.zoomToOptions}),a.createElement("div",{className:l.actions},a.createElement("div",{className:"form-group"},a.createElement("div",{className:"btn-group",role:"group"},a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.props.onCancel},"Cancel"),a.createElement("button",{type:"submit",className:"btn btn-primary",disabled:!this.state.selection,onClick:this.confirmSelection},"Select")))))},MapSelectionOverlay}(o.Component);t.MapSelectionOverlay=u,t.default=u}}]);
//# sourceMappingURL=semantic-search-query-builder-fc88a68a2f3de551f38f.js.map