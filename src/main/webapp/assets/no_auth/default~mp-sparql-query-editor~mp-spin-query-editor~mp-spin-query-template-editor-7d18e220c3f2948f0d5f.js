(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{2263:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),n=r(1),o=r(35),u=r(72),i=r(33),l=r(19),s=r(56),p=r(23),y=r(61),c=r(1212),v=r(1953);r(1445);var d=n.createFactory(u.FormGroup),f=n.createFactory(u.FormControl),g=n.createFactory(u.ControlLabel),h=n.createFactory(u.HelpBlock),b=function(e){function QueryValidatorComponent(t,r){var n=e.call(this,t,r)||this;n.label=l.pool(),n.query=l.pool(),n.fetchQuery=function(e){n.queryService.getQuery(p.Rdf.iri(e)).onValue((function(e){var t=e.label,r=e.value;n.label.plug(l.constant(t)),n.query.plug(l.constant(r))}))},n.initPool=function(){var e=n.label.flatMap(n.validateLabel);e.onValue((function(e){return n.setState({label:i.Just(e)})})).onError((function(e){return n.setState({label:i.Just(e),isValid:!1},n.onChangeResult)}));var t=n.query.flatMap(n.validateQuery);t.onValue((function(e){return n.setState({query:i.Just(e),isValid:!0},(function(){n.onChangeVariables(),n.onChangeResult()}))})).onError((function(e){return n.setState({query:i.Just(e),isValid:!1},(function(){n.onChangeVariables(),n.onChangeResult()}))})),l.combine([e.map((function(e){return e.value})).toProperty((function(){if(n.state.label.isJust)return n.state.label.get().value})),t.map((function(e){return e.value})).toProperty((function(){if(n.state.query.isJust)return n.state.query.get().value}))],(function(e,t){if(e&&t)return n.setState({isValid:!0},n.onChangeResult),{}})).onValue((function(e){return e}))},n.onChangeResult=function(){n.props.onChange&&n.props.onChange(n.getQuery(),n.state.isValid)},n.onChangeVariables=function(){if(n.props.onChangeVariables){var e=n.state.query.get().value;n.props.onChangeVariables(e.variables)}},n.validateLabel=function(e){return e.length<1?l.constantError({value:e,error:new Error("Short description is required.")}):l.constant({value:e})},n.validateQuery=function(e){return void 0===e?l.constantError({value:{query:void 0,type:void 0,queryType:void 0,variables:[]},error:new Error("Query is empty")}):y.SparqlUtil.parseQueryAsync(e).flatMap((function(t){var r="update"===t.type?"UPDATE":t.queryType;return l.constant({value:{query:e,type:t.type,queryType:r,variables:n.getVariables(t)}})})).flatMapErrors((function(t){return l.constantError({value:{query:e,type:void 0,queryType:void 0,variables:[]},error:t.error||new Error(t.message)})})).toProperty()},n.getFormValue=function(e){return l.constant(e.target.value)},n.getVariables=function(e){var t=new(function(e){function class_1(){var t=null!==e&&e.apply(this,arguments)||this;return t.variables=[],t}return a.__extends(class_1,e),class_1.prototype.variableTerm=function(t){var r=t.substr(1);return-1===this.variables.indexOf(r)&&""!==r&&this.variables.push(r),e.prototype.variableTerm.call(this,t)},class_1}(y.QueryVisitor));return t.sparqlQuery(e),t.variables},n.getQuery=function(){var e=n.state,t=e.label,r=e.query;return{label:t.isJust?t.get().value:"",value:r.isJust?r.get().value.query:"",type:r.isJust?r.get().value.type:"",queryType:r.isJust?r.get().value.queryType:""}},n.getValidationState=function(e){if(e.isJust&&e.get().error)return"error"};var o=n.context.semanticContext;return n.queryService=c.QueryService(o),n.state={label:i.Nothing(),query:i.Nothing(),isValid:!1},n}return a.__extends(QueryValidatorComponent,e),QueryValidatorComponent.prototype.componentWillMount=function(){this.initPool()},QueryValidatorComponent.prototype.componentDidMount=function(){this.onUpdateProps({},this.props)},QueryValidatorComponent.prototype.componentWillReceiveProps=function(e){this.onUpdateProps(this.props,e)},QueryValidatorComponent.prototype.onUpdateProps=function(e,t){var r=t.iri,a=t.query;if(r&&r!==e.iri)this.fetchQuery(t.iri);else if(a&&a!==e.query&&(e.query&&e.query.value===a.value||this.query.plug(l.constant(a.value)),!e.query||e.query.label!==a.label)){var n={value:a.label};this.setState({label:i.Just(n)})}},QueryValidatorComponent.prototype.render=function(){var e=this,t=this.props.viewOnly,r=this.state,a=r.label,u=r.query,i=u.isJust?u.get().value.query:"";return o.div({className:"mp-query-validator"},d({validationState:this.getValidationState(a)},g({},"Short Description*"),f({type:"text",value:a.isJust?a.get().value:"",onChange:function(t){return e.label.plug(e.getFormValue(t))},disabled:t}),"error"===this.getValidationState(a)?h({},a.get().error.message):null),d({},g({},"Query Type"),f({type:"text",value:u.isJust?u.get().value.queryType:"",disabled:!0})),t?o.pre({},o.code({},i)):n.createElement(v.SparqlEditor,{query:i,syntaxErrorCheck:!1,onChange:function(t){return e.query.plug(l.constant(t.value))}}),d({validationState:this.getValidationState(u),style:{marginBottom:0}},"error"===this.getValidationState(u)?h({style:{marginBottom:0}},u.get().error.message):null))},QueryValidatorComponent}(s.Component);t.QueryValidatorComponent=b,t.component=b,t.factory=n.createFactory(t.component),t.default=t.component}}]);
//# sourceMappingURL=default~mp-sparql-query-editor~mp-spin-query-editor~mp-spin-query-template-editor-7d18e220c3f2948f0d5f.js.map