(window.webpackJsonp=window.webpackJsonp||[]).push([[388],{1472:function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});var r=o(11),n=o(1),i=o(19),a=o(34),s=o(56),l=o(23),c=o(162),f=o(116),u=o(1294),w=o(116),d=o(72),p=o(3317),v=function(e){function WorkflowCreateComponent(t,o){var r=e.call(this,t,o)||this;return r.cancellation=new a.Cancellation,r.queryCancellation=r.cancellation.derive(),r.workflowService=new u.WorkflowService,r.state={},r}return r.__extends(WorkflowCreateComponent,e),WorkflowCreateComponent.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.subject,r=t.id,n=t.useEventSystem;if(!o&&!n)throw new Error('Component is used in the basic mode. You should provide "subject" because it wont be provided via event system.');if(n&&!r)throw new Error('You should provide "id" if you want the component to be used as event target or source.');n?this.initializeEventListener():(this.queryCancellation=this.cancellation.deriveAndCancel(this.queryCancellation),this.queryCancellation.map(this.workflowService.isWorkflowExist(l.Rdf.iri(o))).observe({value:function(t){return e.setState({exists:t})},error:function(t){return e.setState({error:t})}}))},WorkflowCreateComponent.prototype.initializeEventListener=function(){var e=this,t=this.props.id;this.cancellation.map(c.listen({eventType:p.WorkflowCreate,target:t})).observe({value:function(t){t.data&&t.data.iri?e.createWorkflowInstantiation(t.data.iri):f.addNotification({level:"error",message:'Supplied event doesn\'t provide the "iri" parameter'})},error:function(t){return e.setState({error:t})}})},WorkflowCreateComponent.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},WorkflowCreateComponent.prototype.createWorkflowInstantiation=function(e){var t=this,o=this.props,r=o.definition,n=o.assignee,a=o.firstStep,s=o.metadataQuery,u=o.newWorkflowIriTemplate,w=o.useEventSystem,d={subject:new l.Rdf.Iri(e),definition:new l.Rdf.Iri(r),firstStep:new l.Rdf.Iri(a),metadataQuery:s,assignee:new l.Rdf.Iri(n),newWorkflowIriTemplate:u};this.queryCancellation=this.cancellation.deriveAndCancel(this.queryCancellation),this.queryCancellation.map(this.workflowService.isWorkflowExist(d.subject)).flatMap((function(o){return o?(f.addNotification({level:"error",message:'The worflow instantiation for "'+e+'" already exists.'}),i.never()):t.workflowService.createWorkflowInstantiation(d)})).observe({value:function(o){f.addNotification({level:"success",message:"The workflow instantiation has been created."}),w&&(c.trigger({eventType:p.WorkflowCreated,source:t.props.id,data:{iri:o.value}}),c.trigger({eventType:p.SubjectGetInWorkflow,source:t.props.id,data:{iri:e}})),t.setState({exists:!w,error:void 0})},error:function(e){f.addNotification({level:"error",message:"The workflow instantiation hasn't been created."}),t.setState({error:e})}})},WorkflowCreateComponent.prototype.render=function(){var e=this,t=this.props,o=t.className,r=t.useEventSystem,i=t.subject;if(r)return null;var a=this.state,s=a.error,l=a.exists;return r?null:n.createElement("div",{className:o},n.createElement("button",{className:"btn btn-success",disabled:l,title:l?'Worflow instantiation for "'+i+'" already exists.':"Create workflow instantiation",onClick:function(){e.createWorkflowInstantiation(i)}},"Create workflow"),s?n.createElement(d.Alert,{bsStyle:"warning"},n.createElement(w.ErrorPresenter,{error:s})):null)},WorkflowCreateComponent}(s.Component);t.WorkflowCreateComponent=v,t.default=v},3317:function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});var r=o(162).EventMaker;t.WorkflowCreate=r("Workflow.Create"),t.WorkflowCreated=r("Workflow.Created"),t.SubjectGetInWorkflow=r("Workflow.SubjectGetInWorkflow")}}]);
//# sourceMappingURL=mp-workflow-create-acb1979e5c6466d6320d.js.map