(window.webpackJsonp=window.webpackJsonp||[]).push([[450],{1494:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,a=n(11),o=n(1),l=n(7),i=n(72),s=n(34),c=n(56),d=n(117),u=n(327),g=n(23),p=n(1274),h=n(1284),m=n(1240),f=n(1241),S=n(1242),v=n(116),y=n(1581),N=n(1700),E=n(2346),T=n(3341),A=n(1990),P=n(3342),C=n(3343),M=n(2347),b=n(1302);!function(e){e[e.Loading=1]="Loading",e[e.Success=2]="Success",e[e.Error=3]="Error"}(r||(r={}));var x=function(e){function AlignmentTool(t,n){var l=e.call(this,t,n)||this;return l.cancellation=new s.Cancellation,l.onSourcePanelMount=function(e){l.sourcePanel=e},l.onSourceRequestMore=function(e){l.controller.requestMore(M.AlignementRole.Source,e)},l.onSourceExpandOrCollapse=function(e,t){l.controller.expandOrCollapse(M.AlignementRole.Source,e,t)},l.onSourceSelectionChanged=function(e){l.controller.setSelection(M.AlignementRole.Source,e)},l.onSourceExpandAndScroll=function(e,t){l.controller.expandAndScrollToPath(M.AlignementRole.Source,e,t)},l.onSourceCancelExpanding=function(){l.controller.cancelExpandingToScroll(M.AlignementRole.Source)},l.onSourceFindAligned=function(e){var t=assertLoaded(l.state),n=t.target.forest.getFirst(e);if(n){var r=t.target.forest.getKeyPath(n);l.controller.expandAndScrollToPath(M.AlignementRole.Target,r,n.base)}},l.onTargetPanelMount=function(e){l.targetPanel=e},l.onTargetRequestMore=function(e){l.controller.requestMore(M.AlignementRole.Target,e)},l.onTargetExpandOrCollapse=function(e,t){l.controller.expandOrCollapse(M.AlignementRole.Target,e,t)},l.onTargetExpandAndScroll=function(e,t){l.controller.expandAndScrollToPath(M.AlignementRole.Target,e,t)},l.onTargetCancelExpanding=function(){l.controller.cancelExpandingToScroll(M.AlignementRole.Target)},l.onDragStart=function(e){l.controller.enqueueStateUpdate((function(){return{draggedNodes:e}}))},l.onDragEnd=function(){l.controller.enqueueStateUpdate((function(){return{draggedNodes:void 0}}))},l.onAlign=function(e,t){if(0!==e.length){var n=assertLoaded(l.state);if(1===e.length){var r=e[0];!function showAlignmentRelationDialog(e){var t=e.sourceNode,n=e.targetNode,r=e.onSubmit,onDialogClose=function(){d.getOverlaySystem().hide(T.ConfirmAlignDialog.KEY)};d.getOverlaySystem().show(T.ConfirmAlignDialog.KEY,o.createElement(T.ConfirmAlignDialog,{sourceNode:t,targetNode:n,onSubmit:function(e){onDialogClose(),r(e)},onClose:onDialogClose}))}({sourceNode:r.base,targetNode:n.target.forest.fromKeyPath(t).base,onSubmit:function(e){l.controller.alignNodes(t,[{kind:e,sourceNode:r}])}})}else{var a=e.map((function(e){return{sourceNode:e,kind:N.AlignKind.NarrowerMatch}}));l.controller.alignNodes(t,a)}}},l.onUnalign=function(e){l.controller.unalignNode(e)},l.onScrollToEntry=function(e){var t=assertLoaded(l.state),n=t.source.forest.getFirst(y.Node.keyOf(e.targetAligned.aligned)),r=t.source.forest.getKeyPath(n);l.controller.expandAndScrollToPath(M.AlignementRole.Source,r,e.targetAligned.aligned);var a=e.targetBase.base||e.targetBase.aligned,o=t.target.forest.getFirst(y.Node.keyOf(a)),i=t.target.forest.getKeyPath(o);l.controller.expandAndScrollToPath(M.AlignementRole.Target,i,a)},l.loadAlignment=function(){var e=l.props,t=e.alignmentContainer,n=e.queries,o=l.service.get(g.Rdf.iri(t)).map((function(e){return A.deserializeAlignment(e)})).flatMap((function(e){return l.controller.loadState(n,e)})).toProperty();l.cancellation.map(o).observe({value:function(e){return l.setState(a.__assign({type:r.Success},e))},error:function(e){v.addNotification({level:"error",message:"Failed to load alignment state."},e),l.setState({type:r.Error})}})},l.onCancelUnsaved=function(){l.loadAlignment()},l.onSaveAlignments=function(){var e=l.props.alignmentContainer,t=assertLoaded(l.state),n=t.metadata,r=t.target,a=A.exportAlignment(r.forest,n),o=A.serializeAlignment(a);l.cancellation.map(l.service.update(g.Rdf.iri(e),o)).observe({value:function(){v.addNotification({level:"success",message:"Successfully updated the alignment."}),l.controller.setSavedState()},error:function(e){return v.addNotification({level:"error",message:"Error while updating the alignment."},e)}})},l.service=new E.AlignmentService(l.context.semanticContext),l.controller=new M.ToolController({cancellation:l.cancellation,updateState:function(e,t){l.setState((function(t){return e(assertLoaded(t))}),(function(){return t(assertLoaded(l.state))}))},getSparqlOptions:function(){return{context:l.context.semanticContext}},scrollToPath:function(e,t){(e===M.AlignementRole.Source?l.sourcePanel:l.targetPanel).scrollToPath(t)},showValidationError:function(e){v.addNotification({level:"warning",message:e})}}),l.state={type:r.Loading},l}return a.__extends(AlignmentTool,e),AlignmentTool.prototype.componentDidMount=function(){this.loadAlignment()},AlignmentTool.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},AlignmentTool.prototype.render=function(){var e=this.props,t=e.className,n=e.style;if(this.state.type===r.Loading)return o.createElement("div",{className:l(b.component,t)},o.createElement(u.Spinner,null));if(this.state.type===r.Error)return null;var a=this.state,s=a.source,c=a.target,d=a.draggedNodes,g=a.matches,v=a.savedMatches;return o.createElement("div",{className:l(b.component,t),style:n},o.createElement(p.SplitPaneComponent,{id:"alignment-tool-pane",dock:!1,minSize:300},o.createElement(h.Panel,{className:b.leftPanel},o.createElement(m.PanelHeader,null,o.createElement("div",null,"Source")),o.createElement(S.PanelBody,null,o.createElement(C.MatchPanel,{ref:this.onSourcePanelMount,className:b.sourcePanel,role:M.AlignementRole.Source,state:s,requestMoreItems:this.onSourceRequestMore,onExpandOrCollapse:this.onSourceExpandOrCollapse,onSelectionChanged:this.onSourceSelectionChanged,onExpandAndScrollToPath:this.onSourceExpandAndScroll,onCancelExpandingToScroll:this.onSourceCancelExpanding,draggedNodes:d,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onFindAligned:this.onSourceFindAligned}))),o.createElement("div",{className:b.rightPanel},o.createElement(h.Panel,{className:b.targetHolder},o.createElement(m.PanelHeader,null,o.createElement("div",null,"Target")),o.createElement(S.PanelBody,null,o.createElement(C.MatchPanel,{ref:this.onTargetPanelMount,className:b.targetPanel,role:M.AlignementRole.Target,state:c,requestMoreItems:this.onTargetRequestMore,onExpandOrCollapse:this.onTargetExpandOrCollapse,onExpandAndScrollToPath:this.onTargetExpandAndScroll,onCancelExpandingToScroll:this.onTargetCancelExpanding,draggedNodes:d,onAlign:this.onAlign,onUnalign:this.onUnalign}))),o.createElement(h.Panel,{className:b.controlHolder},o.createElement(m.PanelHeader,null,o.createElement("div",null,"Alignments")),o.createElement(S.PanelBody,null,o.createElement("div",{className:b.controlPanel},o.createElement(P.MatchList,{className:b.controlList,matches:g,savedMatches:v,onScrollToEntry:this.onScrollToEntry}))),o.createElement(f.PanelFooter,null,o.createElement("div",{className:b.controlToolbar},o.createElement(i.Button,{disabled:g===v,bsStyle:"danger",onClick:this.onCancelUnsaved},"Cancel Pending"),o.createElement(i.Button,{disabled:g===v,bsStyle:"success",onClick:this.onSaveAlignments},"Save alignment")))))))},AlignmentTool}(c.Component);function assertLoaded(e){if(e.type!==r.Success)throw new Error("Cannot update state while AlignmentTool still loading");return e}t.AlignmentTool=x,t.default=x},2347:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,a,o=n(11),l=n(43),i=n(34),s=n(23),c=n(61),d=n(1581),u=n(1700),g=n(1990);!function(e){e[e.Source=1]="Source",e[e.Target=2]="Target"}(r=t.AlignementRole||(t.AlignementRole={})),function(e){function get(e,t){return t===r.Source?e.source:e.target}function set(e,t){return o.__assign(o.__assign({},e),t)}e.get=get,e.set=set,e.mergeIn=function mergeIn(e,t,n){var a=set(get(e,t),n);return t===r.Source?{source:a}:{target:a}}}(a=t.PanelState||(t.PanelState={}));var p=function(){function ToolController(e){this.changeQueue=[],this.changeCallbacks=[],this.changingState=!1,this.cancellation=e.cancellation,this.updateState=e.updateState,this.getSparqlOptions=e.getSparqlOptions,this.scrollToPath=e.scrollToPath,this.showValidationError=e.showValidationError}return ToolController.prototype.loadState=function(e,t){var n=t.metadata,r=n.source,a=n.target,s=createQueries(e,r),c=createQueries(e,a),g=new d.SparqlNodeModel({rootsQuery:s.queries.rootsQuery,childrenQuery:s.queries.childrenQuery,parentsQuery:s.queries.parentsQuery,sparqlOptions:this.getSparqlOptions}),p=new d.SparqlNodeModel({rootsQuery:c.queries.rootsQuery,childrenQuery:c.queries.childrenQuery,parentsQuery:c.queries.parentsQuery,sparqlOptions:this.getSparqlOptions}),h=new u.AlignmentNodeModel({baseModel:p,baseNodeQuery:c.nodeQuery,alignedModel:g,alignNodeQuery:s.nodeQuery});return h.loadState(t).map((function(e){var n=l.Map(),r={metadata:t.metadata,source:{queries:s.queries,patterns:s.patterns,model:new u.AlignmentNodeModel({baseModel:g,alignedModel:p}),forest:e.source,selection:d.TreeSelection.empty(e.source),expandingToScroll:!1,expandingCancellation:i.Cancellation.cancelled},target:{queries:c.queries,patterns:c.patterns,model:h,forest:e.target,selection:d.TreeSelection.empty(e.target),expandingToScroll:!1,expandingCancellation:i.Cancellation.cancelled},matches:n,savedMatches:n},a=syncDecoratorsAndMatches(r);return o.__assign(o.__assign(o.__assign({},r),a),{savedMatches:a.matches})}))},ToolController.prototype.enqueueStateUpdate=function(e,t){var n=this;this.changeQueue.push(e),t&&this.changeCallbacks.push(t),this.changingState||this.updateState((function(e){for(var t=null;n.changeQueue.length>0;){var r=n.changeQueue.shift()(o.__assign(o.__assign({},e),t));null!=r&&(t=o.__assign(o.__assign({},t),r))}return t}),(function(e){for(;n.changeCallbacks.length>0;){n.changeCallbacks.shift()(e)}}))},ToolController.prototype.requestMore=function(e,t){var n=this;this.enqueueStateUpdate((function(r){var o=a.get(r,e),l=o.model,i=o.forest,s=d.queryMoreChildren((function(e){return l.loadMoreChildren(e)}),i,t),c=s[0],u=s[1];return n.cancellation.map(u).observe({value:function(t){n.onMoreItemsLoaded(e,t)}}),a.mergeIn(r,e,{forest:c})}))},ToolController.prototype.onMoreItemsLoaded=function(e,t){var n=this;this.enqueueStateUpdate((function(r){n.enqueueStateUpdate(syncDecoratorsAndMatches);var o=a.get(r,e).forest;return a.mergeIn(r,e,{forest:t(o)})}))},ToolController.prototype.expandOrCollapse=function(e,t,n){this.enqueueStateUpdate((function(r){var o=a.get(r,e).forest.updateNode(t,(function(e){return d.TreeNode.set(e,{expanded:n})}));return a.mergeIn(r,e,{forest:o})}))},ToolController.prototype.setSelection=function(e,t){this.enqueueStateUpdate((function(n){return a.mergeIn(n,e,{selection:t})}))},ToolController.prototype.expandAndScrollToPath=function(e,t,n){var r=this,onExpandingStateChanged=function(t){var n=a.get(t,e),o=n.expandingToScroll,l=n.highlightedPath;!o&&l&&r.scrollToPath(e,l)};this.enqueueStateUpdate((function(o){var l=a.get(o,e),i=r.cancellation.deriveAndCancel(l.expandingCancellation);return i.map(d.loadPath((function(e){return l.model.hasMoreChildren(e)}),(function(e){return l.model.loadMoreChildren(e)}),l.forest,t).map((function(e){return d.expandPath(e,t)}))).observe({value:function(n){r.enqueueStateUpdate((function(o){return r.enqueueStateUpdate(syncDecoratorsAndMatches),a.mergeIn(o,e,{forest:n,expandingToScroll:!1,highlightedPath:t})}),onExpandingStateChanged)},error:function(t){console.error(t),r.enqueueStateUpdate((function(t){return a.mergeIn(t,e,{expandingToScroll:!1,highlightedPath:void 0})}))}}),a.mergeIn(o,e,{expandingToScroll:!0,expandingCancellation:i,expandTarget:n})}),onExpandingStateChanged)},ToolController.prototype.cancelExpandingToScroll=function(e){this.enqueueStateUpdate((function(t){var n=a.get(t,e);return n.expandingToScroll?(n.expandingCancellation.cancelAll(),a.mergeIn(t,e,{expandingToScroll:!1,expandTarget:void 0,highlightedPath:void 0})):null}))},ToolController.prototype.alignNodes=function(e,t){var n=this;this.enqueueStateUpdate((function(o){for(var l=o.target,i=l.forest,_loop_1=function(t,r){var a=r.base,o=r.excludeFromAlignment;if(!n.validate(l.forest,e,a,t)){var s=i.fromKeyPath(e),c=s?"<"+i.keyOf(s)+">":"<?>";return console.warn("Invalid alignment: "+a.iri+" "+u.AlignKind[t]+" "+c),"continue"}if(t===u.AlignKind.ExactMatch)i=l.forest.updateNode(e,(function(e){return u.AlignmentNode.setExactMatch(e,a,o)}));else{if(t!==u.AlignKind.NarrowerMatch)throw new Error("Invalid alignment relation type '"+u.AlignKind[t]+"'");i=i.updateNode(e,(function(e){var t=u.AlignmentNode.addNarrowMatches(e,[u.asNarrowMatch(a,o)]);return d.TreeNode.set(t,{expanded:!0})}))}},s=0,c=t;s<c.length;s++){var g=c[s];_loop_1(g.kind,g.sourceNode)}return n.enqueueStateUpdate(syncDecoratorsAndMatches),a.mergeIn(o,r.Target,{forest:i})}),(function(a){t.some((function(e){return e.kind===u.AlignKind.ExactMatch}))&&n.requestMore(r.Target,e)}))},ToolController.prototype.validate=function(e,t,n,r){var a=u.validateAlignment(e,t,n,r);return a.valid||this.showValidationError(a.message),a.valid},ToolController.prototype.unalignNode=function(e){var t=this;this.enqueueStateUpdate((function(n){var o=n.target,l=o.forest.fromKeyPath(e);if(!l||!l.aligned)return null;var i=d.Node.keyOf(l.aligned),s=d.Node.keyOf(u.AlignmentNode.getMatchTarget(l,o.forest).base),c=u.unalignAll(o.forest,i,s);return t.enqueueStateUpdate(syncDecoratorsAndMatches),a.mergeIn(n,r.Target,{forest:c})}))},ToolController.prototype.setSavedState=function(){this.enqueueStateUpdate((function(e){return{dirty:!1,savedMatches:e.matches}}))},ToolController}();function syncDecoratorsAndMatches(e){var t=e.source,n=e.target,r=g.groupMatches(e.target.forest),o=l.Map().withMutations((function(e){r.forEach((function(t){t.forEach((function(t,n){return e.set(n,t)}))}))})),i=t.forest.mapRoot((function(e){return decorateMatchParent(d.mapBottomUp(e,(function(e){var t=o.get(u.AlignmentNode.keyOf(e));if(t){var n=t.targetAligned.excludeFromAlignment,r=decorateMatchChildren(e,(function(e){return!n.has(u.AlignmentNode.keyOf(e))})),a=t.targetBase.base;return u.AlignmentNode.set(r,{matchedTargetNode:a})}if(e.matchedTargetNode){r=decorateMatchChildren(e,(function(){return!1}));return u.AlignmentNode.set(r,{matchedTargetNode:void 0})}return e})))})),s=n.forest.mapRoot(decorateMatchParent);return{matches:r,source:a.set(t,{forest:i}),target:a.set(n,{forest:s})}}function decorateMatchChildren(e,t){var mapNode=function(e){var n=t(e),r=e.children.map(mapNode);return u.AlignmentNode.set(e,{decorateAlignChild:n,children:r})};return mapNode(e)}function decorateMatchParent(e){return d.mapBottomUp(e,(function(e){var t=e.children.some((function(t){return Boolean(t.matchedTargetNode||!e.aligned&&t.aligned||t.decorateAlignParent)}));return u.AlignmentNode.set(e,{decorateAlignParent:t})}))}function createQueries(e,t){var n=c.SparqlUtil.parseQuery(e.rootsQuery),r=c.SparqlUtil.parseQuery(e.childrenQuery),a=c.SparqlUtil.parseQuery(e.parentsQuery),o=c.SparqlUtil.parseQuery(e.searchQuery),l=c.SparqlUtil.parseQuery(e.nodeQuery),i=new h({"alignment:__graph__":t});return[n,r,a,o,l].forEach((function(e){return i.sparqlQuery(e)})),{queries:{rootsQuery:n,childrenQuery:r,parentsQuery:a,searchQuery:o},nodeQuery:l,patterns:{rootsQuery:c.SparqlUtil.serializeQuery(n),childrenQuery:c.SparqlUtil.serializeQuery(r),parentsQuery:c.SparqlUtil.serializeQuery(a),searchQuery:c.SparqlUtil.serializeQuery(o)}}}t.ToolController=p;var h=function(e){function IriBinder(t){var n=e.call(this)||this;return n.replacements=t,n}return o.__extends(IriBinder,e),IriBinder.prototype.tryReplace=function(e){var t=this.replacements[e];return void 0!==t?s.turtle.serialize.nodeToN3(t):void 0},IriBinder.prototype.iri=function(e){return this.tryReplace(e)},IriBinder}(c.QueryVisitor)},3341:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(72),l=n(56),i=n(1581),s=n(117),c=n(1700),d=n(1495),u=function(e){function ConfirmAlignDialog(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(ConfirmAlignDialog,e),ConfirmAlignDialog.prototype.render=function(){var e=this.props,t=e.sourceNode,n=e.targetNode,r=e.onSubmit,l=e.onClose;return a.createElement(s.OverlayDialog,{type:"modal",show:!0,className:d.component,title:"Select alignment relation type",onHide:l},a.createElement(o.Button,{bsSize:"large",block:!0,onClick:function(){return r(c.AlignKind.ExactMatch)}},a.createElement("span",{className:d.description},a.createElement("span",{className:d.sourceTerm},i.Node.getLabel(t))," is exact match (=) to"," ",a.createElement("span",{className:d.targetTerm},i.Node.getLabel(n)))),a.createElement(o.Button,{bsSize:"large",block:!0,onClick:function(){return r(c.AlignKind.NarrowerMatch)}},a.createElement("span",{className:d.description},a.createElement("span",{className:d.sourceTerm},i.Node.getLabel(t))," is narrow match (≤) to"," ",a.createElement("span",{className:d.targetTerm},i.Node.getLabel(n)))))},ConfirmAlignDialog.KEY="ConfirmAlignDialog",ConfirmAlignDialog}(l.Component);t.ConfirmAlignDialog=u},3342:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(72),l=n(16),i=n(7),s=n(56),c=n(1700),d=n(1496),u=function(e){function MatchList(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(MatchList,e),MatchList.prototype.render=function(){var e=this,t=this.props,n=t.className,r=function computeMatchEntries(e){var t=[];return e.forEach((function(e){return e.forEach((function(e){t.push(e)}))})),l.orderBy(t,g)}(t.matches);return a.createElement("ul",{className:i(d.component,n)},r.map((function(t){return e.renderMatch(t)})))},MatchList.prototype.renderMatch=function(e){var t=this,n=e.targetBase,r=e.targetAligned.aligned||e.targetAligned.base,l="<"+c.AlignmentNode.keyOf(n)+">"+e.kind+r.iri.toString(),i=e.kind===c.AlignKind.ExactMatch?"=":"≤",s=this.props.savedMatches.hasIn([e.targetBase.base.iri.value,e.targetAligned.aligned.iri.value]);return a.createElement("li",{key:l,className:d.entry},a.createElement("span",null,getLabel(r)),a.createElement("span",null," ",i," "),a.createElement("span",null,getLabel(n.base)),s?null:a.createElement("span",{className:d.unsaved},"unsaved"),a.createElement(o.Button,{className:d.scrollTo,bsSize:"xs",title:"Scroll to aligned terms",onClick:function(){return t.scrollToItem(e)}},a.createElement("span",{className:"fa fa-arrow-right","aria-hidden":"true"})))},MatchList.prototype.scrollToItem=function(e){this.props.onScrollToEntry(e)},MatchList}(s.Component);t.MatchList=u;var g=[function(e){return getLabel(e.targetBase.base)},function(e){return e.kind},function(e){return getLabel(e.targetAligned.aligned||e.targetAligned.base)}];function getLabel(e){return e.label?e.label.value:e.iri.value}},3343:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(7),l=n(72),i=n(43),s=n(56),c=n(633),d=n(328),u=n(327),g=n(630),p=n(1581),h=n(1700),m=n(2347),f=n(1497),S=function(e){function MatchPanel(){var t=null!==e&&e.apply(this,arguments)||this;return t.searchedPaths=i.Set(),t.onAlignmentTreeMount=function(e){t.alignementTree=e},t.onSearchBadgeClick=function(e,n){var r=e.getKeyPath(n);t.props.onExpandAndScrollToPath(r,n)},t.onSearchSelectionChanged=function(e){var n=t.searchedPaths;t.searchedPaths=p.TreeSelection.leafs(e).map((function(t){return i.List(e.getKeyPath(t))})).toSet();var r=t.searchedPaths.filter((function(e){return!n.has(e)}));if(1===r.size){var a=r.first().toArray();t.props.onExpandAndScrollToPath(a,e.fromKeyPath(a))}},t.isLeaf=function(e){var n=t.props.state.model;return e.children?0===e.children.length&&!n.hasMoreChildren(e):void 0},t.childrenOf=function(e){var n=t.props.state.model;return{children:e.children,loading:e.loading,hasMoreItems:n.hasMoreChildren(e)}},t.requestMore=function(e){var n=t.props;(0,n.requestMoreItems)(n.state.forest.getKeyPath(e))},t.onExpandedOrCollapsed=function(e,n){var r=t.props;(0,r.onExpandOrCollapse)(r.state.forest.getKeyPath(e),n)},t.onShowNodeInfoClick=function(e){e.stopPropagation()},t}return r.__extends(MatchPanel,e),MatchPanel.prototype.render=function(){var e=this,t=this.props,n=t.className,l=t.role,i=t.state,s=i.patterns,c=i.forest,d=i.selection,u=i.expandingToScroll,g=i.highlightedPath,h=[];if(g){var S=c.fromKeyPath(g);S&&(h=c.getNodePath(S))}var v={forest:c,isLeaf:this.isLeaf,childrenOf:this.childrenOf,renderItem:function(t){return e.renderTreeNodeRow(t,h)},requestMore:this.requestMore,hideCheckboxes:l===m.AlignementRole.Target,selectionMode:this.props.role===m.AlignementRole.Source?p.PartialSubtrees():p.SingleFullSubtree(),selection:d,onSelectionChanged:this.props.onSelectionChanged,isExpanded,onExpandedOrCollapsed:this.onExpandedOrCollapsed};return a.createElement("div",{className:o(f.component,n)},a.createElement(p.SemanticTreeInput,r.__assign({},s,{multipleSelection:!0,onSelectionClick:this.onSearchBadgeClick,onSelectionChanged:this.onSearchSelectionChanged})),a.createElement("div",{className:f.alignmentTreeContainer},u?this.renderExpandToScrollMessage():null,a.createElement(p.LazyTreeSelector,r.__assign({},v,{ref:this.onAlignmentTreeMount,className:f.alignmentTree}))))},MatchPanel.prototype.renderTreeNodeRow=function(e,t){var n=this.computeDecoratorsClass(e,t);return a.createElement("span",{className:f.alignmentNodeRow},this.renderTreeNode(e,n),this.renderIndicators(e),this.renderUnalignButton(e),this.renderFindAlignedButton(e),this.renderInfoButton(e))},MatchPanel.prototype.renderTreeNode=function(e,t){var n=this,r=this.props,o=r.role,l=r.onDragEnd,i=r.state,s=i.forest,c=i.selection,u=(e.base||e.aligned).iri.value,g=a.createElement("span",{className:t,title:u},function renderAlignedTerm(e){return e.base&&e.aligned?a.createElement("span",null,a.createElement("span",{className:f.baseTerm},p.Node.getLabel(e.base)),a.createElement("span",{className:f.alignedTerm}," = ",p.Node.getLabel(e.aligned))):e.base?a.createElement("span",{className:f.baseTerm},p.Node.getLabel(e.base)):e.aligned?a.createElement("span",{className:f.alignedTerm},e.alignKind===h.AlignKind.NarrowerMatch?"≥ ":"",p.Node.getLabel(e.aligned)):null}(e));if(o===m.AlignementRole.Source){var S=p.PartialSubtrees(),v=c.nodes.get(h.AlignmentNode.keyOf(e));if(v&&v.size>0){var y=s.getKeyPath(e),N=c.fromKeyPath(y);if(N&&S.isSelectedSubtree(N))return a.createElement(d.Draggable,{iri:e.base.iri.value,onDragStart:function(){return n.startDraggingSelection()},onDragEnd:l},a.createElement("span",{className:f.draggableWrapper},a.createElement("span",{className:f.draggableHandle}),g))}}else if(o===m.AlignementRole.Target&&e.base){var E=s.getKeyPath(e);return a.createElement(d.Droppable,{onDrop:function(e){return n.onDropInto(E,e)}},g)}return g},MatchPanel.prototype.renderIndicators=function(e){var t=[];if(e.decorateAlignParent){var n=a.createElement(l.Tooltip,{id:"aligned-descendants"},"Term has aligned descendants.");t.push(a.createElement(l.OverlayTrigger,{key:"aligned-descendants",placement:"top",overlay:n},a.createElement("span",{className:f.decorateAlignParent}," [*]")))}return t},MatchPanel.prototype.computeDecoratorsClass=function(e,t){var n=[f.decoratedNodeBody],r=t.indexOf(e);if(r>=0){var a=r===t.length-1;n.push(a?f.decorateHighlightLeaf:f.decorateHighlightParent)}return(e.matchedTargetNode||e.decorateAlignChild)&&n.push(f.decorateAlignLeaf),n.join(" ")},MatchPanel.prototype.scrollToPath=function(e){this.alignementTree.scrollToPath(e)},MatchPanel.prototype.renderExpandToScrollMessage=function(){var e=this.props,t=e.onCancelExpandingToScroll,n=e.state.expandTarget;return a.createElement("div",{className:f.scrollNotification},"Scrolling to item ",a.createElement("span",{className:f.scrollToName},n.label.value),a.createElement(u.Spinner,{className:f.scrollSpinner,spinnerDelay:0,messageDelay:1/0}),a.createElement(l.Button,{bsSize:"xsmall",className:f.cancelScrollingTo,onClick:t},"Cancel"))},MatchPanel.prototype.startDraggingSelection=function(){var e=this.props.state,t=e.forest,n=e.selection,r=p.PartialSubtrees().getSelectedSubtrees(n);if(0!==r.length){var a=r.map((function(e){var r=n.getKeyPath(e),a=t.fromKeyPath(r),o=h.findExcludedChildren(a,e,n),l=a.base.children&&a.base.children.length>0?p.Node.set(a.base,{children:void 0,reachedLimit:!1}):a.base;return h.AlignmentNode.set(h.AlignmentNode.empty,{base:l,excludeFromAlignment:o})}));this.props.onDragStart(a)}},MatchPanel.prototype.onDropInto=function(e,t){var n=this.props,r=n.state,a=n.draggedNodes,o=n.onCancelExpandingToScroll,l=n.onAlign;r.expandingToScroll&&o(),l&&a&&a.some((function(e){return e.base.iri.equals(t)}))&&l(a,e)},MatchPanel.prototype.renderInfoButton=function(e){var t=a.createElement(v,{node:e,infoTemplate:this.props.infoTemplate});return a.createElement(l.OverlayTrigger,{key:h.AlignmentNode.keyOf(e),trigger:"click",rootClose:!0,placement:"right",overlay:t},a.createElement(l.Button,{bsSize:"xsmall",className:f.nodeInfoButton,onClick:this.onShowNodeInfoClick},a.createElement("span",{className:"fa fa-info","aria-hidden":"true"})))},MatchPanel.prototype.renderUnalignButton=function(e){var t=this.props,n=t.onUnalign,r=t.state.forest;return n&&e.aligned&&e.alignKind!==h.AlignKind.MatchChild?a.createElement(l.Button,{bsSize:"xsmall",className:f.unalignButton,onClick:function(t){t.stopPropagation();var a=r.getKeyPath(e);n(a)}},"unalign"):null},MatchPanel.prototype.renderFindAlignedButton=function(e){var t=this.props.onFindAligned;return t&&e.matchedTargetNode?a.createElement(l.Button,{bsSize:"xsmall",className:f.findAlignedButton,onClick:function(n){n.stopPropagation(),t(p.Node.keyOf(e.matchedTargetNode))}},a.createElement("span",{className:"fa fa-arrow-right","aria-hidden":"true"})):null},MatchPanel}(s.Component);function isExpanded(e){return e.expanded}t.MatchPanel=S;var v=function(e){function NodeInfoPopover(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(NodeInfoPopover,e),NodeInfoPopover.prototype.render=function(){var e=this.props,t=e.node,n=e.infoTemplate,i=void 0===n?"<i>No info available</i>":n,s=r.__rest(e,["node","infoTemplate"]),d=t.base||t.aligned,u=p.Node.getLabel(d),h=a.createElement(c.ResourceLink,{resource:d.iri},u),m=s;return a.createElement(l.Popover,r.__assign({id:"alignment-tool-node-info"},m,{className:o(f.nodeInfoPopup,m.className),title:h}),a.createElement(g.TemplateItem,{template:{source:i,options:{iri:d.iri.value,label:u}}}))},NodeInfoPopover}(a.Component)}}]);
//# sourceMappingURL=rs-alignment-tool-30b3bfd43748652718d5.js.map