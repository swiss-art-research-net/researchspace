(window.webpackJsonp=window.webpackJsonp||[]).push([[487],{1329:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),o=a(35),i=a(20),s=a(16),l=a(33),u=a(1919),p=a(1922),c=a(2194),f=a(1806),d=a(1732),m=a(2798),g=a(2197),v=a(1731),y=a(2809),h=a(1807),w=a(1931),M=a(1805),S=a(1809),E=a(1646),x=a(1810),P=a(1644),k=a(1932),C=a(2200),T=a(2811),F=a(1583),L=a(1925),b=a(2173),G=a(1548),N=a(162),O=a(61),R=a(56),I=a(116),A=a(327),U=a(630),_=a(2813),z=a(2816);a(1248),a(1330);var q="researchspace-map-widget",D=function(e){function SemanticMap(t,a){var r=e.call(this,t,a)||this;return r.createGeometries=function(e){var t={};return e.forEach((function(e){var a=new S.default(e),o=void 0;if(s.isUndefined(e.lat)||s.isUndefined(e.lng)?!s.isUndefined(e.wkt)&&s.isUndefined(o)&&(o=r.readWKT(e.wkt.value)):o=new E.default(r.transformToMercator(parseFloat(e.lng.value),parseFloat(e.lat.value))),s.isUndefined(o)){r.setState({errorMessage:l.Just("Result of SPARQL Select query does have neither\n                    lat,lng nor wkt projection variable. ")})}else{a.setGeometry(o);var i=o.getType();t[i]=t[i]?n.__spreadArrays(t[i],[a]):[a]}})),t},r.createLayer=function(e,t){var a,n=new d.default({features:e});if("Point"===t){var r=new m.default({source:n,distance:40});return new z.default({source:r,style:(a={},function(e,t,a){return new v.default({image:new w.default({radius:t,fill:new h.default({color:a})}),text:new y.default({text:e.toString(),fill:new h.default({color:"#fff"})})})},function(e){var t=e.get("features"),n=t.length,r=(t[0].get("color")||{value:"#000"}).value,o=a[""+n+r];if(!o){if(1===n){var i=e.getGeometry();o=getFeatureStyle(i,r)}else{var s=Math.max(8,Math.min(.75*n,20));o=function(e,t,a){return new v.default({image:new w.default({radius:t,fill:new h.default({color:a})}),text:new y.default({text:e.toString(),fill:new h.default({color:"#fff"})})})}(n,s,r)}a[n]=o}return[o]}),zIndex:1})}return new f.default({source:n,style:function(e){var t=e.getGeometry(),a=e.get("color");return getFeatureStyle(t,a?a.value:void 0)},zIndex:0})},r.addMarkersFromQuery=function(e,t){var a=e.query,n=e.fixZoomLevel;if(a){var o=O.SparqlClient.select(a,{context:t.semanticContext});o.onValue((function(e){var t=s.map(e.results.bindings,(function(e){return s.mapValues(e,(function(e){return e}))}));if(O.SparqlUtil.isSelectResultEmpty(e))r.setState({noResults:!0,errorMessage:l.Nothing(),isLoading:!1});else{r.setState({noResults:!1,errorMessage:l.Nothing(),isLoading:!1});var a=r.createGeometries(t);r.updateLayers(a);var o=r.map.getView(),i=r.calculateExtent();o.fit(i,{maxZoom:10}),n&&o.setZoom(n)}})),o.onError((function(e){return r.setState({errorMessage:l.Just(e),isLoading:!1})})),o.onEnd((function(){r.props.id&&N.trigger({eventType:N.BuiltInEvents.ComponentLoaded,source:r.props.id})})),r.props.id&&N.trigger({eventType:N.BuiltInEvents.ComponentLoading,source:r.props.id,data:o})}},r.updateLayers=function(e){s.forEach(e,(function(e,t){var a=r.layers[t];if(a){var n=a.getSource();n instanceof m.default&&(n=n.getSource()),n.clear(),n.addFeatures(e)}else a=r.createLayer(e,t),r.layers[t]=a,r.map.addLayer(a)}))},r.createMap=function(){r.renderMap(i.findDOMNode(r.refs[q]),r.props,{lng:parseFloat("0"),lat:parseFloat("0")},[])},r.getMarkerFromMapAsElements=function(){s.isUndefined(r.layers)||s.forEach(r.layers,(function(e){var t=r.refs["ref-map-widget-elements"],a=e.getSource();a instanceof m.default&&(a=a.getSource());var n=a.getFeaturesInExtent(a.getExtent()),o=i.findDOMNode(t),l=r.state.tupleTemplate;s.forEach(n,(function(e){var t=SemanticMap.createPopupContent(e.getProperties(),l),a=(new DOMParser).parseFromString(t,"text/html");o.appendChild(a.body.firstChild)}))}))},r.compileTemplatesInConfig=function(e){var t=l.fromNullable(r.handleDeprecatedLayout(e)).chain((function(e){return l.fromNullable(e)})).getOrElse('\n        <semantic-link class="map-resource-link" data-uri="{{link.value}}">\n        </semantic-link>\n        <p>{{description.value}}</p>\n    ');r.appliedTemplateScope.compile(t).then((function(e){r.setState({tupleTemplate:l.Just(e),errorMessage:l.Nothing()})})).catch((function(e){r.setState({errorMessage:l.Just(e)})}))},r.state={tupleTemplate:l.Nothing(),noResults:!1,isLoading:!0,errorMessage:l.Nothing()},r}return n.__extends(SemanticMap,e),SemanticMap.createPopupContent=function(e,t){var a="";return!1===s.isUndefined(e.link)&&(a+='\n          <semantic-link uri="'+e.link+'"></semantic-link>\n          <p>'+e.description+"</p>\n      "),t.map((function(t){return t(e)})).getOrElse(a)},SemanticMap.prototype.componentDidMount=function(){this.createMap()},SemanticMap.prototype.componentWillReceiveProps=function(e,t){e.query!==this.props.query&&this.addMarkersFromQuery(e,t)},SemanticMap.prototype.componentWillMount=function(){this.compileTemplatesInConfig(this.props)},SemanticMap.prototype.render=function(){return this.state.errorMessage.isNothing?void 0===this.state.tupleTemplate?r.createElement(A.Spinner):this.state.noResults?r.createElement(U.TemplateItem,{template:{source:this.props.noResultTemplate}}):o.div({style:{height:"100%",width:"100%"}},o.div({ref:q,className:"researchspace-map-widget",style:{height:"100%",width:"100%",visibility:this.state.noResults?"hidden":"visible"}},o.div({className:"researchspace-map-widget-elements",ref:"ref-map-widget-elements",onClick:this.getMarkerFromMapAsElements.bind(this),style:{display:"none"}})),this.state.isLoading?r.createElement(A.Spinner):null):o.div({className:"researchspace-map-widget"},r.createElement(I.ErrorNotification,{errorMessage:this.state.errorMessage.get()}))},SemanticMap.prototype.initializeMarkerPopup=function(e){var t=this,a=new _;e.addOverlay(a),e.on("click",(function(n){a.hide(),a.setOffset([0,0]);var r=e.forEachFeatureAtPixel(n.pixel,(function(e,t){return e}));if(r){var o=function getPopupCoordinate(e,t){if(e instanceof E.default)return e.getCoordinates();if(e instanceof P.default)return e.getInteriorPoint().getCoordinates();if(e instanceof k.default)for(var a=e.getPolygons(),n=0;n<a.length;n++){var r=a[n];if(r.intersectsCoordinate(t))return getPopupCoordinate(r,t)}else if(e instanceof C.default){var o=e.getGeometries();for(n=0;n<o.length;n++){var i=o[n];if(i.intersectsCoordinate(t))return getPopupCoordinate(i,t)}}return e.getClosestPoint(t)}(r.getGeometry(),n.coordinate),i=r.getProperties().features,s=(void 0===i?[r]:i).map((function(e){var a=e.getProperties();return"<div>"+SemanticMap.createPopupContent(a,t.state.tupleTemplate)+"</div>"}));a.setOffset([0,-22]),a.show(o,"<mp-template-item>"+s.join("")+"</mp-template-item>")}})),e.on("pointermove",(function(t){var a=e.hasFeatureAtPixel(t.pixel);e.getTarget().style.cursor=a?"pointer":""}))},SemanticMap.prototype.transformToMercator=function(e,t){return F.default.transform([e,t],"EPSG:4326","EPSG:3857")},SemanticMap.prototype.readWKT=function(e){return(new T.default).readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})},SemanticMap.prototype.renderMap=function(e,t,a,r){var o=this;window.setTimeout((function(){var t=o.createGeometries(r),i=s.mapValues(t,o.createLayer),l=new u.default({controls:L.default.defaults({attributionOptions:{collapsible:!1}}),interactions:b.default.defaults({mouseWheelZoom:!1}),layers:n.__spreadArrays([new c.default({source:new g.default})],s.values(i)),target:e,view:new p.default({center:o.transformToMercator(parseFloat(a.lng),parseFloat(a.lat)),zoom:1})});o.layers=i,o.map=l,o.addMarkersFromQuery(o.props,o.context),o.initializeMarkerPopup(l),window.addEventListener("resize",(function(){l.updateSize()}))}),1e3)},SemanticMap.prototype.calculateExtent=function(){var e=G.default.createEmpty();return s.forEach(this.layers,(function(t){var a=t.getSource();a instanceof m.default&&(a=a.getSource()),G.default.extend(e,a.getExtent())})),e},SemanticMap.prototype.handleDeprecatedLayout=function(e){return s.has(e,"layout")?(console.warn("layout property in semantic-map is deprecated, please use flat properties instead"),e.layout.tupleTemplate):e.tupleTemplate},SemanticMap}(R.Component);function getFeatureStyle(e,t){return e instanceof E.default||e instanceof x.default?new v.default({geometry:e,text:new y.default({text:"ÔÅÅ",font:"normal 22px FontAwesome",textBaseline:"bottom",fill:new h.default({color:t||"#000"})})}):e instanceof C.default?e.getGeometries().map((function(e){return getFeatureStyle(e,t)})):new v.default({geometry:e,fill:new h.default({color:t||"rgba(255, 255, 255, 0.5)"}),stroke:new M.default({color:t||"#3399CC",width:1.25})})}t.SemanticMap=D,t.default=D}}]);
//# sourceMappingURL=semantic-map-f7455dd23fdf83afb281.js.map