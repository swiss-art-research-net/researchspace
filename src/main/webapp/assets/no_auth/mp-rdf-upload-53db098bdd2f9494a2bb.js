(window.webpackJsonp=window.webpackJsonp||[]).push([[373],{1385:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var r=a(11),o=a(1),n=a(16),s=a(72),l=a(33),p=a(10),i=a(19),c=a(7),d=a(56),u=a(34),m=a(63),h=a(23),g=a(61),f=a(1264),U=a(122),y=a(631),v=a(1654),R=a(116),b=a(327),T=a(630),E=a(2981);a(1386);var S=function(e){function RdfUpload(t,a){var r=e.call(this,t,a)||this;return r.cancellation=new u.Cancellation,r.onDropAccepted=function(e){var t=r.context.semanticContext.repository;r.setState({messages:[],progress:l.Nothing()});var a=e.map((function(a,o){var s=n.isEmpty(r.props.contentType)?g.SparqlUtil.getMimeType(g.SparqlUtil.getFileEnding(a)):r.props.contentType,p=r.state.targetGraph.isJust?r.state.targetGraph.get():"file://"+a.name+"-"+createTimestamp(),i=f.RDFGraphStoreService.createGraphFromFile({targetGraph:h.Rdf.iri(encodeURI(p)),keepSourceGraphs:r.state.keepSourceGraphs,file:a,contentType:s,onProgress:function(t){return r.setState({progress:l.Just(100*(o/e.length+t/100)),progressText:l.Just(o+"/"+e.length+" Files")})},repository:t});return r.cancellation.map(i).observe({value:function(){return r.appendUploadMessage("File: "+a.name+" uploaded.")},error:function(e){console.error(e),r.appendUploadMessage("File: "+a.name+" failed.",e)}}),i}));r.cancellation.map(i.combine(a)).observe({value:function(){return setTimeout((function(){return m.refresh()}),2e3)}})},r.onChangeTargetGraph=function(e){e.stopPropagation(),e.preventDefault();var t=e.target.value.trim();n.isEmpty(t)?r.setState({targetGraph:l.Nothing()}):r.setState({targetGraph:l.Just(t)})},r.onChangeKeepSourceGraphs=function(e){r.setState({keepSourceGraphs:e.target.checked})},r.onClickLoadByUrl=function(){r.setState({messages:[],progress:l.Nothing()});var e,t=r.state,a=t.remoteFileUrl,o=t.targetGraph;try{e=function makeLoadQuery(e,t){var a=t.isJust?t.get():e+"-"+createTimestamp(),r="LOAD <"+encodeURI(e)+"> INTO GRAPH <"+encodeURI(a)+">",o=g.SparqlUtil.parseQuery(r);if("update"!==o.type)throw new Error("Query must be an update operation");return o}(a,o)}catch(e){var n=o.isJust?"Error constructing update query (probably invalid file or named graph URL?)":"Error constructing update query (probably invalid file URL?)";return void r.appendUploadMessage(n,e)}r.setState({progress:l.Just(100),progressText:l.Just("Database is processing the LOAD command")});var s=r.context.semanticContext;r.cancellation.map(g.SparqlClient.executeSparqlUpdate(e,{context:s})).observe({value:function(){r.appendUploadMessage("File from URL successfully loaded."),setTimeout((function(){return m.refresh()}),2e3)},error:function(e){console.error(e),r.appendUploadMessage("Failed to load file from URL.",e)},end:function(){r.setState({progress:l.Nothing(),progressText:l.Nothing()})}})},r.state={messages:[],progress:l.Nothing(),progressText:l.Nothing(),targetGraph:l.Nothing(),keepSourceGraphs:t.keepSourceGraphs},r}return r.__extends(RdfUpload,e),RdfUpload.prototype.componentDidMount=function(){var e=this;E.RdfUploadExtension.loadAndUpdate(this,this.cancellation),this.cancellation.map(U.getRepositoryInfo("default")).onValue((function(t){return e.setState({repositoryType:t.type})}))},RdfUpload.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},RdfUpload.prototype.appendUploadMessage=function(e,t){this.setState((function(a){return{messages:r.__spreadArrays(a.messages,[{alert:t?y.AlertType.WARNING:y.AlertType.SUCCESS,message:e,children:t?o.createElement(R.ErrorPresenter,{error:t}):void 0}])}}))},RdfUpload.prototype.render=function(){var e=this;if(E.RdfUploadExtension.isLoading())return o.createElement(b.Spinner,null);var t=this.props,a=t.className,n=t.style,l=this.state.messages.map((function(e,t){return o.createElement(y.Alert,r.__assign({key:t},e))})),p=this.state.progress.map((function(t){return o.createElement(s.ProgressBar,{active:!0,min:0,max:100,now:t,label:e.state.progressText.getOrElse("Uploading Files")})})).getOrElse(null),i=Boolean(this.state.progress.getOrElse(0)),d=this.state.repositoryType!==U.NeptuneRepositoryType&&this.props.allowLoadByUrl,u=o.createElement(o.Fragment,null,p,o.createElement("div",{className:"RdfUpload__note"},"RDF files can be uploaded using the drag&drop field below. Clicking into the field will open the browser's default file selector."),o.createElement(v.Dropzone,{onDropAccepted:this.onDropAccepted,accept:this.props.accept},(function(t){return o.createElement(T.TemplateItem,{template:{source:e.props.dropAreaTemplate,options:t}})})),l);return o.createElement("div",{className:c("RdfUpload",a),style:n},this.props.showAdvancedOptions?o.createElement(o.Fragment,null,o.createElement("a",{className:"RdfUpload__advance",onClick:function(){return e.setState({showOptions:!e.state.showOptions})}},"Advanced Options"),this.renderAdvancedOptions()):null,d?o.createElement(s.Tabs,{id:"rdf-upload-tabs",unmountOnExit:!0},o.createElement(s.Tab,{eventKey:1,className:"RdfUpload__tab",title:"File Upload",disabled:i},u),o.createElement(s.Tab,{eventKey:2,className:"RdfUpload__tab",title:"Load by HTTP/FTP/File URL",disabled:i},p,o.createElement("div",{className:"RdfUpload__note"},"Please note: Loading via HTTP/FTP/File URL depends on the database backend i.e. it must support the SPARQL LOAD command and must allow outgoing network connections to the publicly accessible HTTP/FTP URLs or must have access to the File URL respectively."),o.createElement(s.FormControl,{type:"text",value:this.state.remoteFileUrl||"",placeholder:"Please enter publicly accessible HTTP/FTP URL",onChange:function(t){return e.setState({remoteFileUrl:t.currentTarget.value})}}),o.createElement(s.Button,{bsStyle:"primary",className:"RdfUpload__load-button",disabled:!this.state.remoteFileUrl||i,onClick:this.onClickLoadByUrl},"Load by URL"),l)):u)},RdfUpload.prototype.renderAdvancedOptions=function(){return o.createElement(s.Panel,{collapsible:!0,expanded:this.state.showOptions},o.createElement(s.FormControl,{type:"text",label:"Target NamedGraph",placeholder:"URI of the target NamedGraph. Will be generated automatically if empty.",onChange:this.onChangeTargetGraph}),o.createElement(s.Checkbox,{label:"Keep source NamedGraphs",onChange:this.onChangeKeepSourceGraphs},"Keep source NamedGraphs"))},RdfUpload.defaultProps={keepSourceGraphs:!1,allowLoadByUrl:!0,showAdvancedOptions:!0,dropAreaTemplate:"<div class='RdfUpload__rdf-dropzone-content'>Please drag&amp;drop your RDF file(s) here.</div>"},RdfUpload}(d.Component);function createTimestamp(){return p().format("DD-MM-YYYY-hh-mm-ss")}t.RdfUpload=S,t.default=S},2981:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var r=a(120);t.RdfUploadExtension=new r.ExtensionPoint}}]);
//# sourceMappingURL=mp-rdf-upload-53db098bdd2f9494a2bb.js.map