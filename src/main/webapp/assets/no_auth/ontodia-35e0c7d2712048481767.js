(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{1243:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),i=n(19),o=n(16),s=n(1579),l=n(142),d=n(162),u=n(34),p=n(56),c=n(23),f=n(63),m=n(225),g=n(1562),h=n(2334),v=n(1210),y=n(117),E=n(116),b=n(327),S=n(630),I=n(214),C=n(329),T=n(141),w=n(140),P=n(214),k=n(3307),L=n(3310),O=n(3312),R=n(3313),_=n(3314),D=n(1987),N=n(3315),M=n(1637),A=n(1293),F=n(1844),x=n(3316),B=n(1751),j=n(1845),V={createWorkspace:function(e,t){return a.createElement(s.Workspace,t)},createToolbar:function(e,t){return a.createElement(R.Toolbar,t)},onNewDigaramInitialized:function(e,t){t.forceLayout(),t.zoomToFit()},getPersistence:function(e){return new x.FormBasedPersistence(e)}},U=function(e){function Ontodia(t,n){var i=e.call(this,t,n)||this;return i.cancellation=new u.Cancellation,i.listener=new s.EventObserver,i.nodeTemplates={},i.getWorkspace=function(){return i.workspace},i.onIriClick=function(e){var t=e.iri,n=e.clickIntent,r=e.originalEvent,a=c.Rdf.iri(t);if("jumpToEntity"===n||"openEntityIri"===n)m.isSimpleClick(r)?f.navigateToResource(a).onEnd((function(){})):f.openResourceInNewWindow(a);else{var i=r.target.target,o=void 0===i?"_blank":i;f.openExternalLink(l(a.value),o).onEnd((function(){}))}},i.getRepositories=function(){var e=i.context.semanticContext.repository,t=void 0===e?"default":e,n=i.props.repositories;return void 0===n?[t]:n},i.prepareImages=function(e){var t=i.props,n=t.imageQuery,r=t.imageIris;return n||r?n?k.prepareImages(e,n):void 0:k.fetchThumbnails(e,i.context.semanticContext)},i.prepareLabels=function(e){var t=Array.from(e,c.Rdf.iri),n=i.context.semanticContext;return w.getLabels(t,{context:n}).map((function(e){var t=new Map;return e.forEach((function(e,n){var r={value:e,language:""};t.set(n.value,[r])})),t})).toPromise()},i.initWorkspace=function(e){if(e){var t=i.props,n=t.onLoadWorkspace,r=t.imageIris,a=t.provisionQuery,o=t.acceptBlankNodes,l=t.settings,d=t.autoZoom,u=t.hideNavigationConfirmation,p=t.imageQuery,c=i.state.fieldConfiguration;i.workspace=e,n&&n(e);var f={endpointUrl:"",prepareImages:!r&&!p||p?i.prepareImages:void 0,prepareLabels:i.prepareLabels,imagePropertyUris:r,queryMethod:s.SparqlQueryMethod.POST,acceptBlankNodes:o},m=i.getRepositories();i.dataProvider=L.createDataProvider({configName:l,options:f,repositories:m,createRDFStorage:void 0!==a,fields:c.allFields,settings:i.props.providerSettings,forceFields:c.datatypeFields}),i.validationApi&&i.validationApi.setDataProvider(i.dataProvider),i.importLayout(),d&&i.listener.listen(i.workspace.getEditor().events,"addElements",(function(){i.workspace.zoomToFit()})),u||i.registerNavigationConfirmation(),i.subscribeOnEvents(),c.authoringMode&&i.subscribeOnAuthoringEvents()}},i.onSaveDiagramPressed=function(){var e=i.state.diagramIri;if(e){var t=i.workspace.getModel().exportLayout(),n=i.state.label;i.cancellation.map(i.parsedMetadata.flatMap((function(r){return k.updateDiagram(e,t,n,r)})).map((function(e){return d.trigger({eventType:j.DiagramSaved,source:i.props.id,data:{resourceIri:i.state.diagramIri}}),d.trigger({eventType:j.DiagramIsDirty,source:i.props.id,data:{hasChanges:!1}}),e}))).observe({value:function(){i.workspace.getModel().history.reset(),E.addNotification({level:"success",message:"Saved diagram "+n})},error:function(e){return E.addNotification({level:"error",message:"Error saving diagram "+n},e)}})}else i.openSaveModal()},i.onPersistAuthoredChanges=function(){i.workspace.showWaitIndicatorWhile(i.persistAuthoredChanges())},i.onChangesPersisted=function(e){for(var t=i.workspace.getModel(),n=i.workspace.getEditor(),a=0,o=r.__spreadArrays(t.elements);a<o.length;a++){var l=o[a],u=e.finalizedEntities.get(l.iri);u?l.setData(u):null===u&&t.removeElement(l.id)}for(var p=0,c=r.__spreadArrays(t.links);p<c.length;p++){var f=c[p],m=n.authoringState.links.get(f.data);m&&m.deleted&&t.removeLink(f.id)}n.setAuthoringState(s.AuthoringState.empty),n.cancelSelection(),t.history.reset(),d.trigger({source:i.props.id,eventType:j.DiagramChanged,data:{model:t,authoringState:n.authoringState,temporaryState:n.temporaryState}})},i.importProvisionData=function(){var e=i.props.provisionQuery;if(!e)return Promise.resolve();var t=i.getRepositories();return O.getRdfExtGraphBySparqlQuery(e,t).then((function(e){return i.addGraphToRDFDataProvider(e)}))},i.addGraphToRDFDataProvider=function(e){for(var t,n=0,r=i.dataProvider.dataProviders;n<r.length;n++){var a=r[n],o=a.name,s=a.dataProvider;o===L.RDF_DATA_PROVIDER_NAME&&(t=s)}t&&t.addGraph(O.makeRdfExtGraph(e))},i.importModelLayout=function(e){var t=void 0===i.props.requestLinksOnInit||i.props.requestLinksOnInit,n=e||{};return i.workspace.getModel().importLayout({dataProvider:i.dataProvider,preloadedElements:n.preloadedElements||{},diagram:n.diagram,validateLinks:t})},i.openSaveModal=function(){var e=i.workspace.getModel().exportLayout();y.getOverlaySystem().show("create-new-resource",a.createElement(h.CreateResourceDialog,{onSave:function(t){return i.onSaveModalSubmit(t,e)},onHide:function(){return y.getOverlaySystem().hide("create-new-resource")},show:!0,title:i.props.saveDiagramLabel||"Save Ontodia diagram",placeholder:"Enter diagram name"}))},i.renderPropertyEditor=function(e){var t=i.state.fieldConfiguration,n=F.getEntityMetadata(e.elementData,t.metadata),o=i.workspace.getEditor().authoringState;if(n){var l=F.convertElementModelToCompositeValue(e.elementData,n),d=o.elements.get(l.subject.value),u=!1,p=void 0;d&&d.type===s.AuthoringKind.ChangeElement&&(u=!d.before,p=d.newIri);var f=r.__assign(r.__assign({},l),{subject:"string"==typeof p?c.Rdf.iri(p):l.subject}),m=makePersistenceFromConfig(t.persistence),h={acceptIriAuthoring:u||m.supportsIriEditing,fields:n.fieldByIri.toArray(),newSubjectTemplate:n.newSubjectTemplate,model:f,onSubmit:function(t){var r=F.convertCompositeValueToElementModel(t,n);e.onSubmit(r)},onCancel:function(){return e.onCancel&&e.onCancel()}},v=n.formChildren||g.generateFormFromFields({fields:n.fields.filter((function(e){return!M.isObjectProperty(e,n)})),overrides:t.inputOverrides});return a.createElement(_.EntityForm,h,v)}return a.createElement(E.ErrorNotification,{errorMessage:"<ontodia-entity-metadata> is not defined for the '"+e.elementData.types.join(", ")+"' types"})},i.resolveElementTemplate=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t],a=i.nodeTemplates[r];if(a)return a}return i.defaultNodeTemplate},i.prepareElementTemplates=function(){var e=i.props,t=e.nodeTemplates,n=e.defaultNodeTemplate;Object.keys(t).forEach((function(e){var n=t[e];i.nodeTemplates[e]=i.getElementTemplate(n)})),n&&(i.defaultNodeTemplate=i.getElementTemplate(n))},i.getElementTemplate=function(e){var inAuthoringMode=function(){return i.state.fieldConfiguration.authoringMode};return function(t){function class_1(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(class_1,t),class_1.prototype.render=function(){var t=this;return inAuthoringMode()?a.createElement(s.AuthoredEntity,{templateProps:this.props,children:function(n){return a.createElement(S.TemplateItem,{template:{source:e,options:t.props},componentMapper:function(e){return function mapTemplateComponent(e,t){return function mapElement(e){if(!I.isValidChild(e))return e;if("button"===e.type){switch(e.props.name){case"edit":return a.cloneElement(e,{disabled:!t.canEdit,onClick:t.onEdit});case"delete":return a.cloneElement(e,{disabled:!t.canDelete,onClick:t.onDelete})}return e}return"children"in e.props?a.cloneElement(e,{},I.universalChildren(a.Children.map(e.props.children,mapElement))):e}(e)}(e,n)}})}}):a.createElement(S.TemplateItem,{template:{source:e,options:this.props}})},class_1}(a.Component)},i.resolveLinkTemplate=function(e){var t=i.props,n=t.edgeStyles,a=t.defaultEdgeStyle,o=n[e]||a;if(o){var s=o.markerSource,l=o.markerTarget,d=o.linkStyle,u=void 0===d?{}:d,p=o.editable;return{markerSource:s,markerTarget:l,renderLink:function(e){if(p&&e.linkState){var t=[{value:e.linkState["ontodia:customLabel"],language:""}],n=u.label,a=void 0===n?{}:n,i=a.attrs,o=void 0===i?{}:i,s=o.text,l=void 0===s?{}:s;return r.__assign(r.__assign({},u),{label:r.__assign(r.__assign({},a),{attrs:r.__assign(r.__assign({},o),{text:r.__assign(r.__assign({},l),{text:t})})})})}return u},setLinkLabel:p?function(e,t){var n;e.setLinkState(((n={})["ontodia:customLabel"]=t,n))}:void 0}}},i.suggestProperties=function(e){var t=i.props.propertySuggestionQuery;if(!e.token){var n=i.workspace.getModel(),r=i.workspace.getDiagram(),a=n.getElement(e.elementId);e.token=a?r.formatLabel(a.data.label.values,a.data.id):""}return k.suggestProperties(e,t)},i.resolveNodeStyles=function(e){var t=i.props.nodeStyles;for(var n in t)if(e.indexOf(n)>=0){var r=t[n];return{icon:r.image,color:r.color}}},i.state={diagramIri:t.diagram,loading:!0},i}return r.__extends(Ontodia,e),Ontodia.prototype.componentDidUpdate=function(e){var t=this.props.diagram;t!==e.diagram&&this.setState({diagramIri:t})},Ontodia.prototype.loadFieldConfiguration=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:t=a.Children.toArray(this.props.children).find((function(e){return P.componentHasType(e,A.OntodiaFieldConfiguration)})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,A.extractFieldConfiguration(t?t.props:void 0,e)];case 2:return n=r.sent(),[3,4];case 3:return o=r.sent(),i=o,[3,4];case 4:return e.aborted||(n?(n.authoringMode&&(this.metadataApi=new D.FieldBasedMetadataApi(n.metadata),this.validationApi=new N.FieldBasedValidationApi(n.metadata,n.enforceConstraints)),this.setState({fieldConfiguration:n})):this.setState({configurationError:i})),[2]}}))}))},Ontodia.prototype.render=function(){var e=this;if(this.state.configurationError)return a.createElement(E.ErrorNotification,{errorMessage:this.state.configurationError});if(this.state.loading)return a.createElement(b.Spinner,{});var t=C.getPreferredUserLanguage(),n=T.ConfigHolder.getUIConfig().preferredLanguages.map((function(e){return{code:e,label:e}})),r=this.props,i=r.readonly,o=r.groupBy,s=r.hidePanels,l=r.hideNavigator,d=r.collapseNavigator,u=r.hideToolbar,p=r.hideHalo,c=r.hideScrollBars,f=r.saveDiagramLabel,m=r.persistChangesLabel,g=r.propertySuggestionQuery,h=r.zoomRequireCtrl,v=r.nodeStyles,y=r.leftPanelInitiallyOpen,S=r.rightPanelInitiallyOpen,I=this.state.fieldConfiguration,w=V.createWorkspace,P=V.createToolbar,k={ref:this.initWorkspace,languages:n.length>0?n:[{code:t,label:t}],language:t,onSaveDiagram:i?void 0:this.onSaveDiagramPressed,onPersistChanges:I.authoringMode?this.onPersistAuthoredChanges:void 0,leftPanelInitiallyOpen:!i&&y,rightPanelInitiallyOpen:!i&&S,toolbar:P(this.props,{saveDiagramLabel:f,persistChangesLabel:m,getWorkspace:this.getWorkspace,onSaveDiagramAs:function(){return e.openSaveModal()},onPersistChangesAndSaveDiagram:function(){return e.onPersistChangesAndSaveDiagram()}}),metadataApi:this.metadataApi,validationApi:this.validationApi,viewOptions:{onIriClick:this.onIriClick,groupBy:o,suggestProperties:g?this.suggestProperties:void 0},zoomOptions:{min:.002,maxFit:1,requireCtrl:h},hidePanels:s,hideToolbar:u,hideScrollBars:c,hideHalo:p,hideNavigator:l,collapseNavigator:d,typeStyleResolver:v?this.resolveNodeStyles:void 0,elementTemplateResolver:this.resolveElementTemplate,linkTemplateResolver:this.resolveLinkTemplate,selectLabelLanguage,propertyEditor:this.renderPropertyEditor};return w(this.props,k)},Ontodia.prototype.componentDidMount=function(){var e=this;this.loadFieldConfiguration(B.deriveCancellationToken(this.cancellation)).then((function(){return e.setState({loading:!1})})),this.parsedMetadata=this.parseMetadata(),this.prepareElementTemplates(),this.registerEventSources()},Ontodia.prototype.componentWillUnmount=function(){this.cancellation.cancelAll(),this.listener.stopListening(),this.navigationListenerUnsubscribe&&this.navigationListenerUnsubscribe(),this.unregisterEventSources()},Ontodia.prototype.registerEventSources=function(){var e=this.props.id;d.registerEventSource({source:e,eventType:j.DiagramChanged}),d.registerEventSource({source:e,eventType:j.DiagramIsDirty})},Ontodia.prototype.unregisterEventSources=function(){var e=this.props.id;d.unregisterEventSource({source:e,eventType:j.DiagramChanged}),d.unregisterEventSource({source:e,eventType:j.DiagramIsDirty})},Ontodia.prototype.subscribeOnEvents=function(){var e=this,t=this.props.id,n=this.workspace.getModel(),r=this.workspace.getEditor(),a=o.debounce((function(){d.trigger({source:t,eventType:j.DiagramChanged,data:{model:n,authoringState:r.authoringState,temporaryState:r.temporaryState}})}),300);this.listener.listen(n.events,"changeCells",a),this.listener.listen(n.events,"elementEvent",(function(e){"changeData"===e.key&&a()})),this.listener.listen(r.events,"changeAuthoringState",a),this.listener.listen(r.events,"changeTemporaryState",a),this.cancellation.map(d.listen({eventType:j.FocusOnElement,target:t})).observe({value:function(t){var a=t.data,i=n.elements.find((function(e){return e.iri===a.iri}));if(i){var o=i.position,s=o.x,l=o.y,d=i.size,u=d.width,p=d.height;e.workspace.zoomToFitRect({x:s,y:l,width:u,height:p}),r.setSelection([i])}}})},Ontodia.prototype.subscribeOnAuthoringEvents=function(){var e=this,t=this.props.id,n=this.workspace.getEditor();this.cancellation.map(d.listen({eventType:j.CreateElement,target:t})).map((function(t){var n=t.data.elementData;return r.__assign(r.__assign({},t.data),{elementModel:r.__assign(r.__assign({},n),{id:e.metadataApi.generateIriForModel(n)})})})).observe({value:function(e){var t=e.elementModel,r=e.targets,a=n.createNewEntity({elementModel:t});r.forEach((function(e){var t=e.targetIri,r=e.linkTypeId,i=n.model.elements.find((function(e){return e.iri===t}));if(i){var o={linkTypeId:r,sourceId:a.iri,targetId:i.iri},l=new s.Link({typeId:r,sourceId:a.id,targetId:i.id,data:o});n.createNewLink({link:l})}}))}}),this.cancellation.map(d.listen({eventType:j.EditElement,target:t})).observe({value:function(e){var t=e.data,r=t.targetIri,a=t.elementData;n.changeEntityData(r,a)}}),this.cancellation.map(d.listen({eventType:j.DeleteElement,target:t})).observe({value:function(e){n.deleteEntity(e.data.iri)}})},Ontodia.prototype.importLayout=function(){var e=this,t=i.combine([i.fromPromise(this.setLayout()),this.parsedMetadata]);this.cancellation.map(t).observe({error:function(t){return e.setState({configurationError:t})},end:function(){e.props.id&&d.trigger({eventType:d.BuiltInEvents.ComponentLoaded,source:e.props.id})}}),this.props.id&&d.trigger({eventType:d.BuiltInEvents.ComponentLoading,source:this.props.id,data:t.toProperty()})},Ontodia.prototype.registerNavigationConfirmation=function(){var e=this,t=this.workspace.getModel();this.listener.listen(t.history.events,"historyChanged",(function(t){var n=t.hasChanges;if(n&&e.props.id&&d.trigger({eventType:j.DiagramIsDirty,source:e.props.id,data:{hasChanges:n}}),n&&!e.navigationListenerUnsubscribe){e.navigationListenerUnsubscribe=f.navigationConfirmation("Changes you made to the diagram will not be saved.")}else!n&&e.navigationListenerUnsubscribe&&(e.navigationListenerUnsubscribe(),e.navigationListenerUnsubscribe=void 0)}))},Ontodia.prototype.parseMetadata=function(){return this.props.metadata?this.cancellation.map(c.turtle.deserialize.turtleToTriples(this.props.metadata).mapErrors((function(e){return new u.WrappingError("Invalid metadata format",e)}))):i.constant([])},Ontodia.prototype.onPersistChangesAndSaveDiagram=function(){var e=this;this.workspace.showWaitIndicatorWhile(this.persistAuthoredChanges().then((function(){return e.onSaveDiagramPressed()})))},Ontodia.prototype.persistAuthoredChanges=function(){var e=this.state.fieldConfiguration,t=makePersistenceFromConfig(e.persistence),n=this.workspace.getModel(),r=this.workspace.getEditor(),a=new Map;n.elements.forEach((function(e){return a.set(e.iri,e.data)}));return t.persist({entityMetadata:e.metadata,state:r.authoringState,fetchModel:function(e){return a.has(e)?i.constant(a.get(e)):i.fromPromise(n.dataProvider.elementInfo({elementIds:[e]}).then((function(t){return t[e]}))).toProperty()}}).map(this.onChangesPersisted).toPromise()},Ontodia.prototype.setLayout=function(){var e=this;return this.importProvisionData().then((function(){var t=e.props,n=t.query,r=t.iri,a=t.linkSettings,i=t.iris,o=e.state.diagramIri;return o?e.setLayoutByDiagram(o):n?e.setLayoutBySparqlQuery(n):r?e.setLayoutByIri(r):i?e.setLayoutByIris(i):e.importModelLayout({preloadedElements:{},diagram:s.makeSerializedDiagram({linkTypeOptions:a})})})).then((function(){e.workspace.getModel().history.reset()}))},Ontodia.prototype.setLayoutBySparqlQuery=function(e){var t=this,n=V.onNewDigaramInitialized,r=this.getRepositories(),a=O.getRdfExtGraphBySparqlQuery(e,r).then((function(e){return new s.GraphBuilder(t.dataProvider).getGraphFromRDFGraph(e)}));return this.workspace.showWaitIndicatorWhile(a),a.then((function(e){return t.importModelLayout({preloadedElements:e.preloadedElements,diagram:e.diagram})})).then((function(){n(t.props,t.workspace)}))},Ontodia.prototype.setLayoutByDiagram=function(e){var t=this,n=k.getDiagramByIri(e,{repository:"assets"});return this.workspace.showWaitIndicatorWhile(n),n.then((function(e){return t.setState({label:e.label}),t.importModelLayout({diagram:e.diagram})})).then((function(){t.workspace.zoomToFit()}))},Ontodia.prototype.setLayoutByIri=function(e){var t=this;return this.setLayoutByIris([e]).then((function(){var n=t.workspace.getEditor(),r=n.model.elements.find((function(t){return t.data.id===e}));r&&(t.workspace.centerTo({x:r.position.x+r.size.width/2+500,y:r.position.y+r.size.height/2}),n.showConnectionsMenu(r))}))},Ontodia.prototype.setLayoutByIris=function(e){var t=this,n=V.onNewDigaramInitialized,a=new s.GraphBuilder(this.dataProvider).createGraph({elementIds:e.map((function(e){return e})),links:[]});return this.workspace.showWaitIndicatorWhile(a),a.then((function(e){return t.importModelLayout({preloadedElements:e.preloadedElements,diagram:r.__assign(r.__assign({},e.diagram),{linkTypeOptions:t.props.linkSettings})}).then((function(){n(t.props,t.workspace)}))}))},Ontodia.prototype.onSaveModalSubmit=function(e,t){var n=this;return this.setState({label:e}),this.cancellation.map(this.parsedMetadata.flatMap((function(n){return k.saveDiagram(e,t,n)}))).flatMap((function(e){return n.props.addToDefaultSet?v.addToDefaultSet(e,n.props.id):i.constant(e)})).flatMap((function(e){if(n.workspace.getModel().history.reset(),"navigate"===n.props.postSaving){var t=r.__assign(r.__assign({},n.props.queryParams),{diagram:e.value});return f.navigateToResource(c.Rdf.iri(n.props.navigateTo),t)}return n.setState({diagramIri:e.value}),i.constant(void 0)})).map((function(e){return d.trigger({eventType:j.DiagramSaved,source:n.props.id,data:{resourceIri:n.state.diagramIri}}),d.trigger({eventType:j.DiagramIsDirty,source:n.props.id,data:{hasChanges:!1}}),e})).mapErrors((function(t){return E.addNotification({level:"error",message:"Error saving diagram "+e},t),t})).toProperty()},Ontodia.defaultProps={navigateTo:"http://www.researchspace.org/resource/assets/OntodiaView",queryParams:{},addToDefaultSet:!1,nodeTemplates:{},edgeStyles:{},acceptBlankNodes:!1,postSaving:"navigate"},Ontodia}(p.Component);function makePersistenceFromConfig(e){return void 0===e&&(e={type:"form"}),V.getPersistence(e)}t.Ontodia=U;var selectLabelLanguage=function(e,t){return C.selectPreferredLabel(e,t)};t.default=U},3307:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(19),i=n(33),o=n(1579),s=n(23),l=n(1223),d=n(218),u=n(61),p=n(118),c=n(1227),f=n(1579),m=n(3308);t.OntodiaContextV1=n(3309),t.prepareImages=function prepareImages(e,t){var n;try{var r=u.SparqlUtil.parseQuery(t);if("query"!==r.type)throw new Error("Image query must be a SELECT query");var a=Object.keys(e).map((function(e){return{element:s.Rdf.iri(e)}}));n=u.SparqlClient.prepareParsedQuery(a)(r)}catch(e){return Promise.reject(e)}return u.SparqlClient.select(n).map((function(e){for(var t={},n=0,r=e.results.bindings;n<r.length;n++){var a=r[n];t[a.element.value]=a.image.value}return t})).toPromise()},t.fetchThumbnails=function fetchThumbnails(e,t){var n=Object.keys(e).map((function(e){return s.Rdf.iri(e)}));return c.getThumbnails(n,{context:t}).map((function(e){return e.mapKeys((function(e){return e.value})).toObject()})).toPromise()};var g={"@context":t.OntodiaContextV1["@context"],"@type":"Diagram",layoutData:{"@type":"Layout",elements:{"@type":"Element","@embed":"@always","ontodia:resource":{"@embed":"@never"}},links:{"@type":"Link",source:{"@embed":"@never"},target:{"@embed":"@never"}}}};function makeDiagramResource(e,n,a,i){void 0===i&&(i="");var s=r.__assign({},e);return(s["@context"]=o.DIAGRAM_CONTEXT_URL_V1)&&(s["@context"]=t.OntodiaContextV1["@context"]),s[d.rdfs.label.value]=n,s["@id"]=i,a.forEach((function(e){s[e.p.value]=e.o.isLiteral()?e.o.value:{"@id":e.o.value}})),s}t.getDiagramByIri=function getDiagramByIri(e,n){var i,s=new p.LdpService(d.VocabPlatform.OntodiaDiagramContainer.value,n),u=l.makeDocumentLoader({overrideContexts:(i={},i[o.DIAGRAM_CONTEXT_URL_V1]=t.OntodiaContextV1,i)});return s.getResourceRequest(e,"text/turtle").flatMap((function(e){return l.fromRdf(e,{documentLoader:u,format:"text/turtle",useNativeTypes:!0})})).flatMap((function(e){if(e.length>0&&e[0]&&e[0]["@type"]&&e[0]["@type"]instanceof Array&&e[0]["@type"].indexOf(m.ontodiaNsv0.diagram.value)>=0){var t=JSON.parse(e[0][m.ontodiaNsv0.diagramLayoutString.value][0]["@value"]);return a.constant({label:e[0][d.rdfs.label.value],diagram:f.convertToSerializedDiagram({layoutData:t.layoutData,linkTypeOptions:t.linkSettings})})}return l.frame(e,g,{documentLoader:u}).map((function(e){return{label:e["@graph"][0][d.rdfs.label.value],diagram:r.__assign(r.__assign({linkTypeOptions:[]},e["@graph"][0]),{"@context":e["@context"]})}}))})).toPromise()},t.saveDiagram=function saveDiagram(e,t,n){var r=makeDiagramResource(t,e,n);return new p.LdpService(d.VocabPlatform.OntodiaDiagramContainer.value).createResourceRequest(d.VocabPlatform.OntodiaDiagramContainer,{data:JSON.stringify(r),format:"application/ld+json"},i.Just(e)).map((function(e){return new s.Rdf.Iri(e)}))},t.updateDiagram=function updateDiagram(e,t,n,r){var a=makeDiagramResource(t,n,r,e);return new p.LdpService(d.VocabPlatform.OntodiaDiagramContainer.value).sendUpdateResourceRequest(s.Rdf.iri(e),{data:JSON.stringify(a),format:"application/ld+json"}).map((function(){}))},t.suggestProperties=function suggestProperties(e,t){var n=e.token,r=e.properties,a={context:{repository:"wikidata-property-suggester"}},i=s.Rdf.literal(n.toLowerCase()),o=[];return r.forEach((function(e){o.push({property:s.Rdf.iri(e)})})),u.SparqlClient.prepareQuery(t,o).map((function(e){return u.SparqlClient.setBindings(e,{term:i})})).flatMap((function(e){return u.SparqlClient.select(e,a)})).map((function(e){var t=e.results.bindings,n={};return t.forEach((function(e){var t=e.id.value,r=parseFloat(e.score.value);n[t]={propertyIri:t,score:r}})),r.forEach((function(e){n[e]||(n[e]={propertyIri:e,score:0})})),n})).toPromise()}},3308:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(23);!function(e){e._NAMESPACE="http://www.ontodia.org/schema/v1#",e.iri=function(t){return r.Rdf.iri(e._NAMESPACE+t)},e.diagram=e.iri("diagram"),e.diagramLayoutString=e.iri("diagramLayoutString")}(t.ontodiaNsv0||(t.ontodiaNsv0={})),function(e){e._NAMESPACE="http://ontodia.org/schema/v1#",e.iri=function(t){return r.Rdf.iri(e._NAMESPACE+t)},e.diagram=e.iri("Diagram")}(t.ontodiaNsv1||(t.ontodiaNsv1={}))},3309:function(e){e.exports=JSON.parse('{"@context":{"ontodia":"http://ontodia.org/schema/v1#","xsd":"http://www.w3.org/2001/XMLSchema#","Diagram":"ontodia:Diagram","layoutData":"ontodia:layoutData","linkTypeOptions":"ontodia:linkTypeOptions","Layout":"ontodia:Layout","elements":{"@id":"ontodia:hasElement","@container":"@set"},"links":{"@id":"ontodia:hasLink","@container":"@set"},"Element":"ontodia:Element","iri":{"@id":"ontodia:resource","@type":"@id"},"position":"ontodia:position","x":{"@id":"ontodia:xCoordValue"},"y":{"@id":"ontodia:yCoordValue"},"size":"ontodia:size","fixedSize":"ontodia:fixedSize","height":{"@id":"ontodia:height"},"width":{"@id":"ontodia:width"},"isExpanded":{"@id":"ontodia:isExpanded"},"Link":"ontodia:Link","property":{"@id":"ontodia:property","@type":"@id"},"source":"ontodia:source","target":"ontodia:target","vertices":{"@id":"ontodia:vertex","@container":"@list"},"LinkTypeOptions":"ontodia:LinkTypeOptions","visible":"ontodia:visible","showLabel":"ontodia:showLabel","elementState":"ontodia:elementState","linkState":"ontodia:linkState"}}')},3310:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1579),i=n(34),o=n(61),s=n(141),l=n(36),d=n(216),u=n(3311);t.RDF_DATA_PROVIDER_NAME="rdf";var p={default:u.OwlStatsSettings,nostats:u.OwlNoStatsSettings,wikidata:u.WikidataSettings};function getEndpointUrlForRepository(e){return(l.getBaseUrl()?l.getBaseUrl()+"/sparql":"/sparql")+"?repository="+e}t.createDataProvider=function createDataProvider(e){var n,i=e.configName,o=e.options,l=e.settings,u=e.repositories,f=e.createRDFStorage,m=e.fields,g=e.forceFields;if(i){if(!(n=p[i]))throw new Error("Unknown Ontodia configuration '"+i+"'")}else n=p.default;n.dataLabelProperty=s.ConfigHolder.getUIConfig().labelPropertyPattern;var h=function createFieldConfiguration(e,t){var n=function createLinkConfigurations(e){if(!e||0===e.length)return[];return e.filter((function(e){return d.xsd.anyURI.equals(e.xsdDatatype)})).map(fieldToLinkConfig)}(e),a=function createPropertyConfiguration(e,t){if(!e||0===e.length)return[];return e.filter((function(e){return t&&t.has(e.iri)||!d.xsd.anyURI.equals(e.xsdDatatype)})).map(fieldToPropertyConfig)}(e,t),i={linkConfigurations:n,propertyConfigurations:a};n.length>0&&(i=r.__assign(r.__assign({},i),{elementInfoQuery:"\n        PREFIX ontodia: <https://ontodia.org/context/v1.json/>\n        CONSTRUCT {\n            ?inst ontodia:type ?class .\n            ?inst ontodia:label ?label .\n            ?inst ?propType ?propValue.\n        } WHERE {\n            VALUES (?inst) {${ids}}\n            OPTIONAL { ?inst a ?class }\n            OPTIONAL { ?inst ${dataLabelProperty} ?label }\n            OPTIONAL {\n              ${propertyConfigurations}\n            }\n        }\n      "}));return i}(m,g),v=r.__assign(r.__assign(r.__assign({},n),h),l);if(1===u.length&&!f){var y=u[0];return new c(r.__assign(r.__assign({},o),{endpointUrl:getEndpointUrlForRepository(y)}),v)}var E=u.map((function(e){return{name:e,dataProvider:new c(r.__assign(r.__assign({},o),{endpointUrl:getEndpointUrlForRepository(e)}),v)}}));return f&&E.push({name:t.RDF_DATA_PROVIDER_NAME,dataProvider:new a.RDFDataProvider({data:[],parsers:{}})}),new a.CompositeDataProvider(E)};var c=function(e){function OptimizingDataProvider(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(OptimizingDataProvider,e),OptimizingDataProvider.prototype.executeSparqlQuery=function(t){var n=this.optimizeAndAddPrefixes(t);return e.prototype.executeSparqlQuery.call(this,n)},OptimizingDataProvider.prototype.executeSparqlConstruct=function(t){var n=this.optimizeAndAddPrefixes(t);return e.prototype.executeSparqlConstruct.call(this,n)},OptimizingDataProvider.prototype.optimizeAndAddPrefixes=function(e){try{var t=o.SparqlUtil.parseQuery(e);return o.SparqlUtil.serializeQuery(t)}catch(t){return console.warn("Failed to optimize Ontodia query:"),console.warn(e),console.warn(t),e}},OptimizingDataProvider}(a.SparqlDataProvider);function fieldToLinkConfig(e){var t=parseSelectPattern(e),n=e.domain?e.domain.map((function(e){return e.value})):void 0,r=parseDirectPredicate(t.where);return r?{id:e.iri,domain:n,path:r}:(new o.VariableRenameBinder("subject","source").query(t),new o.VariableRenameBinder("value","target").query(t),{id:e.iri,domain:n,path:serializePatterns(t.where)})}function fieldToPropertyConfig(e){var t=parseSelectPattern(e),n=e.domain?e.domain.map((function(e){return e.value})):void 0,r=parseDirectPredicate(t.where);return r?{id:e.iri,domain:n,path:r}:(new o.VariableRenameBinder("subject","inst").query(t),{id:e.iri,domain:n,path:serializePatterns(t.where)})}function parseSelectPattern(e){if(!e.selectPattern)throw new Error("Expected a selectPattern for field: "+e.iri);var t;try{t=o.SparqlUtil.parseQuery(e.selectPattern)}catch(t){throw new i.WrappingError("Failed to parse selectPattern for field: "+e.iri,t)}if("query"!==t.type||"SELECT"!==t.queryType)throw new Error("Expected a SELECT query in selectPattern for field: "+e.iri);return t}function serializePatterns(e){var t={type:"query",queryType:"SELECT",variables:["*"],prefixes:{},where:e},n=o.SparqlUtil.serializeQuery(t),r="SELECT * WHERE { ".length;return n.substr(r,n.length-r-2)}function parseDirectPredicate(e){for(var t,n=o.SparqlTypeGuards.isIri,r=0,a=e;r<a.length;r++){var i=a[r];switch(i.type){case"bgp":for(var s=0,l=i.triples;s<l.length;s++){var d=l[s],u=/^[?$]subject$/.test(d.subject)&&/^[?$]value$/.test(d.object)&&n(d.predicate),p=/^[?$]label$/.test(d.object);if(u)t=d.predicate;else if(!p)return}break;case"bind":break;default:return}}return t}},3311:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.WikidataSettings={linkConfigurations:[],propertyConfigurations:[],defaultPrefix:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX wdt: <http://www.wikidata.org/prop/direct/>\nPREFIX wd: <http://www.wikidata.org/entity/>\nPREFIX owl:  <http://www.w3.org/2002/07/owl#>\n\n",schemaLabelProperty:"rdfs:label",dataLabelProperty:"rdfs:label",fullTextSearch:{prefix:"PREFIX bds: <http://www.bigdata.com/rdf/search#>\n",queryPattern:"?inst rdfs:label ?searchLabel.\nSERVICE bds:search {\n  ?searchLabel bds:search \"${text}*\" ;\n    bds:minRelevance '0.5' ;\n    bds:matchAllTerms 'true' .\n}\nBIND(IF(STRLEN(?strInst) > 33,\n  0-<http://www.w3.org/2001/XMLSchema#integer>(SUBSTR(?strInst, 33)),\n  -10000\n) as ?score)\n"},classTreeQuery:"SELECT distinct ?class ?parent WHERE {\n  { ?class wdt:P279 wd:Q35120. }\n    UNION\n  { ?parent wdt:P279 wd:Q35120.\n    ?class wdt:P279 ?parent. }\n    UNION\n  { ?parent wdt:P279/wdt:P279 wd:Q35120.\n    ?class wdt:P279 ?parent. }\n}",linksInfoQuery:"SELECT ?source ?type ?target WHERE {\n  ${linkConfigurations}\n  VALUES (?source) {${ids}}\n  VALUES (?target) {${ids}}\n}",elementInfoQuery:"PREFIX ontodia: <https://ontodia.org/context/v1.json/>\nCONSTRUCT {\n  ?inst ontodia:type ?class .\n  ?inst ?propType ?propValue.\n} WHERE {\n  VALUES (?inst) {${ids}}\n  OPTIONAL {\n    ?inst wdt:P31 ?class\n  }\n  OPTIONAL {\n    ${propertyConfigurations}\n    FILTER (isLiteral(?propValue))\n  }\n}",imageQueryPattern:'{ ?inst ?linkType ?fullImage } UNION { ?inst wdt:P163/wdt:P18 ?fullImage }\nBIND(CONCAT("https://commons.wikimedia.org/w/thumb.php?f=",\n  STRAFTER(STR(?fullImage), "Special:FilePath/"), "&w=200") AS ?image)\n',linkTypesOfQuery:"SELECT DISTINCT ?link WHERE {\n  ${linkConfigurations}\n  ?claim <http://wikiba.se/ontology#directClaim> ?link .\n}",linkTypesStatisticsQuery:"SELECT (${linkId} as ?link) (COUNT(?outObject) AS ?outCount) (COUNT(?inObject) AS ?inCount)\nWHERE {\n  {\n    {\n      SELECT DISTINCT ?outObject WHERE {\n        ${linkConfigurationOut}\n        FILTER(ISIRI(?outObject))\n        ?outObject ?someprop ?someobj.\n      }\n      LIMIT 101\n    }\n  } UNION {\n    {\n      SELECT DISTINCT ?inObject WHERE {\n        ${linkConfigurationIn}\n        FILTER(ISIRI(?inObject))\n        ?inObject ?someprop ?someobj.\n      }\n      LIMIT 101\n    }\n  }\n}",filterRefElementLinkPattern:"?claim <http://wikiba.se/ontology#directClaim> ?link .",filterTypePattern:"?inst wdt:P31 ?instType. ?instType wdt:P279* ?class",filterAdditionalRestriction:"FILTER ISIRI(?inst)\nBIND(STR(?inst) as ?strInst)\nFILTER EXISTS { ?inst ?someprop ?someobj }\n",filterElementInfoPattern:"OPTIONAL { ?inst wdt:P31 ?foundClass }\nBIND (COALESCE(?foundClass, owl:Thing) as ?class)\nOPTIONAL { ?inst rdfs:label ?label }\n"},t.OwlNoStatsSettings={linkConfigurations:[],propertyConfigurations:[],defaultPrefix:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nPREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX owl:  <http://www.w3.org/2002/07/owl#>\n\n",schemaLabelProperty:"rdfs:label",dataLabelProperty:"rdfs:label",fullTextSearch:{prefix:"",queryPattern:'OPTIONAL { ?inst ${dataLabelProperty} ?search1 }\nFILTER REGEX(COALESCE(STR(?search1), STR(?extractedLabel)), "${text}", "i")\nBIND(0 as ?score)\n',extractLabel:!0},classTreeQuery:"SELECT ?class ?parent WHERE {\n  { ?class a rdfs:Class }\n  UNION\n  { ?class a owl:Class }\n  FILTER ISIRI(?class)\n  OPTIONAL { ?class rdfs:subClassOf ?parent. FILTER ISIRI(?parent) }\n}",linksInfoQuery:"SELECT ?source ?type ?target WHERE {\n  ${linkConfigurations}\n  VALUES (?source) {${ids}}\n  VALUES (?target) {${ids}}\n}",elementInfoQuery:"PREFIX ontodia: <https://ontodia.org/context/v1.json/>\n\nCONSTRUCT {\n  ?inst ontodia:type ?class .\n  ?inst ontodia:label ?label .\n  ?inst ?propType ?propValue.\n} WHERE {\n  VALUES (?inst) {${ids}}\n  OPTIONAL { ?inst a ?class }\n  OPTIONAL { ?inst ${dataLabelProperty} ?label }\n  OPTIONAL {\n    ${propertyConfigurations}\n    FILTER (isLiteral(?propValue))\n  }\n}\n",imageQueryPattern:"{ ?inst ?linkType ?image }\nUNION\n{ [] ?linkType ?inst. BIND(?inst as ?image) }\n",linkTypesOfQuery:"SELECT DISTINCT ?link WHERE {\n  ${linkConfigurations}\n}\n",linkTypesStatisticsQuery:"SELECT ?link ?outCount ?inCount WHERE {\n  {\n    SELECT (${linkId} as ?link) (count(?outObject) as ?outCount) WHERE {\n      ${linkConfigurationOut} .\n      ${navigateElementFilterOut}\n    } LIMIT 101\n  }\n  {\n    SELECT (${linkId} as ?link) (count(?inObject) as ?inCount) WHERE {\n      ${linkConfigurationIn} .\n      ${navigateElementFilterIn}\n    } LIMIT 101\n  }\n}",filterRefElementLinkPattern:"",filterTypePattern:"?inst a ?instType. ?instType rdfs:subClassOf* ?class",filterElementInfoPattern:"OPTIONAL { ?inst rdf:type ?foundClass }\nBIND (COALESCE(?foundClass, owl:Thing) as ?class)\nOPTIONAL { ?inst ${dataLabelProperty} ?label }\n",filterAdditionalRestriction:""},t.OwlStatsSettings=r.__assign(r.__assign({},t.OwlNoStatsSettings),{classTreeQuery:"SELECT ?class ?instcount ?label ?parent WHERE {\n  {\n    SELECT ?class (count(?inst) as ?instcount)\n    WHERE {\n      ?inst rdf:type ?class.\n      FILTER ISIRI(?class)\n    }\n    GROUP BY ?class\n  }\n  UNION\n  { ?class rdf:type rdfs:Class }\n  UNION\n  { ?class rdf:type owl:Class }\n  OPTIONAL { ?class rdfs:label ?label }\n  OPTIONAL { ?class rdfs:subClassOf ?parent. FILTER ISIRI(?parent) }\n}"})},3312:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),a=n(16),i=n(1967),o=n(61);function makeRdfExtNode(e){var t=e.type,n=e.value;return"uri"===t?i.createNamedNode(n):i.createLiteral(n)}t.getRdfExtGraphBySparqlQuery=function getRdfExtGraphBySparqlQuery(e,t){return r.combine(t.map((function(t){return o.SparqlClient.construct(e,{context:{repository:t}})}))).map((function(e){var t=[];return a.flatten(e).forEach((function(e){t.push({subject:{type:e.s.isIri()?"uri":"literal",value:e.s.value},predicate:{type:e.p.isIri()?"uri":"literal",value:e.p.value},object:{type:e.o.isIri()?"uri":"literal",value:e.o.value}})})),a.uniqWith(t,a.isEqual)})).toPromise()},t.makeRdfExtGraph=function makeRdfExtGraph(e){var t=e.map((function(e){var t=e.subject,n=e.predicate,r=e.object;return{subject:makeRdfExtNode(t),predicate:makeRdfExtNode(n),object:makeRdfExtNode(r)}}));return i.createGraph(t)}},3313:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),i=n(72),o=n(7),s=n(1579),l=n(56),d=n(216),u=n(121),p=n(1238),c=n(1460);t.ToolbarStyles=c;var f=function(e){function Toolbar(){var t=null!==e&&e.apply(this,arguments)||this;return t.listener=new s.EventObserver,t.onExportPng=function(){return t.props.onExportPNG()},t.onExportSvg=function(){return t.props.onExportSVG()},t.onChangeLanguage=function(e){var n=e.currentTarget.value;t.props.onChangeLanguage(n)},t}return r.__extends(Toolbar,e),Toolbar.prototype.componentDidMount=function(){var e=this,t=this.props.history;t&&this.listener.listen(t.events,"historyChanged",(function(){e.forceUpdate()}))},Toolbar.prototype.renderSaveButton=function(){var e=this.props,t=e.canPersistChanges,n=e.hasUnpersistedChanges,r=e.canSaveDiagram,o=e.saveDiagramLabel,s=e.persistChangesLabel,l=e.onPersistChanges,d=e.onPersistChangesAndSaveDiagram,u=e.onSaveDiagram,p=e.onSaveDiagramAs;return l&&n?a.createElement(i.Dropdown,{id:"persist-changes-button",className:"btn-group-sm",disabled:!t},a.createElement(i.Button,{disabled:!t,bsStyle:"success",onClick:l,className:c.saveButton},a.createElement("span",{className:"fa fa-floppy-o","aria-hidden":"true"})," ",s),a.createElement(i.Dropdown.Toggle,{bsStyle:"success"}),a.createElement(i.Dropdown.Menu,null,a.createElement(i.MenuItem,{href:"#",onClick:d},s," & ",o))):u&&r?a.createElement(i.Dropdown,{id:"save-diagram-button",className:"btn-group-sm"},a.createElement(i.Button,{bsStyle:"primary",onClick:u,className:c.saveButton},a.createElement("span",{className:"fa fa-floppy-o","aria-hidden":"true"})," ",o),a.createElement(i.Dropdown.Toggle,{bsStyle:"primary"}),a.createElement(i.Dropdown.Menu,null,a.createElement(i.MenuItem,{href:"#",onClick:p},o," as..."))):null},Toolbar.prototype.render=function(){var e=this.getUndoReduCommands(this.props.history),t=e.redo,n=e.undo;return a.createElement("div",{className:c.component},a.createElement(p.HasPermission,{permission:u.Permissions.toLdp("container",d.VocabPlatform.OntodiaDiagramContainer,"create","any")},a.createElement(i.ButtonGroup,{bsSize:"small",className:c.group},this.renderSaveButton())),n&&t?a.createElement(i.ButtonGroup,{bsSize:"small",className:c.group},a.createElement(i.Button,{className:"ontodia-btn ontodia-btn-default",title:n.title,disabled:!n.enabled,onClick:n.invoke},a.createElement("span",{className:"fa fa-undo","aria-hidden":"true"})),a.createElement(i.Button,{className:"ontodia-btn ontodia-btn-default",title:t.title,disabled:!t.enabled,onClick:t.invoke},a.createElement("span",{className:"fa fa-repeat","aria-hidden":"true"}))):null,a.createElement(i.ButtonGroup,{bsSize:"small",className:c.group},a.createElement(i.Button,{type:"button",className:"ontodia-btn ontodia-btn-default",onClick:this.props.onForceLayout},a.createElement("span",{title:"Force layout",className:"fa fa-snowflake-o","aria-hidden":"true"})),this.props.onClearAll?a.createElement(i.Button,{onClick:this.props.onClearAll},a.createElement("span",{className:"fa fa-trash","aria-hidden":"true"})," Clear All"):null,a.createElement(i.Button,{title:"Zoom In",onClick:this.props.onZoomIn},a.createElement("span",{className:"fa fa-search-plus","aria-hidden":"true"})),a.createElement(i.Button,{title:"Zoom Out",onClick:this.props.onZoomOut},a.createElement("span",{className:"fa fa-search-minus","aria-hidden":"true"})),a.createElement(i.Button,{title:"Fit to Screen",onClick:this.props.onZoomToFit},a.createElement("span",{className:"fa fa-arrows-alt","aria-hidden":"true"})),a.createElement(i.Button,{title:"Export diagram as PNG",onClick:this.onExportPng},a.createElement("span",{className:"fa fa-picture-o","aria-hidden":"true"})," PNG"),a.createElement(i.Button,{title:"Export diagram as SVG",onClick:this.onExportSvg},a.createElement("span",{className:"fa fa-picture-o","aria-hidden":"true"})," SVG"),a.createElement(i.Button,{title:"Print diagram",onClick:this.props.onPrint},a.createElement("span",{className:"fa fa-print","aria-hidden":"true"}))),this.renderLanguages())},Toolbar.prototype.renderLanguages=function(){var e=this.props,t=e.selectedLanguage,n=e.languages;return n.length<=1?null:a.createElement(i.ButtonGroup,{bsSize:"small",className:o(c.group,c.languageSelector)},a.createElement("label",null,a.createElement("span",null,"Data Language - "),a.createElement("select",{value:t,onChange:this.onChangeLanguage},n.map((function(e){var t=e.code,n=e.label;return a.createElement("option",{key:t,value:t},n)})))))},Toolbar.prototype.getUndoReduCommands=function(e){var t,n;if(e){var r=last(e.undoStack);t={title:r&&r.title?"Undo ("+r.title+")":"Undo",enabled:Boolean(r),invoke:function(){return e.undo()}};var a=last(e.redoStack);n={title:a&&a.title?"Redo ("+a.title+")":"Redo",enabled:Boolean(a),invoke:function(){return e.redo()}}}return{undo:t,redo:n}},Toolbar.defaultProps={saveDiagramLabel:"Save diagram",persistChangesLabel:"Save data"},Toolbar}(l.Component);function last(e){return e.length>0?e[e.length-1]:void 0}t.Toolbar=f},3314:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),i=n(1),o=n(56),s=n(1562),l=n(214),d=n(1461),u=n(23),p=function(e){function EntityForm(t,n){var r=e.call(this,t,n)||this;r.onSubmit=function(){r.formRef.finalize(r.state.model).observe({value:function(e){r.props.onSubmit(e)},error:function(){return r.props.onSubmit(r.state.model)}})},r.onReset=function(){r.setState({model:r.initModel})};var a=r.modelEqualToSuggested(r.props.model);return r.initModel=r.props.model,r.state={model:r.initModel,suggestIri:Boolean(r.props.acceptIriAuthoring)&&a},r}return r.__extends(EntityForm,e),EntityForm.prototype.componentWillReceiveProps=function(e){this.props.model!==e.model&&(this.initModel=e.model,this.setState({model:this.initModel}))},EntityForm.prototype.mapChildren=function(e){var t=this;return i.Children.map(e,(function(e){if(l.isValidChild(e)){if("button"===e.type){if("reset"===e.props.name)return i.cloneElement(e,{onClick:t.onReset});if("submit"===e.props.name)return i.cloneElement(e,{onClick:t.onSubmit});if("cancel"===e.props.name)return i.cloneElement(e,{onClick:function(){return t.props.onCancel()}})}if(e.props.children)return i.cloneElement(e,{},l.universalChildren(t.mapChildren(e.props.children)))}return e}))},EntityForm.prototype.onModelUpdate=function(e){var t=this.props.acceptIriAuthoring&&this.state.suggestIri?this.modifyModelsIriBySuggestion(e):e;this.setState({model:t})},EntityForm.prototype.modifyModelsIriBySuggestion=function(e){return this.modelEqualToSuggested(e)?e:r.__assign(r.__assign({},e),{subject:s.generateSubjectByTemplate(this.props.newSubjectTemplate,void 0,r.__assign(r.__assign({},e),{subject:new u.Rdf.Iri("")}))})},EntityForm.prototype.modelEqualToSuggested=function(e){return s.wasIriGeneratedByTemplate(e.subject.value,this.props.newSubjectTemplate,void 0,r.__assign(r.__assign({},e),{subject:new u.Rdf.Iri("")}))},EntityForm.prototype.onChangeIri=function(e){var t=e.target.value;this.setState((function(e){return{suggestIri:!1,model:r.__assign(r.__assign({},e.model),{subject:new u.Rdf.Iri(t)})}}))},EntityForm.prototype.onChangeSuggestingMode=function(){var e=this;this.setState((function(t){var n=!t.suggestIri,r=t.model;return{suggestIri:n,model:n?e.modifyModelsIriBySuggestion(r):r}}))},EntityForm.prototype.renderIri=function(){var e=this,t=this.state,n=t.model,r=t.suggestIri;return a.createElement("div",{className:"semantic-form-input-decorator semantic-form-input-decorator--with-header"},a.createElement("div",{style:{display:"flex"}},a.createElement("label",{style:{marginLeft:-12}},"IRI"),a.createElement("label",{style:{marginLeft:5,opacity:.8}},"(Suggest IRI",a.createElement("input",{type:"checkbox",checked:r,onClick:function(){return e.onChangeSuggestingMode()}}),")")),a.createElement("input",{className:"plain-text-field__text form-control",value:n.subject.value,onChange:function(t){return e.onChangeIri(t)}}))},EntityForm.prototype.render=function(){var e=this,t=this.mapChildren(this.props.children);return a.createElement("div",{className:d.dialog},a.createElement("div",{className:d.content},this.props.acceptIriAuthoring?this.renderIri():null,a.createElement(s.SemanticForm,{newSubjectTemplate:this.props.newSubjectTemplate,ref:function(t){return e.formRef=t},fields:this.props.fields,model:this.state.model,onLoaded:function(){},onChanged:function(t){return e.onModelUpdate(t)}},t)))},EntityForm}(o.Component);t.EntityForm=p},3315:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1579),i=n(43),o=n(19),s=n(23),l=n(1562),d=n(1218),u=n(1825),p=n(1751),c=n(1987),f=n(1637),m=n(1844),g=function(){function FieldBasedValidationApi(e,t){this.entityMetadata=e,this.enforceConstraints=t}return FieldBasedValidationApi.prototype.setDataProvider=function(e){this.dataProvider=e},FieldBasedValidationApi.prototype.shouldEnforceConstraints=function(){return this.enforceConstraints},FieldBasedValidationApi.prototype.validate=function(e){var t=e.target,n=e.state,a=m.getEntityMetadata(t,this.entityMetadata);if(void 0===a&&n.elements.has(t.id)){var i={type:"element",target:t.id,message:"Cannot find metadata for any of the entity types"};return Promise.resolve([i])}var s=o.combine({domainRangeErrors:this.checkDomainRangeCompatibility(e,a),relatedElementsErrors:this.checkRelatedElements(e,a)},(function(e){var t=e.domainRangeErrors,n=e.relatedElementsErrors;return r.__spreadArrays(t,n)})).flatMapErrors((function(e){var n={type:"element",target:t.id,message:"Unexpected error during the validation process: "+e.message};return o.constant([n])}));return p.observableToCancellablePromise(s,e.cancellation)},FieldBasedValidationApi.prototype.checkDomainRangeCompatibility=function(e,t){var n=e.target,r=e.outboundLinks,a=e.model,i=new c.BaseTypeClosureRequest;i.addAll(n.types);for(var o=0,s=r;o<s.length;o++){var l=s[o],d=findLinkSource(a,l);d&&i.addAll(d.data.types);var u=findLinkTarget(a,l);u&&i.addAll(u.data.types)}return i.query().map((function(e){for(var n=[],i=0,o=r;i<o.length;i++){var s=o[i],l=t.fieldByIri.get(s.linkTypeId);if(l){var d=findLinkSource(a,s),u=d?d.data.types:void 0;if(u&&!c.hasCompatibleType(l.domain,u,e)){var p=l.domain.map((function(e){return e.value})).join(", ");n.push({type:"link",target:s,message:"The source element should have one of the types '"+p+"'"})}var f=findLinkTarget(a,s),m=f?f.data.types:void 0;if(m&&!c.hasCompatibleType(l.range,m,e)){var g=l.range.map((function(e){return e.value})).join(", ");n.push({type:"link",target:s,message:"The target element should have one of the types '"+g+"'"})}}}return n}))},FieldBasedValidationApi.prototype.checkRelatedElements=function(e,t){var n=e.target,r=e.state;return this.dataProvider?(a.AuthoringState.isNewElement(r,n.id)?o.constant({type:l.CompositeValue.type,subject:s.Rdf.iri(n.id),definitions:t.fieldByIri,fields:i.Map(),errors:i.List()}):function fetchExistingEnitityState(e,t,n){return o.fromPromise(n.linkTypesOf({elementId:e})).flatMap((function(n){for(var r=new Set,a=0,i=n;a<i.length;a++){var o=i[a],l=o.id,d=o.outCount,u=t.fieldByIri.get(l);u&&d>0&&r.add(u)}var p=t.fieldByIri.filter((function(e){return r.has(e)})).toMap();return m.fetchInitialModel(s.Rdf.iri(e),t,p)})).toProperty()}(n.id,t,this.dataProvider)).flatMap((function(e){var a=m.applyEventsToCompositeValue({elementIri:n.id,state:r,metadata:t,initialModel:e});return l.FieldValue.isEmpty(a)?o.constant(a):function validateWholeComposite(e){var t=l.CompositeValue.set(e,{fields:e.fields.clear(),errors:e.errors.clear()}),n=[];return e.fields.forEach((function(r,a){var i=e.definitions.get(a);if(i){var o=u.tryBeginValidation(i,t,e);o&&n.push(o)}})),0===n.length?o.constant(e):o.zip(n).map((function(t){for(var n=e,r=0,a=t;r<a.length;r++){n=(0,a[r])(e)}return n})).toProperty()}(a)})).map((function(n){return function extractValidationErrorsFromComposite(e,t,n){var r=e.target,a=e.outboundLinks;if(l.FieldValue.isEmpty(t))return[];var i=[];d.collectErrors([],t,i);var o=[];i.forEach((function(e){var t=e.message,n=e.path;o.push({type:"element",target:r.id,message:t,propertyType:n.join("/")})}));for(var s=new Map,u=0,p=a;u<p.length;u++){var c=p[u];s.has(c.linkTypeId)||s.set(c.linkTypeId,[]),s.get(c.linkTypeId).push(c)}return t.fields.forEach((function(e,a){var i=t.definitions.get(a);l.checkCardinalityAndDuplicates(e.values,i).forEach((function(e){var t=e.message;if(f.isObjectProperty(i,n)){var a=s.get(i.iri);if(a)for(var l=0,d=a;l<d.length;l++){var u=d[l];o.push({type:"link",target:u,message:t})}}o.push({type:"element",target:r.id,message:t,propertyType:i.iri})}))})),o}(e,n,t)})).toProperty():o.constantError(new Error("Missing data provider to fetch entity state"))},FieldBasedValidationApi}();function findLinkSource(e,t){var n=e.links.find((function(e){return e.data===t}));return n?e.sourceOf(n):void 0}function findLinkTarget(e,t){var n=e.links.find((function(e){return e.data===t}));return n?e.targetOf(n):void 0}t.FieldBasedValidationApi=g},3316:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(19),i=n(23),o=n(1562),s=n(1951),l=n(1637),d=n(1844),u=function(){function FormBasedPersistence(e){this.props=e}return Object.defineProperty(FormBasedPersistence.prototype,"supportsIriEditing",{get:function(){return!1},enumerable:!0,configurable:!0}),FormBasedPersistence.prototype.persist=function(e){var t,n=this;switch(this.props.type){case"form":t=new o.LdpPersistence;break;case"sparql":t=new s.SparqlPersistence({targetGraphIri:this.props.targetGraphIri,targetInsertGraphIri:this.props.targetInsertGraphIri});break;default:throw new Error("Undefined data persistence type.")}var u=function collectEntitiesState(e){var t=e.state,n=new Set,r=new Set;return t.elements.forEach((function(e){if(e.deleted){var t=e.after;r.add(t.id),n.add(t.id)}else{var a=e.before;t=e.after;if(a){if(t.id!==a.id)throw new Error("Changing IRIs of existing entities is not supported via ldp");r.add(t.id),n.add(t.id)}else r.add(t.id)}})),t.links.forEach((function(e){if(e.deleted){var t=e.after;r.add(t.sourceId),n.add(t.sourceId),n.add(t.targetId)}else{var a=e.before;t=e.after;a&&(r.add(a.sourceId),n.add(a.sourceId),n.add(a.targetId)),r.add(t.sourceId),n.add(t.sourceId),n.add(t.targetId)}})),{toFetch:n,changed:r}}(e),p=u.toFetch,c=u.changed;return function fetchEntities(e,t){var n=e.fetchModel,r=e.entityMetadata,o=Array.from(t,(function(e){return n(e).flatMap((function(t){var n=d.getEntityMetadata(t,r);return n?d.fetchInitialModel(i.Rdf.iri(e),n).map((function(e){return{model:t,value:e}})):a.constant(void 0)}))}));if(0===o.length)return a.constant(new Map);return a.zip(o).map((function(e){var t=new Map;return e.forEach((function(e){e&&t.set(e.model.id,e)})),t})).toProperty()}(e,p).flatMap((function(i){var s=function diffAndFinalizeEntities(e,t,n,a){var i=t.state,s=t.entityMetadata,u=new Map,p=new Map;n.forEach((function(e){var t,n,r=a.get(e),l=function getNewElementModel(e,t){var n=e.elements.get(t);if(n){var r=n,a=r.before,i=r.after;if(!a)return i}return}(i,e);if(l){var c=d.getEntityMetadata(l,s),f=d.convertElementModelToCompositeValue(l,c);f=d.applyEventsToCompositeValue({elementIri:e,state:i,metadata:c,initialModel:f}),t={iri:h=l.id,metadata:c,value:o.FieldValue.empty},n={iri:h,metadata:c,value:f}}else{if(!r)throw new Error("Failed to load intial state for entity <"+e+">");var m=r.model,g=r.value,h=(c=d.getEntityMetadata(m,s),f=d.applyEventsToCompositeValue({elementIri:e,state:i,metadata:c,initialModel:g}),m.id),v=o.FieldValue.isEmpty(f)?m.id:f.subject.value;t={iri:h,metadata:c,value:g},n={iri:h,newIri:v!==h?v:void 0,metadata:c,value:f}}u.set(e,t),p.set(e,n)})),e.debug&&(u.size!==p.size&&console.error("Different diff lengths!"),u.forEach((function(e,t){var n=p.get(t);console.log("Diff for entity",t,o.computeValuePatch(e.value,n.value)),console.log(" where previous",o.computeValuePatch(o.FieldValue.empty,e.value)),console.log(" where current",o.computeValuePatch(o.FieldValue.empty,n.value))})));var c=new Map;return p.forEach((function(e,t){var n=e.value,a=e.metadata,i=null;o.FieldValue.isComposite(n)&&(i=function filterObjectProperties(e,t){var n={};for(var a in e.properties)if(Object.prototype.hasOwnProperty.call(e.properties,a)){var i=t.fieldByIri.get(a);i&&l.isObjectProperty(i,t)||(n[a]=e.properties[a])}return r.__assign(r.__assign({},e),{properties:n})}(d.convertCompositeValueToElementModel(n,a),a));c.set(t,i)})),{previousStates:u,currentStates:p,finalizedEntities:c}}(n.props,e,c,i),u=s.previousStates,p=s.currentStates,f=s.finalizedEntities,m=[];return u.forEach((function(e){var n=p.get(e.iri);m.push(t.persist(e.value,n.value))})),a.zip(m).map((function(){return{finalizedEntities:f}})).toProperty()})).toProperty()},FormBasedPersistence}();t.FormBasedPersistence=u}}]);
//# sourceMappingURL=ontodia-35e0c7d2712048481767.js.map