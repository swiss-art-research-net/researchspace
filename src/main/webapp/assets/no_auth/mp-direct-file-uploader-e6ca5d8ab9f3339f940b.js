(window.webpackJsonp=window.webpackJsonp||[]).push([[345],{1390:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var l=a(11),r=a(1),o=a(72),s=a(1559),i=a(34),n=a(56),p=a(640),c=a(1211),d=a(631),u=a(1654),g=a(116),f=a(1239),m=a(1219),h=["assets","templates","config","file"],v=function(e){function DirectFileUploader(t,a){var l=e.call(this,t,a)||this;l.cancellation=new i.Cancellation;var r=t.defaultObjectKind&&-1!==h.indexOf(t.defaultObjectKind)?t.defaultObjectKind:h[0];return l.state={alertState:void 0,progress:void 0,progressText:void 0,storageId:t.defaultStorageId,path:{folder:t.defaultFolder||"/",objectKind:r,name:void 0}},l}return l.__extends(DirectFileUploader,e),DirectFileUploader.prototype.componentDidMount=function(){this.loadStoragesList()},DirectFileUploader.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},DirectFileUploader.prototype.componentWillReceiveProps=function(e){if(this.state.storages){var t=this.state.storages.find((function(t){return t.appId===e.defaultStorageId}));t&&this.setState({storageId:t.appId})}},DirectFileUploader.prototype.getFileManager=function(){var e=this.context.semanticContext.repository;return new c.FileManager({repository:e})},DirectFileUploader.prototype.uploadFile=function(){var e=this,t=this.state.file;this.cancellation.map(this.getFileManager().uploadFileDirectlyToStorage({storage:this.state.storageId,folder:this.getFolder(),fileName:this.state.path.name,file:t,onProgress:function(t){e.setState({progress:t,progressText:"Uploading ..."})}})).observe({value:function(t){g.addNotification({message:"File succesfully uploaded.",level:"success"}),e.setState({alertState:{alert:d.AlertType.SUCCESS,message:'File "'+t+'" has been successfully uploaded to the storage "'+e.state.storageId+'".'},progress:null,path:l.__assign(l.__assign({},e.state.path),{name:""}),file:void 0})},error:function(a){g.addNotification({message:"Failed to upload file.",level:"error"}),e.setState({alertState:{alert:d.AlertType.WARNING,message:'Failed to upload file "'+t.name+'": '+a+" - "+a.response.text},progress:null,path:l.__assign(l.__assign({},e.state.path),{name:""}),file:void 0})}})},DirectFileUploader.prototype.onDropAccepted=function(e){var t=this.state.path,a=e[0];this.setState({alertState:null,progress:null,file:a,path:l.__assign(l.__assign({},t),{name:a.name})})},DirectFileUploader.prototype.onDropRejected=function(e){var t=e[0];this.setState({alertState:{alert:d.AlertType.WARNING,message:"Incompatible file type: expected "+this.props.acceptPattern+", got "+t.type},progress:null})},DirectFileUploader.prototype.loadStoragesList=function(){var e=this;this.cancellation.map(p.getStorageStatus()).observe({value:function(t){var a=e.props.defaultStorageId&&t.find((function(t){return t.appId===e.props.defaultStorageId}));e.setState({storages:t,storageId:a?a.appId:t[0].appId})},error:function(t){e.setState({alertState:{alert:d.AlertType.WARNING,message:"Failed to fetch storage list: "+t},progress:null})}})},DirectFileUploader.prototype.getFolder=function(){var e=this.state.path.objectKind,t=this.state.path.folder;return(t=t.split("/").filter((function(e){return Boolean(e)})).join("/"))?e+"/"+t:e},DirectFileUploader.prototype.render=function(){var e=this,t=this.state.alertState?r.createElement("div",{className:m.alertComponent},r.createElement(d.Alert,l.__assign({},this.state.alertState))):null,a=this.state,i=a.storages,n=a.path,p=a.file,c=!p,g=a.storageId+": "+this.getFolder()+"/"+(n.name||"undefined");return r.createElement("div",{className:m.DirectFileUploader},r.createElement("div",{className:m.row,style:{alignItems:"center"}},r.createElement("div",{className:m.FileUploader},this.state.progress?r.createElement(o.ProgressBar,{active:!0,min:0,max:100,now:this.state.progress,label:this.state.progressText}):null,r.createElement(u.Dropzone,{accept:this.props.acceptPattern,onDropAccepted:this.onDropAccepted.bind(this),onDropRejected:this.onDropRejected.bind(this),noClick:Boolean(this.state.progress||!i)},c?r.createElement("div",{className:m.mpDropZonePlaceHolder},this.props.children||r.createElement("div",{className:m.mpDropZonePlaceHolder},this.props.placeholder||"Select file to upload.")):r.createElement("div",{className:m.fileIcon},r.createElement("i",{className:f.getFileIcon(p.type),"aria-hidden":"true"})))),r.createElement("div",{className:m.rightInputBar},r.createElement("label",null,"Target Storage"),r.createElement(s.default,{className:m.storageInput,clearable:!1,value:this.state.storageId,options:i?i.map((function(e){return{value:e.appId,label:e.writable?e.appId:e.appId+" (readonly)",disabled:!e.writable}})):[],onChange:function(t){Array.isArray(t)||"string"!=typeof t.value||e.setState({storageId:t.value})}}),r.createElement("label",null,"Target Folder"),r.createElement("div",{className:m.storageInput,style:{display:"flex"}},r.createElement(s.default,{clearable:!1,style:{width:85},value:n.objectKind,options:h.map((function(e){return{value:e,label:e}})),onChange:function(t){if(!Array.isArray(t)&&"string"==typeof t.value){var a=l.__assign(l.__assign({},e.state.path),{objectKind:t.value});e.setState({path:a})}}}),r.createElement("input",{value:n.folder,style:{borderLeft:"none"},placeholder:"Sub folder",title:"Sub folder",onChange:function(t){var a=l.__assign(l.__assign({},e.state.path),{folder:t.target.value});e.setState({path:a})},className:"plain-text-field__text form-control "+m.storageInput})),r.createElement("label",null,"Target Filename"),r.createElement("input",{disabled:c,value:n.name,placeholder:c?"Please select first a file to upload...":"Input filename...",title:c?"Please select first a file to upload":"Filename",onChange:function(t){return e.setState({path:l.__assign(l.__assign({},n),{name:t.target.value})})},className:"plain-text-field__text form-control "+m.storageInput}))),r.createElement("div",{className:m.row,style:{flexDirection:"column",marginTop:"30px"}},r.createElement("label",null,"Target Path Preview"),r.createElement("div",{className:m.storageInput,style:{display:"flex"}},r.createElement("input",{disabled:!0,value:c?"":g,style:{marginRight:15},placeholder:"Please use the file selector to select a file to upload...",title:c?"Please use the file selector to select a file to upload":"Target path: "+g,className:"plain-text-field__text form-control "+m.storageInput}),r.createElement("button",{title:c?"Please use the file selector to select a file to upload":'Upload file to storage "'+this.state.storageId+'" and location "'+this.getFolder()+n.name+'"',className:"btn btn-primary",disabled:c||!n.name,onClick:function(){return e.uploadFile()}},"Upload"))),r.createElement("div",{className:m.row},t))},DirectFileUploader}(n.Component);t.DirectFileUploader=v,t.default=v}}]);
//# sourceMappingURL=mp-direct-file-uploader-e6ca5d8ab9f3339f940b.js.map