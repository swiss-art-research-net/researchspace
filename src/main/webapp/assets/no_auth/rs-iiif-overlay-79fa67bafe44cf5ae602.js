(window.webpackJsonp=window.webpackJsonp||[]).push([[317],{1297:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=r(1),o=r(35),n=r(19),s=r(43),l=r(7),d=r(23),p=r(63),c=r(117),u=r(2334),m=r(3318),g=r(1847),f=r(3319),v=r(3325);r(1298);var y=r(635)("overlay-comparison"),h=function(e){function OverlayComparison(t,r){var a=e.call(this,t,r)||this;return a.createOverlayImage=function(e){if(a.state.metadata&&!(a.state.metadata.size<2))return a.setState(a.updateState({creatingImage:!0})),f.default.createOverlayImage(e,a.state.metadata.get(0).iri,a.state.firstImageWeight,a.state.metadata.get(1).iri,1-a.state.firstImageWeight).flatMap((function(e){return a.setState(a.updateState({creatingImage:!1})),p.navigateToResource(e,{},"assets")})).toProperty()},a.state=a.updateState({firstImageWeight:.5}),a}return a.__extends(OverlayComparison,e),OverlayComparison.prototype.loadState=function(e){var t=e.selection.map((function(e){return"string"==typeof e?d.Rdf.iri(e):e})).map((function(t){return g.queryIIIFImageOrRegion(t,e.imageIdPattern,e.repositories)}));return n.zip(t).map((function(e){return{metadata:s.List(e)}}))},OverlayComparison.prototype.render=function(){var t=this,r=e.prototype.render.call(this);return o.div({className:y("").toString()},o.div({className:y("controls").toString()},o.span({className:y("image-label").toString()},"First image"),o.input({className:y("slider").toString(),readOnly:this.state.loading,type:"range",min:0,max:1,step:.01,value:this.state.firstImageWeight,onChange:function(e){var r=e.target,a=parseFloat(r.value),i=isNaN(a)?.5:Math.min(1,Math.max(0,a));t.setState(t.updateState({firstImageWeight:i}))}}),o.span({className:y("image-label").toString()},"Second image"),o.button({type:"button",className:l("btn","btn-default",y("submit").toString()),disabled:this.state.loading||this.state.creatingImage,onClick:function(){c.getOverlaySystem().show("create-overlay-image",i.createElement(u.CreateResourceDialog,{onSave:t.createOverlayImage,onHide:function(){return c.getOverlaySystem().hide("create-overlay-image")},show:!0,title:"Create overlay image",placeholder:"Enter image title"}))}},"Create overlayed image")),o.div({className:y("image-container").toString()},r||i.createElement(v.OpenSeadragonOverlay,{metadata:this.state.metadata,iiifServerUrl:this.props.iiifServerUrl,firstImageWeight:this.state.firstImageWeight})))},OverlayComparison.defaultProps={repositories:["default"]},OverlayComparison}(m.KefirComponentBase);t.OverlayComparison=h,t.c=h,t.f=i.createFactory(t.c),t.default=t.c},3318:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=r(1),o=r(19),n=r(139),s=r(56),l=r(116),d=r(639),p=function(e){function KefirComponentBase(t,r){var a=e.call(this,t,r)||this;return a.requests=o.pool(),a.requests.flatMapLatest((function(e){if(!e)return o.never();try{var t=a.loadState(e);return t||o.never()}catch(e){return console.error(e),o.constantError(e.message)}})).onValue((function(e){return a.setState((function(t){return n({},t,{loading:!1},e)}))})).onError((function(e){return a.setState((function(t){return n({},t,{loading:!1,error:e})}))})),a.state=a.updateState({loading:!0}),a}return a.__extends(KefirComponentBase,e),KefirComponentBase.prototype.updateState=function(e){return n({},this.state,e)},KefirComponentBase.prototype.componentDidMount=function(){this.requests.plug(o.constant(this.props))},KefirComponentBase.prototype.componentWillReceiveProps=function(e){this.requests.plug(o.constant(e))},KefirComponentBase.prototype.componentWillUnmount=function(){this.requests.plug(o.constant(void 0))},KefirComponentBase.prototype.render=function(){return this.state.loading?d.default({}):this.state.error?i.createElement(l.ErrorNotification,{errorMessage:this.state.error}):null},KefirComponentBase}(s.Component);t.KefirComponentBase=p},3319:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=r(23),o=r(118),n=r(1658),s=function(e){function LdpOverlayImageServiceClass(t){return e.call(this,t)||this}return a.__extends(LdpOverlayImageServiceClass,e),LdpOverlayImageServiceClass.prototype.createResourceGraph=function(e,t,r,a,o){var s=i.Rdf.iri(""),l=i.Rdf.iri("http://www.researchspace.org/event"),d=i.Rdf.iri("http://www.researchspace.org/param1"),p=i.Rdf.iri("http://www.researchspace.org/param2");return i.Rdf.graph([i.Rdf.triple(s,i.vocabularies.rdf.type,n.rso.Thing),i.Rdf.triple(s,i.vocabularies.rdf.type,n.rso.EX_Digital_Image),i.Rdf.triple(s,i.vocabularies.rdf.type,n.crmdig.D9_Data_Object),i.Rdf.triple(s,i.vocabularies.rdfs.label,i.Rdf.literal(e)),i.Rdf.triple(s,n.rso.displayLabel,i.Rdf.literal(e)),i.Rdf.triple(t,n.crmdig.L21_used_as_derivation_source,l),i.Rdf.triple(a,n.crmdig.L21_used_as_derivation_source,l),i.Rdf.triple(l,i.vocabularies.rdf.type,n.crmdig.D3_Formal_Derivation),i.Rdf.triple(l,n.crmdig.L22_created_derivative,s),i.Rdf.triple(l,n.crmdig.L13_used_parameters,d),i.Rdf.triple(d,i.vocabularies.rdf.type,n.crmdig.D1_Digital_Object),i.Rdf.triple(d,n.rso.OverlayImageSource,a),i.Rdf.triple(d,n.rso.OverlayOrder,i.Rdf.literal("1")),i.Rdf.triple(d,n.rso.OverlayOpacity,i.Rdf.literal(""+o)),i.Rdf.triple(l,n.crmdig.L13_used_parameters,p),i.Rdf.triple(p,i.vocabularies.rdf.type,n.crmdig.D1_Digital_Object),i.Rdf.triple(p,n.rso.OverlayImageSource,t),i.Rdf.triple(p,n.rso.OverlayOrder,i.Rdf.literal("2")),i.Rdf.triple(p,n.rso.OverlayOpacity,i.Rdf.literal(""+r))])},LdpOverlayImageServiceClass.prototype.createOverlayImage=function(e,t,r,a,i){var o=this.createResourceGraph(e,t,r,a,i);return this.addResource(o)},LdpOverlayImageServiceClass}(o.LdpService);t.LdpOverlayImageServiceClass=s,t.LdpOverlayImageService=new s(n.rso.OverlayImageContainer.value),t.default=t.LdpOverlayImageService},3325:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),i=r(1),o=r(35),n=r(3326),s=r(1846);r(1298);var l=r(635)("open-seadragon-overlay"),d=function(e){function OpenSeadragonOverlay(t){var r=e.call(this,t)||this;return r.onFirstImageLoaded=function(e){r.osd.images.push(e.tiledImage);var t=subsequentImagesOpacity(r.props.firstImageWeight,r.props.metadata.size);r.props.metadata.skip(1).forEach((function(e){var a=r.getImageInformationRequestUri(e);r.osd.viewer.addTiledImage({tileSource:a,opacity:t,success:r.onSubsequentImageLoaded})}))},r.onSubsequentImageLoaded=function(e){r.osd.images.push(e.item)},r}return a.__extends(OpenSeadragonOverlay,e),OpenSeadragonOverlay.prototype.shouldComponentUpdate=function(e,t){return this.osd&&e.firstImageWeight!==this.props.firstImageWeight&&this.setOpacity(e.firstImageWeight),!1},OpenSeadragonOverlay.prototype.setOpacity=function(e){for(var t=subsequentImagesOpacity(e,this.osd.images.length),r=1;r<this.osd.images.length;r++)this.osd.images[r].setOpacity(t);this.osd.viewer.forceRedraw()},OpenSeadragonOverlay.prototype.getImageInformationRequestUri=function(e){var t=s.getIIIFServerUrl(this.props.iiifServerUrl);return s.constructInformationRequestUri(t,e.imageId)},OpenSeadragonOverlay.prototype.render=function(){var e=this;return o.div({className:l("").toString(),style:{},ref:function(t){try{e.renderOpenSeadragon(t)}catch(e){console.log(e)}}})},OpenSeadragonOverlay.prototype.renderOpenSeadragon=function(e){if(e&&this.props.metadata&&this.props.iiifServerUrl){var t=n({id:"osd",element:e,alwaysBlend:!0,showNavigationControl:!1,opacity:1,minZoomImageRatio:.6,maxZoomPixelRatio:4,tileSources:[this.getImageInformationRequestUri(this.props.metadata.first())]});t.addOnceHandler("tile-loaded",this.onFirstImageLoaded),this.osd={viewer:t,images:[]}}else this.osd&&(this.osd.viewer.destroy(),this.osd=void 0)},OpenSeadragonOverlay}(i.Component);function subsequentImagesOpacity(e,t){return(1-e)/Math.max(1,t-1)}t.OpenSeadragonOverlay=d}}]);
//# sourceMappingURL=rs-iiif-overlay-79fa67bafe44cf5ae602.js.map