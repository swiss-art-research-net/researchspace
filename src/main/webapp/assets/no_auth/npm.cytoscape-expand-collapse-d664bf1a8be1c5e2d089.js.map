{"version":3,"sources":["webpack:///./node_modules/cytoscape-expand-collapse/src/elementUtilities.js","webpack:///./node_modules/cytoscape-expand-collapse/src/index.js","webpack:///./node_modules/cytoscape-expand-collapse/src/undoRedoUtilities.js","webpack:///./node_modules/cytoscape-expand-collapse/src/cueUtilities.js","webpack:///./node_modules/cytoscape-expand-collapse/src/debounce.js","webpack:///./node_modules/cytoscape-expand-collapse/src/expandCollapseUtilities.js","webpack:///./node_modules/cytoscape-expand-collapse/src/boundingBoxUtilities.js"],"names":["module","exports","elementUtilities","cy","moveNodes","positionDiff","nodes","notCalcTopMostNodes","topMostNodes","this","getTopMostNodes","i","length","node","oldX","position","oldY","x","y","children","nodesMap","id","filter","ele","parent","rearrange","layoutBy","layout","run","convertToRenderedPosition","modelPosition","pan","zoom","register","cytoscape","$","undoRedoUtilities","cueUtilities","opts","options","getScratch","fisheye","animate","ready","undoable","cueEnabled","expandCollapseCuePosition","expandCollapseCueSize","expandCollapseCueLineSize","expandCueImage","undefined","collapseCueImage","expandCollapseCueSensitivity","extendOptions","api","createExtensionAPI","setScratch","extendBy","tempOpts","key","hasOwnProperty","evalOptions","call","expandCollapseUtilities","name","value","_eles","eles","collapsibleNodes","tempOptions","collapseGivenNodes","collapse","union","descendants","expandableNodes","expandGivenNodes","expandAllNodes","collapseRecursively","expandRecursively","hasClass","isExpandable","isParent","_nodes","self","isCollapsible","data","collapsedChildren","collection","getCollapsedChildrenRecursively","j","collapsedNodes","trigger","cyOrEle","scratch","val","jQuery","undoRedo","ur","secondTimeOpts","actions","action","doIt","getNodePositions","positions","func","args","result","getEles","firstTime","oldData","indexOf","returnToPositions","currentPositions","pos","debounce","params","eMouseOver","eMouseOut","ePosition","eRemove","eTap","eZoom","eAdd","eFree","nodeWithRenderedCue","fn","preventDrawing","functions","init","$container","$canvas","append","_sizeCanvas","attr","height","width","css","setTimeout","canvasBb","offset","containerBb","top","left","clearDraws","sizeCanvas","window","bind","optCache","ctx","getContext","w","h","clearRect","drawExpandCollapseCue","_private","diff","expandcollapseStartX","expandcollapseStartY","expandcollapseRectSize","expandcollapseCenterX","expandcollapseCenterY","cueCenter","isCollapsed","rectSize","lineSize","size","parseFloat","option","expandcollapseCenter","Math","max","img","Image","src","drawImage","oldFillStyle","fillStyle","oldWidth","lineWidth","oldStrokeStyle","strokeStyle","ellipse","PI","fill","beginPath","moveTo","lineTo","closePath","stroke","expandcollapseRenderedStartX","expandcollapseRenderedStartY","expandcollapseRenderedCueSize","on","e","currMousePos","cyPosition","topLeft","bottomRight","isInsideCompound","oldMousePos","renderedPosition","cyRenderedPosition","unselect","Tap","event","expandcollapseRenderedRectSize","expandcollapseRenderedEndX","expandcollapseRenderedEndY","cyRenderedPos","cyRenderedPosX","cyRenderedPosY","factor","abs","defaultActions","do","expand","unbind","off","apply","container","Array","prototype","slice","arguments","error","nativeMax","now","Date","getTime","wait","maxTimeoutId","stamp","thisArg","timeoutId","trailingCall","lastCalled","maxWait","trailing","TypeError","leading","isObject","type","complete","isCalled","clearTimeout","delayed","remaining","maxDelayed","debounced","leadingCall","cancel","boundingBoxUtilities","animatedlyMovingNodeCount","expandNodeBaseFunction","single","removeData","removeClass","restore","repairEdges","endOperation","simpleCollapseGivenNodes","roots","root","collapseBottomUp","simpleExpandGivenNodes","applyFishEyeViewToEachNode","expandTopDown","simpleExpandAllNodes","orphans","expandStack","expandAllTopDown","expandedStack","push","expandNode","startBatch","endBatch","style","update","collapseNode","convertToModelPosition","applyFishEyeView","commonExpandOperation","fishEyeViewExpandGivenNode","storeWidthHeight","animating","topLeftPosition","bottomRightPosition","bb","x1","x2","y1","y2","nodeBB","unionBB","getUnion","equalBoundingBoxes","viewPort","getFitViewport","duration","outerWidth","outerHeight","connectedEdges","barrowEdgesOfcollapsedChildren","removeChildren","addClass","xPositionInParent","yPositionInParent","nodeToExpand","siblings","getSiblings","x_a","y_a","d_x_left","d_x_right","d_y_upper","d_y_lower","abs_diff_on_x","abs_diff_on_y","xPosInParentSibling","yPosInParentSibling","sibling","x_b","y_b","slope","d_x","d_y","T_x","T_y","isFinite","min","fishEyeViewMoveNode","difference","childrenList","newPosition","relativePosition","child","removedChild","remove","isMetaEdge","edge","relatedNodes","edges","edgesWith","not","relatedNodeMap","each","source","target","originalEndsData","move","findNewEnd","current","inside","connectedMetaEdges","originalEnds","currentSrcId","isOuterNode","temp","bb1","bb2"],"mappings":"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","file":"npm.cytoscape-expand-collapse-d664bf1a8be1c5e2d089.js","sourcesContent":["function elementUtilities(cy) {\n return {\n  moveNodes: function (positionDiff, nodes, notCalcTopMostNodes) {\n    var topMostNodes = notCalcTopMostNodes ? nodes : this.getTopMostNodes(nodes);\n    for (var i = 0; i < topMostNodes.length; i++) {\n      var node = topMostNodes[i];\n      var oldX = node.position(\"x\");\n      var oldY = node.position(\"y\");\n      node.position({\n        x: oldX + positionDiff.x,\n        y: oldY + positionDiff.y\n      });\n      var children = node.children();\n      this.moveNodes(positionDiff, children, true);\n    }\n  },\n  getTopMostNodes: function (nodes) {//*//\n    var nodesMap = {};\n    for (var i = 0; i < nodes.length; i++) {\n      nodesMap[nodes[i].id()] = true;\n    }\n    var roots = nodes.filter(function (ele, i) {\n      if(typeof ele === \"number\") {\n        ele = i;\n      }\n      \n      var parent = ele.parent()[0];\n      while (parent != null) {\n        if (nodesMap[parent.id()]) {\n          return false;\n        }\n        parent = parent.parent()[0];\n      }\n      return true;\n    });\n\n    return roots;\n  },\n  rearrange: function (layoutBy) {\n    if (typeof layoutBy === \"function\") {\n      layoutBy();\n    } else if (layoutBy != null) {\n      var layout = cy.layout(layoutBy);\n      if (layout && layout.run) {\n        layout.run();\n      }\n    }\n  },\n  convertToRenderedPosition: function (modelPosition) {\n    var pan = cy.pan();\n    var zoom = cy.zoom();\n\n    var x = modelPosition.x * zoom + pan.x;\n    var y = modelPosition.y * zoom + pan.y;\n\n    return {\n      x: x,\n      y: y\n    };\n  }\n };\n}\n\nmodule.exports = elementUtilities;\n",";\n(function () {\n  'use strict';\n\n  // registers the extension on a cytoscape lib ref\n  var register = function (cytoscape, $) {\n\n    if (!cytoscape) {\n      return;\n    } // can't register if cytoscape unspecified\n\n    var undoRedoUtilities = require('./undoRedoUtilities');\n    var cueUtilities = require(\"./cueUtilities\");\n\n    function extendOptions(options, extendBy) {\n      var tempOpts = {};\n      for (var key in options)\n        tempOpts[key] = options[key];\n\n      for (var key in extendBy)\n        if (tempOpts.hasOwnProperty(key))\n          tempOpts[key] = extendBy[key];\n      return tempOpts;\n    }\n    \n    // evaluate some specific options in case of they are specified as functions to be dynamically changed\n    function evalOptions(options) {\n      var animate = typeof options.animate === 'function' ? options.animate.call() : options.animate;\n      var fisheye = typeof options.fisheye === 'function' ? options.fisheye.call() : options.fisheye;\n      \n      options.animate = animate;\n      options.fisheye = fisheye;\n    }\n    \n    // creates and returns the API instance for the extension\n    function createExtensionAPI(cy, expandCollapseUtilities) {\n      var api = {}; // API to be returned\n      // set functions\n    \n      // set all options at once\n      api.setOptions = function(opts) {\n        setScratch(cy, 'options', options);\n      };\n\n      // set the option whose name is given\n      api.setOption = function (name, value) {\n        getScratch(cy, 'options')[name] = value;\n      };\n\n      // Collection functions\n\n      // collapse given eles extend options with given param\n      api.collapse = function (_eles, opts) {\n        var eles = this.collapsibleNodes(_eles);\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return expandCollapseUtilities.collapseGivenNodes(eles, tempOptions);\n      };\n\n      // collapse given eles recursively extend options with given param\n      api.collapseRecursively = function (_eles, opts) {\n        var eles = this.collapsibleNodes(_eles);\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return this.collapse(eles.union(eles.descendants()), tempOptions);\n      };\n\n      // expand given eles extend options with given param\n      api.expand = function (_eles, opts) {\n        var eles = this.expandableNodes(_eles);\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return expandCollapseUtilities.expandGivenNodes(eles, tempOptions);\n      };\n\n      // expand given eles recusively extend options with given param\n      api.expandRecursively = function (_eles, opts) {\n        var eles = this.expandableNodes(_eles);\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return expandCollapseUtilities.expandAllNodes(eles, tempOptions);\n      };\n\n\n      // Core functions\n\n      // collapse all collapsible nodes\n      api.collapseAll = function (opts) {\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return this.collapseRecursively(this.collapsibleNodes(), tempOptions);\n      };\n\n      // expand all expandable nodes\n      api.expandAll = function (opts) {\n        var options = getScratch(cy, 'options');\n        var tempOptions = extendOptions(options, opts);\n        evalOptions(tempOptions);\n\n        return this.expandRecursively(this.expandableNodes(), tempOptions);\n      };\n\n\n      // Utility functions\n\n      // returns if the given node is expandable\n      api.isExpandable = function (node) {\n        return node.hasClass('cy-expand-collapse-collapsed-node');\n      };\n\n      // returns if the given node is collapsible\n      api.isCollapsible = function (node) {\n        return !this.isExpandable(node) && node.isParent();\n      };\n\n      // get collapsible ones inside given nodes if nodes parameter is not specified consider all nodes\n      api.collapsibleNodes = function (_nodes) {\n        var self = this;\n        var nodes = _nodes ? _nodes : cy.nodes();\n        return nodes.filter(function (ele, i) {\n          if(typeof ele === \"number\") {\n            ele = i;\n          }\n          return self.isCollapsible(ele);\n        });\n      };\n\n      // get expandable ones inside given nodes if nodes parameter is not specified consider all nodes\n      api.expandableNodes = function (_nodes) {\n        var self = this;\n        var nodes = _nodes ? _nodes : cy.nodes();\n        return nodes.filter(function (ele, i) {\n          if(typeof ele === \"number\") {\n            ele = i;\n          }\n          return self.isExpandable(ele);\n        });\n      };\n      \n      // Get the children of the given collapsed node which are removed during collapse operation\n      api.getCollapsedChildren = function (node) {\n        return node.data('collapsedChildren');\n      };\n\n      /** Get collapsed children recursively including nested collapsed children\n       * Returned value includes edges and nodes, use selector to get edges or nodes\n       * @param node : a collapsed node\n       * @return all collapsed children\n       */\n      api.getCollapsedChildrenRecursively = function(node) {\n        var collapsedChildren = cy.collection();\n        return expandCollapseUtilities.getCollapsedChildrenRecursively(node, collapsedChildren);\n      };\n\n      /** Get collapsed children of all collapsed nodes recursively including nested collapsed children\n       * Returned value includes edges and nodes, use selector to get edges or nodes\n       * @return all collapsed children\n       */\n      api.getAllCollapsedChildrenRecursively = function(){\n        var collapsedChildren = cy.collection();\n        var collapsedNodes = cy.nodes(\".cy-expand-collapse-collapsed-node\");\n        var j;\n        for (j=0; j < collapsedNodes.length; j++){\n            collapsedChildren = collapsedChildren.union(this.getCollapsedChildrenRecursively(collapsedNodes[j]));\n        }\n        return collapsedChildren;\n      };\n      // This method forces the visual cue to be cleared. It is to be called in extreme cases \n      api.clearVisualCue = function(node) {\n        cy.trigger('expandcollapse.clearvisualcue');\n      };\n      \n      // This method works problematic TODO fix related bugs and expose it\n      // Unbinds cue events\n//      api.disableCue = function() {\n//        if (options.cueEnabled) {\n//          cueUtilities('unbind', cy);\n//          options.cueEnabled = false;\n//        }\n//      }\n      \n      return api; // Return the API instance\n    }\n\n    // Get the whole scratchpad reserved for this extension (on an element or core) or get a single property of it\n    function getScratch (cyOrEle, name) {\n      if (cyOrEle.scratch('_cyExpandCollapse') === undefined) {\n        cyOrEle.scratch('_cyExpandCollapse', {});\n      }\n\n      var scratch = cyOrEle.scratch('_cyExpandCollapse');\n      var retVal = ( name === undefined ) ? scratch : scratch[name];\n      return retVal;\n    }\n\n    // Set a single property on scratchpad of an element or the core\n    function setScratch (cyOrEle, name, val) {\n      getScratch(cyOrEle)[name] = val;\n    }\n\n    // register the extension cy.expandCollapse()\n    cytoscape(\"core\", \"expandCollapse\", function (opts) {\n      var cy = this;\n\n      var options = getScratch(cy, 'options') || {\n        layoutBy: null, // for rearrange after expand/collapse. It's just layout options or whole layout function. Choose your side!\n        fisheye: true, // whether to perform fisheye view after expand/collapse you can specify a function too\n        animate: true, // whether to animate on drawing changes you can specify a function too\n        ready: function () { }, // callback when expand/collapse initialized\n        undoable: true, // and if undoRedoExtension exists,\n\n        cueEnabled: true, // Whether cues are enabled\n        expandCollapseCuePosition: 'top-left', // default cue position is top left you can specify a function per node too\n        expandCollapseCueSize: 12, // size of expand-collapse cue\n        expandCollapseCueLineSize: 8, // size of lines used for drawing plus-minus icons\n        expandCueImage: undefined, // image of expand icon if undefined draw regular expand cue\n        collapseCueImage: undefined, // image of collapse icon if undefined draw regular collapse cue\n        expandCollapseCueSensitivity: 1 // sensitivity of expand-collapse cues\n      };\n\n      // If opts is not 'get' that is it is a real options object then initilize the extension\n      if (opts !== 'get') {\n        options = extendOptions(options, opts);\n\n        var expandCollapseUtilities = require('./expandCollapseUtilities')(cy);\n        var api = createExtensionAPI(cy, expandCollapseUtilities); // creates and returns the API instance for the extension\n\n        setScratch(cy, 'api', api);\n\n        undoRedoUtilities(cy, api);\n\n        if(options.cueEnabled)\n          cueUtilities(options, cy, api, $);\n\n\n        options.ready();\n\n        setScratch(cy, 'options', options);\n      }\n\n      return getScratch(cy, 'api'); // Expose the API to the users\n    });\n  };\n  \n\n  if (typeof module !== 'undefined' && module.exports) { // expose as a commonjs module\n    module.exports = register;\n  }\n\n  if (typeof define !== 'undefined' && define.amd) { // expose as an amd/requirejs module\n    define('cytoscape-expand-collapse', function () {\n      return register;\n    });\n  }\n\n    if (typeof cytoscape !== 'undefined' && typeof jQuery !== 'undefined') { // expose to global cytoscape (i.e. window.cytoscape)\n      register(cytoscape, jQuery);\n  }\n\n})();\n","module.exports = function (cy, api) {\n  if (cy.undoRedo == null)\n    return;\n\n  var ur = cy.undoRedo({}, true);\n\n  function getEles(_eles) {\n    return (typeof _eles === \"string\") ? cy.$(_eles) : _eles;\n  }\n\n  function getNodePositions() {\n    var positions = {};\n    var nodes = cy.nodes();\n\n    for (var i = 0; i < nodes.length; i++) {\n      var ele = nodes[i];\n      positions[ele.id()] = {\n        x: ele.position(\"x\"),\n        y: ele.position(\"y\")\n      };\n    }\n\n    return positions;\n  }\n\n  function returnToPositions(positions) {\n    var currentPositions = {};\n    cy.nodes().positions(function (ele, i) {\n      if(typeof ele === \"number\") {\n        ele = i;\n      }\n      currentPositions[ele.id()] = {\n        x: ele.position(\"x\"),\n        y: ele.position(\"y\")\n      };\n      var pos = positions[ele.id()];\n      return {\n        x: pos.x,\n        y: pos.y\n      };\n    });\n\n    return currentPositions;\n  }\n\n  var secondTimeOpts = {\n    layoutBy: null,\n    animate: false,\n    fisheye: false\n  };\n\n  function doIt(func) {\n    return function (args) {\n      var result = {};\n      var nodes = getEles(args.nodes);\n      if (args.firstTime) {\n        result.oldData = getNodePositions();\n        result.nodes = func.indexOf(\"All\") > 0 ? api[func](args.options) : api[func](nodes, args.options);\n      } else {\n        result.oldData = getNodePositions();\n        result.nodes = func.indexOf(\"All\") > 0 ? api[func](secondTimeOpts) : api[func](cy.collection(nodes), secondTimeOpts);\n        returnToPositions(args.oldData);\n      }\n\n      return result;\n    };\n  }\n\n  var actions = [\"collapse\", \"collapseRecursively\", \"collapseAll\", \"expand\", \"expandRecursively\", \"expandAll\"];\n\n  for (var i = 0; i < actions.length; i++) {\n    ur.action(actions[i], doIt(actions[i]), doIt(actions[(i + 3) % 6]));\n  }\n\n};\n","var debounce = require('./debounce');\n\nmodule.exports = function (params, cy, api, $) {\n  var elementUtilities;\n  var fn = params;\n\n  var eMouseOver, eMouseOut, ePosition, eRemove, eTap, eZoom, eAdd, eFree;\n  var nodeWithRenderedCue, preventDrawing = false;\n  \n  var functions = {\n    init: function () {\n      var self = this;\n      var opts = params;\n      var $container = this;\n      var $canvas = $('<canvas></canvas>');\n      elementUtilities = require('./elementUtilities')(cy);\n\n      $container.append($canvas);\n\n      var _sizeCanvas = debounce(function () {\n        $canvas\n          .attr('height', $container.height())\n          .attr('width', $container.width())\n          .css({\n            'position': 'absolute',\n            'top': 0,\n            'left': 0,\n            'z-index': '999'\n          })\n        ;\n\n        setTimeout(function () {\n          var canvasBb = $canvas.offset();\n          var containerBb = $container.offset();\n\n          $canvas\n            .css({\n              'top': -(canvasBb.top - containerBb.top),\n              'left': -(canvasBb.left - containerBb.left)\n            })\n          ;\n\n          // refresh the cues on canvas resize\n          if(cy){\n            clearDraws(true);\n          }\n        }, 0);\n\n      }, 250);\n\n      function sizeCanvas() {\n        _sizeCanvas();\n      }\n\n      sizeCanvas();\n\n      $(window).bind('resize', function () {\n        sizeCanvas();\n      });\n\n      var ctx = $canvas[0].getContext('2d');\n\n      // write options to data\n      var data = $container.data('cyexpandcollapse');\n      if (data == null) {\n        data = {};\n      }\n      data.options = opts;\n\n      var optCache;\n\n      function options() {\n        return optCache || (optCache = $container.data('cyexpandcollapse').options);\n      }\n\n      function clearDraws() {\n        var w = $container.width();\n        var h = $container.height();\n\n        ctx.clearRect(0, 0, w, h);\n      }\n\n      function drawExpandCollapseCue(node) {\n        var children = node.children();\n        var collapsedChildren = node._private.data.collapsedChildren;\n        var hasChildren = children != null && children.length > 0;\n        // If this is a simple node with no collapsed children return directly\n        if (!hasChildren && collapsedChildren == null) {\n          return;\n        }\n\n        var isCollapsed = node.hasClass('cy-expand-collapse-collapsed-node');\n\n        //Draw expand-collapse rectangles\n        var rectSize = options().expandCollapseCueSize;\n        var lineSize = options().expandCollapseCueLineSize;\n        var diff;\n\n        var expandcollapseStartX;\n        var expandcollapseStartY;\n        var expandcollapseEndX;\n        var expandcollapseEndY;\n        var expandcollapseRectSize;\n\n        var expandcollapseCenterX;\n        var expandcollapseCenterY;\n        var cueCenter;\n\n        if (options().expandCollapseCuePosition === 'top-left') {\n          var offset = 1;\n          var size = cy.zoom() < 1 ? rectSize / (2*cy.zoom()) : rectSize / 2;\n\n          var x = node.position('x') - node.width() / 2 - parseFloat(node.css('padding-left')) \n                  + parseFloat(node.css('border-width')) + size + offset;\n          var y = node.position('y') - node.height() / 2 - parseFloat(node.css('padding-top')) \n                  + parseFloat(node.css('border-width')) + size + offset;\n\n          cueCenter = {\n            x : x,\n            y : y\n          };\n        } else {\n          var option = options().expandCollapseCuePosition;\n          cueCenter = typeof option === 'function' ? option.call(this, node) : option;\n        }\n        \n        var expandcollapseCenter = elementUtilities.convertToRenderedPosition(cueCenter);\n\n        // convert to rendered sizes\n        rectSize = Math.max(rectSize, rectSize * cy.zoom());\n        lineSize = Math.max(lineSize, lineSize * cy.zoom());\n        diff = (rectSize - lineSize) / 2;\n\n        expandcollapseCenterX = expandcollapseCenter.x;\n        expandcollapseCenterY = expandcollapseCenter.y;\n\n        expandcollapseStartX = expandcollapseCenterX - rectSize / 2;\n        expandcollapseStartY = expandcollapseCenterY - rectSize / 2;\n        expandcollapseEndX = expandcollapseStartX + rectSize;\n        expandcollapseEndY = expandcollapseStartY + rectSize;\n        expandcollapseRectSize = rectSize;\n\n        // Draw expand/collapse cue if specified use an image else render it in the default way\n        if (!isCollapsed && options().expandCueImage) {\n          var img=new Image();\n          img.src = options().expandCueImage;\n          ctx.drawImage(img, expandcollapseCenterX, expandcollapseCenterY, rectSize, rectSize);\n        }\n        else if (isCollapsed && options().collapseCueImage) {\n          var img=new Image();\n          img.src = options().collapseCueImage;\n          ctx.drawImage(img, expandcollapseCenterX, expandcollapseCenterY, rectSize, rectSize);\n        }\n        else {\n          var oldFillStyle = ctx.fillStyle;\n          var oldWidth = ctx.lineWidth;\n          var oldStrokeStyle = ctx.strokeStyle;\n\n          ctx.fillStyle = \"black\";\n          ctx.strokeStyle = \"black\";\n\n          ctx.ellipse(expandcollapseCenterX, expandcollapseCenterY, rectSize / 2, rectSize / 2, 0, 0, 2 * Math.PI);\n          ctx.fill();\n\n          ctx.beginPath();\n\n          ctx.strokeStyle = \"white\";\n          ctx.lineWidth = Math.max(2.6, 2.6 * cy.zoom());\n\n          ctx.moveTo(expandcollapseStartX + diff, expandcollapseStartY + rectSize / 2);\n          ctx.lineTo(expandcollapseStartX + lineSize + diff, expandcollapseStartY + rectSize / 2);\n\n          if (isCollapsed) {\n            ctx.moveTo(expandcollapseStartX + rectSize / 2, expandcollapseStartY + diff);\n            ctx.lineTo(expandcollapseStartX + rectSize / 2, expandcollapseStartY + lineSize + diff);\n          }\n\n          ctx.closePath();\n          ctx.stroke();\n\n          ctx.strokeStyle = oldStrokeStyle;\n          ctx.fillStyle = oldFillStyle;\n          ctx.lineWidth = oldWidth;\n        }\n\n        node._private.data.expandcollapseRenderedStartX = expandcollapseStartX;\n        node._private.data.expandcollapseRenderedStartY = expandcollapseStartY;\n        node._private.data.expandcollapseRenderedCueSize = expandcollapseRectSize;\n        \n        nodeWithRenderedCue = node;\n      }\n\n      {\n        cy.on('expandcollapse.clearvisualcue', function() {\n\n          if ( nodeWithRenderedCue ) {\n            clearDraws();\n          }\n        });\n        \n        cy.bind('zoom pan', eZoom = function () {\n          if ( nodeWithRenderedCue ) {\n            clearDraws();\n          }\n        });\n\n\t\t// check if mouse is inside given node\n\t\tvar isInsideCompound = function(node, e){\n\t\t\tif (node){\n\t\t\t\tvar currMousePos = e.position || e.cyPosition;\n\t\t\t\tvar topLeft = {\n\t\t\t\t\tx: (node.position(\"x\") - node.width() / 2 - parseFloat(node.css('padding-left'))),\n\t\t\t\t\ty: (node.position(\"y\") - node.height() / 2 - parseFloat(node.css('padding-top')))};\n\t\t\t\tvar bottomRight = {\n\t\t\t\t\tx: (node.position(\"x\") + node.width() / 2 + parseFloat(node.css('padding-right'))),\n\t\t\t\t\ty: (node.position(\"y\") + node.height() / 2+ parseFloat(node.css('padding-bottom')))};\n\n\t\t\t\tif (currMousePos.x >= topLeft.x && currMousePos.y >= topLeft.y &&\n\t\t\t\t\tcurrMousePos.x <= bottomRight.x && currMousePos.y <= bottomRight.y){\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\tcy.on('mousemove', function(e){\n\t\t\tif(!isInsideCompound(nodeWithRenderedCue, e)){\n\t\t\t\tclearDraws()\n\t\t\t}\n\t\t\telse if(nodeWithRenderedCue && !preventDrawing){\n\t\t\t\tdrawExpandCollapseCue(nodeWithRenderedCue);\n\t\t\t}\n\t\t});\n\n\t\tcy.on('mouseover', 'node', eMouseOver = function (e) {\n\t\t\tvar node = this;\n\t\t\t// clear draws if any\n\t\t\tif (api.isCollapsible(node) || api.isExpandable(node)){\n\t\t\t\tif ( nodeWithRenderedCue && nodeWithRenderedCue.id() != node.id() ) {\n\t\t\t\t\tclearDraws();\n\t\t\t\t}\n\t\t\t\tdrawExpandCollapseCue(node);\n\t\t\t}\n\t\t});\n\n\t\tvar oldMousePos = null, currMousePos = null;\n\t\tcy.on('mousedown', function(e){\n\t\t\toldMousePos = e.renderedPosition || e.cyRenderedPosition\n\t\t});\n\t\tcy.on('mouseup', function(e){\n\t\t\tcurrMousePos = e.renderedPosition || e.cyRenderedPosition\n\t\t});\n\n\t\tcy.on('grab', 'node', eMouseOut = function (e) {\n\t\t\tpreventDrawing = true;\n\t\t});\n\n\t\tcy.on('free', 'node', eMouseOut = function (e) {\n\t\t\tpreventDrawing = false;\n\t\t});\n\n\t\tcy.on('position', 'node', ePosition = function () {\n\t\t\tif (nodeWithRenderedCue)\n\t\t\t\tclearDraws();\n\t\t});\n\n\t\tcy.on('remove', 'node', eRemove = function () {\n\t\t\tclearDraws();\n\t\t\tnodeWithRenderedCue = null;\n\t\t});\n\n\t\tvar ur;\n\t\tcy.on('select', 'node', function(){\n\t\t\tif (this.length > cy.nodes(\":selected\").length)\n\t\t\t\tthis.unselect();\n\t\t});\n\n\t\tcy.on('tap', Tap = function (event) {\n\t\t\tvar node = nodeWithRenderedCue;\n\t\t\tif (node){\n\t\t\t\tvar expandcollapseRenderedStartX = node._private.data.expandcollapseRenderedStartX;\n\t\t\t\tvar expandcollapseRenderedStartY = node._private.data.expandcollapseRenderedStartY;\n\t\t\t\tvar expandcollapseRenderedRectSize = node._private.data.expandcollapseRenderedCueSize;\n\t\t\t\tvar expandcollapseRenderedEndX = expandcollapseRenderedStartX + expandcollapseRenderedRectSize;\n\t\t\t\tvar expandcollapseRenderedEndY = expandcollapseRenderedStartY + expandcollapseRenderedRectSize;\n                \n                var cyRenderedPos = event.renderedPosition || event.cyRenderedPosition;\n\t\t\t\tvar cyRenderedPosX = cyRenderedPos.x;\n\t\t\t\tvar cyRenderedPosY = cyRenderedPos.y;\n\t\t\t\tvar factor = (options().expandCollapseCueSensitivity - 1) / 2;\n\n\t\t\t\tif ( (Math.abs(oldMousePos.x - currMousePos.x) < 5 && Math.abs(oldMousePos.y - currMousePos.y) < 5)\n\t\t\t\t\t&& cyRenderedPosX >= expandcollapseRenderedStartX - expandcollapseRenderedRectSize * factor\n\t\t\t\t\t&& cyRenderedPosX <= expandcollapseRenderedEndX + expandcollapseRenderedRectSize * factor\n\t\t\t\t\t&& cyRenderedPosY >= expandcollapseRenderedStartY - expandcollapseRenderedRectSize * factor\n\t\t\t\t\t&& cyRenderedPosY <= expandcollapseRenderedEndY + expandcollapseRenderedRectSize * factor) {\n\t\t\t\t\tif(opts.undoable && !ur)\n\t\t\t\t\t\tur = cy.undoRedo({\n\t\t\t\t\t\t\tdefaultActions: false\n\t\t\t\t\t\t});\n\t\t\t\t\tif(api.isCollapsible(node))\n\t\t\t\t\t\tif (opts.undoable){\n\t\t\t\t\t\t\tur.do(\"collapse\", {\n\t\t\t\t\t\t\t\tnodes: node,\n\t\t\t\t\t\t\t\toptions: opts\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tapi.collapse(node, opts);\n\t\t\t\telse if(api.isExpandable(node))\n\t\t\t\t\tif (opts.undoable)\n\t\t\t\t\t\tur.do(\"expand\", {\n\t\t\t\t\t\t\tnodes: node,\n\t\t\t\t\t\t\toptions: opts\n\t\t\t\t\t\t});\n\t\t\t\t\telse\n\t\t\t\t\t\tapi.expand(node, opts);\n\t\t\t\t\t}\n\t\t\t}\n\t\t});\n      }\n\n      $container.data('cyexpandcollapse', data);\n    },\n    unbind: function () {\n        var cy = this.cytoscape('get');\n        cy.off('mouseover', 'node', eMouseOver)\n          .off('mouseout tapdragout', 'node', eMouseOut)\n          .off('position', 'node', ePosition)\n          .off('remove', 'node', eRemove)\n          .off('tap', 'node', eTap)\n          .off('add', 'node', eAdd)\n          .off('free', 'node', eFree);\n\n        cy.unbind(\"zoom pan\", eZoom);\n    }\n  };\n\n  if (functions[fn]) {\n    return functions[fn].apply($(cy.container()), Array.prototype.slice.call(arguments, 1));\n  } else if (typeof fn == 'object' || !fn) {\n    return functions.init.apply($(cy.container()), arguments);\n  } else {\n    $.error('No such function `' + fn + '` for cytoscape.js-expand-collapse');\n  }\n\n  return $(this);\n};\n","var debounce = (function () {\n  /**\n   * lodash 3.1.1 (Custom Build) <https://lodash.com/>\n   * Build: `lodash modern modularize exports=\"npm\" -o ./`\n   * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>\n   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n   * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n   * Available under MIT license <https://lodash.com/license>\n   */\n  /** Used as the `TypeError` message for \"Functions\" methods. */\n  var FUNC_ERROR_TEXT = 'Expected a function';\n\n  /* Native method references for those with the same name as other `lodash` methods. */\n  var nativeMax = Math.max,\n          nativeNow = Date.now;\n\n  /**\n   * Gets the number of milliseconds that have elapsed since the Unix epoch\n   * (1 January 1970 00:00:00 UTC).\n   *\n   * @static\n   * @memberOf _\n   * @category Date\n   * @example\n   *\n   * _.defer(function(stamp) {\n   *   console.log(_.now() - stamp);\n   * }, _.now());\n   * // => logs the number of milliseconds it took for the deferred function to be invoked\n   */\n  var now = nativeNow || function () {\n    return new Date().getTime();\n  };\n\n  /**\n   * Creates a debounced function that delays invoking `func` until after `wait`\n   * milliseconds have elapsed since the last time the debounced function was\n   * invoked. The debounced function comes with a `cancel` method to cancel\n   * delayed invocations. Provide an options object to indicate that `func`\n   * should be invoked on the leading and/or trailing edge of the `wait` timeout.\n   * Subsequent calls to the debounced function return the result of the last\n   * `func` invocation.\n   *\n   * **Note:** If `leading` and `trailing` options are `true`, `func` is invoked\n   * on the trailing edge of the timeout only if the the debounced function is\n   * invoked more than once during the `wait` timeout.\n   *\n   * See [David Corbacho's article](http://drupalmotion.com/article/debounce-and-throttle-visual-explanation)\n   * for details over the differences between `_.debounce` and `_.throttle`.\n   *\n   * @static\n   * @memberOf _\n   * @category Function\n   * @param {Function} func The function to debounce.\n   * @param {number} [wait=0] The number of milliseconds to delay.\n   * @param {Object} [options] The options object.\n   * @param {boolean} [options.leading=false] Specify invoking on the leading\n   *  edge of the timeout.\n   * @param {number} [options.maxWait] The maximum time `func` is allowed to be\n   *  delayed before it's invoked.\n   * @param {boolean} [options.trailing=true] Specify invoking on the trailing\n   *  edge of the timeout.\n   * @returns {Function} Returns the new debounced function.\n   * @example\n   *\n   * // avoid costly calculations while the window size is in flux\n   * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n   *\n   * // invoke `sendMail` when the click event is fired, debouncing subsequent calls\n   * jQuery('#postbox').on('click', _.debounce(sendMail, 300, {\n   *   'leading': true,\n   *   'trailing': false\n   * }));\n   *\n   * // ensure `batchLog` is invoked once after 1 second of debounced calls\n   * var source = new EventSource('/stream');\n   * jQuery(source).on('message', _.debounce(batchLog, 250, {\n   *   'maxWait': 1000\n   * }));\n   *\n   * // cancel a debounced call\n   * var todoChanges = _.debounce(batchLog, 1000);\n   * Object.observe(models.todo, todoChanges);\n   *\n   * Object.observe(models, function(changes) {\n   *   if (_.find(changes, { 'user': 'todo', 'type': 'delete'})) {\n   *     todoChanges.cancel();\n   *   }\n   * }, ['delete']);\n   *\n   * // ...at some point `models.todo` is changed\n   * models.todo.completed = true;\n   *\n   * // ...before 1 second has passed `models.todo` is deleted\n   * // which cancels the debounced `todoChanges` call\n   * delete models.todo;\n   */\n  function debounce(func, wait, options) {\n    var args,\n            maxTimeoutId,\n            result,\n            stamp,\n            thisArg,\n            timeoutId,\n            trailingCall,\n            lastCalled = 0,\n            maxWait = false,\n            trailing = true;\n\n    if (typeof func != 'function') {\n      throw new TypeError(FUNC_ERROR_TEXT);\n    }\n    wait = wait < 0 ? 0 : (+wait || 0);\n    if (options === true) {\n      var leading = true;\n      trailing = false;\n    } else if (isObject(options)) {\n      leading = !!options.leading;\n      maxWait = 'maxWait' in options && nativeMax(+options.maxWait || 0, wait);\n      trailing = 'trailing' in options ? !!options.trailing : trailing;\n    }\n\n    function cancel() {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      if (maxTimeoutId) {\n        clearTimeout(maxTimeoutId);\n      }\n      lastCalled = 0;\n      maxTimeoutId = timeoutId = trailingCall = undefined;\n    }\n\n    function complete(isCalled, id) {\n      if (id) {\n        clearTimeout(id);\n      }\n      maxTimeoutId = timeoutId = trailingCall = undefined;\n      if (isCalled) {\n        lastCalled = now();\n        result = func.apply(thisArg, args);\n        if (!timeoutId && !maxTimeoutId) {\n          args = thisArg = undefined;\n        }\n      }\n    }\n\n    function delayed() {\n      var remaining = wait - (now() - stamp);\n      if (remaining <= 0 || remaining > wait) {\n        complete(trailingCall, maxTimeoutId);\n      } else {\n        timeoutId = setTimeout(delayed, remaining);\n      }\n    }\n\n    function maxDelayed() {\n      complete(trailing, timeoutId);\n    }\n\n    function debounced() {\n      args = arguments;\n      stamp = now();\n      thisArg = this;\n      trailingCall = trailing && (timeoutId || !leading);\n\n      if (maxWait === false) {\n        var leadingCall = leading && !timeoutId;\n      } else {\n        if (!maxTimeoutId && !leading) {\n          lastCalled = stamp;\n        }\n        var remaining = maxWait - (stamp - lastCalled),\n                isCalled = remaining <= 0 || remaining > maxWait;\n\n        if (isCalled) {\n          if (maxTimeoutId) {\n            maxTimeoutId = clearTimeout(maxTimeoutId);\n          }\n          lastCalled = stamp;\n          result = func.apply(thisArg, args);\n        }\n        else if (!maxTimeoutId) {\n          maxTimeoutId = setTimeout(maxDelayed, remaining);\n        }\n      }\n      if (isCalled && timeoutId) {\n        timeoutId = clearTimeout(timeoutId);\n      }\n      else if (!timeoutId && wait !== maxWait) {\n        timeoutId = setTimeout(delayed, wait);\n      }\n      if (leadingCall) {\n        isCalled = true;\n        result = func.apply(thisArg, args);\n      }\n      if (isCalled && !timeoutId && !maxTimeoutId) {\n        args = thisArg = undefined;\n      }\n      return result;\n    }\n\n    debounced.cancel = cancel;\n    return debounced;\n  }\n\n  /**\n   * Checks if `value` is the [language type](https://es5.github.io/#x8) of `Object`.\n   * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n   *\n   * @static\n   * @memberOf _\n   * @category Lang\n   * @param {*} value The value to check.\n   * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n   * @example\n   *\n   * _.isObject({});\n   * // => true\n   *\n   * _.isObject([1, 2, 3]);\n   * // => true\n   *\n   * _.isObject(1);\n   * // => false\n   */\n  function isObject(value) {\n    // Avoid a V8 JIT bug in Chrome 19-20.\n    // See https://code.google.com/p/v8/issues/detail?id=2291 for more details.\n    var type = typeof value;\n    return !!value && (type == 'object' || type == 'function');\n  }\n\n  return debounce;\n\n})();\n\nmodule.exports = debounce;","var boundingBoxUtilities = require('./boundingBoxUtilities');\n\n// Expand collapse utilities\nfunction expandCollapseUtilities(cy) {\nvar elementUtilities = require('./elementUtilities')(cy);\nreturn {\n  //the number of nodes moving animatedly after expand operation\n  animatedlyMovingNodeCount: 0,\n  /*\n   * A funtion basicly expanding a node, it is to be called when a node is expanded anyway.\n   * Single parameter indicates if the node is expanded alone and if it is truthy then layoutBy parameter is considered to\n   * perform layout after expand.\n   */\n  expandNodeBaseFunction: function (node, single, layoutBy) {\n    if (!node._private.data.collapsedChildren){\n      return;\n    }\n\n    //check how the position of the node is changed\n    var positionDiff = {\n      x: node._private.position.x - node._private.data['position-before-collapse'].x,\n      y: node._private.position.y - node._private.data['position-before-collapse'].y\n    };\n\n    node.removeData(\"infoLabel\");\n    node.removeClass('cy-expand-collapse-collapsed-node');\n\n    node.trigger(\"expandcollapse.beforeexpand\");\n    node._private.data.collapsedChildren.restore();\n    this.repairEdges(node);\n    node._private.data.collapsedChildren = null;\n\n    elementUtilities.moveNodes(positionDiff, node.children());\n    node.removeData('position-before-collapse');\n\n    node.trigger(\"position\"); // position not triggered by default when nodes are moved\n    node.trigger(\"expandcollapse.afterexpand\");\n\n    // If expand is called just for one node then call end operation to perform layout\n    if (single) {\n      this.endOperation(layoutBy);\n    }\n  },\n  /*\n   * A helper function to collapse given nodes in a simple way (Without performing layout afterward)\n   * It collapses all root nodes bottom up.\n   */\n  simpleCollapseGivenNodes: function (nodes) {//*//\n    nodes.data(\"collapse\", true);\n    var roots = elementUtilities.getTopMostNodes(nodes);\n    for (var i = 0; i < roots.length; i++) {\n      var root = roots[i];\n      \n      // Collapse the nodes in bottom up order\n      this.collapseBottomUp(root);\n    }\n    \n    return nodes;\n  },\n  /*\n   * A helper function to expand given nodes in a simple way (Without performing layout afterward)\n   * It expands all top most nodes top down.\n   */\n  simpleExpandGivenNodes: function (nodes, applyFishEyeViewToEachNode) {\n    nodes.data(\"expand\", true); // Mark that the nodes are still to be expanded\n    var roots = elementUtilities.getTopMostNodes(nodes);\n    for (var i = 0; i < roots.length; i++) {\n      var root = roots[i];\n      this.expandTopDown(root, applyFishEyeViewToEachNode); // For each root node expand top down\n    }\n    return nodes;\n  },\n  /*\n   * Expands all nodes by expanding all top most nodes top down with their descendants.\n   */\n  simpleExpandAllNodes: function (nodes, applyFishEyeViewToEachNode) {\n    if (nodes === undefined) {\n      nodes = cy.nodes();\n    }\n    var orphans;\n    orphans = elementUtilities.getTopMostNodes(nodes);\n    var expandStack = [];\n    for (var i = 0; i < orphans.length; i++) {\n      var root = orphans[i];\n      this.expandAllTopDown(root, expandStack, applyFishEyeViewToEachNode);\n    }\n    return expandStack;\n  },\n  /*\n   * The operation to be performed after expand/collapse. It rearrange nodes by layoutBy parameter.\n   */\n  endOperation: function (layoutBy) {\n    var self = this;\n    cy.ready(function () {\n      setTimeout(function() {\n        elementUtilities.rearrange(layoutBy);\n      }, 0);\n      \n    });\n  },\n  /*\n   * Calls simple expandAllNodes. Then performs end operation.\n   */\n  expandAllNodes: function (nodes, options) {//*//\n    var expandedStack = this.simpleExpandAllNodes(nodes, options.fisheye);\n\n    this.endOperation(options.layoutBy);\n\n    /*\n     * return the nodes to undo the operation\n     */\n    return expandedStack;\n  },\n  /*\n   * Expands the root and its collapsed descendents in top down order.\n   */\n  expandAllTopDown: function (root, expandStack, applyFishEyeViewToEachNode) {\n    if (root._private.data.collapsedChildren != null) {\n      expandStack.push(root);\n      this.expandNode(root, applyFishEyeViewToEachNode);\n    }\n    var children = root.children();\n    for (var i = 0; i < children.length; i++) {\n      var node = children[i];\n      this.expandAllTopDown(node, expandStack, applyFishEyeViewToEachNode);\n    }\n  },\n  //Expand the given nodes perform end operation after expandation\n  expandGivenNodes: function (nodes, options) {\n    // If there is just one node to expand we need to animate for fisheye view, but if there are more then one node we do not\n    if (nodes.length === 1) {\n      \n      var node = nodes[0];\n      if (node._private.data.collapsedChildren != null) {\n        // Expand the given node the third parameter indicates that the node is simple which ensures that fisheye parameter will be considered\n        this.expandNode(node, options.fisheye, true, options.animate, options.layoutBy);\n      }\n    } \n    else {\n      // First expand given nodes and then perform layout according to the layoutBy parameter\n      this.simpleExpandGivenNodes(nodes, options.fisheye);\n      this.endOperation(options.layoutBy);\n    }\n\n    /*\n     * return the nodes to undo the operation\n     */\n    return nodes;\n  },\n  //collapse the given nodes then perform end operation\n  collapseGivenNodes: function (nodes, options) {\n    /*\n     * In collapse operation there is no fisheye view to be applied so there is no animation to be destroyed here. We can do this \n     * in a batch.\n     */ \n    cy.startBatch();\n    this.simpleCollapseGivenNodes(nodes, options);\n    cy.endBatch();\n\n    nodes.trigger(\"position\"); // position not triggered by default when collapseNode is called\n    this.endOperation(options.layoutBy);\n\n    // Update the style\n    cy.style().update();\n\n    /*\n     * return the nodes to undo the operation\n     */\n    return nodes;\n  },\n  //collapse the nodes in bottom up order starting from the root\n  collapseBottomUp: function (root) {\n    var children = root.children();\n    for (var i = 0; i < children.length; i++) {\n      var node = children[i];\n      this.collapseBottomUp(node);\n    }\n    //If the root is a compound node to be collapsed then collapse it\n    if (root.data(\"collapse\") && root.children().length > 0) {\n      this.collapseNode(root);\n      root.removeData(\"collapse\");\n    }\n  },\n  //expand the nodes in top down order starting from the root\n  expandTopDown: function (root, applyFishEyeViewToEachNode) {\n    if (root.data(\"expand\") && root._private.data.collapsedChildren != null) {\n      // Expand the root and unmark its expand data to specify that it is no more to be expanded\n      this.expandNode(root, applyFishEyeViewToEachNode);\n      root.removeData(\"expand\");\n    }\n    // Make a recursive call for children of root\n    var children = root.children();\n    for (var i = 0; i < children.length; i++) {\n      var node = children[i];\n      this.expandTopDown(node);\n    }\n  },\n  // Converst the rendered position to model position according to global pan and zoom values\n  convertToModelPosition: function (renderedPosition) {\n    var pan = cy.pan();\n    var zoom = cy.zoom();\n\n    var x = (renderedPosition.x - pan.x) / zoom;\n    var y = (renderedPosition.y - pan.y) / zoom;\n\n    return {\n      x: x,\n      y: y\n    };\n  },\n  /*\n   * This method expands the given node. It considers applyFishEyeView, animate and layoutBy parameters.\n   * It also considers single parameter which indicates if this node is expanded alone. If this parameter is truthy along with \n   * applyFishEyeView parameter then the state of view port is to be changed to have extra space on the screen (if needed) before appliying the\n   * fisheye view.\n   */\n  expandNode: function (node, applyFishEyeView, single, animate, layoutBy) {\n    var self = this;\n    \n    var commonExpandOperation = function (node, applyFishEyeView, single, animate, layoutBy) {\n      if (applyFishEyeView) {\n\n        node._private.data['width-before-fisheye'] = node._private.data['size-before-collapse'].w;\n        node._private.data['height-before-fisheye'] = node._private.data['size-before-collapse'].h;\n        \n        // Fisheye view expand the node.\n        // The first paramter indicates the node to apply fisheye view, the third parameter indicates the node\n        // to be expanded after fisheye view is applied.\n        self.fishEyeViewExpandGivenNode(node, single, node, animate, layoutBy);\n      }\n      \n      // If one of these parameters is truthy it means that expandNodeBaseFunction is already to be called.\n      // However if none of them is truthy we need to call it here.\n      if (!single || !applyFishEyeView || !animate) {\n        self.expandNodeBaseFunction(node, single, layoutBy);\n      }\n    };\n\n    if (node._private.data.collapsedChildren != null) {\n      this.storeWidthHeight(node);\n      var animating = false; // Variable to check if there is a current animation, if there is commonExpandOperation will be called after animation\n      \n      // If the node is the only node to expand and fisheye view should be applied, then change the state of viewport \n      // to create more space on screen (If needed)\n      if (applyFishEyeView && single) {\n        var topLeftPosition = this.convertToModelPosition({x: 0, y: 0});\n        var bottomRightPosition = this.convertToModelPosition({x: cy.width(), y: cy.height()});\n        var padding = 80;\n        var bb = {\n          x1: topLeftPosition.x,\n          x2: bottomRightPosition.x,\n          y1: topLeftPosition.y,\n          y2: bottomRightPosition.y\n        };\n\n        var nodeBB = {\n          x1: node._private.position.x - node._private.data['size-before-collapse'].w / 2 - padding,\n          x2: node._private.position.x + node._private.data['size-before-collapse'].w / 2 + padding,\n          y1: node._private.position.y - node._private.data['size-before-collapse'].h / 2 - padding,\n          y2: node._private.position.y + node._private.data['size-before-collapse'].h / 2 + padding\n        };\n\n        var unionBB = boundingBoxUtilities.getUnion(nodeBB, bb);\n        \n        // If these bboxes are not equal then we need to change the viewport state (by pan and zoom)\n        if (!boundingBoxUtilities.equalBoundingBoxes(unionBB, bb)) {\n          var viewPort = cy.getFitViewport(unionBB, 10);\n          var self = this;\n          animating = animate; // Signal that there is an animation now and commonExpandOperation will be called after animation\n          // Check if we need to animate during pan and zoom\n          if (animate) {\n            cy.animate({\n              pan: viewPort.pan,\n              zoom: viewPort.zoom,\n              complete: function () {\n                commonExpandOperation(node, applyFishEyeView, single, animate, layoutBy);\n              }\n            }, {\n              duration: 1000\n            });\n          }\n          else {\n            cy.zoom(viewPort.zoom);\n            cy.pan(viewPort.pan);\n          }\n        }\n      }\n      \n      // If animating is not true we need to call commonExpandOperation here\n      if (!animating) {\n        commonExpandOperation(node, applyFishEyeView, single, animate, layoutBy);\n      }\n      \n      //return the node to undo the operation\n      return node;\n    }\n  },\n  //collapse the given node without performing end operation\n  collapseNode: function (node) {\n    if (node._private.data.collapsedChildren == null) {\n      node.data('position-before-collapse', {\n        x: node.position().x,\n        y: node.position().y\n      });\n\n      node.data('size-before-collapse', {\n        w: node.outerWidth(),\n        h: node.outerHeight()\n      });\n\n      var children = node.children();\n\n      children.unselect();\n      children.connectedEdges().unselect();\n\n      node.trigger(\"expandcollapse.beforecollapse\");\n      \n      this.barrowEdgesOfcollapsedChildren(node);\n      this.removeChildren(node, node);\n      node.addClass('cy-expand-collapse-collapsed-node');\n\n      node.trigger(\"expandcollapse.aftercollapse\");\n      \n      node.position(node.data('position-before-collapse'));\n\n      //return the node to undo the operation\n      return node;\n    }\n  },\n  storeWidthHeight: function (node) {//*//\n    if (node != null) {\n      node._private.data['x-before-fisheye'] = this.xPositionInParent(node);\n      node._private.data['y-before-fisheye'] = this.yPositionInParent(node);\n      node._private.data['width-before-fisheye'] = node.outerWidth();\n      node._private.data['height-before-fisheye'] = node.outerHeight();\n\n      if (node.parent()[0] != null) {\n        this.storeWidthHeight(node.parent()[0]);\n      }\n    }\n\n  },\n  /*\n   * Apply fisheye view to the given node. nodeToExpand will be expanded after the operation. \n   * The other parameter are to be passed by parameters directly in internal function calls.\n   */\n  fishEyeViewExpandGivenNode: function (node, single, nodeToExpand, animate, layoutBy) {\n    var siblings = this.getSiblings(node);\n\n    var x_a = this.xPositionInParent(node);\n    var y_a = this.yPositionInParent(node);\n\n    var d_x_left = Math.abs((node._private.data['width-before-fisheye'] - node.outerWidth()) / 2);\n    var d_x_right = Math.abs((node._private.data['width-before-fisheye'] - node.outerWidth()) / 2);\n    var d_y_upper = Math.abs((node._private.data['height-before-fisheye'] - node.outerHeight()) / 2);\n    var d_y_lower = Math.abs((node._private.data['height-before-fisheye'] - node.outerHeight()) / 2);\n\n    var abs_diff_on_x = Math.abs(node._private.data['x-before-fisheye'] - x_a);\n    var abs_diff_on_y = Math.abs(node._private.data['y-before-fisheye'] - y_a);\n\n    // Center went to LEFT\n    if (node._private.data['x-before-fisheye'] > x_a) {\n      d_x_left = d_x_left + abs_diff_on_x;\n      d_x_right = d_x_right - abs_diff_on_x;\n    }\n    // Center went to RIGHT\n    else {\n      d_x_left = d_x_left - abs_diff_on_x;\n      d_x_right = d_x_right + abs_diff_on_x;\n    }\n\n    // Center went to UP\n    if (node._private.data['y-before-fisheye'] > y_a) {\n      d_y_upper = d_y_upper + abs_diff_on_y;\n      d_y_lower = d_y_lower - abs_diff_on_y;\n    }\n    // Center went to DOWN\n    else {\n      d_y_upper = d_y_upper - abs_diff_on_y;\n      d_y_lower = d_y_lower + abs_diff_on_y;\n    }\n\n    var xPosInParentSibling = [];\n    var yPosInParentSibling = [];\n\n    for (var i = 0; i < siblings.length; i++) {\n      xPosInParentSibling.push(this.xPositionInParent(siblings[i]));\n      yPosInParentSibling.push(this.yPositionInParent(siblings[i]));\n    }\n\n    for (var i = 0; i < siblings.length; i++) {\n      var sibling = siblings[i];\n\n      var x_b = xPosInParentSibling[i];\n      var y_b = yPosInParentSibling[i];\n\n      var slope = (y_b - y_a) / (x_b - x_a);\n\n      var d_x = 0;\n      var d_y = 0;\n      var T_x = 0;\n      var T_y = 0;\n\n      // Current sibling is on the LEFT\n      if (x_a > x_b) {\n        d_x = d_x_left;\n      }\n      // Current sibling is on the RIGHT\n      else {\n        d_x = d_x_right;\n      }\n      // Current sibling is on the UPPER side\n      if (y_a > y_b) {\n        d_y = d_y_upper;\n      }\n      // Current sibling is on the LOWER side\n      else {\n        d_y = d_y_lower;\n      }\n\n      if (isFinite(slope)) {\n        T_x = Math.min(d_x, (d_y / Math.abs(slope)));\n      }\n\n      if (slope !== 0) {\n        T_y = Math.min(d_y, (d_x * Math.abs(slope)));\n      }\n\n      if (x_a > x_b) {\n        T_x = -1 * T_x;\n      }\n\n      if (y_a > y_b) {\n        T_y = -1 * T_y;\n      }\n      \n      // Move the sibling in the special way\n      this.fishEyeViewMoveNode(sibling, T_x, T_y, nodeToExpand, single, animate, layoutBy);\n    }\n\n    // If there is no sibling call expand node base function here else it is to be called one of fishEyeViewMoveNode() calls\n    if (siblings.length == 0) {\n      this.expandNodeBaseFunction(nodeToExpand, single, layoutBy);\n    }\n\n    if (node.parent()[0] != null) {\n      // Apply fisheye view to the parent node as well ( If exists )\n      this.fishEyeViewExpandGivenNode(node.parent()[0], single, nodeToExpand, animate, layoutBy);\n    }\n\n    return node;\n  },\n  getSiblings: function (node) {\n    var siblings;\n\n    if (node.parent()[0] == null) {\n      var orphans = cy.nodes(\":visible\").orphans();\n      siblings = orphans.difference(node);\n    } else {\n      siblings = node.siblings(\":visible\");\n    }\n\n    return siblings;\n  },\n  /*\n   * Move node operation specialized for fish eye view expand operation\n   * Moves the node by moving its descandents. Movement is animated if both single and animate flags are truthy.\n   */\n  fishEyeViewMoveNode: function (node, T_x, T_y, nodeToExpand, single, animate, layoutBy) {\n    var childrenList = node.children(\":visible\");\n    var self = this;\n    \n    /*\n     * If the node is simple move itself directly else move it by moving its children by a self recursive call\n     */\n    if (childrenList.length == 0) {\n      var newPosition = {x: node._private.position.x + T_x, y: node._private.position.y + T_y};\n      if (!single || !animate) {\n        node._private.position.x = newPosition.x;\n        node._private.position.y = newPosition.y;\n      }\n      else {\n        this.animatedlyMovingNodeCount++;\n        node.animate({\n          position: newPosition,\n          complete: function () {\n            self.animatedlyMovingNodeCount--;\n            if (self.animatedlyMovingNodeCount > 0 || !nodeToExpand.hasClass('cy-expand-collapse-collapsed-node')) {\n\n              return;\n            }\n            \n            // If all nodes are moved we are ready to expand so call expand node base function\n            self.expandNodeBaseFunction(nodeToExpand, single, layoutBy);\n\n          }\n        }, {\n          duration: 1000\n        });\n      }\n    }\n    else {\n      for (var i = 0; i < childrenList.length; i++) {\n        this.fishEyeViewMoveNode(childrenList[i], T_x, T_y, nodeToExpand, single, animate, layoutBy);\n      }\n    }\n  },\n  xPositionInParent: function (node) {//*//\n    var parent = node.parent()[0];\n    var x_a = 0.0;\n\n    // Given node is not a direct child of the the root graph\n    if (parent != null) {\n      x_a = node.relativePosition('x') + (parent.width() / 2);\n    }\n    // Given node is a direct child of the the root graph\n\n    else {\n      x_a = node.position('x');\n    }\n\n    return x_a;\n  },\n  yPositionInParent: function (node) {//*//\n    var parent = node.parent()[0];\n\n    var y_a = 0.0;\n\n    // Given node is not a direct child of the the root graph\n    if (parent != null) {\n      y_a = node.relativePosition('y') + (parent.height() / 2);\n    }\n    // Given node is a direct child of the the root graph\n\n    else {\n      y_a = node.position('y');\n    }\n\n    return y_a;\n  },\n  /*\n   * for all children of the node parameter call this method\n   * with the same root parameter,\n   * remove the child and add the removed child to the collapsedchildren data\n   * of the root to restore them in the case of expandation\n   * root._private.data.collapsedChildren keeps the nodes to restore when the\n   * root is expanded\n   */\n  removeChildren: function (node, root) {\n    var children = node.children();\n    for (var i = 0; i < children.length; i++) {\n      var child = children[i];\n      this.removeChildren(child, root);\n      var removedChild = child.remove();\n      if (root._private.data.collapsedChildren == null) {\n        root._private.data.collapsedChildren = removedChild;\n      }\n      else {\n        root._private.data.collapsedChildren = root._private.data.collapsedChildren.union(removedChild);\n      }\n    }\n  },\n  isMetaEdge: function(edge) {\n    return edge.hasClass(\"cy-expand-collapse-meta-edge\");\n  },\n  barrowEdgesOfcollapsedChildren: function(node) {\n    var relatedNodes = node.descendants();\n    var edges = relatedNodes.edgesWith(cy.nodes().not(relatedNodes.union(node)));\n    \n    var relatedNodeMap = {};\n    \n    relatedNodes.each(function(ele, i) {\n      if(typeof ele === \"number\") {\n        ele = i;\n      }\n      relatedNodeMap[ele.id()] = true;\n    });\n    \n    for (var i = 0; i < edges.length; i++) {\n      var edge = edges[i];\n      var source = edge.source();\n      var target = edge.target();\n      \n      if (!this.isMetaEdge(edge)) { // is original\n        var originalEndsData = {\n          source: source,\n          target: target\n        };\n        \n        edge.addClass(\"cy-expand-collapse-meta-edge\");\n        edge.data('originalEnds', originalEndsData);\n      }\n      \n      edge.move({\n        target: !relatedNodeMap[target.id()] ? target.id() : node.id(),\n        source: !relatedNodeMap[source.id()] ? source.id() : node.id()\n      });\n    }\n  },\n  findNewEnd: function(node) {\n    var current = node;\n    \n    while( !current.inside() ) {\n      current = current.parent();\n    }\n    \n    return current;\n  },\n  repairEdges: function(node) {\n    var connectedMetaEdges = node.connectedEdges('.cy-expand-collapse-meta-edge');\n    \n    for (var i = 0; i < connectedMetaEdges.length; i++) {\n      var edge = connectedMetaEdges[i];\n      var originalEnds = edge.data('originalEnds');\n      var currentSrcId = edge.data('source');\n      var currentTgtId = edge.data('target');\n      \n      if ( currentSrcId === node.id() ) {\n        edge = edge.move({\n          source: this.findNewEnd(originalEnds.source).id()\n        });\n      } else {\n        edge = edge.move({\n          target: this.findNewEnd(originalEnds.target).id()\n        });\n      }\n      \n      if ( edge.data('source') === originalEnds.source.id() && edge.data('target') === originalEnds.target.id() ) {\n        edge.removeClass('cy-expand-collapse-meta-edge');\n        edge.removeData('originalEnds');\n      }\n    }\n  },\n  /*node is an outer node of root\n   if root is not it's anchestor\n   and it is not the root itself*/\n  isOuterNode: function (node, root) {//*//\n    var temp = node;\n    while (temp != null) {\n      if (temp == root) {\n        return false;\n      }\n      temp = temp.parent()[0];\n    }\n    return true;\n  },\n  /**\n   * Get all collapsed children - including nested ones\n   * @param node : a collapsed node\n   * @param collapsedChildren : a collection to store the result\n   * @return : collapsed children\n   */\n  getCollapsedChildrenRecursively: function(node, collapsedChildren){\n    var children = node.data('collapsedChildren');\n    var i;\n    for (i=0; i < children.length; i++){\n      if (children[i].data('collapsedChildren')){\n        collapsedChildren = collapsedChildren.union(this.getCollapsedChildrenRecursively(children[i], collapsedChildren));\n      }\n      collapsedChildren = collapsedChildren.union(children[i]);\n    }\n    return collapsedChildren;\n  }\n}\n};\n\nmodule.exports = expandCollapseUtilities;\n","var boundingBoxUtilities = {\n  equalBoundingBoxes: function(bb1, bb2){\n      return bb1.x1 == bb2.x1 && bb1.x2 == bb2.x2 && bb1.y1 == bb2.y1 && bb1.y2 == bb2.y2;\n  },\n  getUnion: function(bb1, bb2){\n      var union = {\n      x1: Math.min(bb1.x1, bb2.x1),\n      x2: Math.max(bb1.x2, bb2.x2),\n      y1: Math.min(bb1.y1, bb2.y1),\n      y2: Math.max(bb1.y2, bb2.y2),\n    };\n\n    union.w = union.x2 - union.x1;\n    union.h = union.y2 - union.y1;\n\n    return union;\n  }\n};\n\nmodule.exports = boundingBoxUtilities;"],"sourceRoot":""}