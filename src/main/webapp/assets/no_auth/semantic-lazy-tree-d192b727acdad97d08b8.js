(window.webpackJsonp=window.webpackJsonp||[]).push([[486],{1327:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),a=n(1),o=n(43),i=n(34),l=n(61),s=n(162),c=n(56),d=n(630),p=n(327),h=n(328),u=n(1581),f=n(2712),g=n(1328),m=function(e){function LazyTree(t,n){var r=e.call(this,t,n)||this;return r.searchedPaths=o.Set(),r.cancellation=new i.Cancellation,r.expandingCancellation=i.Cancellation.cancelled,r.onTreeMount=function(e){r.tree=e},r.onSearchBadgeClick=function(e,t){var n=e.getKeyPath(t);r.onExpandAndScrollToPath(n,t)},r.onSearchSelectionChanged=function(e){var t=r.searchedPaths;r.searchedPaths=u.TreeSelection.leafs(e).map((function(t){return o.List(e.getKeyPath(t))})).toSet();var n=r.searchedPaths.filter((function(e){return!t.has(e)}));if(1===n.size){var a=n.first().toArray();r.onExpandAndScrollToPath(a,e.fromKeyPath(a))}},r.onItemClick=function(e){s.trigger({eventType:f.ItemSelected,source:r.props.id,data:{iri:e.iri.value}})},r.isLeaf=function(e){var t=r.state.model;return e.children?0===e.children.length&&!t.hasMoreChildren(e):void 0},r.childrenOf=function(e){var t=r.state.model;return{children:e.children,loading:e.loading,hasMoreItems:t.hasMoreChildren(e)}},r.requestMore=function(e){var t=r.state.forest.getKeyPath(e),n=r.state,a=n.model,o=n.forest,i=u.queryMoreChildren((function(e){return a.loadMoreChildren(e)}),o,t),l=i[0],s=i[1];r.cancellation.map(s).observe({value:function(e){r.setState({forest:e(o)})}}),r.setState({forest:l})},r.onExpandedOrCollapsed=function(e,t){var n=r.state.forest.getKeyPath(e),a=r.state.forest.updateNode(n,(function(e){return u.TreeNode.set(e,{expanded:t})}));r.setState({forest:a})},r.state={loading:!0},r}return r.__extends(LazyTree,e),LazyTree.prototype.componentDidMount=function(){var e=this,t="query"===this.props.type?this.props.config:u.createDefaultTreeQueries(this.props.config),n=new u.SparqlNodeModel({rootsQuery:l.SparqlUtil.parseQuery(t.rootsQuery),childrenQuery:l.SparqlUtil.parseQuery(t.childrenQuery),parentsQuery:l.SparqlUtil.parseQuery(t.parentsQuery),sparqlOptions:function(){return{context:e.context.semanticContext}},limit:this.props.pageSize});n.loadMoreChildren(u.Node.readyToLoadRoot).onValue((function(r){e.setState({loading:!1,expandingToScroll:!1,forest:u.KeyedForest.create(u.Node.keyOf,r),patterns:t,model:n})}))},LazyTree.prototype.render=function(){return this.state.loading?a.createElement("div",null,"Loading"):this.renderTree()},LazyTree.prototype.renderTree=function(){var e=this,t=this.state,n=t.patterns,o=t.forest,i=t.expandingToScroll,l=t.highlightedPath,s=[];if(l){var c=o.fromKeyPath(l);c&&(s=o.getNodePath(c))}var d={forest:o,isLeaf:this.isLeaf,childrenOf:this.childrenOf,renderItem:function(t){return e.renderTreeNodeRow(t,s)},requestMore:this.requestMore,hideCheckboxes:!0,onExpandedOrCollapsed:this.onExpandedOrCollapsed,isExpanded:function(e){return e.expanded},selectionMode:u.SingleFullSubtree(),onItemClick:this.onItemClick};return a.createElement("div",{className:g.component},a.createElement(u.SemanticTreeInput,r.__assign({},n,{multipleSelection:!0,onSelectionClick:this.onSearchBadgeClick,onSelectionChanged:this.onSearchSelectionChanged})),a.createElement("div",{className:g.alignmentTreeContainer},i?this.renderExpandToScrollMessage():null,a.createElement(u.LazyTreeSelector,r.__assign({},d,{ref:this.onTreeMount,className:g.alignmentTree}))))},LazyTree.prototype.renderTreeNodeRow=function(e,t){var n=this.computeDecoratorsClass(e,t);return a.createElement("span",{className:g.alignmentNodeRow},a.createElement(h.Draggable,{iri:e.iri.value},this.renderTreeNode(e,n)),this.renderNodeInfoTemplate(e))},LazyTree.prototype.renderTreeNode=function(e,t){var n=e.iri.value;return a.createElement("span",{className:t,title:n},a.createElement("span",null,u.Node.getLabel(e)))},LazyTree.prototype.renderNodeInfoTemplate=function(e){return this.props.infoTemplate?a.createElement(d.TemplateItem,{template:{source:this.props.infoTemplate,options:{iri:e.iri.value}}}):null},LazyTree.prototype.renderExpandToScrollMessage=function(){var e=this.state.expandTarget;return a.createElement("div",{className:g.scrollNotification},"Scrolling to item ",a.createElement("span",{className:g.scrollToName},e.label.value),a.createElement(p.Spinner,{className:g.scrollSpinner,spinnerDelay:0,messageDelay:1/0}))},LazyTree.prototype.computeDecoratorsClass=function(e,t){var n=[g.decoratedNodeBody],r=t.indexOf(e);if(r>=0){var a=r===t.length-1;n.push(a?g.decorateHighlightLeaf:g.decorateHighlightParent)}return n.join(" ")},LazyTree.prototype.onExpandAndScrollToPath=function(e,t){var n=this,onExpandingStateChanged=function(){var e=n.state,t=e.expandingToScroll,r=e.highlightedPath;!t&&r&&n.scrollToPath(r)};this.setState({expandingToScroll:!0,expandTarget:t},(function(){n.expandingCancellation=n.cancellation.deriveAndCancel(n.expandingCancellation),n.expandingCancellation.map(u.loadPath((function(e){return n.state.model.hasMoreChildren(e)}),(function(e){return n.state.model.loadMoreChildren(e)}),n.state.forest,e).map((function(t){return u.expandPath(t,e)}))).observe({value:function(t){n.setState({forest:t,expandingToScroll:!1,highlightedPath:e},onExpandingStateChanged)},error:function(e){console.error(e),n.setState({expandingToScroll:!1,highlightedPath:void 0})}})}))},LazyTree.prototype.cancelExpandingToScroll=function(){this.state.expandingToScroll&&(this.expandingCancellation.cancelAll(),this.setState({expandingToScroll:!1,expandTarget:void 0,highlightedPath:void 0}))},LazyTree.prototype.scrollToPath=function(e){this.tree.scrollToPath(e)},LazyTree.defaultProps={pageSize:50},LazyTree}(c.Component);t.LazyTree=m,t.default=m},2712:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(162).EventMaker;t.ItemSelected=r("LazyTree.ItemSelected")}}]);
//# sourceMappingURL=semantic-lazy-tree-d192b727acdad97d08b8.js.map