(window.webpackJsonp=window.webpackJsonp||[]).push([[503],{1353:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),a=n(16),o=n(34),s=n(214),l=n(162),u=n(61),p=n(116),c=n(2929),d=n(1569),h=n(1630),S=n(1943),R=n(1824),E=function(e){function SemanticSearchResult(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(SemanticSearchResult,e),SemanticSearchResult.prototype.render=function(){var e=this;return i.createElement(d.SemanticSearchContext.Consumer,null,(function(t){return i.createElement(m,r.__assign({},e.props,{context:t}))}))},SemanticSearchResult}(i.Component),m=function(e){function SemanticSearchResultInner(t){var n=e.call(this,t)||this;return n.cancellation=new o.Cancellation,n.listenToChildLoading=function(e){e&&("string"!=typeof e&&e.props.id?n.cancellation.map(l.listen({eventType:l.BuiltInEvents.ComponentLoading,source:e.props.id})).observe({value:function(t){var r=s.componentHasType(e,c.ResultsNumber);n.props.context.notifyResultLoading(r?{type:"count",task:t.data}:{type:"other",task:t.data.map((function(){}))})}}):n.setState({error:"semantic-search-result child component should have the 'id' property"}))},n.buildResultQuery=function(e,t,r){return t.resultQuery.map((function(e){var i,o=u.SparqlUtil.parseQuerySync(r);(i=o.where).unshift.apply(i,e.where);var s=e.variables[0];s.substring(1)!==h.SEMANTIC_SEARCH_VARIABLES.PROJECTION_ALIAS_VAR&&o.where.push({expression:s,type:"bind",variable:"?"+h.SEMANTIC_SEARCH_VARIABLES.PROJECTION_ALIAS_VAR}),!o.limit&&n.props.context.baseConfig.limit&&(o.limit=t.baseConfig.limit),a.has(t.bindings,h.RESULT_VARIABLES.CONTEXT_RELATION_VAR)&&n.bindRelationPattern(o,t.bindings);var l=u.SparqlClient.setBindings(o,n.props.context.bindings);return u.SparqlUtil.serializeQuery(R.generateQueryForMultipleDatasets(l,t.selectedDatasets,t.baseConfig.datasetsConfig))}))},n.bindRelationPattern=function(e,t){n.props.context.searchProfileStore.map((function(t){var r=n.props.context.visualizationContext.getOrElse(t.relations.first()),i=R.tryGetRelationPatterns(n.props.context.baseConfig,r).find((function(e){return"resource"===e.kind||"literal"===e.kind||"date-range"===e.kind||"numeric-range"===e.kind}));if(i){var a=u.SparqlUtil.parsePatterns(i.queryPattern,e.prefixes);if("date-range"===i.kind){var o={begin:h.SEMANTIC_SEARCH_VARIABLES.DATE_BEGING_VAR,end:h.SEMANTIC_SEARCH_VARIABLES.DATE_END_VAR};a=S.transformRangePattern(a,o,o)}else if("numeric-range"===i.kind){o={begin:h.SEMANTIC_SEARCH_VARIABLES.NUMERIC_RANGE_BEGIN_VAR,end:h.SEMANTIC_SEARCH_VARIABLES.NUMERIC_RANGE_END_VAR};a=S.transformRangePattern(a,o,o)}new u.PatternBinder(h.RESULT_VARIABLES.CONTEXT_RELATION_PATTERN_VAR,a).sparqlQuery(e)}return e}))},n.state={},n}return r.__extends(SemanticSearchResultInner,e),SemanticSearchResultInner.prototype.shouldComponentUpdate=function(e,t){var n=this.props.context,r=e.context;return!(a.isEqual(r.resultQuery.getOrElse(null),n.resultQuery.getOrElse(null))&&a.isEqual(r.bindings,n.bindings)&&a.isEqual(this.state,t)&&r.availableDomains.isEqual(n.availableDomains))},SemanticSearchResultInner.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticSearchResultInner.prototype.render=function(){return this.state.error?i.createElement(p.ErrorNotification,{errorMessage:this.state.error}):this.mapChildren(this.props.children)},SemanticSearchResultInner.prototype.mapChildren=function(e){var t=this;return s.universalChildren(i.Children.toArray(e).map((function(e){if(s.isValidChild(e)){if(a.has(e.props,"query")){var n=t.tryMakeControlled(e);return t.buildResultQuery(t.props,t.props.context,e.props.query).map((function(e){return t.updateChildQuery(n,e)})).getOrElse(null)}return i.cloneElement(e,e.props,t.mapChildren(e.props.children))}return e})))},SemanticSearchResultInner.prototype.tryMakeControlled=function(e){var t=this;if(s.hasControlledProps(e.type)&&e.props.id){var n={onControlledPropChange:function(n){t.props.context.updateResultState(e.props.id,n)}},a=this.props.context.resultState[e.props.id]||{};return i.cloneElement(e,r.__assign(r.__assign({},a),n))}return e},SemanticSearchResultInner.prototype.updateChildQuery=function(e,t){this.listenToChildLoading(e);var n=a.assign({},e.props,{query:t});return i.cloneElement(e,n,e.props.children)},SemanticSearchResultInner}(i.Component);t.default=E},2929:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1250);t.ResultsNumber=r.ResultsNumberComponent,t.ResultsNumberProps=r.Props}}]);
//# sourceMappingURL=semantic-search-result-aa39e47b8ab9bdae6aa7.js.map