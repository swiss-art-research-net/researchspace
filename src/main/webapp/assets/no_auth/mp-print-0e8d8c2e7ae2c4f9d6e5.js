(window.webpackJsonp=window.webpackJsonp||[]).push([[370],{1420:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),i=n(1),r=n(1),s=n(35),a=n(33),l=n(20),c=n(3027),d=n(19),p=n(635),u=n(16),m=n(23),f=n(331),h=n(120),v=n(56),y=n(214),P=n(1273);n(1421);var b=function(t){function PrintComponent(e,i){var c=t.call(this,e,i)||this;return c.observer=new MutationObserver(u.debounce((function(){return c.setStyles()}),500)),c.loadHtml2Pdf=function(){c.props.htmlToPdf&&Promise.resolve().then((function(){return n(3030)})).then((function(t){c.html2pdf=t,c.setState({html2pdfLoaded:!0})}))},c.setPrintSections=function(){var t=[];d.sequentially(0,c.props.pages).map((function(t){return m.Rdf.iri(t)})).flatMap(c.loadAndParseTemplate).onValue((function(e){t.push(c.findPrintSections(e))})).onEnd((function(){var e=[].concat.apply([],t),n=c.mergePrintSections(e).map((function(t){return{content:t,isSelected:t.props.defaultPrint}}));c.setState({sections:n},c.setStyles)}))},c.mergePrintSections=function(t){var e=[];return t.forEach((function(t){var n=t.props.id,o=u.find(e,{id:n});o?o.sections.push(t):e.push({id:n,sections:[t]})})),e.map((function(t){var e=t.sections[0];if(1===t.sections.length)return e;var n=e.props,o=n.id,i=n.label,r=n.defaultPrint;return P.factory({id:o,label:i,defaultPrint:r},t.sections)}))},c.loadAndParseTemplate=function(t){var e=a.fromNullable(c.context.semanticContext).map((function(t){return t.repository})).getOrElse(void 0);return f.PageService.loadRenderedTemplate(t,t,{repository:e}).flatMap((function(t){return d.fromPromise(h.ModuleRegistry.parseHtmlToReact("\n              <div>\n                "+t.templateHtml+"\n              </div>\n            ")).map((function(t){return s.div({},t)}))})).toProperty()},c.findPrintSections=function(t,e){return e||(e=[]),t?(y.componentHasType(t,P.PrintSectionComponent)?e.push(t):y.isValidChild(t)&&t.props.children&&r.Children.forEach(t.props.children,(function(t){c.findPrintSections(t,e)})),e):null},c.setStyles=function(){h.ModuleRegistry.parseHtmlToReact(document.head.innerHTML).then((function(t){var e=(t=Array.isArray(t)?t:[t]).filter((function(t){return"link"===t.type||"style"===t.type}));c.setState({styles:e})}))},c.handleCheck=function(t,e){var n=c.state.sections,i=o.__assign(o.__assign({},n[t]),{isSelected:e.target.checked}),r=o.__spreadArrays(n);r.splice(t,1,i),c.setState({sections:r})},c.handlePrint=function(){var t=l.findDOMNode(c.frameRef);t.contentWindow.document.execCommand("print",!1,null)||t.contentWindow.print()},c.handleExportAsPDF=function(){var t=l.findDOMNode(c.frameRef),e=c.getIframeBody(t);c.html2pdf(e,c.props.htmlToPdf)},c.onFrameMount=function(t){c.frameRef=t},c.state={sections:[],styles:[],html2pdfLoaded:!1},c}return o.__extends(PrintComponent,t),PrintComponent.prototype.componentDidMount=function(){this.loadHtml2Pdf(),this.setPrintSections();var t=document.querySelector("head");this.observer.observe(t,{subtree:!1,characterData:!1,childList:!0})},PrintComponent.prototype.componentWillUnmount=function(){this.observer.disconnect()},PrintComponent.prototype.getIframeBody=function(t){return(t.contentDocument||t.contentWindow.document).querySelector("body")},PrintComponent.prototype.render=function(){var t,e,n=this,o=this.state.sections,r=o.filter((function(t){return t.isSelected})).map((function(t){return s.div({key:t.content.props.id},t.content)})),a=p(this.props.className||"mp-print"),l=i.createElement(c.default,{ref:this.onFrameMount,className:a("iframe").toString(),head:i.createElement("div",null,this.state.styles,i.createElement("style",null,".hidden-print {display: none} .frame-content {padding: 20px}"))},r);if(o.length>1){var d=o.map((function(t,e){var o=t.content.props,i=o.id,r=o.label;return s.div({className:"checkbox",key:i},s.label({},s.input({type:"checkbox",value:r,checked:t.isSelected,onChange:n.handleCheck.bind(n,e)}),r))}));t=s.div({className:"panel panel-default "+a("select").toString()},s.div({className:"panel-heading "+a("select-header").toString()},"Print Sections"),s.div({className:"panel-body "+a("select-body").toString()},d),s.div({className:"panel-footer "+a("select-footer").toString()},s.button({className:"btn btn-primary",onClick:this.handlePrint,title:"Recommended option for native or PDF printing. Uses native browser print functionlity. Requires Unix, Mac, Windows >10 or a PDF Print Driver being installed."},"Print PDF")," ",this.props.htmlToPdf&&this.state.html2pdfLoaded?s.button({className:"btn btn-primary",onClick:this.handleExportAsPDF,title:"Client-side export to PDF. Only recommended if no PDF print driveris available."},"Export as PDF"):null)),e=l}else e=s.div({className:a("body-inner").toString()},s.div({className:a("body-content").toString()},l),s.div({className:"panel-footer "+a("body-footer").toString()},s.button({className:"btn btn-primary",onClick:this.handlePrint},"Print")," ",s.button({className:"btn btn-primary",onClick:this.handleExportAsPDF},"Export as PDF")));return s.div({className:a("").toString(),style:this.props.style},s.div({className:a("body").toString()},s.div({className:"panel panel-default "+a("preview").toString()},e),t))},PrintComponent}(v.Component);e.PrintComponent=b,e.default=b}}]);
//# sourceMappingURL=mp-print-0e8d8c2e7ae2c4f9d6e5.js.map