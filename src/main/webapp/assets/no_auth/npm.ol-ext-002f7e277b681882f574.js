(window.webpackJsonp=window.webpackJsonp||[]).push([[422],{2816:function(t,e,a){"use strict";a.r(e);var i=a(1546),r=a(1806),s=a(1732),n=a(1616),o=a(1548),u=a(1646),c=a(1919),ol_layer_AnimatedCluster=function(t){var e=t||{};r.default.call(this,e),this.oldcluster=new s.default,this.clusters=[],this.animation={start:!1},this.set("animationDuration","number"==typeof e.animationDuration?e.animationDuration:700),this.set("animationMethod",e.animationMethod||n.default.easeOut),this.getSource().on("change",this.saveCluster,this),this.on("precompose",this.animate,this),this.on("postcompose",this.postanimate,this)};i.default.inherits(ol_layer_AnimatedCluster,r.default),ol_layer_AnimatedCluster.prototype.saveCluster=function(){if(this.oldcluster.clear(),this.get("animationDuration")){var t=this.getSource().getFeatures();t.length&&t[0].get("features")&&(this.oldcluster.addFeatures(this.clusters),this.clusters=t.slice(0),this.sourceChanged=!0)}},ol_layer_AnimatedCluster.prototype.getClusterForFeature=function(t,e){for(var a=0;e[a];a++){var i=e[a].get("features");if(i&&i.length)for(var r,s=0;r=i[s];s++)if(t===r)return e[a]}return!1},ol_layer_AnimatedCluster.prototype.stopAnimation=function(){this.animation.start=!1,this.animation.cA=[],this.animation.cB=[]},ol_layer_AnimatedCluster.prototype.animate=function(t){var e=this.get("animationDuration");if(e){var a=t.frameState.viewState.resolution,i=this.animation,r=t.frameState.time;if(i.resolution!=a&&this.sourceChanged){var s=t.frameState.extent;i.resolution<a?(s=o.default.buffer(s,100*a),i.cA=this.oldcluster.getFeaturesInExtent(s),i.cB=this.getSource().getFeaturesInExtent(s),i.revers=!1):(s=o.default.buffer(s,100*a),i.cA=this.getSource().getFeaturesInExtent(s),i.cB=this.oldcluster.getFeaturesInExtent(s),i.revers=!0),i.clusters=[];for(var n,l=0;n=i.cA[l];l++){var h=n.get("features");if(h&&h.length)(d=this.getClusterForFeature(h[0],i.cB))&&i.clusters.push({f:n,pt:d.getGeometry().getCoordinates()})}if(i.resolution=a,this.sourceChanged=!1,!i.clusters.length||i.clusters.length>1e3)return void this.stopAnimation();r=i.start=(new Date).getTime()}if(i.start){var f=t.vectorContext,g=(r-i.start)/e;g>1&&(this.stopAnimation(),g=1),g=this.get("animationMethod")(g);var p=this.getStyle(),m="function"==typeof p?p:p.length?function(){return p}:function(){return[p]};t.context.save(),t.context.globalAlpha=this.getOpacity();var d,v=t.frameState.pixelRatio;for(l=0;d=i.clusters[l];l++){var x=d.f.getGeometry().getCoordinates(),y=x[0]-d.pt[0],S=x[1]-d.pt[1];i.revers?(x[0]=d.pt[0]+g*y,x[1]=d.pt[1]+g*S):(x[0]=x[0]-g*y,x[1]=x[1]-g*S);for(var w,F=m(d.f,a,!0),C=new u.default(x),A=0;w=F[A];A++){var b,D=!c.default.prototype.getFeaturesAtPixel&&w.getImage();D&&(b=D.getScale(),D.setScale(b*v)),f.setStyle?1!==d.f.get("features").length||y||S?(f.setStyle(w),f.drawGeometry(C)):f.drawFeature(d.f.get("features")[0],w):(f.setImageStyle(D),f.setTextStyle(w.getText()),f.drawPointGeometry(C)),D&&D.setScale(b)}}t.context.restore(),t.frameState.animate=!0,t.context.save(),t.context.beginPath(),t.context.rect(0,0,0,0),t.context.clip(),this.clip_=!0}}},ol_layer_AnimatedCluster.prototype.postanimate=function(t){this.clip_&&(t.context.restore(),this.clip_=!1)},e.default=ol_layer_AnimatedCluster}}]);
//# sourceMappingURL=npm.ol-ext-002f7e277b681882f574.js.map