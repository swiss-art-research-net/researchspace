(window.webpackJsonp=window.webpackJsonp||[]).push([[466],{1531:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),a=n(43),i=n(19),r=n(1),s=n(34),d=n(56),c=n(36),l=n(23),u=n(216),p=n(1211),f=n(121),m=n(1562),v=n(116),g=n(117),h=n(327),A=n(1852),y=n(3412),T=n(3413),E=n(3414),S=n(1307),_=n(1537),N=function(t){function TextAnnotationWorkspace(e,n){var r=t.call(this,e,n)||this;return r.cancellation=new s.Cancellation,r.persistingAnnotation=new s.Cancellation,r.onEditorStateChange=function(t){r.setState({editorState:t})},r.onHighlightAnnotations=function(t){r.setState({highlightedAnnotations:t})},r.onFocusAnnotation=function(t){r.setState({focusedAnnotation:t})},r.onBeginAddingAnnotation=function(){r.setState((function(t){return{editorState:r.state.editorState.updateAnnotation(A.PLACEHOLDER_ANNOTATION,(function(t){return o.__assign(o.__assign({},t),{iri:A.ANNOTATION_TO_DELETE})})).addAnnotation(A.PLACEHOLDER_ANNOTATION).deleteAnnotation(A.ANNOTATION_TO_DELETE),editedAnnotation:A.PLACEHOLDER_ANNOTATION,focusedAnnotation:A.PLACEHOLDER_ANNOTATION,highlightedAnnotations:new Set([A.PLACEHOLDER_ANNOTATION.value])}}),(function(){r.showOrHideAnnotationEditorModal()}))},r.onBeginEditingAnnotation=function(t){r.resetEditedAnnotation(t)},r.onCancelEditingAnnotation=function(){r.state.editedAnnotation&&r.resetEditedAnnotation(void 0)},r.resetEditedAnnotation=function(t){r.setState((function(e){var n=e.editorState,o=e.editedAnnotation,a=A.sameIri(o,A.PLACEHOLDER_ANNOTATION)?n.deleteAnnotation(A.PLACEHOLDER_ANNOTATION):n,i=new Set;return t&&i.add(t.value),{editorState:a,editedAnnotation:t,focusedAnnotation:t,highlightedAnnotations:i}}),(function(){r.showOrHideAnnotationEditorModal()}))},r.onPersistAnnotation=function(t,e,n){r.persistingAnnotation.cancelAll(),r.persistingAnnotation=new s.Cancellation;var a=l.Rdf.iri(r.props.documentIri),d=n.subject;if(!t)return i.constantError(new Error("Failed to find annotation to persist"));var c=r.state.editorState.annotations.find((function(e){return e.iri.equals(t)})),u=c.selector,p=c.selectedText,f="range"===u.type?A.createRangeTarget({source:a,selector:u,selectedText:p}):A.createPointTarget({source:a,selector:u}),g=A.createProvenanceEvent({source:a,userIri:r.state.permissions.userIri,modifiedAt:A.getCurrentDateTime()}),h=n;return h=A.addField(h,A.OAHasTarget,[f]),h=A.addField(h,A.CrmdigL48iWasAnnotationCreatedBy,[g]),r.persistingAnnotation.map(r.getPersistence().persist(m.FieldValue.empty,h)).map((function(){r.setState((function(n){return{editorState:n.editorState.updateAnnotation(t,(function(t){return o.__assign(o.__assign({},t),{iri:d,bodyType:e,renderVersion:(t.renderVersion||0)+1})})),editedAnnotation:A.sameIri(n.editedAnnotation,t)?void 0:n.editedAnnotation,highlightedAnnotations:new Set}}),(function(){r.showOrHideAnnotationEditorModal()}))})).mapErrors((function(t){return v.addNotification({level:"error",message:"Failed to create annotation"},t),t}))},r.onDeleteAnnotation=function(t){if(!r.state.editorState.annotations.find((function(e){return e.iri.equals(t)})))return i.constant(void 0);var e={type:"composite",subject:t,definitions:a.Map(),fields:a.Map(),errors:m.FieldError.noErrors},n=r.getPersistence().persist(e,m.FieldValue.empty).map((function(){var e=r.state.editorState.deleteAnnotation(t);r.setState({editorState:e})}));return n.observe({error:function(t){v.addNotification({level:"error",message:"Failed to delete annotation"},t)}}),n},r.handlers={highlightAnnotations:r.onHighlightAnnotations,focusAnnotation:r.onFocusAnnotation,beginAddingAnnotation:r.onBeginAddingAnnotation,beginEditingAnnotation:r.onBeginEditingAnnotation,cancelEditingAnnotation:r.onCancelEditingAnnotation,persistAnnotation:r.onPersistAnnotation,deleteAnnotation:r.onDeleteAnnotation},r.state={loadingDocument:!0,highlightedAnnotations:new Set},r}return o.__extends(TextAnnotationWorkspace,t),TextAnnotationWorkspace.prototype.getFileManager=function(){var t=this.context.semanticContext.repository;return new p.FileManager({repository:t})},TextAnnotationWorkspace.prototype.componentDidMount=function(){var t=this;if("string"!=typeof this.props.annotationTooltip)throw new Error("Missing required property 'annotation-tooltip'");var e=function extractAnnotationTypes(t){var e=new Map;return r.Children.forEach(t,(function(t){var n=S.extractAnnotationType(t);e.set(n.iri.value,n)})),e}(this.props.children);this.setState({annotationTypes:e});var n,o,a,s,d=l.Rdf.iri(this.props.documentIri);this.cancellation.map(i.combine({document:this.fetchDocument(d),annotations:A.fetchAnnotations(d,this.context.semanticContext,(s=e,function(t){for(var e=0,n=t;e<n.length;e++){var o=n[e];if(s.has(o.value))return o}})),permissions:(n={container:u.VocabPlatform.FormContainer},o=n.container,a=void 0===o?u.VocabPlatform.FormContainer:o,i.combine({userIri:i.fromPromise(f.Util.getUser()).map((function(t){return l.Rdf.iri(t.userURI)})).flatMapErrors((function(){return i.constant(void 0)})),formCreate:f.Util.isPermitted("forms:ldp:create"),formUpdate:f.Util.isPermitted("forms:ldp:update"),formDelete:f.Util.isPermitted("forms:ldp:delete"),ldpCreate:f.Util.isPermitted(f.Permissions.toLdp("container",a,"create","any")),ldpUpdateAny:f.Util.isPermitted(f.Permissions.toLdp("container",a,"update","any")),ldpUpdateOwner:f.Util.isPermitted(f.Permissions.toLdp("container",a,"update","owner")),ldpDeleteAny:f.Util.isPermitted(f.Permissions.toLdp("container",a,"delete","any")),ldpDeleteOwner:f.Util.isPermitted(f.Permissions.toLdp("container",a,"delete","owner"))},(function(t){return{userIri:t.userIri,create:t.formCreate&&t.ldpCreate,updateOwner:t.formUpdate&&t.ldpUpdateOwner,updateAny:t.formUpdate&&t.ldpUpdateAny,deleteOwner:t.formDelete&&t.ldpDeleteOwner,deleteAny:t.formDelete&&t.ldpDeleteAny}})).toProperty())})).observe({value:function(e){var n=e.document,o=e.annotations,a=e.permissions;t.setState({loadingDocument:!1,permissions:a,editorState:E.makeIntitialEditorState({sourceHtml:n,annotations:o})})},error:function(e){return t.setState({loadingDocument:!1,loadingError:e})}})},TextAnnotationWorkspace.prototype.fetchDocument=function(t){var e=this;return this.getFileManager().getFileResource(t).flatMap((function(t){var n=p.FileManager.getFileUrl(t.fileName,e.props.storage);return s.requestAsProperty(c.get(n).accept("text/html"))})).map((function(t){return t.text})).toProperty()},TextAnnotationWorkspace.prototype.componentWillUnmount=function(){this.cancellation.cancelAll(),this.persistingAnnotation.cancelAll()},TextAnnotationWorkspace.prototype.render=function(){var t=l.Rdf.iri(this.props.documentIri),e=this.state,n=e.annotationTypes,o=e.loadingDocument,a=e.loadingError;if(!n||o)return r.createElement(h.Spinner,{spinnerDelay:0});if(a)return r.createElement(v.ErrorNotification,{title:"Error loading document "+t,errorMessage:a});var i=this.state,s=i.permissions,d=i.editorState,c=i.highlightedAnnotations,u=i.focusedAnnotation;return r.createElement("div",{className:_.component},r.createElement(E.TextAnnotationEditor,{className:_.editorPanel,editorState:d,onEditorStateChange:this.onEditorStateChange,annotationTypes:n,tooltipTemplate:this.props.annotationTooltip,permissions:s,handlers:this.handlers}),r.createElement(T.AnnotationSidebar,{className:_.annotationsPanel,annotationTypes:n,fallbackTemplate:this.props.fallbackTemplate,annotations:d.annotations,highlightedAnnotations:c,focusedAnnotation:u,permissions:s,handlers:this.handlers}))},TextAnnotationWorkspace.prototype.showOrHideAnnotationEditorModal=function(){var t=this.state.editedAnnotation;if(t){var e=this.state.editorState.annotations.find((function(e){return A.sameIri(e.iri,t)}));g.getOverlaySystem().show("rs-text-annotation-workspace",r.createElement(g.OverlayDialog,{show:!0,title:t.equals(A.PLACEHOLDER_ANNOTATION)?"New annotation":"Edit annotation",onHide:this.handlers.cancelEditingAnnotation},r.createElement(y.AnnotationEditForm,{subject:t,subjectTemplate:this.props.annotationSubjectTemplate,selectedText:e?e.selectedText:void 0,annotationBodyType:e?e.bodyType:void 0,annotationTypes:this.state.annotationTypes,handlers:this.handlers})))}else g.getOverlaySystem().hide("rs-text-annotation-workspace")},TextAnnotationWorkspace.prototype.getPersistence=function(){var t=this.context.semanticContext;return new m.LdpPersistence({type:"ldp",repository:t.repository})},TextAnnotationWorkspace.defaultProps={fallbackTemplate:"<div>Unknown type for annotation: {{iri.value}}</div>"},TextAnnotationWorkspace}(d.Component);e.TextAnnotationWorkspace=N,e.default=N},1852:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),a=n(43),i=n(19),r=n(10),s=n(23),d=n(1223),c=n(61),l=n(118),u=n(1562),p=n(1624),f=n(3411),m=s.vocabularies.oa,v=s.vocabularies.rdf,g=s.vocabularies.xsd,h=s.vocabularies.VocabPlatform;function createDirectField(t,e){return u.normalizeFieldDefinition(o.__assign(o.__assign({},e),{selectPattern:c.SparqlUtil.serializeQuery(c.SparqlClient.setBindings(c.SparqlUtil.parseQuery("SELECT $value WHERE { $subject ?predicate $value }"),{predicate:t})),insertPattern:c.SparqlUtil.serializeQuery(c.SparqlClient.setBindings(c.SparqlUtil.parseQuery("INSERT { $subject ?predicate $value } WHERE {}"),{predicate:t})),deletePattern:c.SparqlUtil.serializeQuery(c.SparqlClient.setBindings(c.SparqlUtil.parseQuery("DELETE { $subject ?predicate $value } WHERE {}"),{predicate:t}))}))}function makeSelector(t,n,o){var a=valueFromRdf(s.Rdf.literal(o.toString(),g.nonNegativeInteger));return makeComposite(t,"xpath-{{UUID}}",[{def:e.RdfType,value:valueFromRdf(m.XPathSelector)},{def:e.RdfValue,value:valueFromRdf(s.Rdf.literal(n))},{def:e.OARefinedBy,value:makeComposite(t,"offset-{{UUID}}",[{def:e.RdfType,value:valueFromRdf(m.TextPositionSelector)},{def:e.OAStart,value:a},{def:e.OAEnd,value:a}])}])}function makeComposite(t,e,n){var o={type:u.CompositeValue.type,definitions:a.Map(n.map((function(t){return[t.def.id,t.def]}))),subject:s.Rdf.iri(""),fields:a.Map(n.map((function(t){var e={values:a.List(Array.isArray(t.value)?t.value:[t.value]),errors:u.FieldError.noErrors};return[t.def.id,e]}))),errors:u.FieldError.noErrors};return u.CompositeValue.set(o,{subject:u.generateSubjectByTemplate(e,t,o)})}function valueFromRdf(t){return u.FieldValue.fromLabeled({value:t})}e.OAHasTarget=createDirectField(m.hasTarget,{id:"oaHasTarget",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAHasBody=createDirectField(m.hasBody,{id:"oaHasBody",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAHasSelector=createDirectField(m.hasSelector,{id:"oaHasSelector",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAHasSource=createDirectField(m.hasSource,{id:"oaHasSource",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAHasStartSelector=createDirectField(m.hasStartSelector,{id:"oaHasStartSelector",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAHasEndSelector=createDirectField(m.hasEndSelector,{id:"oaHasEndSelector",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OARefinedBy=createDirectField(m.refinedBy,{id:"oaRefinedBy",minOccurs:1,maxOccurs:1,xsdDatatype:g.anyURI}),e.OAStart=createDirectField(m.start,{id:"oaStart",minOccurs:1,maxOccurs:1,xsdDatatype:g.nonNegativeInteger}),e.OAEnd=createDirectField(m.end,{id:"oaEnd",minOccurs:1,maxOccurs:1,xsdDatatype:g.nonNegativeInteger}),e.RdfType=createDirectField(v.type,{id:"type",xsdDatatype:g.anyURI}),e.RdfValue=createDirectField(v.value,{id:"value"}),e.CrmdigL48iWasAnnotationCreatedBy=createDirectField(p.crmdig.L48i_was_annotation_created_by,{id:"createdBy"}),e.CrmP4HasTimeSpan=u.normalizeFieldDefinition({id:"modifiedAt",xsdDatatype:g.dateTime,selectPattern:"\n    PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n    SELECT $value WHERE {\n      $subject crm:P4_has_time_span ?span.\n      ?span crm:P81a_end_of_the_begin $value.\n    }\n  ",insertPattern:'\n    PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n    INSERT {\n      $subject crm:P4_has_time_span ?span.\n      ?span crm:P81a_end_of_the_begin $value.\n      ?span crm:P81b_begin_of_the_end $value.\n    } WHERE {\n      BIND(IRI(CONCAT(STR($subject), "/modifiedAt")) as ?span)\n    }\n  ',deletePattern:"\n    PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>\n    DELETE {\n      $subject crm:P4_has_time_span ?span.\n      ?span crm:P81a_end_of_the_begin $value.\n      ?span crm:P81b_begin_of_the_end $value.\n    } WHERE {\n      $subject crm:P4_has_time_span ?span.\n      ?span crm:P81a_end_of_the_begin $value.\n    }\n  "}),e.CrmP14CarriedOutBy=createDirectField(p.crm.P14_carried_out_by,{id:"author",xsdDatatype:g.anyURI}),e.createRangeTarget=function createRangeTarget(t){var n=t.source,o=t.selector,a=t.selectedText;return makeComposite(t.source,"range-source-{{UUID}}",[{def:e.RdfType,value:valueFromRdf(m.SpecificResource)},{def:e.OAHasSource,value:valueFromRdf(n)},{def:e.RdfValue,value:"string"==typeof a?valueFromRdf(s.Rdf.literal(a)):[]},{def:e.OAHasSelector,value:makeComposite(t.source,"range-{{UUID}}",[{def:e.RdfType,value:valueFromRdf(m.RangeSelector)},{def:e.OAHasStartSelector,value:makeSelector(t.source,o.start.xPath,o.start.offset)},{def:e.OAHasEndSelector,value:makeSelector(t.source,o.end.xPath,o.end.offset)}])}])},e.createPointTarget=function createPointTarget(t){var n=t.source,o=t.selector;return makeComposite(t.source,"point-source-{{UUID}}",[{def:e.OAHasSource,value:valueFromRdf(n)},{def:e.OAHasSelector,value:makeSelector(t.source,o.xPath,o.offset)}])},e.createProvenanceEvent=function createProvenanceEvent(t){return makeComposite(t.source,"annotation-event-{{UUID}}",[{def:e.RdfType,value:valueFromRdf(p.crmdig.D30_Annotation_Event)},{def:e.CrmP4HasTimeSpan,value:valueFromRdf(t.modifiedAt)},{def:e.CrmP14CarriedOutBy,value:valueFromRdf(t.userIri)}])},e.getCurrentDateTime=function getCurrentDateTime(){return s.Rdf.literal(r.utc().format(),g.dateTime)},e.addField=function addField(t,e,n){return u.CompositeValue.set(t,{definitions:t.definitions.set(e.id,e),fields:t.fields.set(e.id,{values:a.List(n),errors:u.FieldError.noErrors})})},e.PLACEHOLDER_ANNOTATION=s.Rdf.iri(""),e.ANNOTATION_TO_DELETE=s.Rdf.iri("mp-text-annotation:to-delete");var A=c.SparqlUtil.parseQuery("PREFIX oa: <http://www.w3.org/ns/oa#>\nSELECT ?annotation WHERE {\n  ?annotation oa:hasTarget ?target .\n  ?target oa:hasSource ?__documentIri__ .\n}");e.fetchAnnotations=function fetchAnnotations(t,e,n){var o=c.SparqlClient.setBindings(A,{__documentIri__:t});return c.SparqlClient.select(o,{context:e}).flatMap((function(t){for(var o=[],a=0,r=t.results.bindings;a<r.length;a++){var c=r[a].annotation;c&&c.isIri()&&o.push(c)}return 0===o.length?i.constant([]):i.zip(o.map((function(t){return function fetchAnnotation(t,e,n){var o=e.repository,a=d.makeDocumentLoader({overrideContexts:{"https://www.w3.org/ns/anno.jsonld":f}});return new l.LdpService(h.FormContainer.value,{repository:o}).getResourceRequest(t.value+"/container","text/turtle").flatMap((function(t){return d.fromRdf(t,{documentLoader:a,format:"text/turtle",useNativeTypes:!0})})).flatMap((function(t){return d.frame(t,y,{documentLoader:a})})).map((function(e){var o,a=e["@graph"][0],i=a.target.selector,r=a.body.type?Array.isArray(a.body.type)?a.body.type:[a.body.type]:[];return{iri:t,selector:"RangeSelector"===i.type?(o=i,{type:"range",start:extractPointSelector(o.startSelector),end:extractPointSelector(o.endSelector)}):extractPointSelector(i),selectedText:"string"==typeof a.target.value?a.target.value:void 0,bodyType:n(r.map(s.Rdf.iri)),author:"string"==typeof a.carriedOutBy?s.Rdf.iri(a.carriedOutBy):void 0}})).toProperty()}(t,e,n)})))})).toProperty()};var y={"@context":"https://www.w3.org/ns/anno.jsonld","@type":"Annotation",target:{source:{"@embed":"@always"},selector:{}}};function extractPointSelector(t){return{type:"point",xPath:t.value,offset:Number(t.refinedBy.start)}}e.sameIri=function sameIri(t,e){return t&&e&&t.equals(e)||!t&&!e},e.mapIriToColor=function mapIriToColor(t){if(!t||!t.value)return"rgb(52, 152, 219)";var e=Math.abs(function hashFnv32a(t,e){void 0===e&&(e=2166136261);var n,o,a=2147483647&e;for(n=0,o=t.length;n<o;n++)a^=t.charCodeAt(n),a+=(a<<1)+(a<<4)+(a<<7)+(a<<8)+(a<<24);return a>>>0}(t.value)),n=Math.floor(e*(Math.pow(2,24)/Math.pow(2,31)));return"rgb("+(n>>16&255)+","+(n>>8&255)+","+(n>>0&255)+")"}},2366:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(1591),a=n(1852);!function(t){function getAccentColor(t,e){void 0===e&&(e=1);var n=t&&t.color?t.color:a.mapIriToColor(t?t.iri:void 0);if(1===e)return n;var i=o.rgb(n);return i.opacity=e,i.toString()}t.getAccentColor=getAccentColor,t.compute=function compute(t,e,n){var o=t.author&&a.sameIri(n.userIri,t.author),i=o?n.updateOwner:n.updateAny,r=o?n.deleteOwner:n.deleteAny;return{iri:t.iri,type:e?e.iri:void 0,color:getAccentColor(e),iconUrl:e?e.iconUrl:void 0,allowEdit:i,allowDelete:r}}}(e.TextAnnotationTemplateBindings||(e.TextAnnotationTemplateBindings={}))},2393:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o,a,i=n(11),r=n(43),s=n(16),d=n(1609);function getPointFromNodeOffset(t,e,n){var o,a=0,i=t.getTexts().find((function(t,n,i){return a+=t.text.length,o=t,a>e}));return e===a&&(i=o),i?d.Point.create({key:i.key,path:n[i.key],offset:e-a+i.text.length}):void 0}function addMarksAtRange(t,e,n,o,a){return t.getTextsAtRange(n).reduce((function(t,i){var r=e[i.key];if(n.start.isInNode(i)||n.end.isInNode(i)){var s=n.start.isInNode(i)?n.start.offset:0,c=n.end.isInNode(i)?n.end.offset:i.text.length;return t.addMark(r,s,c-s,d.Mark.create({type:o,data:a}))}var l=d.Point.create({path:r,offset:0});return t.addMark(r,l.offset,l.moveToEndOfNode(i).offset-l.offset,d.Mark.create({type:o,data:a}))}),t)}function insertInlineAtPoint(t,e,n,o){var a=t.splitNode(e.path,e.offset,void 0),i=function incrementLastPathIndex(t){var e=t.size-1;return t.set(e,t.get(e)+1)}(e.path);return a.insertNode(i,d.Inline.create({type:n,data:o}))}function findAnnotationLevels(t){var n=new Map;function walkNode(t){if("text"===t.object)t.getLeaves().forEach(walkLeaf);else if("inline"===t.object&&t.type===e.ANNOTATION_POINT_TYPE){var a=o.get(t.data,"iri");n.set(a.value,{iri:a,level:void 0})}else!function walkNodes(t){t.forEach(walkNode)}(t.nodes)}function walkLeaf(t){var a=[];t.marks.forEach((function(t){if(t.type===e.ANNOTATION_RANGE_TYPE){var i=o.get(t.data,"iri"),r=n.get(i.value);r&&(a[r.level]=!0)}})),t.marks.forEach((function(t){if(t.type===e.ANNOTATION_RANGE_TYPE){var i=o.get(t.data,"iri");if(!n.has(i.value)){var r=function findUnoccupiedLevel(t){for(var e=0;e<t.length;e++)if(!t[e])return e;return t.length}(a);a[r]=!0,n.set(i.value,{iri:i,level:r})}}}))}return walkNode(t),n}function mapAnnotations(t,n){findAnnotationLevels(t);function mapLeaf(t){var o=t;return t.marks.forEach((function(t){if(t.type===e.ANNOTATION_RANGE_TYPE){var a=n(t.data);null===a?o=o.removeMark(t):a!==t.data&&(o=o.updateMark(t,d.Mark.create({type:e.ANNOTATION_RANGE_TYPE,data:a})))}})),o}return function mapNode(t){if("text"===t.object){var o=t.getLeaves().map(mapLeaf);return t.setLeaves(o)}if("inline"===t.object&&t.type===e.ANNOTATION_POINT_TYPE){var a=n(t.data);return null===a?null:a===t.data?t:t.set("data",a)}if(t.nodes.size>0){var i=t.nodes.map(mapNode).filter((function(t){return null!==t}));return t.set("nodes",i)}return t}(t)}e.ANNOTATION_RANGE_TYPE="rs-annotation-range",e.ANNOTATION_POINT_TYPE="rs-annotation-point",function(t){function create(t){return r.Map(i.__assign({},t))}function asProps(t){return t.toObject()}t.create=create,t.set=function set(t,e){return create(i.__assign(i.__assign({},asProps(t)),e))},t.asProps=asProps,t.get=function get(t,e){return t.get(e)}}(o=e.AnnotationData||(e.AnnotationData={})),function(t){t.create=function create(t){return r.Map(t)},t.asProps=function asProps(t){return t.toObject()},t.get=function get(t,e){return t.get(e)},t.set=function set(t,e,n){return t.set(e,n)}}(a=e.NodeData||(e.NodeData={})),e.assignXPaths=function assignXPaths(t){function assingXPathToNodes(t,e){var n=function makeChildIndexTracker(){var t=new Map;return function(e){var n=(t.has(e)?t.get(e):0)+1;return t.set(e,n),n}}();return t.map((function(t,o){return"block"===t.object||"inline"===t.object?function assingXPathToNode(t,e){var n=t;return n=(n=n.set("data",a.set(t.data,"xpath",e))).set("nodes",assingXPathToNodes(n.nodes,e))}(t,e+"/"+t.type+"["+n(t.type)+"]"):t}))}var e=assingXPathToNodes(t.nodes,"");return d.Document.create({nodes:e})},e.mergeInAnnotations=function mergeInAnnotations(t,n){var i=function findNodeXPaths(t){var e=new Map,n=new Map;function walkNode(t){if("block"===t.object||"inline"===t.object){var o=a.get(t.data,"xpath");o&&(e.set(o,t),n.set(o,n.size))}"text"!==t.object&&t.nodes.forEach(walkNode)}return walkNode(t),{xpathToNode:e,xpathOrder:n}}(t),r=i.xpathToNode,c=i.xpathOrder,l=t.getKeysToPathsTable(),u=n.reduce((function(t,n){var a=n.iri,i=n.selector,s=n.bodyType;if("range"===i.type){var c=function getRangeFromSelector(t,e,n){var o=e.get(t.start.xPath),a=e.get(t.end.xPath);if(o&&a){var i=getPointFromNodeOffset(o,t.start.offset,n),r=getPointFromNodeOffset(a,t.end.offset,n);if(i&&r)return d.Range.create({focus:i,anchor:r})}return}(i,r,l);if(c)return addMarksAtRange(t,l,c,e.ANNOTATION_RANGE_TYPE,o.create({iri:a,bodyType:s}));console.warn("Cannot find annotation target in the document: ",i)}return t}),t);return u=s.sortBy(n.filter((function(t){return"point"===t.selector.type})),(function(t){var e=t.selector.xPath;return-c.get(e)})).reduce((function(t,n){var a=n.iri,i=n.selector,s=n.bodyType,d=i,c=d.xPath,u=d.offset,p=r.get(c);return p?insertInlineAtPoint(t,getPointFromNodeOffset(p,u,l),e.ANNOTATION_POINT_TYPE,o.create({iri:a,bodyType:s})):(console.warn("Cannot find annotation target in the document: ",i),t)}),u)},e.addMarksAtRange=addMarksAtRange,e.insertInlineAtPoint=insertInlineAtPoint,e.updateAnnotationLevels=function updateAnnotationLevels(t){var e=findAnnotationLevels(t);return mapAnnotations(t,(function(t){var n=o.get(t,"iri"),a=e.get(n.value);return a&&"number"==typeof a.level?o.set(t,{level:a.level}):t}))},e.highlightAnnotations=function highlightAnnotations(t,e){return mapAnnotations(t,(function(t){var n=o.get(t,"iri"),a=o.get(t,"highlighted"),i=e.has(n.value);return i===Boolean(a)?t:o.set(t,{highlighted:i})}))},e.deleteAnnotation=function deleteAnnotation(t,e){return mapAnnotations(t,(function(t){return o.get(t,"iri").equals(e)?null:t}))},e.createDecorationsForRange=function createDecorationsForRange(t,e,n){return t.getTextsAtRange(e).map((function(o){if(e.start.isInNode(o)||e.end.isInNode(o))return d.Decoration.create({anchor:e.start.isInNode(o)?e.start:e.start.moveToStartOfNode(o).normalize(t),focus:e.end.isInNode(o)?e.end:e.end.moveToEndOfNode(o).normalize(t),mark:d.Mark.create({type:n})});var a=t.getPath(o.key),i=d.Point.create({key:o.key,path:a,offset:0});return d.Decoration.create({anchor:i,focus:i.moveToEndOfNode(o).normalize(t),mark:d.Mark.create({type:n})})}))},e.setValueProps=function setValueProps(t,e){var n=e.document,o=void 0===n?t.document:n,a=e.selection,i=void 0===a?t.selection:a,r=e.decorations,s=void 0===r?t.decorations:r;return d.Value.create({document:o,selection:i,decorations:s})},e.sortAnnotationsByFirstOccurence=function sortAnnotationsByFirstOccurence(t,e){var n=new Map;mapAnnotations(t,(function(t){return n.set(o.get(t,"iri").value,n.size),t}));var a=i.__spreadArrays(e);return a.sort((function(t,e){var o=n.get(t.iri.value),a=n.get(e.iri.value);return o<a?-1:o>a?1:0})),a},e.updateAnnotation=function updateAnnotation(t,e,n){return mapAnnotations(t,(function(t){return o.get(t,"iri").equals(e)?o.set(t,{iri:n.iri,bodyType:n.bodyType}):t}))},e.extractTextFragment=function extractTextFragment(t,e){return t.getFragmentAtRange(e).getBlocks().map((function(t){return t.text})).join(" ")}},3411:function(t){t.exports=JSON.parse('{"@context":{"oa":"http://www.w3.org/ns/oa#","rdf":"http://www.w3.org/1999/02/22-rdf-syntax-ns#","rdfs":"http://www.w3.org/2000/01/rdf-schema#","xsd":"http://www.w3.org/2001/XMLSchema#","crm":"http://www.cidoc-crm.org/cidoc-crm/","crmdig":"http://www.ics.forth.gr/isl/CRMdig/","id":{"@type":"@id","@id":"@id"},"type":{"@type":"@id","@id":"@type"},"label":"rdfs:label","value":"rdf:value","Annotation":"oa:Annotation","SpecificResource":"oa:SpecificResource","RangeSelector":"oa:RangeSelector","XPathSelector":"oa:XPathSelector","TextPositionSelector":"oa:TextPositionSelector","D30_Annotation_Event":"crmdig:D30_Annotation_Event","body":{"@type":"@id","@id":"oa:hasBody"},"target":{"@type":"@id","@id":"oa:hasTarget"},"source":{"@type":"@id","@id":"oa:hasSource"},"selector":{"@type":"@id","@id":"oa:hasSelector"},"refinedBy":{"@type":"@id","@id":"oa:refinedBy"},"startSelector":{"@type":"@id","@id":"oa:hasStartSelector"},"endSelector":{"@type":"@id","@id":"oa:hasEndSelector"},"start":{"@id":"oa:start","@type":"xsd:nonNegativeInteger"},"end":{"@id":"oa:end","@type":"xsd:nonNegativeInteger"},"createdBy":{"@type":"@id","@id":"crmdig:L48i_was_annotation_created_by"},"carriedOutBy":{"@type":"@id","@id":"crm:P14_carried_out_by"},"timeSpan":{"@type":"@id","@id":"crm:P4_has_time_span"},"endOfBegin":{"@type":"xsd:dateTime","@id":"crm:P81a_end_of_the_begin"},"beginOfEnd":{"@type":"xsd:dateTime","@id":"crm:P81b_begin_of_the_end"}}}')},3412:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),a=n(19),i=n(1),r=n(1559),s=n(56),d=n(23).vocabularies.oa,c=n(1562),l=n(1624),u=n(1852),p=n(1532),f=function(t){function AnnotationEditForm(e,n){var o=t.call(this,e,n)||this;return o.state={formKey:0,selectedBodyType:o.props.annotationBodyType},o}return o.__extends(AnnotationEditForm,t),AnnotationEditForm.prototype.componentWillReceiveProps=function(t){u.sameIri(this.props.annotationBodyType,t.annotationBodyType)||this.setState((function(e){return{formKey:e.formKey+1,selectedBodyType:t.annotationBodyType}}))},AnnotationEditForm.prototype.render=function(){var t=this.props,e=t.subject,n=t.subjectTemplate,o=t.annotationTypes,r=t.handlers,s=this.state,f=s.formKey,m=s.selectedBodyType,v=m?o.get(m.value):void 0;return i.createElement(c.ResourceEditorForm,{key:f,fields:AnnotationEditForm.FIELDS,subject:e,newSubjectTemplate:n,postAction:"none",persistence:{persist:function(t,n){return m?c.FieldValue.isEmpty(n)?a.constant(void 0):r.persistAnnotation(e,m,n):a.constantError(new Error("Missing annotation type"))},remove:function(t){}}},i.createElement("div",{className:p.formContent},this.props.selectedText?i.createElement("div",{className:p.selectedFragment},"Selected fragment:",i.createElement("div",{className:p.selectedFragmentText},this.props.selectedText)):null,this.renderBodyTypeSelector(),i.createElement(c.HiddenInput,{for:u.RdfType.id,defaultValues:[d.Annotation.value,l.crmdig.D29_Annotation_Object.value]}),i.createElement("div",{className:p.bodyInput},v?i.cloneElement(v.input,{renderHeader:!1}):null)),i.createElement("button",{name:"submit",className:"btn btn-primary"},u.sameIri(e,u.PLACEHOLDER_ANNOTATION)?"Create annotation":"Update annotation"),i.createElement("button",{className:"btn btn-default "+p.cancelButton,onClick:r.cancelEditingAnnotation},"Cancel"))},AnnotationEditForm.prototype.renderBodyTypeSelector=function(){var t=this,e=this.props.annotationTypes,n=this.state.selectedBodyType,o=[];e.forEach((function(t){o.push({type:t,value:t.iri.value,label:t.label})}));var optionRenderer=function(t){var e=t.type;return i.createElement("div",null,e.iconUrl?i.createElement("img",{className:p.bodyTypeIcon,src:e.iconUrl}):null,e.label)};return i.createElement(r.default,{clearable:!1,placeholder:"Select annotation type...",value:n?n.value:void 0,options:o,optionRenderer,valueRenderer:optionRenderer,onChange:function(n){if(!Array.isArray(n)&&"string"==typeof n.value){var o=e.get(n.value);t.setState((function(t){return{formKey:t.formKey+1,selectedBodyType:o.iri}}))}}})},AnnotationEditForm.FIELDS=[u.RdfType,u.OAHasBody],AnnotationEditForm}(s.Component);e.AnnotationEditForm=f},3413:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),a=n(7),i=n(1),r=n(72),s=n(56),d=n(23),c=n(630),l=n(1852),u=n(2366),p=n(1533),f=function(t){function AnnotationSidebar(e,n){var o=t.call(this,e,n)||this;return o.onAnnotationListMount=function(t){o.annotationList=t},o.onSelectTab=function(t){o.setState({selectedTab:t})},o.onClickInsideAnnotation=function(t){var e=o.props.handlers,n=t.target;if(n instanceof HTMLButtonElement){var a=n.getAttribute("data-annotation");a&&("edit"===n.name?e.beginEditingAnnotation(d.Rdf.iri(a)):"delete"===n.name&&e.deleteAnnotation(d.Rdf.iri(a)))}},o.state={selectedTab:"all"},o}return o.__extends(AnnotationSidebar,t),AnnotationSidebar.prototype.componentDidUpdate=function(t){var e=this.props.focusedAnnotation;e&&!l.sameIri(e,t.focusedAnnotation)&&this.scrollAnnotationIntoView(e)},AnnotationSidebar.prototype.render=function(){var t=this,e=this.props,n=e.className,o=e.annotationTypes,s=e.annotations,d=e.focusedAnnotation,c=e.highlightedAnnotations,u=this.state.selectedTab;return i.createElement("div",{className:a(p.component,n)},i.createElement(r.Tab.Container,{id:"rs-text-annotation-types",activeKey:u,onSelect:this.onSelectTab},i.createElement(r.Nav,{bsStyle:"tabs"},i.createElement(r.NavItem,{eventKey:"all",title:"All annotations"},"all"),Array.from(o.values(),(function(t){var e=function countAnnotationForTab(t,e){if("all"===e)return t.length;for(var n=0,o=0,a=t;o<a.length;o++){var i=a[o];i.bodyType&&i.bodyType.value===e&&n++}return n}(s,t.iri.value);return i.createElement(r.NavItem,{key:t.iri.value,eventKey:t.iri.value,disabled:0===e,title:t.label},i.createElement("div",{className:p.tabHeader},t.iconUrl?i.createElement("img",{className:p.tabIcon,src:t.iconUrl}):i.createElement("span",null,t.label)))})))),i.createElement("div",{className:p.annotationList,ref:this.onAnnotationListMount},s.map((function(e){return t.renderAnnotation(e,{hidden:(n=e,o=u,!("all"===o||n.bodyType&&n.bodyType.value===o)),focused:l.sameIri(e.iri,d),highlighted:0===c.size||c.has(e.iri.value)});var n,o}))))},AnnotationSidebar.prototype.renderAnnotation=function(t,e){var n,o=this.props,r=o.annotationTypes,s=o.fallbackTemplate,d=o.permissions,f=l.sameIri(t.iri,l.PLACEHOLDER_ANNOTATION),v=t.bodyType,g=v?r.get(v.value):void 0,h=a(p.annotation,((n={})[p.focused]=e.focused,n[p.highlighted]=e.highlighted,n));return i.createElement("div",{key:t.iri.value,"data-annotation-iri":t.iri.value,className:h,style:e.hidden?{display:"none"}:void 0,onClick:this.onClickInsideAnnotation},f?i.createElement("div",{className:p.newAnnotationPlaceholder},"New annotation"):null,!f&&g?i.createElement(m,{markupTemplateScope:g.templateScope},i.createElement(c.TemplateItem,{key:t.renderVersion,template:{source:g.template,options:u.TextAnnotationTemplateBindings.compute(t,g,d)}})):null,f||g?null:i.createElement(c.TemplateItem,{template:{source:s,options:u.TextAnnotationTemplateBindings.compute(t,g,d)}}))},AnnotationSidebar.prototype.scrollAnnotationIntoView=function(t){if(this.annotationList)for(var e=this.annotationList.getBoundingClientRect(),n=this.annotationList.children,o=0;o<n.length;o++){var a=n[o];if(a.getAttribute("data-annotation-iri")===t.value){var i=a.getBoundingClientRect(),r=i.top-e.top,s=this.annotationList.scrollTop,d=s+e.height;(r<s||r+i.height>d)&&(this.annotationList.scrollTop=r)}}},AnnotationSidebar}(s.Component);e.AnnotationSidebar=f;var m=function(t){function TemplateScopeProvider(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(TemplateScopeProvider,t),TemplateScopeProvider.prototype.render=function(){return i.Children.only(this.props.children)},TemplateScopeProvider}(s.Component)},3414:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),a=n(7),i=n(19),r=n(1),s=n(72),d=n(1609),c=n(2389),l=n(34),u=n(56),p=n(23),f=n(630),m=n(1886),v=n(2366),g=n(2393),h=n(2393),A=n(3530),y=n(1536),T=new Set,E=function(t){function TextAnnotationEditor(e,n){var a=t.call(this,e,n)||this;return a.debounceTooltip=new l.Cancellation,a.onChange=function(t){var e=a.props,n=e.editorState;(0,e.onEditorStateChange)(n.set({value:t.value}))},a.onSidelineMount=function(t){a.sideline=t},a.onKeyDown=function(t,e,n){var o=t;if(!((o.ctrlKey||o.metaKey)&&67===o.keyCode))return t.preventDefault(),!0},a.onTextClick=function(t,e,n){a.props.handlers.focusAnnotation(void 0)},a.ignoreIfReadonly=function(t,e,n){return t.preventDefault(),!0},a.onEditorMount=function(t){a.editor=t},a.renderNode=function(t,e,n){var i=t.node,s=t.attributes,d=t.children;return A.BLOCK_TAGS[i.type]||A.INLINE_TAGS[i.type]?r.createElement(i.type,o.__assign(o.__assign({},g.NodeData.get(i.data,"attributes")),s),d):"inline"===i.object&&i.type===N.TAG_NAME?r.createElement(N,{inline:i,attributes:s,getAnnotationType:a.getAnnotationType,onClick:a.onClickAnnotation,onStartHovering:a.onStartHoveringAnnotation,onStopHovering:a.onStopHoveringAnnotation},d):n()},a.renderMark=function(t,e,n){var i=t.mark,s=t.marks,d=t.attributes,c=t.children;return A.MARK_TAGS[i.type]?r.createElement(i.type,o.__assign(o.__assign({},g.NodeData.get(i.data,"attributes")),d),c):i.type===_.TAG_NAME?r.createElement(_,{mark:i,marks:s,attributes:d,getAnnotationType:a.getAnnotationType,onClick:a.onClickAnnotation,onStartHovering:a.onStartHoveringAnnotation,onStopHovering:a.onStopHoveringAnnotation},c):n()},a.onSelect=function(t,e,n){n();var o=a.props.editorState;e.value.selection.equals(o.markedSelection)||(a.debounceTooltip.cancelAll(),a.debounceTooltip=new l.Cancellation,a.debounceTooltip.map(i.later(0,!0)).observe({value:function(){a.updateSelectionOffset(e)}}))},a.onAddAnnotationClick=function(){(0,a.props.handlers.beginAddingAnnotation)(),a.setState({selectionTopOffset:0})},a.getAnnotationType=function(t){if(t)return a.props.annotationTypes.get(t.value)},a.onClickAnnotation=function(t){a.props.handlers.focusAnnotation(g.AnnotationData.get(t,"iri"))},a.onStartHoveringAnnotation=function(t){var e=a.props,n=e.editorState,i=e.onEditorStateChange,r=e.handlers,s=new Set(t.iris.map((function(t){return t.value})));r.highlightAnnotations(s);var d=n.annotations.filter((function(t){return s.has(t.iri.value)})),c=h.highlightAnnotations(n.value.document,s);i(S.set(n,{value:h.setValueProps(n.value,{document:c}),tooltip:o.__assign(o.__assign({},t),{annotations:d})}))},a.onStopHoveringAnnotation=function(){var t=a.props,e=t.editorState,n=t.onEditorStateChange;t.handlers.highlightAnnotations(T);var i=h.highlightAnnotations(e.value.document,T),r=e;r.tooltip&&n(S.set(r,{value:h.setValueProps(e.value,{document:i}),tooltip:o.__assign(o.__assign({},r.tooltip),{hovering:!1})}))},a.onTooltipHide=function(){var t=a.props,e=t.editorState;(0,t.onEditorStateChange)(S.set(e,{tooltip:void 0}))},a.onTooltipClick=function(t){var e=a.props.handlers,n=t.target;if(n instanceof HTMLButtonElement){var o=n.getAttribute("data-annotation");o&&("edit"===n.name?e.beginEditingAnnotation(p.Rdf.iri(o)):"delete"===n.name&&e.deleteAnnotation(p.Rdf.iri(o)))}},a.state={},a}return o.__extends(TextAnnotationEditor,t),TextAnnotationEditor.prototype.componentDidMount=function(){var t=this.props,e=t.editorState;(0,t.onEditorStateChange)(S.set(e,{owner:this}))},TextAnnotationEditor.prototype.render=function(){var t=this.props,e=t.className,n=t.editorState,o=t.permissions,i=this.state.selectionTopOffset;return r.createElement("div",{className:a(y.component,e)},r.createElement("div",{className:y.textEditor},r.createElement(c.Editor,{ref:this.onEditorMount,spellCheck:!1,value:n.value,onChange:this.onChange,onKeyDown:this.onKeyDown,onClick:this.onTextClick,onDragStart:this.ignoreIfReadonly,onCut:this.ignoreIfReadonly,onPaste:this.ignoreIfReadonly,onSelect:this.onSelect,renderNode:this.renderNode,renderMark:this.renderMark}),r.createElement("div",{className:y.addAnnotationSideline,ref:this.onSidelineMount},o.create&&i>0?r.createElement(s.Button,{className:y.addAnnotationButton,style:{top:i},title:"Add annotation",onClick:this.onAddAnnotationClick},r.createElement("span",{className:y.addAnnotationIcon})):null)),this.renderTooltip())},TextAnnotationEditor.prototype.renderTooltip=function(){var t=this.props,e=t.editorState,n=t.tooltipTemplate,o=t.annotationTypes,a=t.permissions,i=e.tooltip;if(!i||!n)return null;var s=i.annotations.length>0?i.annotations[0]:void 0,d=s.bodyType?o.get(s.bodyType.value):void 0;return r.createElement("div",{style:{position:"fixed",left:0,top:0}},r.createElement(m.TargetedPopover,{key:i.left+";"+i.top,id:"text-annotation-editor-tooltip",hideTimeout:500,targetLeft:i.left,targetTop:i.top,popoverSide:"top",arrowAlignment:"center",onHide:i.hovering?void 0:this.onTooltipHide},r.createElement(f.TemplateItem,{componentProps:{onClick:this.onTooltipClick},template:{source:n,options:v.TextAnnotationTemplateBindings.compute(s,d,a)}})))},TextAnnotationEditor.prototype.updateSelectionOffset=function(t){if(this.sideline){var e=t.value.selection,n=e.start,o=e.end,a=d.Range.create({anchor:n,focus:o}),i=c.findDOMRange(a).getBoundingClientRect(),r=i.top+i.height/2-this.sideline.getBoundingClientRect().top;this.setState({selectionTopOffset:r})}},TextAnnotationEditor}(u.Component);e.TextAnnotationEditor=E;var S=function(){function EditorState(t){this.value=t.value,this.annotations=t.annotations,this.owner=t.owner,this.markedSelection=t.markedSelection,this.tooltip=t.tooltip}return EditorState.create=function(t){return new EditorState(t)},EditorState.set=function(t,e){var n={value:t.value,annotations:t.annotations,owner:t.owner,markedSelection:t.markedSelection,tooltip:t.tooltip};return new EditorState(o.__assign(o.__assign({},n),e))},EditorState.prototype.set=function(t){return EditorState.set(this,t)},EditorState.prototype.addAnnotation=function(t){var e,n,a,i=this.value,r=i.document,s=i.selection,c=s.start,l=s.end;if(s.isExpanded){var u=r.getKeysToPathsTable(),p=d.Range.create({anchor:s.start,focus:s.end});e=h.addMarksAtRange(r,u,p,g.ANNOTATION_RANGE_TYPE,g.AnnotationData.create({iri:t,bodyType:void 0})),n={type:"range",start:{type:"point",xPath:findXPathAt(r,c.path),offset:c.offset},end:{type:"point",xPath:findXPathAt(r,l.path),offset:l.offset}},a=h.extractTextFragment(r,p)}else e=h.insertInlineAtPoint(r,s.start,g.ANNOTATION_POINT_TYPE,g.AnnotationData.create({iri:t,bodyType:void 0})),n={type:"point",xPath:findXPathAt(r,c.path),offset:c.offset};var f={iri:t,selector:n,selectedText:a},m=h.sortAnnotationsByFirstOccurence(e,o.__spreadArrays(this.annotations,[f]));return EditorState.set(this,{value:h.setValueProps(this.value,{document:e}),annotations:m})},EditorState.prototype.updateAnnotation=function(t,e){var n,o=this.annotations.map((function(o){return o.iri.equals(t)?n=e(o):o}));if(!n)return this;var a=h.setValueProps(this.value,{document:h.updateAnnotation(this.value.document,t,n)});return EditorState.set(this,{value:a,annotations:o})},EditorState.prototype.deleteAnnotation=function(t){if(this.annotations.find((function(e){return e.iri.equals(t)}))){var e=h.setValueProps(this.value,{document:h.deleteAnnotation(this.value.document,t)}),n=this.annotations.filter((function(e){return!e.iri.equals(t)}));return EditorState.set(this,{value:e,annotations:n,tooltip:void 0})}return this},EditorState}();function findXPathAt(t,e){var n=t.getAncestors(e).last();if("block"!==n.object&&"inline"!==n.object)throw new Error("Unexpected parent node type: "+n.object);var o=g.NodeData.get(n.data,"xpath");if(!o)throw new Error("Failed to find XPath at selected node");return o}e.makeIntitialEditorState=function makeIntitialEditorState(t){var e=A.SLATE_HTML.deserialize(t.sourceHtml).document;e=h.assignXPaths(e),e=h.mergeInAnnotations(e,t.annotations),e=h.updateAnnotationLevels(e);var n=h.sortAnnotationsByFirstOccurence(e,t.annotations);return S.create({value:d.Value.create({document:e}),annotations:n})};var _=function(t){function AnnotationMark(){var e=null!==t&&t.apply(this,arguments)||this;return e.onClick=function(t){t.stopPropagation(),e.props.onClick(e.props.mark.data)},e.onMouseEnter=function(t){var n=t.currentTarget.getBoundingClientRect();e.props.onStartHovering({left:(n.left+n.right)/2,top:n.top,hovering:!0,iris:e.props.marks.filter((function(t){return t.type===g.ANNOTATION_RANGE_TYPE})).map((function(t){return g.AnnotationData.get(t.data,"iri")})).toArray()})},e.onMouseLeave=function(){e.props.onStopHovering()},e}return o.__extends(AnnotationMark,t),AnnotationMark.prototype.render=function(){var t=this.props,e=t.mark,n=t.children,a=t.attributes,i=t.getAnnotationType,s=g.AnnotationData.asProps(e.data),d=(s.iri,s.bodyType),c=s.level,l=s.highlighted,u=i(d);return r.createElement("span",o.__assign({},a,{onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{paddingBottom:1+3*("number"==typeof c?c:0),borderBottom:"2px solid",borderColor:v.TextAnnotationTemplateBindings.getAccentColor(u),backgroundColor:l?v.TextAnnotationTemplateBindings.getAccentColor(u,.3):void 0}}),n)},AnnotationMark.TAG_NAME="rs-annotation-range",AnnotationMark}(r.Component),N=function(t){function AnnotationInline(){var e=null!==t&&t.apply(this,arguments)||this;return e.onClick=function(t){t.stopPropagation(),e.props.onClick(e.props.inline.data)},e.onMouseEnter=function(t){var n=t.currentTarget.getBoundingClientRect();e.props.onStartHovering({left:(n.left+n.right)/2,top:n.top,hovering:!0,iris:[g.AnnotationData.get(e.props.inline.data,"iri")]})},e.onMouseLeave=function(){e.props.onStopHovering()},e}return o.__extends(AnnotationInline,t),AnnotationInline.prototype.render=function(){var t=this.props,e=t.inline,n=t.children,a=t.attributes,i=t.getAnnotationType,s=g.AnnotationData.asProps(e.data),d=(s.iri,s.highlighted),c=i(s.bodyType),l=v.TextAnnotationTemplateBindings.getAccentColor(c,d?1:.5),u=a.className?a.className+" "+y.pointAnnotation:y.pointAnnotation;return r.createElement("span",o.__assign({},a,{className:u,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{backgroundColor:l}}),n)},AnnotationInline.TAG_NAME="rs-annotation-point",AnnotationInline}(r.Component);e.default=E},3530:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o=n(2394),a=n(120);e.BLOCK_TAGS={blockquote:!0,div:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,p:!0,pre:!0,section:!0,table:!0,tbody:!0,td:!0,th:!0,thead:!0,tr:!0},e.INLINE_TAGS={span:!0},e.MARK_TAGS={a:!0,b:!0,code:!0,em:!0,i:!0,strong:!0,u:!0};var i=[{deserialize:function(t,n){if(t.nodeType===Node.TEXT_NODE&&t.textContent.match(/^\s*$/))return null;var o=t.tagName.toLowerCase(),a=e.BLOCK_TAGS[o];return a?{object:"block",type:"string"==typeof a?a:o,data:{attributes:getAttributesAsReactProps(t)},nodes:n(t.childNodes)}:void 0},serialize:function(t,e){throw new Error("block serialization is not supported")}},{deserialize:function(t,n){var o=t.tagName.toLowerCase(),a=e.MARK_TAGS[o];if(a)return{object:"mark",type:"string"==typeof a?a:o,data:{attributes:getAttributesAsReactProps(t)},nodes:n(t.childNodes)}},serialize:function(t,e){throw new Error("mark serialization is not supported")}}];function getAttributesAsReactProps(t){for(var e={},n=0;n<t.attributes.length;n++){var o=t.attributes.item(n),i="style"===o.name?a.ModuleRegistry.parseReactStyleFromCss(o.value):o.value;e[o.name]=i}return e}e.SLATE_HTML=new o.default({rules:i})}}]);
//# sourceMappingURL=rs-text-annotation-workspace-92e849f124701e5e41ba.js.map