(window.webpackJsonp=window.webpackJsonp||[]).push([[496],{1501:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),i=a(35),o=a(7),s=a(162),l=a(56),c=a(1738),u=a(1569),p=a(3344),d=a(3388),f=a(1851),h=function(e){function SemanticSearchFacet(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(SemanticSearchFacet,e),SemanticSearchFacet.prototype.render=function(){var e=this,t=this.context.semanticContext;return r.createElement(u.SemanticSearchContext.Consumer,null,(function(a){return r.createElement(g,n.__assign({},e.props,{context:n.__assign(n.__assign({},a),{semanticContext:t})}))}))},SemanticSearchFacet}(l.Component),g=function(e){function SemanticSearchFacetInner(t){var a=e.call(this,t)||this;return a.isOldVisualizationContext=function(e,t){return!(!e.isNothing||!t.isNothing)||e.chain((function(e){return t.map((function(t){return{c:e,r:t}}))})).map((function(e){var t=e.c,a=e.r;return t.equals(a)})).getOrElse(!1)},a.toggleFilter=function(){a.setState((function(e){return{showFacets:!e.showFacets}})),s.trigger({eventType:f.SearchFilterToggled,source:a.props.id})},a.state={facetData:null,showFacets:t.openByDefault,bigResultSet:!1},a}return n.__extends(SemanticSearchFacetInner,e),SemanticSearchFacetInner.prototype.componentWillReceiveProps=function(e){var t=this.props.context,a=e.context,n=a.baseQuery.isJust&&a.domain.isJust&&a.resultsStatus.loaded,r=t.domain.chain((function(e){return a.domain.map((function(t){return{currentDomain:e,newDomain:t}}))})).map((function(e){var t=e.currentDomain,a=e.newDomain;return!t.iri.equals(a.iri)})).getOrElse(!1);if(!this.facetStore&&n||r)this.createFacetStore(a.baseQuery.get(),a);else if(n){if(this.facetStore.facetActions().setBaseQuery(a.baseQuery.get()),e.listenToContextSwitch&&a.visualizationContext.isJust&&!this.isOldVisualizationContext(t.visualizationContext,a.visualizationContext)){var i=a.visualizationContext.get();this.facetStore.facetActions().selectCategory(i.hasRange),this.facetStore.facetActions().selectRelation(i)}}else a.baseQuery.isNothing&&(this.facetStore=null,this.setState({facetData:null}))},SemanticSearchFacetInner.prototype.createFacetStore=function(e,t){var a=this;this.facetStore=new d.FacetStore({domain:t.domain.get(),availableDomains:t.availableDomains.getOrElse(void 0),baseConfig:t.baseConfig,baseQuery:e,initialAst:t.facetStructure.getOrElse(void 0),searchProfileStore:t.searchProfileStore.get(),config:this.props},t);var n=this.facetStore.facetActions();this.props.context.setFacetActions(n),this.facetStore.getFacetData().observe({value:function(e){a.setState({facetData:e}),a.props.context.setFacetStructure(e.ast)}}),this.facetStore.getFacetedQuery().onValue((function(e){return a.props.context.setFacetedQuery(e)}))},SemanticSearchFacetInner.prototype.render=function(){if(this.props.context.baseQuery.isJust){var e=this.state.facetData&&this.state.showFacets;return i.div({className:"semantic-facet-holder"},this.state.facetData&&this.state.showFacets?p.default({data:this.state.facetData,actions:this.facetStore.facetActions(),config:this.props}):null,i.button({className:o({"btn-xs":!0,"show-facet-button":!0,"show-facet-button__hide":e,"show-facet-button__show":!e}),onClick:this.toggleFilter},this.state.showFacets?"Hide Filter":"Show Filter"))}return null},SemanticSearchFacetInner.defaultProps={valueCategories:{},valueRelations:{},categories:{tupleTemplate:c.DefaultFacetCategoriesTupleTemplate},relations:{tupleTemplate:c.DefaultFacetRelationTupleTemplate},defaultValueQueries:{},defaultValueTemplate:c.DefaultFacetValueTemplate,facetValuesThreshold:1e4},SemanticSearchFacetInner}(r.Component);t.default=h},2352:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(16),r=a(1606);t.DateRange=r.DateRange,t.Literal=r.Literal,t.NumericRange=r.NumericRange,t.partialValueEquals=function partialValueEquals(e,t){return n.has(e,"literal")&&n.has(t,"literal")?e.literal.equals(t.literal):!(!n.has(e,"iri")||!n.has(t,"iri"))&&e.iri.equals(t.iri)}},3344:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),i=a(35),o=a(16),s=a(162),l=a(327),c=a(3345),u=a(3346),p=a(1851);a(1506);var d=function(e){function FacetComponent(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLoadingIndicator=function(){return t.props.data.relations.some((function(e){return o.isUndefined(e.available)}))?[i.div({},i.em({},"Searching for relations ...")),i.div({},r.createElement(l.Spinner))]:[]},t.onCategoryChange=function(e){t.props.data.viewState.category.map((function(t){return t.iri.equals(e.iri)})).getOrElse(!1)?t.props.actions.deselectCategory():(t.props.actions.selectCategory(e),s.trigger({eventType:p.SearchFacetCategorySelected,source:t.props.config.id,data:e.iri.value}))},t}return n.__extends(FacetComponent,e),FacetComponent.prototype.render=function(){return i.div({className:"facet"},this.props.data.categories.size>1?i.div({className:"facet__category-selector-holder"},c.default({mode:this.props.data.viewState.selectorMode,tupleTemplate:this.props.data.viewState.categoryTemplate,entities:this.props.data.categories,actions:{onValueChange:this.onCategoryChange},selectedElement:this.props.data.viewState.category})):null,this.renderRelations())},FacetComponent.prototype.renderRelations=function(){var e=this;return i.div.apply(i,n.__spreadArrays([{className:"facet-relations"}],this.renderLoadingIndicator(),[this.props.data.relations.filter((function(e){return!1!==e.available})).map((function(t){return u.default({key:t.iri.value,relation:t,data:e.props.data,actions:e.props.actions,config:e.props.config})})).toArray()]))},FacetComponent}(r.Component);t.FacetComponent=d,t.Facet=r.createFactory(d),t.default=t.Facet},3345:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),i=a(35),o=a(20),s=a(7),l=a(16),c=a(1559),u=a(630),p=function(e){function CategorySelectorComponent(t,a){var n=e.call(this,t,a)||this;return n.updateDisabledItems=function(){var e=l.reduce(n.refs,(function(e,t,a){return e[a]=n.hasDisabledChild(o.findDOMNode(t)),e}),{});0==l.isEqual(e,n.state.isDisabled)&&n.setState({isDisabled:e})},n.state={isDisabled:{}},n}return n.__extends(CategorySelectorComponent,e),CategorySelectorComponent.prototype.componentDidMount=function(){l.delay(this.updateDisabledItems,1e3,"later")},CategorySelectorComponent.prototype.componentDidUpdate=function(){l.delay(this.updateDisabledItems,1e3,"later")},CategorySelectorComponent.prototype.render=function(){return"dropdown"===this.props.mode?this.renderCategoryDropdown():this.renderCategoryButtons()},CategorySelectorComponent.prototype.renderCategoryButtons=function(){var e=this,t=this.props.entities.map((function(t){var a=e.props.selectedElement.map((function(e){return t.iri.value===e.iri.value})).getOrElse(!1);return i.li({key:t.iri.value},r.createElement(u.TemplateItem,{ref:t.iri.value,componentProps:{disabled:1==e.state.isDisabled[t.iri.value],className:s({btn:!0,"btn-default":!0,"category-item-holder":!0,"category-item-holder--active":a}),title:t.label,"data-rdfa-about":t.iri.value,onClick:function(a){0==e.hasDisabledChild(a.currentTarget)&&(a.currentTarget.blur(),e.props.actions.onValueChange(t))}},template:{source:e.props.tupleTemplate,options:t.tuple}}))}));return i.ol({className:"category-selector"},t.toArray())},CategorySelectorComponent.prototype.renderCategoryDropdown=function(){var e=this,t=this.props.selectedElement.map((function(t){var a=t.iri.value;return e.props.entities.find((function(e){return e.iri.value===a}))})).getOrElse(null);return r.createElement(c.default,{className:"category-selector",placeholder:"Select category",value:t,options:this.props.entities.toArray(),optionRenderer:function(a){var n=t&&a.iri.value===t.iri.value;return r.createElement(u.TemplateItem,{key:a.iri.value,ref:a.iri.value,template:{source:e.props.tupleTemplate,options:a.tuple},componentProps:{disabled:1==e.state.isDisabled[a.iri.value],className:s({btn:!0,"btn-default":!0,"category-item-holder":!0,"category-item-holder--active":n}),title:a.label,"data-rdfa-about":a.iri.value}})},onChange:function(a){a&&a!==t?e.props.actions.onValueChange(a):!a&&t&&e.props.actions.onValueChange(t)}})},CategorySelectorComponent.prototype.hasDisabledChild=function(e){return l.some(e.children,(function(e){return"true"==e.dataset.disabled}))},CategorySelectorComponent}(r.Component);t.CategorySelectorComponent=p,t.CategorySelector=r.createFactory(p),t.default=t.CategorySelector},3346:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),i=a(35),o=a(33),s=a(3347),l=a(7),c=a(1991),u=a(16),p=a(162),d=a(630),f=a(327),h=a(1601),g=a(2352),m=a(3356),v=a(2353),y=a(1851),A=r.createFactory(s),_=function(e){function RelationFacetComponent(t,a){var n=e.call(this,t,a)||this;return n.renderRelation=function(){return i.div({className:"facet__relation"},i.div({className:"facet__relation__header",onClick:n.onRelationClick().bind(n)},i.i({className:l({"facet__relation__header__icon--selected":n.isSelectedRelation(),facet__relation__header__icon:!n.isSelectedRelation()})}),r.createElement(d.TemplateItem,{template:{source:n.props.data.viewState.relationTemplate,options:n.props.relation.tuple}}),n.isSelectedRelation()&&n.props.data.viewState.values.loading?r.createElement(f.Spinner):i.span({})),n.isSelectedRelation()&&!n.props.data.viewState.values.loading?i.div({className:"facet__relation__body"},n.renderRelationFacetBody(n.props.data.viewState)):i.div({}))},n.isSelectedRelation=function(){return n.props.data.viewState.relation.map((function(e){return e.iri.equals(n.props.relation.iri)})).getOrElse(!1)},n.state={},n}return n.__extends(RelationFacetComponent,e),RelationFacetComponent.prototype.render=function(){return!0===this.props.relation.available?this.renderRelation():null},RelationFacetComponent.prototype.renderRelationFacetBody=function(e){var t=e.relationType,a=e.values;return"resource"===t||"literal"===t?this.renderFacetValues(a.values,t):"numeric-range"===t||"date-range"===t?this.renderSlider(a.values,t):null},RelationFacetComponent.prototype.renderFacetValues=function(e,t){var a=this,n=this.props.relation.hasRange.label,o=this.state.filterString?this.state.filterString:"",s=0===e.length&&!this.props.data.viewState.values.loading,l=this.props.config.facetValuesThreshold>0&&e.length>this.props.config.facetValuesThreshold;return this.props.data.viewState.values.error?i.div({className:"facet__relation__values"},i.em({},"An error has occurred! Probably, there are too many facet values for the selected relation. Please, try to refine your search.")):s?i.div({className:"facet__relation__values"},i.em({},"Values not found...")):i.div({className:"facet__relation__values"},l?i.em({className:"facet__relation__warning"},"Only first "+this.props.config.facetValuesThreshold+" facet values are shown! Please refine your search "):null,r.createElement(h.ClearableInput,{type:"text",className:"facet__relation__values__filter",placeholder:"Search "+c.noun(n).pluralize()+"...",value:o,onClear:function(){return a.setState({filterString:void 0})},onChange:function(e){var t=e.target.value;a.setState({filterString:t})}}),A({elementHeight:20,containerHeight:250},e.filter((function(e){var a="resource"===t?e.label:e.literal.value;return!o||a.toLowerCase().indexOf(o.toLowerCase())>=0})).map((function(e){return m.default({key:"resource"===t?e.iri.value:e.literal.value,kind:t,facetValue:{entity:e,tupleTemplate:a.props.data.viewState.valuesTemplate,selected:a.isTermSelected(e)},highlight:o,actions:{selectFacetValue:a.props.actions.selectFacetValue(a.props.relation),deselectFacetValue:a.props.actions.deselectFacetValue(a.props.relation)}})}))))},RelationFacetComponent.prototype.renderSlider=function(e,t){var a=this,n=o.fromNullable(u.find(this.props.data.ast.conjuncts,(function(e){return e.relation.iri.equals(a.props.relation.iri)}))).chain((function(e){return u.isEmpty(e.disjuncts)?o.Nothing():o.Just(u.head(e.disjuncts).value)}));return v.FacetSlider({kind:t,data:e,value:n,actions:{toggleFacetValue:this.props.actions.selectFacetValue(this.props.relation)}})},RelationFacetComponent.prototype.onRelationClick=function(){var e=this;return function(){e.isSelectedRelation()?e.props.actions.deselectRelation():(p.trigger({eventType:y.SearchFacetPropertySelected,source:e.props.config.id,data:e.props.relation.iri.value}),e.props.actions.selectRelation(e.props.relation))}},RelationFacetComponent.prototype.isTermSelected=function(e){return o.fromNullable(this.props.data.viewState.selectedValues.get(this.props.relation)).chain((function(t){return o.fromNullable(t.find((function(t){return g.partialValueEquals(t,e)})))})).map((function(e){return!0})).getOrElse(!1)},RelationFacetComponent}(r.PureComponent);t.RelationFacetComponent=_,t.RelationFacet=r.createFactory(_),t.default=t.RelationFacet},3356:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),i=a(35),o=a(630),s=a(327),l=function(e){function FacetValueComponent(t,a){var n=e.call(this,t,a)||this;return n.state={selected:t.facetValue.selected,isLoading:!1},n}return n.__extends(FacetValueComponent,e),FacetValueComponent.prototype.componentWillReceiveProps=function(e){this.setState({selected:e.facetValue.selected,isLoading:!1})},FacetValueComponent.prototype.renderCheckboxLabel=function(){var e=this.props.kind,t=this.props.facetValue.tupleTemplate[e];return r.createElement(o.TemplateItem,{template:{source:t,options:n.__assign({highlight:this.props.highlight},this.props.facetValue.entity.tuple)}})},FacetValueComponent.prototype.render=function(){return i.div({className:"facet__relation__values__value checkbox",onClick:this.onValueClick.bind(this)},i.label({},i.input({type:"checkbox",className:"checkbox",checked:this.state.selected}),this.renderCheckboxLabel(),this.state.isLoading?r.createElement(s.Spinner):i.span({})))},FacetValueComponent.prototype.onValueClick=function(e){e.stopPropagation(),"INPUT"===e.target.tagName&&(this.setState({selected:e.target.checked,isLoading:!0}),this.props.facetValue.selected?this.props.actions.deselectFacetValue(this.props.facetValue.entity):this.props.actions.selectFacetValue(this.props.facetValue.entity))},FacetValueComponent}(r.Component);t.FacetValueComponent=l,t.FacetValue=r.createFactory(l),t.default=t.FacetValue},3388:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(33),i=a(16),o=a(19),s=a(43),l=a(10),c=a(23),u=a(61),p=a(214),d=a(1630),f=a(1738),h=a(1943),g=a(1944),m=a(2352),v=a(1606),y=a(1824),A=a(140),_=a(162),V=function(){function FacetStore(e,t){var a=this;this.ast=p.Action(),this.baseQuery=p.Action(),this.relations=p.Action(),this.values=p.Action({values:[],loading:!1,error:!1}),this.facetData=p.Action(),this.facetedQuery=p.Action(),this.facetView=p.Action(),this.selectValueAction=p.Action(),this.deselectValueAction=p.Action(),this.removeConjunctAction=p.Action(),this.relationsCache={},this.valuesCache={},this.initialValues=function(e){return s.OrderedMap().withMutations((function(t){e.conjuncts.forEach((function(e){return t.set(e.relation,s.List(e.disjuncts.map((function(e){return e.value}))))}))}))},this.buldAst=function(e){var t=0;return{conjuncts:e.map((function(e,n){var r=a.getDisjunctType(n),i=e.map((function(e,n){return a.createValueDisjunct(e,r,t,n)})).toArray();return t+=1,{kind:v.ConjunctKinds.Relation,conjunctIndex:[t],relation:n,range:n.hasRange,disjuncts:i}})).toArray()}},this.getDisjunctType=function(e){switch(a.getFacetValuesQueryForRelation(a.config,e).kind){case"resource":return v.EntityDisjunctKinds.Resource;case"date-range":return v.TemporalDisjunctKinds.DateRange;case"literal":return v.LiteralDisjunctKind;case"numeric-range":return v.NumericRangeDisjunctKind}},this.createValueDisjunct=function(e,t,a,n){return{kind:t,disjunctIndex:[a,n],value:e}},this.setBaseQuery=function(e){return a.baseQuery(e)},this.selectCategory=function(e){a.toggleCategoryAction(r.Just(e))},this.deselectCategory=function(){a.toggleCategoryAction(r.Nothing())},this.selectRelation=function(e){a.toggleRelationAction(r.Just(e))},this.deselectRelation=function(){a.toggleRelationAction(r.Nothing())},this.selectFacetValue=function(e){return function(t){return a.selectValueAction({relation:e,value:t})}},this.deselectFacetValue=function(e){return function(t){return a.deselectValueAction({relation:e,value:t})}},this.executeRelationCheckQuery=function(e,t){return u.SparqlClient.ask(e,{context:a.context.semanticContext}).map((function(n){return t.available=n,a.relationsCache[e]=n,t})).flatMapErrors((function(e){return t.available=!1,o.constant(t)}))},this.removeConjunct=function(e){a.removeConjunctAction(e)},this.context=t,this.config=e;var n=e.initialAst||{conjuncts:[]};this.ast(n),this.selectedValues=p.Action(this.initialValues(n)),this.baseQuery(i.clone(this.config.baseQuery));var l=this.baseQuery.$property.skipDuplicates(i.isEqual);this.actions={selectCategory:this.selectCategory,deselectCategory:this.deselectCategory,selectRelation:this.selectRelation,deselectRelation:this.deselectRelation,selectFacetValue:this.selectFacetValue,deselectFacetValue:this.deselectFacetValue,setBaseQuery:this.setBaseQuery,removeConjunct:this.removeConjunct};var c=this.config.searchProfileStore.rangesFor(this.config.domain).map(this.buildFacetCategoryBinding),d=e.config.selectFirstCategory?r.Just(c.first()):r.Nothing();this.toggleCategoryAction=p.Action(d),this.toggleRelationAction=p.Action(r.Nothing()),o.combine({relations:this.relations.$property,viewState:this.facetView.$property,ast:this.ast.$property,categories:o.constant(c)}).debounce(200).onValue(this.facetData),o.combine({value:this.selectValueAction.$property},{selected:this.selectedValues.$property}).onValue((function(e){var t=e.value,n=e.selected,r=a.getDisjunctType(t.relation),i=n;r!==v.TemporalDisjunctKinds.DateRange&&r!==v.NumericRangeDisjunctKind||(i=n.delete(t.relation));var o=i.get(t.relation)||s.List();o=o.push(t.value),a.selectedValues(i.set(t.relation,o))})),o.combine({value:this.deselectValueAction.$property},{selected:this.selectedValues.$property}).onValue((function(e){var t=e.value,n=e.selected,r=n.get(t.relation).filterNot((function(e){return m.partialValueEquals(t.value,e)}));r.isEmpty()?a.selectedValues(n.remove(t.relation)):a.selectedValues(n.set(t.relation,r))})),this.selectedValues.$property.map(this.buldAst).onValue(this.ast),o.combine({ast:this.ast.$property,baseQuery:l}).onValue((function(e){var t=e.ast,n=e.baseQuery;a.facetedQuery(a.generateQuery(n,t.conjuncts)),a.valuesCache={}})),o.combine({ast:this.ast.$property,category:this.toggleCategoryAction.$property,baseQuery:l}).onValue((function(e){var t=e.ast,n=e.category,r=e.baseQuery;return a.fetchRelations(r,t.conjuncts,n).onValue(a.relations)})),this.facetView({category:d,relation:r.Nothing(),values:{values:[],loading:!1},selectedValues:s.OrderedMap(),relationType:null,categoryTemplate:e.config.categories.tupleTemplate,relationTemplate:e.config.relations.tupleTemplate,valuesTemplate:e.config.defaultValueTemplate,selectorMode:e.baseConfig.selectorMode}),o.combine({relation:this.toggleRelationAction.$property,category:this.toggleCategoryAction.$property,values:this.values.$property,selectedValues:this.selectedValues.$property},{facetView:this.facetView.$property}).onValue((function(t){var n=t.relation,r=t.category,i=t.values,o=t.facetView,s=t.selectedValues;if(o.relation=n,o.category=r,o.values=i,o.selectedValues=s,n.isJust){var l=a.getFacetValuesQueryForRelation(a.config,n.get());o.relationType=l.kind;var c=void 0,u=void 0;"literal"===l.kind?c=l.tupleTemplate||e.config.defaultValueTemplate.literal:"resource"===l.kind&&(u=l.tupleTemplate||e.config.defaultValueTemplate.resource),o.valuesTemplate={literal:c,resource:u}}a.facetView(o)})),o.combine({relation:this.toggleRelationAction.$property,baseQuery:l},{ast:this.ast.$property}).onValue((function(t){var n=t.ast,r=t.relation,i=t.baseQuery;if(r.isNothing)a.values({values:[],loading:!1,error:!1});else{var s=r.get().iri.value;a.values({values:[],loading:!0,error:!1});(a.valuesCache[s]?o.constant(a.valuesCache[s]):a.fetchFacetValues(i,n.conjuncts,r.get())).onValue((function(t){var n;a.values({values:t,loading:!1,error:!1}),a.valuesCache=((n={})[s]=t,n),_.trigger({eventType:_.BuiltInEvents.ComponentLoaded,source:e.config.id})})).onError((function(e){console.error(e),a.values({values:[],loading:!1,error:!0})}))}})),o.combine({conjunct:this.removeConjunctAction.$property},{selected:this.selectedValues.$property}).onValue((function(e){var t=e.selected,n=e.conjunct.relation;a.selectedValues(t.remove(n))}))}return FacetStore.prototype.getFacetedQuery=function(){return this.facetedQuery.$property},FacetStore.prototype.getFacetAst=function(){return this.ast.$property},FacetStore.prototype.getFacetData=function(){return this.facetData.$property},FacetStore.prototype.facetActions=function(){return this.actions},FacetStore.prototype.fetchRelations=function(e,t,a){var n,i=this,s=this.config.searchProfileStore.relationsFor({domain:r.Just(this.config.domain),range:a}).map(this.buildFacetRelationBinding),l=u.SparqlUtil.parseQuery("ASK { FILTER(?__relationPattern__) }");(n=l.where).unshift.apply(n,e.where),l.where=l.where.concat(this.generateQueryClause(e,t));var c=y.generateQueryForMultipleDatasets(l,this.context.selectedDatasets,this.context.baseConfig.datasetsConfig),p=s.valueSeq().sortBy((function(e){return e.label})).map((function(e){return i.fetchRelation(c,e)})).toArray();return o.merge(p).toProperty().scan((function(e,t){return e.set(g.RelationKey.key({iri:t.iri,domain:t.hasDomain.iri,range:t.hasRange.iri}),t)}),s)},FacetStore.prototype.fetchRelation=function(e,t){var a,n=this.getFacetValuesQueryForRelation(this.config,t).valuesQuery,r=u.SparqlUtil.parseQuery(n).where,s=u.cloneQuery(e);new u.PatternBinder("__relationPattern__",r).sparqlQuery(s);var l=u.SparqlClient.setBindings(s,((a={})[d.FACET_VARIABLES.RELATION_VAR]=t.iri,a)),c=u.SparqlUtil.serializeQuery(l);return i.has(this.relationsCache,c)?(t.available=this.relationsCache[c],o.constant(t)):this.executeRelationCheckQuery(c,t)},FacetStore.prototype.buildFacetRelationBinding=function(e){var t={$relation:e.tuple,$domain:e.hasDomain.tuple,$range:e.hasRange.tuple,available:void 0};return n.__assign(n.__assign({},e),{tuple:t})},FacetStore.prototype.buildFacetCategoryBinding=function(e){var t={$category:e.tuple};return n.__assign(n.__assign({},e),{tuple:t})},FacetStore.prototype.fetchFacetValues=function(e,t,a){var n=this.getFacetValuesQueryForRelation(this.config,a);switch(n.kind){case"resource":return this.fetchFacetResourceValues(e,t,a,n);case"date-range":return this.fetchFacetDateRangeValues(e,t,a,n);case"literal":return this.fetchFacetLiteralValues(e,t,a,n);case"numeric-range":return this.fetchFacetNumericRangeValues(e,t,a,n)}},FacetStore.prototype.augmentWithLabelsFromServiceIfNeeded=function(e){return e.length>0&&"string"!=typeof e[0].label?A.getLabels(e.map((function(e){return e.iri})),{context:this.context.semanticContext}).map((function(t){return e.map((function(e){var a=t.get(e.iri);return e.tuple[d.FACET_VARIABLES.VALUE_RESOURCE_LABEL_VAR]=c.Rdf.literal(a),{iri:e.iri,label:a,description:a,tuple:e.tuple}}))})):o.constant(e)},FacetStore.prototype.fetchFacetResourceValues=function(e,t,a,n){var r=this;return this.executeValuesQuery(e,t,a,n.valuesQuery,!0).map((function(e){return e.results.bindings.map((function(e){return{iri:e[d.FACET_VARIABLES.VALUE_RESOURCE_VAR],label:d.FACET_VARIABLES.VALUE_RESOURCE_LABEL_VAR in e?e[d.FACET_VARIABLES.VALUE_RESOURCE_LABEL_VAR].value:void 0,description:d.FACET_VARIABLES.VALUE_RESOURCE_LABEL_VAR in e?e[d.FACET_VARIABLES.VALUE_RESOURCE_LABEL_VAR].value:void 0,tuple:e}}))})).flatMap((function(e){return r.augmentWithLabelsFromServiceIfNeeded(e)})).map((function(e){return i.sortBy(e,(function(e){return e.label}))})).toProperty()},FacetStore.prototype.fetchFacetDateRangeValues=function(e,t,a,n){return this.executeValuesQuery(e,t,a,n.valuesQuery).map((function(e){return e.results.bindings.map((function(e){return{begin:l(e[d.FACET_VARIABLES.VALUE_DATE_RANGE_BEGIN_VAR].value,l.ISO_8601),end:l(e[d.FACET_VARIABLES.VALUE_DATE_RANGE_END_VAR].value,l.ISO_8601)}})).filter((function(e){var t=e.begin,a=e.end;return t.isValid()&&a.isValid()}))}))},FacetStore.prototype.fetchFacetLiteralValues=function(e,t,a,n){return this.executeValuesQuery(e,t,a,n.valuesQuery).map((function(e){return e.results.bindings.map((function(e){return{literal:e[d.FACET_VARIABLES.VALUE_LITERAL],tuple:e}}))}))},FacetStore.prototype.fetchFacetNumericRangeValues=function(e,t,a,n){return this.executeValuesQuery(e,t,a,n.valuesQuery).map((function(e){return e.results.bindings.map((function(e){return{begin:parseFloat(e[d.FACET_VARIABLES.VALUE_NUMERIC_RANGE_BEGIN_VAR].value),end:parseFloat(e[d.FACET_VARIABLES.VALUE_NUMERIC_RANGE_END_VAR].value),tuple:e}}))}))},FacetStore.prototype.executeValuesQuery=function(e,t,a,n,r){var o,s,l;void 0===r&&(r=!1);var c=y.rewriteProjectionVariable(u.SparqlUtil.parseQuerySync(n),this.getProjectionVariable(e));(o=c.where).unshift.apply(o,e.where),c.where=c.where.concat(this.generateQueryClause(e,this.excludeClauseForRelation(t,a.iri))),r&&this.config.config.facetValuesThreshold>0&&(c.limit=this.config.config.facetValuesThreshold+1);var p=u.SparqlClient.setBindings(c,i.assign(((s={})[d.FACET_VARIABLES.RELATION_VAR]=a.iri,s[d.FACET_VARIABLES.RANGE_VAR]=a.hasRange.iri,s),((l={})[d.SEMANTIC_SEARCH_VARIABLES.SELECTED_ALIGNMENT]=this.context.selectedAlignment.map((function(e){return e.iri})).getOrElse(void 0),l))),f=y.generateQueryForMultipleDatasets(p,this.context.selectedDatasets,this.context.baseConfig.datasetsConfig);return u.SparqlClient.select(f,{context:this.context.semanticContext})},FacetStore.prototype.excludeClauseForRelation=function(e,t){return i.reject(e,(function(e){return e.relation.iri.equals(t)}))},FacetStore.prototype.generateQuery=function(e,t){var a=this.generateQueryClause(e,t),n=i.clone(e);return n.where=n.where.concat(a),n},FacetStore.prototype.getFacetValuesQueryForRelation=function(e,t){var a=e.config,n=a.valueCategories,r=a.valueRelations,o=t.hasRange.iri.toString(),s=t.iri.toString();return i.has(r,s)?r[s]:i.has(n,o)?n[o]:function generateFacetValuePatternFromRelation(e,t){var a=y.tryGetRelationPatterns(e.baseConfig,t).filter((function(e){return i.some(["resource","literal","date-range","numeric-range"],(function(t){return t===e.kind}))})),n=1===a.length?a[0]:void 0;a.length>1&&console.warn("Found multiple matching patterns for facet relation "+t.iri);var r=n||{},o=r.kind,s=void 0===o?"resource":o,l=r.queryPattern;void 0===l&&(l="resource"===s?f.DefaultFacetValuesQueries.ResourceRelationPattern:"literal"===s?f.DefaultFacetValuesQueries.LiteralRelationPattern:assertHandledEveryPatternKind(s));var c=u.SparqlUtil.parseQuery(function getDefaultValuesQuery(e,t){var a=f.DefaultFacetValuesQueries;return"resource"===t?e.defaultValueQueries.resource||a.forResource():"literal"===t?e.defaultValueQueries.literal||a.forLiteral():"date-range"===t?a.forDateRange():"numeric-range"===t?a.forNumericRange():assertHandledEveryPatternKind(t)}(e.config,s)),p=function transformRelationPatternForFacetValues(e,t){var a;if("resource"===t)a=new u.VariableRenameBinder(d.SEMANTIC_SEARCH_VARIABLES.RESOURCE_VAR,d.FACET_VARIABLES.VALUE_RESOURCE_VAR);else if("literal"===t)a=new u.VariableRenameBinder(d.SEMANTIC_SEARCH_VARIABLES.LITERAL_VAR,d.FACET_VARIABLES.VALUE_LITERAL);else{if("date-range"===t){var n={begin:d.SEMANTIC_SEARCH_VARIABLES.DATE_BEGING_VAR,end:d.SEMANTIC_SEARCH_VARIABLES.DATE_END_VAR},r={begin:d.FACET_VARIABLES.VALUE_DATE_RANGE_BEGIN_VAR,end:d.FACET_VARIABLES.VALUE_DATE_RANGE_END_VAR};return h.transformRangePattern(e,n,r)}if("numeric-range"===t){n={begin:d.SEMANTIC_SEARCH_VARIABLES.NUMERIC_RANGE_BEGIN_VAR,end:d.SEMANTIC_SEARCH_VARIABLES.NUMERIC_RANGE_END_VAR},r={begin:d.FACET_VARIABLES.VALUE_NUMERIC_RANGE_BEGIN_VAR,end:d.FACET_VARIABLES.VALUE_NUMERIC_RANGE_END_VAR};return h.transformRangePattern(e,n,r)}assertHandledEveryPatternKind(t)}var o=i.cloneDeep(e);return o.forEach((function(e){return a.pattern(e)})),o}(u.SparqlUtil.parsePatterns(l,c.prefixes),s);new u.PatternBinder(d.FACET_VARIABLES.RELATION_PATTERN_VAR,p).sparqlQuery(c);var g=u.SparqlUtil.serializeQuery(c);return"resource"===s?{kind:"resource",valuesQuery:g}:"literal"===s?{kind:"literal",valuesQuery:g}:"date-range"===s?{kind:"date-range",valuesQuery:g}:"numeric-range"===s?{kind:"numeric-range",valuesQuery:g}:assertHandledEveryPatternKind(s)}(e,t)},FacetStore.prototype.getProjectionVariable=function(e){return this.config.availableDomains?this.config.availableDomains.get(this.config.domain.iri):e.variables[0]},FacetStore.prototype.generateQueryClause=function(e,t){var a=this;return this.config.availableDomains?this.config.availableDomains.map((function(e,n){var r=t.filter((function(e){return e.relation.hasDomain.iri.equals(n)}));return y.conjunctsToQueryPatterns(a.config.baseConfig,e,a.config.domain,r)})).flatten().toArray():y.conjunctsToQueryPatterns(this.config.baseConfig,this.getProjectionVariable(e),this.config.domain,t)},FacetStore}();function assertHandledEveryPatternKind(e){throw new Error("Unexpected pattern kind: "+e)}t.FacetStore=V}}]);
//# sourceMappingURL=semantic-search-facet-b707841a89979dbbab37.js.map