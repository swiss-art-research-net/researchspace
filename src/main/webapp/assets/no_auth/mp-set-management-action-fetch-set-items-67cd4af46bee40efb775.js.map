{"version":3,"sources":["webpack:///./src/main/web/components/sets/actions/FetchSetItemsAction.ts"],"names":["cancellation","Cancellation","fetchingItemsCancellation","derive","onClick","id","deriveAndCancel","set","context","getCurrentSet","map","fetchSetItems","onValue","items","iris","item","iri","value","trigger","source","eventType","SetManagementEvents","ItemsFetched","data","componentWillUnmount","this","cancelAll","render","child","Children","only","props","children","cloneElement","contextTypes","SetManagementContextTypes","SetViewContextTypes","Component","FetchSetItemsAction"],"mappings":"6IAmBA,OAEA,QACA,SACA,SAEA,UAmBA,2F,OAImB,EAAAA,aAAe,IAAI,EAAAC,aAC5B,EAAAC,0BAA4B,EAAKF,aAAaG,SAM9C,EAAAC,QAAU,WACR,cAAAC,GACR,EAAKH,0BAA4B,EAAKF,aAAaM,gBAAgB,EAAKJ,2BACxE,IAAMK,EAAM,EAAKC,QAAQ,+BAA+BC,gBACxD,EAAKP,0BACFQ,IAA4B,EAAKF,QAAQ,qBAAqBG,cAAcJ,IAC5EK,SAAQ,SAACC,GACR,IAAMC,EAAOD,EAAMH,KAAI,SAACK,GAAS,OAAAA,EAAKC,IAAIC,SAC1C,EAAAC,QAAQ,CAAEC,OAAM,EAAEC,UAAW,EAAAC,oBAAoBC,aAAcC,KAAM,CAAET,KAAI,S,EASnF,OA5ByC,mCAOvC,8BAAAU,qBAAA,WACEC,KAAKzB,aAAa0B,aAeb,8BAAAC,OAAP,WACE,IAAMC,EAAQ,EAAAC,SAASC,KAAKL,KAAKM,MAAMC,UACjCD,EAAQ,CAAE3B,QAASqB,KAAKrB,SAC9B,OAAO,EAAA6B,aAAaL,EAAOG,IAzBf,oBAAAG,aAAe,EAAH,uBAAQ,EAAAC,2BAA8B,EAAAC,qBA2BlE,oBA5BA,CAAyC,EAAAC,WAA5B,EAAAC,sBA6Bb,UAAeA","file":"mp-set-management-action-fetch-set-items-67cd4af46bee40efb775.js","sourcesContent":["/**\n * ResearchSpace\n * Copyright (C) 2020, Â© Trustees of the British Museum\n * Copyright (C) 2015-2019, metaphacts GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { Component, Children, ReactElement, cloneElement } from 'react';\n\nimport { Cancellation } from 'platform/api/async';\nimport { trigger } from 'platform/api/events';\nimport { SetManagementEvents } from 'platform/api/services/ldp-set/SetManagementEvents';\n\nimport {\n  SetManagementContextTypes,\n  SetManagementContext,\n  SetViewContext,\n  SetViewContextTypes,\n} from '../SetManagementApi';\nimport { SetItem } from '../SetsModel';\n\nexport interface Props {\n  id: string;\n}\n\n/**\n * Fetches set items of a selected set\n *\n * This action can be used only inside <mp-set-management> component templates.\n *\n * @example <mp-set-management-action-fetch-set-items></mp-set-management-action-fetch-set-items>\n */\nexport class FetchSetItemsAction extends Component<Props, {}> {\n  public static contextTypes = { ...SetManagementContextTypes, ...SetViewContextTypes };\n  context: SetManagementContext & SetViewContext;\n\n  private readonly cancellation = new Cancellation();\n  private fetchingItemsCancellation = this.cancellation.derive();\n\n  componentWillUnmount() {\n    this.cancellation.cancelAll();\n  }\n\n  private onClick = () => {\n    const { id: source } = this.props;\n    this.fetchingItemsCancellation = this.cancellation.deriveAndCancel(this.fetchingItemsCancellation);\n    const set = this.context['mp-set-management--set-view'].getCurrentSet();\n    this.fetchingItemsCancellation\n      .map<ReadonlyArray<SetItem>>(this.context['mp-set-management'].fetchSetItems(set))\n      .onValue((items) => {\n        const iris = items.map((item) => item.iri.value);\n        trigger({ source, eventType: SetManagementEvents.ItemsFetched, data: { iris } });\n      });\n  };\n\n  public render() {\n    const child = Children.only(this.props.children) as ReactElement<any>;\n    const props = { onClick: this.onClick };\n    return cloneElement(child, props);\n  }\n}\nexport default FetchSetItemsAction;\n"],"sourceRoot":""}