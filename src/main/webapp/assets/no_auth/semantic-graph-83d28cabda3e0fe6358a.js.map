{"version":3,"sources":["webpack:///./src/main/web/components/semantic/graph/SemanticGraph.ts","webpack:///./src/main/web/components/semantic/graph/Config.ts","webpack:///./src/main/web/components/semantic/graph/Graph.ts","webpack:///./src/main/web/components/semantic/graph/GraphInternals.ts"],"names":["SemanticGraphConfig","props","context","cancellation","Cancellation","fetching","derive","navigate","event","node","cyTarget","repository","semanticContext","undefined","isNotCompound","isParent","hasClass","data","iri","openLinksInNewWindow","openResourceInNewWindow","navigateToResource","onValue","identity","state","elements","noResults","componentDidMount","this","fetchAndSetData","componentWillReceiveProps","nextProps","isEqual","query","setState","error","config","assign","hidePredicates","SemanticGraph","DEFAULT_HIDE_PREDICATES","deriveAndCancel","graphDataWithLabels","map","GraphInternals","getGraphDataWithLabels","catchCORSError","length","onError","onEnd","id","trigger","eventType","BuiltInEvents","ComponentLoaded","source","ComponentLoading","loadingImages","element","thumbnail","Promise","resolve","reject","img","Image","onload","onerror","crossOrigin","src","all","then","warning","catch","render","createElement","TemplateItem","template","noResultTemplate","ErrorNotification","errorMessage","Alert","alert","AlertType","WARNING","message","parsedConfig","parseComponentConfig","DEFAULT_STYLE","onClick","getDefaultProps","graph","Graph","children","D","div","selector","style","content","width","shape","height","mouseZoom","Component","configWithHidePredicates","has","configWithShowPredicates","cytoscape","registerJquery","jquery","HANDLEBARS_REGEX","setLayout","layout","runLayout","cy","getElementsToLayout","makeLayout","run","regCose","maybe","Nothing","name","idealEdgeLength","getChildContext","cytoscapeApi","jQuery","instance","actions","createCytoscapeInstance","replaceCytoscapeData","Just","_","componentWillUnmount","destroy","redraw","ref","CYTOSCAPE_CONTAINER_REF","position","getOrElse","resize","fit","filter","i","e","isNode","parent","target","remove","add","one","DATA_LOADED_EVENT","composeCytoscapeConfig","on","opts","container","refs","userZoomingEnabled","compileStyles","graphStyle","styles","stylesheet","isCssStylesheet","css","compileStyleSelector","compileHandlebarsForStyleValues","replace","escapeJsRegexChars","literal","vocabularies","xsd","_string","mapValues","value","test","styleTemplateFunction","TemplateScope","default","compileWithoutRemote","str","STYLE_METACHARS_REGEX","childContextTypes","CytoscapeContextTypes","x","obj","STYLE_METACHARS","RegExp","component","factory","createFactory","GLOBAL_GROUP","Rdf","NO_GROUP_SET","Set","of","addLabelsToGraphData","labels","thumbnails","label","get","getGraphData","SparqlClient","construct","prepareGraphData","triples","triplesToShow","getTriplesFilterFunction","showPredicates","fullIri","triple","some","predicate","equals","p","every","groups","getGroups","groupBy","constructGroups","groupByPredicate","groupByStatements","reduce","s","set","o","Map","asMutable","asImmutable","nodes","buildNodes","allTriples","groupsMap","resources","acc","groupNodes","union","r","createGraphResourceNodes","nodeGroups","group","createGraphNode","flatten","toArray","buildEgdes","flatMap","createGraphResourceEdges","isEmpty","createGraphEdge","toString","createEdgesWithGroups","subjectGroups","objectGroups","shareTheGroup","intersect","subjectGroup","filterNot","objectGroup","createNodeId","concat","nodeGroup","nodeGroupGroup","first","addPropertiesToTheElementData","resource","isIri","isLiteral","isBnode","subjectNodeId","objectNodeId","cytoscapeElement","resultingNode","updateElementPropertyValue","propertyValues","push","join","defaultStyles","cloneDeep","mergeStyles","overrideStyles","d","options","graphData","fetchLabels","fetchLabelsForResources","elementsWithIri","iris","getLabels","getLabelsForLiterals","elementsWithLiterals","merge","fetchThumbnails","getThumbnails","Kefir","combine","toProperty"],"mappings":"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","file":"semantic-graph-83d28cabda3e0fe6358a.js","sourcesContent":["/**\n * ResearchSpace\n * Copyright (C) 2020, © Trustees of the British Museum\n * Copyright (C) 2015-2019, metaphacts GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { identity } from 'core.lambda';\nimport { Props as ReactProps, createElement } from 'react';\nimport * as D from 'react-dom-factories';\nimport * as assign from 'object-assign';\nimport { isEqual } from 'lodash';\n\nimport { Cancellation } from 'platform/api/async';\nimport { Rdf } from 'platform/api/rdf';\nimport { Component } from 'platform/api/components';\nimport { BuiltInEvents, trigger } from 'platform/api/events';\nimport { navigateToResource, openResourceInNewWindow } from 'platform/api/navigation';\nimport { TemplateItem } from 'platform/components/ui/template';\nimport { ErrorNotification } from 'platform/components/ui/notification';\nimport { Alert, AlertType } from 'platform/components/ui/alert';\n\nimport { Graph } from './Graph';\nimport * as GraphInternals from './GraphInternals';\nimport { SemanticGraphConfig } from './Config';\nexport { SemanticGraphConfig } from './Config';\n\nimport './SemanticGraph.scss';\n\nexport type SemanticGraphProps = SemanticGraphConfig & ReactProps<SemanticGraph>;\n\nexport interface State {\n  elements: Cy.ElementDefinition[];\n  noResults?: boolean;\n  error?: any;\n  warning?: string;\n}\n\nexport class SemanticGraph extends Component<SemanticGraphProps, State> {\n  public static DEFAULT_STYLE: Cy.InstanceJsonStyle = [\n    {\n      selector: 'edge',\n      style: {\n        'target-arrow-shape': 'triangle',\n        'target-arrow-color': '#bbb',\n        content: 'data(label)',\n        'text-valign': 'center',\n        'text-halign': 'center',\n        'text-outline-width': 2,\n        width: 1,\n        'text-outline-color': 'white',\n        'font-size': '8px',\n        'curve-style': 'bezier',\n        'text-rotation': 'autorotate',\n      },\n    },\n    {\n      selector: 'node',\n      style: {\n        'background-fit': 'contain',\n        'background-color': 'white',\n        'background-image': 'data(thumbnail)',\n        content: 'data(label)',\n        shape: 'ellipse',\n        'text-valign': 'bottom',\n        'text-halign': 'center',\n        'text-outline-width': 2,\n        'text-outline-color': 'white',\n        'font-size': '10px',\n        'border-color': '#bbb',\n        'border-width': 1,\n        width: 40,\n        height: 40,\n      },\n    },\n    {\n      selector: 'node[?isLiteral]',\n      style: {\n        'background-fit': 'contain',\n        'background-color': '#ddd',\n        'border-color': '#bbb',\n        'border-width': 1,\n        content: 'data(label)',\n        shape: 'rectangle',\n        'text-valign': 'center',\n        'text-halign': 'center',\n        'padding-right': 2,\n        'padding-left': 2,\n        'padding-top': 2,\n        'padding-bottom': 2,\n        width: 'label',\n        height: 'label',\n        'text-outline-color': '#ddd',\n        'font-size': '10px',\n      },\n    },\n    {\n      selector: 'edge.cy-expand-collapse-meta-edge',\n      style: {\n        content: '',\n        width: 1,\n        'line-color': 'light-grey',\n        'line-style': 'dotted',\n        'target-arrow-shape': 'none',\n        'curve-style': 'unbundled-bezier',\n        'control-point-distances': '0 0 0',\n      },\n    },\n    {\n      selector: 'node.cy-expand-collapse-collapsed-node',\n      style: {\n        shape: 'rectangle',\n      },\n    },\n    {\n      selector: 'node:parent',\n      style: {\n        'text-valign': 'top',\n        'border-opacity': 0.1,\n      },\n    },\n  ];\n\n  public static getDefaultProps = {\n    mouseZoom: true,\n    height: 400,\n  };\n\n  public static DEFAULT_HIDE_PREDICATES = [\n    '<http://schema.org/thumbnail>',\n    '<http://www.w3.org/2000/01/rdf-schema#label>',\n  ];\n\n  private readonly cancellation = new Cancellation();\n  private fetching = this.cancellation.derive();\n\n  constructor(props: SemanticGraphProps, context: any) {\n    super(props, context);\n    this.state = {\n      elements: [],\n      noResults: false,\n    };\n  }\n\n  componentDidMount(): void {\n    this.fetchAndSetData(this.props);\n  }\n\n  componentWillReceiveProps(nextProps: SemanticGraphProps): void {\n    if (!isEqual(nextProps.query, this.props.query)) {\n      this.fetchAndSetData(nextProps);\n    }\n  }\n\n  private fetchAndSetData(props: SemanticGraphProps): void {\n    this.setState({ error: undefined });\n\n    const config = assign(\n      {},\n      {\n        hidePredicates: SemanticGraph.DEFAULT_HIDE_PREDICATES,\n      },\n      props\n    );\n\n    this.fetching = this.cancellation.deriveAndCancel(this.fetching);\n\n    const context = this.context.semanticContext;\n    const graphDataWithLabels = this.fetching.map(GraphInternals.getGraphDataWithLabels(config, { context }));\n    graphDataWithLabels\n      .onValue((elements) => {\n        this.catchCORSError(elements);\n        this.setState({\n          elements: elements,\n          noResults: !elements.length,\n        });\n      })\n      .onError((error) => this.setState({ error }))\n      .onEnd(() => {\n        if (this.props.id) {\n          trigger({ eventType: BuiltInEvents.ComponentLoaded, source: this.props.id });\n        }\n      });\n\n    if (this.props.id) {\n      trigger({\n        eventType: BuiltInEvents.ComponentLoading,\n        source: this.props.id,\n        data: graphDataWithLabels,\n      });\n    }\n  }\n\n  private catchCORSError(elements: Cy.ElementDefinition[]) {\n    const thumbnails = elements.map((element) => (element.data as any).thumbnail);\n\n    const loadingImages = thumbnails.map(\n      (thumbnail) =>\n        new Promise((resolve, reject) => {\n          const img = new Image();\n          img.onload = () => {\n            resolve();\n          };\n          img.onerror = () => {\n            reject(\n              \"Some images are not accessible or can't be rendered on canvas because of CORS or mixed content error (loading HTTP resource from HTTPS context)!\"\n            );\n          };\n          img.crossOrigin = 'Anonymous';\n          img.src = thumbnail;\n        })\n    );\n\n    Promise.all(loadingImages)\n      .then(() => this.setState({ warning: undefined }))\n      .catch((warning) => this.setState({ warning }));\n  }\n\n  render() {\n    if (this.state.noResults) {\n      return createElement(TemplateItem, { template: { source: this.props.noResultTemplate } });\n    } else if (this.state.error) {\n      return createElement(ErrorNotification, { errorMessage: this.state.error });\n    }\n\n    const warning = this.state.warning\n      ? createElement(Alert, { alert: AlertType.WARNING, message: this.state.warning })\n      : null;\n\n    const parsedConfig = GraphInternals.parseComponentConfig(SemanticGraph.DEFAULT_STYLE, this.props);\n    const config = assign(\n      {},\n      {\n        elements: this.state.elements,\n        onClick: this.navigate,\n      },\n      SemanticGraph.getDefaultProps,\n      parsedConfig\n    );\n    const graph = createElement(Graph, config, this.props.children);\n    return D.div({}, warning, graph);\n  }\n\n  private navigate = (event: Cy.EventObject) => {\n    const node = event.cyTarget;\n    const repository = this.context.semanticContext ? this.context.semanticContext.repository : undefined;\n\n    // disable navigation for blank nodes and literals because it doesn't make any sense.\n    // Also disable navigation for compound nodes, and collapsed compound nodes,\n    // otherwise it will conflict with expand-collapse plugin\n    const isNotCompound = !(node.isParent() || node.hasClass('cy-expand-collapse-collapsed-node'));\n    const isIri: boolean = node.data('isIri');\n    if (isIri && isNotCompound) {\n      const iri = event.cyTarget.data('node') as Rdf.Iri;\n      if (this.props.openLinksInNewWindow) {\n        openResourceInNewWindow(iri, {}, repository);\n      } else {\n        navigateToResource(event.cyTarget.data('node') as Rdf.Iri, {}, repository).onValue(identity);\n      }\n    }\n  };\n}\n\nexport default SemanticGraph;\n","/**\n * ResearchSpace\n * Copyright (C) 2020, © Trustees of the British Museum\n * Copyright (C) 2015-2019, metaphacts GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { has } from 'lodash';\n\nexport interface Stylesheet {\n  /**\n   * The selector concept is similar to the CSS selector, but it provides mechanism to match on Rdf Graphs.\n   * The most significant difference to the CSS selector is that, the specificity rules are completely ignored in stylesheets. For a given style property for a given element, the last matching selector wins.\n   *\n   * The selector semantics is based on <a target='_blank' href='http://js.cytoscape.org/#selectors'>Cytoscape's Selectors</a> with additional RDF specific matchers like:\n   *\n   * 1) Matching on nodes/edges:\n   *   * **node** - `node` selector is used to match on all nodes\n   *   * **edge** - `edge` selector is used to match on all edges\n   *\n   * 2) Matching on node type:\n   *   * **IRI** - to match only nodes which are IRIs one can use `node[?isIri]` selector\n   *   * **literal** - to match only nodes which are literals one can use `node[?isLiteral]` selector\n   *   * **bnode** - to match only nodes which are bnodes one can use `node[?isBnode]` selector\n   *\n   * 3) Exact match on node/edge identifier:\n   *   * **IRI**. To match on the IRI use `iri` helper function, for example to match the node with IRI `<http://example.com/perso/alice>` use `node[resource = iri(<http://example.com/person/alice>)]`. In the same way one can match on edges using `edge[resource = iri(<...>)]` syntax\n   *   * **literal** To match on the string literal use `literal` helper function. `literal` helper function takes second optional argument to specify literal data type, by default it assumes `xsd:string`. For example to match string literal `\"Alice\"` one can use the following pattern `node[resource = literal(Alice)]'`. In case of typed literal, for example `2^^xsd:integer`, one need to explicitly provide datatype - `node[resource = literal(\"2\", iri(<http://www.w3.org/2001/XMLSchema#integer>))]`\n   *\n   * 4) Match on outgoing properties:\n   *   * **property existence** One can match all nodes which have specific outgoing property without any constrain on the property value. There is special `property` function to match on outgoing edges. For example to match on all nodes that have `foaf:knows` outgoing edges - `node[property(<http://xmlns.com/foaf/0.1/knows>)]`\n   *   * **property value** Also it is possible to match on the nodes which have some specific value for some property. One of the most typical use-case for this matcher is styling of nodes of some `rdf:type`, but it is also possible to match on literal values, etc. For example to match on all nodes that have value `2^^xsd:integer` for some property `<http://example.com/count>` - `[property(<http://example.com/count>) *= literal(2, iri(<http://www.w3.org/2001/XMLSchema#integer>))]`\n   *\n   * 5) Matching on edge source/target:\n   *   * **source** - to match on all edges which have some specific resource as a source one can use `edge[source = iri(<...>)]` syntax\n   *   * **target** - to match on all edges which are pointing to some specific resource one can use `edge[target = iri(<...>)]` syntax\n   *\n   * Selectors can be combined together (logical AND) or joined together (logical OR) with commas.\n   * For example to match on nodes that have both `example:Alice` **AND** `example:Bob` as `foaf:knows` values one can use the following selector - `node[property(<http://xmlns.com/foaf/0.1/knows>) *= iri(<http://example.com/person/Alice>)][property(<http://xmlns.com/foaf/0.1/knows>) *= iri(<http://example.com/person/Bob>)`.\n   * And to match on nodes that `foaf:knows` has value `example:Alice` **OR** `example:Bob` on can use the following selector `node[property(<http://xmlns.com/foaf/0.1/knows>) *= iri(<http://example.com/person/Alice>)], node[property(<http://xmlns.com/foaf/0.1/knows>) *= iri(<http://example.com/person/Bob>)`.\n   *\n   * Some cytoscape extensions can define their own useful matchers.\n   */\n  selector: string;\n\n  /**\n   * Graph styles definition in JSON format.\n   * In additional to built-in [Cytoscape.js Styles](http://js.cytoscape.org/#style) one can also use some features which are specific to RDF graphs.\n   *\n   * It is possible to use handlebars templates to access values of outgoing edges in style attributes. E.g. to use `rdfs:label` value as label for the node one can use the following style:\n   * ```\n   * 'style': {\n   *   'content': '{{[<http://www.w3.org/2000/01/rdf-schema#label>].[0].value}}',\n   * }\n   * ```\n   * The assumption here is that a property can have multiple values.\n   *\n   * Also it is possible to use resource preferred label or preferred thumbnail with the help of `data` function.\n   * For example to use preferred label for as node content one can use the following snippet:\n   * ```\n   * 'style': {\n   *   'content': 'data(label)',\n   * }\n   * ```\n   * and in A similar way preferred thumbnail can be used as node background:\n   * ```\n   * 'style': {\n   *   'content': 'data(thumbnail)',\n   * }\n   * ```\n   *\n   */\n  style: Cy.Css.ElementCss;\n}\nexport type Stylesheets = Array<Stylesheet>;\n\n/**\n * The most simple graph configuration option which require only SPARQL CONSTRUCT query. Visualize all statements from the resulted graph, including literal nodes.\n */\nexport interface BaseSemanticGraphConfig {\n  /**\n   * SPARQL CONSTRUCT query string. By default all triples are visualized, including literal nodes\n   */\n  query: string;\n\n  /**\n   * <semantic-link uri='http://help.researchspace.org/resource/FrontendTemplating'>Template</semantic-link> which is applied when query returns no results\n   */\n  noResultTemplate?: string;\n\n  /**\n   * Graph styles definitions. There are some default styles defined for `edge`, `node`, `node[?isLiteral]`, `edge.meta`, etc. So be careful when overriding these generic selectors, because then you will lose all defaults.\n   */\n  graphStyle?: Stylesheets;\n\n  /**\n   * It is possible to group nodes according to some predicate (discriminator) value to display containment relation. Accepts full IRI of the property that should be used as a discriminator.\n   */\n  groupBy?: string;\n\n  /**\n   * Height of the graph component canvas in pixels\n   *\n   * @default 400\n   */\n  height?: number;\n\n  /**\n   * Enable/disable mouse zoom.\n   *\n   * @default true\n   */\n  userZoomingEnabled?: boolean;\n\n  /**\n   * ID for issuing component events.\n   */\n  id?: string;\n\n  /**\n   * `true` if click on the graph node should open corresponding resource page in the new window.\n   *\n   * @default false\n   */\n  openLinksInNewWindow?: boolean;\n}\n\n/**\n * With the default configuration, all triples which are present in the graph are always visualized.\n * But it is possible to show only specific triples using `showPredicates` option.\n */\nexport interface SemanticGraphConfigShow extends BaseSemanticGraphConfig {\n  /**\n   * White-list edges that should be visualized in graph. If some node is used only with non-visible predicates it will not be shown. Accepts only full IRIs in angle brackets, e.g `<http://example.com/something>`\n   */\n  showPredicates: string[];\n}\n\n/**\n * With the default configuration, all triples which are present in the graph are always visualized.\n * But it is possible to hide triples using `hidePredicates` option. For example most of the time it can be convenient to hide predicates with literal values.\n */\nexport interface SemanticGraphConfigHide extends BaseSemanticGraphConfig {\n  /**\n   * Blacklist-list edges that should not be visualized in graph. If some node is used only with black-listed predicates it will not be shown. Accepts only full IRIs in angle brackets, e.g `<http://example.com/something>`.\n   */\n  hidePredicates: string[];\n}\n\nexport type SemanticGraphConfig = BaseSemanticGraphConfig | SemanticGraphConfigShow | SemanticGraphConfigHide;\n\nexport function configWithHidePredicates(config: SemanticGraphConfig): config is SemanticGraphConfigHide {\n  return has(config, 'hidePredicates');\n}\n\nexport function configWithShowPredicates(config: SemanticGraphConfig): config is SemanticGraphConfigShow {\n  return has(config, 'showPredicates');\n}\n","/**\n * ResearchSpace\n * Copyright (C) 2020, © Trustees of the British Museum\n * Copyright (C) 2015-2019, metaphacts GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { identity } from 'core.lambda';\nimport { Component, Props as ReactProps, createFactory } from 'react';\nimport * as D from 'react-dom-factories';\nimport * as assign from 'object-assign';\nimport * as jquery from 'jquery';\nimport * as cytoscape from 'cytoscape';\nimport * as regCose from 'cytoscape-cose-bilkent';\nimport * as maybe from 'data.maybe';\nimport * as _ from 'lodash';\n\nimport { vocabularies } from 'platform/api/rdf';\nimport { TemplateScope, CompiledTemplate } from 'platform/api/services/template';\nimport { CytoscapeContext, CytoscapeContextTypes, DATA_LOADED_EVENT } from './api/Api';\n\n// need to register jquery instance in Cytoscape, to make sure that we're using the same instance\n// in the core Cytoscape, as well as in all Cytoscape plugins\ncytoscape.registerJquery(jquery);\n\n/**\n * Cytoscape component properties\n */\nexport interface Config {\n  /**\n   * An array of [[Cy.ElementDefinition]] specified as plain objects.\n   */\n  elements: Cy.ElementDefinition[];\n\n  /**\n   * Height of the Cytoscape canvas in pixels.\n   */\n  height: number;\n\n  /**\n   * List of style definitions to apply to graph.\n   */\n  graphStyle?: Cy.Stylesheet[];\n\n  /**\n   * Enable/disable mouse zoom\n   */\n  userZoomingEnabled?: boolean;\n\n  /**\n   * Action to execute on node/edge click.\n   */\n  onClick?: (event: Cy.EventObject) => void;\n}\nexport type Props = Config & ReactProps<Graph>;\n\nexport interface State {\n  cytoscape?: Data.Maybe<Cy.Instance>;\n  layout?: Cy.LayoutOptions;\n}\n\n/**\n * React wrapper around Cytoscape.js library.\n *\n * # Extension Mechanism\n * It is possible to extend default Cytoscape functionality with 3-rd party plugins.\n * E.g see http://js.cytoscape.org/#extensions for list of  Cytoscape.js\n * community supported extensions.\n *\n * To simplify integration of 3-rd party extensions into platform we provide extension\n * mechanism based on React. Cytoscape React extension is a component which can be used\n * as child component of CytoscapeComponent and have an access to Cytoscape internals.\n * Access to Cytoscape instance is provided with the help of React Context\n * (see https://facebook.github.io/react/docs/context.html).\n *\n * @see http://js.cytoscape.org/\n */\nexport class Graph extends Component<Props, State> {\n  /**\n   * Regex to find handlebars templates in the Cytoscape JSON style definition.\n   */\n  private HANDLEBARS_REGEX: RegExp = /{{{?([^{}]+)}}}?/;\n\n  private static CYTOSCAPE_CONTAINER_REF = 'cytoscape';\n  refs: {\n    cytoscape: Element;\n  };\n\n  constructor(props: Props) {\n    super(props);\n\n    regCose(cytoscape); // register cose-bilkent layout\n\n    this.state = {\n      cytoscape: maybe.Nothing<Cy.Instance>(),\n      layout: {\n        name: 'cose-bilkent',\n        idealEdgeLength: 100,\n      },\n    };\n  }\n\n  static childContextTypes = CytoscapeContextTypes;\n\n  getChildContext(): CytoscapeContext {\n    return {\n      cytoscapeApi: {\n        cytoscape: cytoscape,\n        jQuery: jquery,\n        instance: this.state.cytoscape,\n        actions: {\n          setLayout: this.setLayout,\n          runLayout: this.runLayout,\n        },\n      },\n    };\n  }\n\n  componentDidMount() {\n    const cy = this.createCytoscapeInstance(this.props);\n    this.replaceCytoscapeData(cy, this.props.elements);\n    this.setState({\n      cytoscape: maybe.Just(cy),\n    });\n  }\n\n  componentWillReceiveProps(props: Props) {\n    if (!_.isEqual(props.elements, this.props.elements)) {\n      this.state.cytoscape.map((cy) => this.replaceCytoscapeData(cy, props.elements));\n    }\n  }\n\n  componentWillUnmount() {\n    this.state.cytoscape.map((cy) => cy.destroy());\n  }\n\n  render() {\n    // we need to redraw the chart on each render\n    // when we use it in tabs or collapsible panel\n    this.redraw();\n\n    return D.div(\n      {},\n      D.div({\n        ref: Graph.CYTOSCAPE_CONTAINER_REF,\n        style: {\n          height: this.props.height,\n          width: '100%',\n\n          // need to be relative if we want to put other plugins inside,\n          // e.g cytoscape-navigator plugin\n          position: 'relative',\n        },\n      }),\n      this.state.cytoscape.map((_) => this.props.children).getOrElse(null)\n    );\n  }\n\n  private setLayout = (layout: Cy.LayoutOptions): void => {\n    this.setState({ layout: layout });\n  };\n\n  private runLayout = () => {\n    this.state.cytoscape.map((cy) => this.getElementsToLayout(cy).makeLayout(this.state.layout).run());\n  };\n\n  private redraw() {\n    this.state.cytoscape.map((cy) => {\n      cy.resize();\n      cy.fit();\n    });\n  }\n\n  /**\n   * When doing graph layout we need to exclude some edges from layout algorithm.\n   * For example edges from child to it's parent.\n   *\n   * @see https://github.com/cytoscape/cytoscape.js-cose-bilkent/issues/25\n   */\n  private getElementsToLayout(cy: Cy.Instance): Cy.CollectionElements {\n    return cy.filter((i, e: any) => {\n      if (e.isNode()) {\n        return true;\n      } else {\n        // filter out edges from child to it's parent and vice-verse\n        return !(e.source().parent().id() === e.target().id() || e.target().parent().id() === e.source().id());\n      }\n    });\n  }\n\n  private replaceCytoscapeData(cytoscape: Cy.Instance, elements: Cy.ElementDefinition[]) {\n    cytoscape.remove('*');\n    cytoscape.add(elements);\n\n    if (elements.length !== 0) {\n      this.runLayout();\n      cytoscape.one('layoutstop', () => cytoscape.trigger(DATA_LOADED_EVENT));\n    }\n  }\n\n  private createCytoscapeInstance(props: Props) {\n    const cy = cytoscape(this.composeCytoscapeConfig(props));\n\n    // attach event handlers\n    const onClick = props.onClick ? props.onClick : identity;\n    cy.on('tap', 'node', onClick);\n    cy.on('tap', 'edge', onClick);\n\n    return cy;\n  }\n\n  private composeCytoscapeConfig(props: Props): Cy.CytoscapeOptions {\n    const opts = {\n      container: this.refs.cytoscape,\n      userZoomingEnabled: false,\n    };\n    const style = {\n      style: this.compileStyles(props.graphStyle),\n    };\n    return assign(opts, this.props, style);\n  }\n\n  private static styleTemplateFunction: (\n    template: CompiledTemplate,\n    x: string\n  ) => (obj: Cy.CollectionFirstElement) => string = function (template: CompiledTemplate, x: string) {\n    return function (obj: Cy.CollectionFirstElement): string {\n      return template(obj.data());\n    };\n  };\n\n  private compileStyles(styles: Cy.Stylesheet[]): Cy.Stylesheet[] {\n    return _.map(styles, (stylesheet: Cy.Stylesheet) => {\n      const style = this.isCssStylesheet(stylesheet) ? stylesheet.css : stylesheet.style;\n      return {\n        selector: this.compileStyleSelector(stylesheet.selector),\n        style: this.compileHandlebarsForStyleValues(style),\n      };\n    });\n  }\n\n  /**\n   *\n   * a) to match on the resource IRI:\n   *    node[resource = iri(<http://example.com>)]\n   * b) to match on the resource Literal:\n   *    node[resource = literal(Alice)]\n   *    node[resource = literal(2, iri(<http://www.w3.org/2001/XMLSchema#integer>))]\n   * c) to match on the outgoing edge of the RDF resource:\n   *    node[proprety(<http://example.com/property>) *= iri(<http://example.com>)]\n   */\n  private compileStyleSelector(selector: string): string {\n    const cytoscapeSelector = selector\n      .replace(/property\\(<(.*?)>\\)/g, (_, iri) => this.escapeJsRegexChars(`-><${iri}>`))\n      .replace(/literal\\((.*?),\\s*iri\\(<(.*?)>\\)\\)/g, (_, literal, iri) => `'\"${literal}\"^^<${iri}>'`)\n      .replace(/iri\\(<(.*?)>\\)/g, (_, iri) => `'<${iri}>'`)\n      .replace(/literal\\((.*?)\\)/g, (_, literal) => `'\"${literal}\"^^${vocabularies.xsd._string}'`);\n    return cytoscapeSelector;\n  }\n\n  private compileHandlebarsForStyleValues(style: Cy.Css.ElementCss): Cy.Css.ElementCss {\n    return _.mapValues(style, (value) => {\n      if (this.HANDLEBARS_REGEX.test(value)) {\n        return Graph.styleTemplateFunction(TemplateScope.default.compileWithoutRemote(value), value);\n      } else {\n        return value;\n      }\n    });\n  }\n\n  private isCssStylesheet(stylesheet: Cy.Stylesheet): stylesheet is Cy.CssStylesheet {\n    return _.has(stylesheet, 'css');\n  }\n\n  /**\n   * Cytoscape stylesheets meta-characters to escape.\n   *\n   * @see http://js.cytoscape.org/#selectors/notes-amp-caveats\n   * @see https://github.com/cytoscape/cytoscape.js/blob/master/src/selector.js#L81\n   */\n  private static STYLE_METACHARS =\n    '[\\\\!\\\\\"\\\\#\\\\$\\\\%\\\\&\\\\\\'\\\\(\\\\)\\\\*\\\\+\\\\,\\\\.\\\\/\\\\:\\\\;\\\\<\\\\=\\\\>\\\\?\\\\@\\\\[\\\\]\\\\^\\\\`\\\\{\\\\|\\\\}\\\\~]';\n\n  private static STYLE_METACHARS_REGEX = new RegExp('(' + Graph.STYLE_METACHARS + ')', 'g');\n\n  /**\n   * Escape Cytoscape style meta-characters.\n   */\n  private escapeJsRegexChars(str: string): string {\n    return str.replace(Graph.STYLE_METACHARS_REGEX, '\\\\$&');\n  }\n}\n\nexport type component = Graph;\nexport const component = Graph;\nexport const factory = createFactory(component);\nexport default component;\n","/**\n * ResearchSpace\n * Copyright (C) 2020, © Trustees of the British Museum\n * Copyright (C) 2015-2019, metaphacts GmbH\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { map, reduce, filter, every, some, cloneDeep } from 'lodash';\nimport { Set, Map } from 'immutable';\nimport * as Kefir from 'kefir';\nimport * as _ from 'lodash';\n\nimport { Rdf } from 'platform/api/rdf';\nimport { SparqlClient, QueryContext } from 'platform/api/sparql';\n\nimport { getLabels } from 'platform/api/services/resource-label';\nimport { getThumbnails } from 'platform/api/services/resource-thumbnail';\nimport { SemanticGraphConfig, configWithHidePredicates, configWithShowPredicates, Stylesheets } from './Config';\n\nconst DEFAULT_THUMBNAIL = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n/**\n * Mapping from Node to parent Node. It is used to construct compound nodes in Cytoscape.\n *\n * Typically it is mapping from some Iri to corresponding named graph Iri.\n */\ntype GroupsMap = Map<Rdf.Node, Set<Rdf.Node>>;\n\ninterface ResourceDataDefinition {\n  node: Rdf.Node;\n  resource: string;\n  label?: string;\n  thumbnail?: string;\n}\n\ninterface ResourceNodeDataDefinition extends ResourceDataDefinition, Cy.NodeDataDefinition {\n  isIri: boolean;\n  isLiteral: boolean;\n  isBnode: boolean;\n}\n\ninterface ResourceEdgeDataDefinition extends ResourceDataDefinition, Cy.EdgeDataDefinition {}\n\ninterface ResourceCytoscapeElement extends Cy.ElementDefinition {\n  data: ResourceNodeDataDefinition | ResourceEdgeDataDefinition;\n}\n\nexport interface ResourceCytoscapeNode extends Cy.NodeDefinition {\n  data: ResourceNodeDataDefinition;\n}\n\nexport interface ResourceCytoscapeEdge extends Cy.EdgeDefinition {\n  data: ResourceEdgeDataDefinition;\n}\n\n/**\n * Special marker that indicates that node doesn't belongs to any compound node.\n */\nconst GLOBAL_GROUP = Rdf.iri('GLOBAL_GROUP');\nconst NO_GROUP_SET = Set.of(GLOBAL_GROUP);\n\n/**\n * Parse component config and apply default styles if needed.\n */\nexport function parseComponentConfig(defaultStyles: Stylesheets, config: SemanticGraphConfig): SemanticGraphConfig {\n  const parsedConfig = cloneDeep(config);\n\n  // Merge user provided styles with defaults.\n  if (_.has(config, 'graphStyle')) {\n    parsedConfig.graphStyle = mergeStyles(defaultStyles, config.graphStyle);\n  } else {\n    parsedConfig.graphStyle = defaultStyles;\n  }\n\n  return parsedConfig;\n}\n\n/**\n * Merge two cytoscape style definitions. If there are two styles with same selector\n * then style definition is taken from the second stylesheet. This way we can make sure\n * that user can reuse default styles and override only what is required.\n */\nfunction mergeStyles(defaultStyles: Stylesheets, overrideStyles: Stylesheets): Stylesheets {\n  // filter default styles which has not been overridden\n  const stylesFromAToKeep = filter(defaultStyles, (d) => !_.some(overrideStyles, (o) => d.selector === o.selector));\n  return stylesFromAToKeep.concat(overrideStyles);\n}\n\n/**\n * Fetch graph data using SPARQL Construct query and then fetch corresponding labels for\n * all resources from query result. Default system label is always available as\n * 'label' property on cytoscape data element.\n */\nexport function getGraphDataWithLabels(\n  config: SemanticGraphConfig,\n  options: { context?: QueryContext }\n): Kefir.Property<ResourceCytoscapeElement[]> {\n  const { context } = options;\n  const graphData = getGraphData(config, context);\n  const labels = graphData.flatMap(fetchLabels(context));\n  const thumbnails = graphData.flatMap(fetchThumbnails(context));\n  return Kefir.combine([graphData, labels, thumbnails], addLabelsToGraphData).toProperty();\n}\n\n/**\n * Put default resource label into cytoscpae 'label' data property.\n */\nexport function addLabelsToGraphData(\n  elements: ResourceCytoscapeElement[],\n  labels: Map<Rdf.Node, string>,\n  thumbnails: Map<Rdf.Node, string>\n): ResourceCytoscapeElement[] {\n  return map(elements, (element) => {\n    element.data.label = labels.get(element.data.node);\n    element.data.thumbnail = thumbnails.get(element.data.node) || DEFAULT_THUMBNAIL;\n    return element;\n  });\n}\n\nfunction fetchLabels(context?: QueryContext) {\n  return function (elements: ResourceCytoscapeElement[]): Kefir.Property<Map<Rdf.Node, string>> {\n    return fetchLabelsForResources(elements, context).map((labels) => getLabelsForLiterals(elements).merge(labels));\n  };\n}\n\n/**\n * Because labels service doesn't support literals we just use literal value as a label.\n */\nfunction getLabelsForLiterals(elements: ResourceCytoscapeElement[]): Map<Rdf.Node, string> {\n  const elementsWithLiterals = elements.filter((e) => e.data.node.isLiteral);\n  return Map(\n    map<ResourceCytoscapeElement, [Rdf.Node, string]>(elementsWithLiterals, (e) => [e.data.node, e.data.node.value])\n  );\n}\n\n/**\n * Fetch labels for resources using [LabelsService].\n */\nfunction fetchLabelsForResources(\n  elements: ResourceCytoscapeElement[],\n  context?: QueryContext\n): Kefir.Property<Map<Rdf.Iri, string>> {\n  const elementsWithIri = filter(elements, (e) => e.data.node.isIri());\n  const iris = map(elementsWithIri, (e) => e.data.node as Rdf.Iri);\n  return getLabels(iris, { context });\n}\n\n/**\n * Fetch thumbnails for resources using [ThumbnailService].\n */\nfunction fetchThumbnails(context?: QueryContext) {\n  return function (elements: ResourceCytoscapeElement[]): Kefir.Property<Map<Rdf.Node, string>> {\n    const elementsWithIri = filter(elements, (e) => e.group === 'nodes' && e.data.node.isIri());\n    const iris = map(elementsWithIri, (e) => e.data.node as Rdf.Iri);\n    return getThumbnails(iris, { context });\n  };\n}\n\n/**\n * Execute SPARQL construct query for graph widget and parse the result to Cytoscape.js format,\n * applying graph widget configuration. See [prepareGraphData] for more details.\n */\nexport function getGraphData(\n  config: SemanticGraphConfig,\n  context: QueryContext\n): Kefir.Property<ResourceCytoscapeElement[]> {\n  return SparqlClient.construct(config.query, { context }).map(prepareGraphData(config));\n}\n\n/**\n * 1) Filter nodes that need to be shown using 'hidePredicates' and 'showPredicates' options.\n * 2) Group nodes if 'groupBy' was provided.\n * 3) Build Cytoscape elements.\n */\nexport function prepareGraphData(config: SemanticGraphConfig): (triples: Rdf.Triple[]) => ResourceCytoscapeElement[] {\n  return (triples: Rdf.Triple[]): ResourceCytoscapeElement[] => {\n    const triplesToShow = filter(triples, getTriplesFilterFunction(config));\n    const groups = getGroups(config, triples);\n    const nodes = buildNodes(triplesToShow, triples, groups);\n    const edges = buildEgdes(triplesToShow, triples, groups);\n    return (edges as Array<ResourceCytoscapeElement>).concat(nodes as Array<ResourceCytoscapeElement>);\n  };\n}\n\n/**\n * Group nodes according to 'groupBy' config properties.\n *\n * @see GroupsMap\n * @see constructGroups\n */\nfunction getGroups(config: SemanticGraphConfig, triples: Rdf.Triple[]): GroupsMap {\n  if (config.groupBy) {\n    return constructGroups(triples, Rdf.fullIri(config.groupBy));\n  } else {\n    return Map<Rdf.Node, Set<Rdf.Node>>();\n  }\n}\n\n/**\n * Create mapping from Nodes to parent Nodes, mapping is based on 'groupByPredicate'.\n *\n * @see GroupsMap\n */\nfunction constructGroups(triples: Rdf.Triple[], groupByPredicate: Rdf.Iri): GroupsMap {\n  const groupByStatements = filter(triples, (triple) => triple.p.equals(groupByPredicate));\n  return reduce(\n    groupByStatements,\n    (map: GroupsMap, triple: Rdf.Triple) => {\n      const groups = map.has(triple.s) ? map.get(triple.s) : Set<Rdf.Node>();\n      return map.set(triple.s, groups.add(triple.o));\n    },\n    Map<Rdf.Node, Set<Rdf.Node>>().asMutable()\n  ).asImmutable();\n}\n\nfunction getTriplesFilterFunction(config: SemanticGraphConfig): (triple: Rdf.Triple) => boolean {\n  // Order is important because property hidePredicates has default value.\n  // configWithHidePredicates(config) is always true.\n  // So if change the order then the second part will not be executed.\n  if (configWithShowPredicates(config)) {\n    // Function to filter only triples which use predicates from 'showPredicates' array.\n    const showPredicates = map(config.showPredicates, Rdf.fullIri);\n    return (triple: Rdf.Triple) => some(showPredicates, (predicate) => predicate.equals(triple.p));\n  } else if (configWithHidePredicates(config)) {\n    const hidePredicates = map(config.hidePredicates, Rdf.fullIri);\n    // Function to filter only triples which do not use predicates from 'hidePredicates' array.\n    return (triple: Rdf.Triple) => every(hidePredicates, (predicate) => predicate.equals(triple.p) === false);\n  } else {\n    return () => true;\n  }\n}\n\nfunction buildNodes(\n  triplesToShow: Rdf.Triple[],\n  allTriples: Rdf.Triple[],\n  groupsMap: GroupsMap\n): ResourceCytoscapeNode[] {\n  const addNode = (acc: Set<Rdf.Node>, triple: Rdf.Triple) => acc.add(triple.s).add(triple.o);\n  const resources = reduce(triplesToShow, addNode, Set<Rdf.Node>());\n\n  const groups = groupsMap.reduce(\n    (acc: Set<Rdf.Node>, groupNodes: Set<Rdf.Node>) => acc.union(groupNodes),\n    Set<Rdf.Node>()\n  );\n  return groups\n    .union(resources)\n    .map((r) => createGraphResourceNodes(r, allTriples, groupsMap.get(r), groupsMap))\n    .flatten()\n    .toArray();\n}\n\nfunction buildEgdes(\n  triplesToShow: Rdf.Triple[],\n  allTriples: Rdf.Triple[],\n  groupsMap: GroupsMap\n): ResourceCytoscapeEdge[] {\n  return Set(triplesToShow)\n    .flatMap((triple: Rdf.Triple) => createGraphResourceEdges(triple, allTriples, groupsMap))\n    .toArray();\n}\n\nfunction createGraphResourceNodes(\n  node: Rdf.Node,\n  triples: Rdf.Triple[],\n  nodeGroups: Set<Rdf.Node> | undefined,\n  groupsMap: GroupsMap\n): Set<ResourceCytoscapeNode> {\n  return nodeGroups\n    ? nodeGroups.map((group) => createGraphNode(node, triples, groupsMap, group))\n    : Set.of(createGraphNode(node, triples, groupsMap));\n}\n\nfunction createGraphNode(\n  node: Rdf.Node,\n  triples: Rdf.Triple[],\n  groupsMap: GroupsMap,\n  nodeGroup: Rdf.Node | undefined = undefined\n): ResourceCytoscapeNode {\n  /**\n   * generate group id for nested groups. Currently group can't be nested in\n   * multiple groups at the same time\n   */\n  const nodeGroupGroup = groupsMap.has(nodeGroup) ? groupsMap.get(nodeGroup).first() : undefined;\n  const cytoscapeNode: ResourceCytoscapeNode = {\n    group: 'nodes',\n    data: {\n      id: createNodeId(node, nodeGroup),\n\n      // if node belongs to some group it is specified as 'parent' property,\n      // see http://js.cytoscape.org/#notation/compound-nodes\n      parent: nodeGroup ? createNodeId(nodeGroup, nodeGroupGroup) : undefined,\n      node: node,\n      resource: node.toString(),\n      isIri: node.isIri(),\n      isLiteral: node.isLiteral(),\n      isBnode: node.isBnode(),\n    },\n  };\n  return addPropertiesToTheElementData(triples, cytoscapeNode);\n}\n\nfunction createNodeId(node: Rdf.Node, nodeGroup: Rdf.Node | undefined = undefined): string {\n  return nodeGroup && !nodeGroup.equals(GLOBAL_GROUP) ? nodeGroup.toString() + node.toString() : node.toString();\n}\n\nfunction createGraphResourceEdges(\n  triple: Rdf.Triple,\n  triples: Rdf.Triple[],\n  groupsMap: GroupsMap\n): Set<ResourceCytoscapeEdge> {\n  if (groupsMap.isEmpty()) {\n    // when we don't have any compound nodes, generate simple single edge.\n    return Set.of(createGraphEdge(triple.s.toString(), triple.o.toString(), triple.p, triples));\n  } else {\n    return createEdgesWithGroups(triple, triples, groupsMap);\n  }\n}\n\n/*\n * When we have compound nodes, situation is a little bit tricky, because node can be\n * part of multiple groups, so we need to make sure that it is properly visualized in\n * all of them.\n *\n * We duplicate node in all compound nodes that it belongs to.\n */\nfunction createEdgesWithGroups(\n  triple: Rdf.Triple,\n  triples: Rdf.Triple[],\n  groupsMap: GroupsMap\n): Set<ResourceCytoscapeEdge> {\n  const subjectGroups = groupsMap.has(triple.s) ? groupsMap.get(triple.s) : NO_GROUP_SET;\n  const objectGroups = groupsMap.has(triple.o) ? groupsMap.get(triple.o) : NO_GROUP_SET;\n\n  // check if object and subject share the same group\n  const shareTheGroup = !subjectGroups.intersect(objectGroups).isEmpty();\n\n  // basically we need to generate edges for all possible group permutations\n  return subjectGroups.flatMap((subjectGroup) =>\n    objectGroups\n      .filterNot(\n        // but do not generate outgoing edges to other groups if nodes belongs to the same group\n        (objectGroup) => !objectGroup.equals(subjectGroup) && shareTheGroup\n      )\n      .map((objectGroup) =>\n        createGraphEdge(createNodeId(triple.s, subjectGroup), createNodeId(triple.o, objectGroup), triple.p, triples)\n      )\n  );\n}\n\nfunction createGraphEdge(\n  subjectNodeId: string,\n  objectNodeId: string,\n  predicate: Rdf.Node,\n  triples: Rdf.Triple[]\n): ResourceCytoscapeEdge {\n  const cytoscapeEdge: ResourceCytoscapeEdge = {\n    group: 'edges',\n    data: {\n      id: subjectNodeId + predicate.toString() + objectNodeId,\n      node: predicate,\n      resource: predicate.toString(),\n      source: subjectNodeId,\n      target: objectNodeId,\n    },\n  };\n  return addPropertiesToTheElementData(triples, cytoscapeEdge);\n}\n\nfunction addPropertiesToTheElementData<T extends ResourceCytoscapeElement>(\n  triples: Rdf.Triple[],\n  cytoscapeElement: T\n): T {\n  return reduce(\n    triples,\n    (resultingNode: T, triple: Rdf.Triple) => {\n      if (triple.s.equals(resultingNode.data.node)) {\n        return updateElementPropertyValue(resultingNode, triple);\n      } else {\n        return resultingNode;\n      }\n    },\n    cytoscapeElement\n  );\n}\n\nfunction updateElementPropertyValue<T extends ResourceCytoscapeElement>(node: T, triple: Rdf.Triple): T {\n  const propertyValues: Array<Rdf.Node> = node.data[triple.p.toString()] || [];\n  propertyValues.push(triple.o);\n  node.data[triple.p.toString()] = propertyValues;\n\n  /*\n   * For all outgoing RDF properties we generate special data properties for cytoscape: \"->URI\".\n   * So it is possible to use them in Cytoscape style selector.\n   * E.g to select all nodes which have rdf:type owl:Thing:\n   * '-><http://www.w3.org/1999/02/22-rdf-syntax-ns#type>'*='<http://www.w3.org/2002/07/owl#Thing>'\n   */\n  node.data['->' + triple.p.toString()] = propertyValues.join(' ');\n  return node;\n}\n"],"sourceRoot":""}