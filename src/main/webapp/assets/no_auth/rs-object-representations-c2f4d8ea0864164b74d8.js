(window.webpackJsonp=window.webpackJsonp||[]).push([[461],{1486:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var i=a(11),s=a(1),o=a(35),n=a(72),r=a(7),d=a(2257),l=a(33),p=a(16),c=a(56),g=a(61),h=a(649),u=a(327),m=s.createFactory(n.Modal),R=s.createFactory(n.Modal.Header),f=s.createFactory(n.Modal.Title),v=s.createFactory(n.Modal.Body);a(1487);var I=function(e){function ObjectRepresentationsWidget(t,a){var i=e.call(this,t,a)||this;return i.handleImageChanges=function(e){var t=e.target.offsetHeight/e.target.offsetWidth;i.LARGEST_PREVIEW_REP_WIDTH*t>i.largestPreviewRepHeight&&(i.largestPreviewRepHeight=i.LARGEST_PREVIEW_REP_WIDTH*t),i.setImageLoaded(e),i.setState({imagesAreLoading:!i.allImagesAreLoaded()})},i.showModalNav=function(){!1===i.state.modalNavIsDisplayed&&i.allReps.length>1&&i.setState({modalNavIsDisplayed:!0})},i.hideModalNav=function(){i.setState({modalNavIsDisplayed:!1})},i.handleModalKeyEvents=function(e){37===e.keyCode?i.prevModalImage():39===e.keyCode?i.nextModalImage():27===e.keyCode&&i.hideModalNav()},i.state={modalIsDisplayed:!1,modalNavIsDisplayed:!1,isLoading:!0,imagesAreLoading:!0,mainPreviewRep:l.Nothing(),focusedPreviewRep:l.Nothing(),focusedModalRep:l.Nothing()},i.allReps=[],i.entityLabel="",i.largestPreviewRepHeight=0,i.LARGEST_PREVIEW_REP_WIDTH=300,i.TRANSITION_TIME=300,i}return i.__extends(ObjectRepresentationsWidget,e),ObjectRepresentationsWidget.prototype.componentDidMount=function(){this.executeQuery(this.props)},ObjectRepresentationsWidget.prototype.executeQuery=function(e){var t=this,a=l.Nothing(),i=l.Nothing(),s=[];g.SparqlClient.select(e.query).onValue((function(e){g.SparqlUtil.isSelectResultEmpty(e)||p.forEach(e.results.bindings,(function(e){a.isNothing&&"true"===e.isMainRep.value?(a=l.Just({imgURL:e.imgURL.value,loaded:!1}),i=l.Just({imgURL:e.imgURL.value,loaded:!1})):e.imgURL&&s.push({imgURL:e.imgURL.value,loaded:!1}),e.label&&(t.entityLabel=e.label.value)})),a.isNothing&&s.length&&(a=l.Just(s.shift()),i=a),a.isNothing&&0===s.length?t.setState({imagesAreLoading:!1}):(a.isJust&&t.addToAllReps(a.get().imgURL),s.length&&p.forEach(s,(function(e){t.addToAllReps(e.imgURL)}))),t.setState({data:e,modalIsDisplayed:!1,isLoading:!1,mainPreviewRep:a,otherPreviewReps:s,focusedPreviewRep:i,focusedModalRep:i})}))},ObjectRepresentationsWidget.prototype.render=function(){return o.div.apply(o,i.__spreadArrays([{className:"object-representations modal-container"}],this.state.isLoading?[s.createElement(u.Spinner)]:this.getContents()))},ObjectRepresentationsWidget.prototype.getContents=function(){return this.state.mainPreviewRep.isJust?[this.createFocusedImageRepresentation(),this.createThumbnails(),this.createModal(),this.state.imagesAreLoading?s.createElement(u.Spinner):null]:[s.createElement(h.default,{template:{source:this.props.noImageTemplate}})]},ObjectRepresentationsWidget.prototype.createFocusedImageRepresentation=function(){var e=this.state.focusedPreviewRep.get().imgURL,t={height:this.largestPreviewRepHeight+"px"};return o.div({title:"Click to view full-size image",className:"object-representations__image--focused",style:t,onClick:this.showModal.bind(this),onLoad:this.handleImageChanges},s.createElement(d.TransitionGroup,{key:"image-focused-transition-group"},s.createElement(d.CSSTransition,{key:e,classNames:"cross-fade",timeout:{enter:this.TRANSITION_TIME,exit:this.TRANSITION_TIME}},o.img({className:"image--focused",src:e,key:e}))))},ObjectRepresentationsWidget.prototype.createThumbnails=function(){var e=this;return s.createElement(d.TransitionGroup,{key:"image-thumbs-transition-group"},s.createElement(d.CSSTransition,{key:"object-representations__images",classNames:"fade-in",appear:!0,timeout:{appear:this.TRANSITION_TIME,enter:this.TRANSITION_TIME,exit:this.TRANSITION_TIME}},o.div({key:"object-representations__images",className:"object-representations__images"},this.state.otherPreviewReps.length?s.createElement(h.default,{key:"main-rep-thumb",template:{source:this.props.template,options:{imgURL:{value:this.state.mainPreviewRep.get().imgURL}}},componentProps:{className:r({"object-representations__image--active":this.state.mainPreviewRep.get().imgURL===this.state.focusedPreviewRep.get().imgURL,"object-representations__image":this.state.mainPreviewRep.get().imgURL!==this.state.focusedPreviewRep.get().imgURL}),onClick:function(){return e.updateFocusedImage(e.state.mainPreviewRep.get().imgURL)},onLoad:this.handleImageChanges}}):null,this.state.otherPreviewReps.map((function(t,a){return s.createElement(h.default,{key:"other-rep-thumb-"+a,template:{source:e.props.template,options:{imgURL:{value:t.imgURL}}},componentProps:{className:r({"object-representations__image--active":e.state.focusedPreviewRep.get().imgURL===t.imgURL,"object-representations__image":e.state.focusedPreviewRep.get().imgURL!==t.imgURL}),onClick:function(){return e.updateFocusedImage(t.imgURL)},onLoad:e.handleImageChanges}})})))))},ObjectRepresentationsWidget.prototype.createModal=function(){var e=this.state.focusedModalRep.isJust?this.state.focusedModalRep.get().imgURL:"",t={width:this.state.focusedModalRep.isJust?this.state.focusedModalRep.get().width+2+"px":"0",overflow:"hidden",margin:"auto",paddingLeft:"0"};return m({style:t,className:"object-representations-modal__container",dialogClassName:"object-representations-modal",show:this.state.modalIsDisplayed,onHide:this.hideModal.bind(this),onMouseEnter:this.showModalNav,onMouseLeave:this.hideModalNav,onKeyUp:this.handleModalKeyEvents},R({closeButton:!0},f({},this.entityLabel)),v({},s.createElement(d.TransitionGroup,{key:"modal-nav-transition-group",className:"object-representations-modal__body",style:{width:this.state.focusedModalRep.isJust?this.state.focusedModalRep.get().width+"px":"0px",height:this.state.focusedModalRep.isJust?this.state.focusedModalRep.get().height+"px":"0px"}},this.state.modalNavIsDisplayed?[s.createElement(d.CSSTransition,{key:"left",classNames:"fade-in",appear:!0,leave:"true",timeout:{appear:this.TRANSITION_TIME,enter:this.TRANSITION_TIME,exit:this.TRANSITION_TIME}},o.span({className:"object-representations-modal__nav fa fa-chevron-circle-left",onClick:this.prevModalImage.bind(this)})),s.createElement(d.CSSTransition,{key:"right",classNames:"fade-in",appear:!0,leave:"true",timeout:{appear:this.TRANSITION_TIME,enter:this.TRANSITION_TIME,exit:this.TRANSITION_TIME}},o.span({className:"object-representations-modal__nav fa fa-chevron-circle-right",onClick:this.nextModalImage.bind(this)}))]:[]),o.img({src:e,style:{width:this.state.focusedModalRep.isJust?this.state.focusedModalRep.get().width+"px":"0px"}})))},ObjectRepresentationsWidget.prototype.updateFocusedImage=function(e){var t=p.find(this.allReps,(function(t){return t.imgURL===e}));this.setState({focusedPreviewRep:l.Just(t),focusedModalRep:l.Just(t)})},ObjectRepresentationsWidget.prototype.setImageLoaded=function(e){var t=this,a=window.innerHeight-50;p.forEach(this.allReps,(function(i){if(p.includes(e.target.currentSrc,i.imgURL)){if(i.loaded=!0,i.width=e.target.naturalWidth<=t.props.maxModalWidth?e.target.naturalWidth:t.props.maxModalWidth,i.height=i.width/(e.target.naturalWidth/e.target.naturalHeight),i.height>a&&(i.height=a,i.width=i.height/(e.target.naturalHeight/e.target.naturalWidth)),i.imgURL===t.state.focusedPreviewRep.get().imgURL){var s=t.state.focusedPreviewRep.get();s.width=i.width,s.height=i.height,t.setState({focusedPreviewRep:l.Just(s)})}return!1}}))},ObjectRepresentationsWidget.prototype.addToAllReps=function(e){p.some(this.allReps,["imgURL",e])||this.allReps.push({imgURL:e,loaded:!1})},ObjectRepresentationsWidget.prototype.allImagesAreLoaded=function(){return p.every(this.allReps,["loaded",!0])},ObjectRepresentationsWidget.prototype.hideModal=function(){this.setState({modalIsDisplayed:!1,focusedModalRep:this.state.focusedPreviewRep})},ObjectRepresentationsWidget.prototype.showModal=function(){this.setState({modalIsDisplayed:!0})},ObjectRepresentationsWidget.prototype.nextModalImage=function(){if(this.allReps.length>1){var e=p.findIndex(this.allReps,{imgURL:this.state.focusedModalRep.get().imgURL});if(-1!==e){var t=e===this.allReps.length-1?0:e+1;this.setState({focusedModalRep:l.Just(this.allReps[t])})}}},ObjectRepresentationsWidget.prototype.prevModalImage=function(){if(this.allReps.length>1){var e=p.findIndex(this.allReps,{imgURL:this.state.focusedModalRep.get().imgURL});if(-1!==e){var t=0===e?this.allReps.length-1:e-1;this.setState({focusedModalRep:l.Just(this.allReps[t])})}}},ObjectRepresentationsWidget.defaultProps={query:"",template:'<img class="object-representations__image--rep" src="{{imgURL.value}}"/>',context:{},maxModalWidth:1200,noImageTemplate:"<div>no image</div>"},ObjectRepresentationsWidget}(c.Component);t.ObjectRepresentationsWidget=I,t.c=I,t.f=s.createFactory(t.c),t.default=t.c}}]);
//# sourceMappingURL=rs-object-representations-c2f4d8ea0864164b74d8.js.map