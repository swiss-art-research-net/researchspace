(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1247:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),o=r(1),i=r(35),a=r(20),s=r(19),l=r(16),c=r(72),u=r(7),d=r(34),p=r(23),h=r(61),f=r(140),m=r(56),y=r(116),v=r(1601),S=r(327),g=r(328),T=r(1887),b=r(1774),C=r(1888),_=r(1889),F=r(2084),w=r(2086),x=r(1323),N=function(e){function SemanticTreeInput(t,r){var o=e.call(this,t,r)||this;return o.cancellation=new d.Cancellation,o.search=o.cancellation.derive(),o.setInitialSelection=function(){var e=o.props.initialSelection;e&&0!==e.length&&o.cancellation.map(f.getLabels(e)).flatMap((function(t){var r=e.map((function(e){return{item:e,label:t.has(e)?p.Rdf.literal(t.get(e)):void 0,hasChildren:p.Rdf.literal(!0)}}));return o.restoreTreeFromLeafNodes(r)})).observe({value:function(e){var t=e;o.setState({confirmedSelection:t})},error:function(e){return console.error("Failed to restore initial tree selection",e)}})},o.state=n.__assign(n.__assign({},o.createQueryModel(o.props)),{mode:{type:"collapsed"},forest:F.Node.readyToLoadForest,confirmedSelection:b.TreeSelection.empty(F.Node.emptyForest)}),o}return n.__extends(SemanticTreeInput,e),SemanticTreeInput.prototype.componentDidMount=function(){this.setInitialSelection()},SemanticTreeInput.prototype.componentWillReceiveProps=function(e){var t=this.props;t.rootsQuery===e.rootsQuery&&t.childrenQuery===e.childrenQuery&&t.parentsQuery===e.parentsQuery&&t.searchQuery===e.searchQuery||this.setState(this.createQueryModel(e))},SemanticTreeInput.prototype.createQueryModel=function(e){var t=this;try{return{model:new F.SparqlNodeModel({rootsQuery:h.SparqlUtil.parseQuerySync(e.rootsQuery),childrenQuery:h.SparqlUtil.parseQuerySync(e.childrenQuery),parentsQuery:h.SparqlUtil.parseQuerySync(e.parentsQuery),limit:200,sparqlOptions:function(){return{context:t.context.semanticContext}}}),searchQuery:h.SparqlUtil.parseQuerySync(e.searchQuery)}}catch(e){return{loadError:e}}},SemanticTreeInput.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticTreeInput.prototype.render=function(){var e=this;if(this.state.loadError)return i.div({className:u(x.holder,this.props.className)},o.createElement(y.ErrorNotification,{errorMessage:this.state.loadError}));var t=i.div({ref:function(t){return e.overlayHolder=t},className:u(x.holder,this.props.className)},i.div({className:x.inputAndButtons},this.renderTextField(),this.renderBrowseButton()),this.renderOverlay());return this.props.droppable?o.createElement(g.Droppable,{query:this.props.droppable.query,dropStyles:this.props.droppable.styles,dropComponents:n.__assign({},this.props.droppable.components),onDrop:function(t){e.setValue(t)}},t):t},SemanticTreeInput.prototype.setValue=function(e){var t=this;this.cancellation.map(f.getLabel(e)).onValue((function(r){var n=b.TreeSelection.setToSingleTerminal(b.TreeSelection.empty(t.state.forest),{iri:e,label:p.Rdf.literal(r)});t.setState({mode:{type:"collapsed"},searchText:void 0,searching:!1,searchResult:void 0,confirmedSelection:n},(function(){t.props.onSelectionChanged&&t.props.onSelectionChanged(t.state.confirmedSelection)}))}))},SemanticTreeInput.prototype.renderTextField=function(){var e=this,t={ref:function(t){return e.textInput=t},className:x.textInput,inputClassName:x.input,value:this.state.searchText||"",placeholder:this.props.placeholder,onFocus:function(){return e.setState({searchInputFocused:!0,mode:"collapsed"===e.state.mode.type&&e.props.openDropdownOnFocus?{type:"full",selection:e.state.confirmedSelection}:e.state.mode})},onBlur:function(){e.setState({searchInputFocused:!1}),e.state.searchText||e.props.openDropdownOnFocus||e.closeDropdown({saveSelection:!1})},onChange:function(t){return e.searchFor(t.currentTarget.value,!1)},onKeyDown:function(t){13===t.keyCode&&e.state.searchInputFocused&&e.searchFor(e.state.searchText,!0)},onClear:function(){(e.state.searchInputFocused||e.state.searchText)&&e.closeDropdown({saveSelection:!1})}},r=this.state.confirmedSelection,n=b.TreeSelection.leafs(r).sortBy((function(e){return e.label.value})),i=this.props.onSelectionClick;return o.createElement(v.ClearableInput,t,n.map((function(t){return o.createElement(v.RemovableBadge,{key:t.iri.value,title:t.iri.value,onClick:i?function(){return i(r,t)}:void 0,onRemove:function(){var r=e.state.confirmedSelection,n=b.TreeSelection.unselect(r,r.keyOf(t));e.setState({confirmedSelection:n},(function(){e.props.onSelectionChanged&&e.props.onSelectionChanged(n)}))}},t.label.value)})).toArray())},SemanticTreeInput.prototype.searchFor=function(e,t){var r=this,n=this.props.allowForceSuggestion&&t||e.length>=3;if(n){this.state.searching&&this.state.searchText===e||(this.setState({searchText:e,searchForce:t,searching:n,mode:{type:"search",selection:this.state.confirmedSelection}}),this.search=this.cancellation.deriveAndCancel(this.search),this.search.map(this.performSearch(e)).observe({value:function(e){return r.setState({searchResult:e,searching:!1})},error:function(e){return r.setState({searchResult:{error:e},searching:!1})}}))}else{this.search.cancelAll();var o=this.state.mode;0!==e.length||this.props.openDropdownOnFocus?e.length>0&&(o={type:"search",selection:this.state.confirmedSelection}):o={type:"collapsed"},this.setState({mode:o,searchText:e,searchForce:t})}},SemanticTreeInput.prototype.performSearch=function(e){var t=this,r=h.SparqlClient.setBindings(this.state.searchQuery,{__token__:h.SparqlUtil.makeLuceneQuery(e)});return s.later(300,{}).flatMap((function(){return h.SparqlClient.select(r)})).flatMap((function(e){return t.restoreTreeFromLeafNodes(e.results.bindings).map((function(t){return{forest:t,matchedCount:e.results.bindings.length,matchLimit:r.limit}}))}))},SemanticTreeInput.prototype.renderBrowseButton=function(){var e,t=this;return o.createElement(c.OverlayTrigger,{placement:"bottom",overlay:o.createElement(c.Tooltip,{id:"SemanticTreeInput__tooltip"},"Browse full hierarchy")},o.createElement(c.Button,{className:x.browseButton,active:"full"===this.state.mode.type,onClick:function(){var e=t.state.mode.type;"collapsed"===e||"search"===e?(t.search.cancelAll(),t.setState({searchText:void 0,searching:!1,searchResult:void 0,mode:{type:"full",selection:t.state.confirmedSelection}})):"full"===e&&t.closeDropdown({saveSelection:!1})}},i.span(((e={className:"fa fa-sitemap fa-lg"})["aria-hidden"]=!0,e))))},SemanticTreeInput.prototype.closeDropdown=function(e){this.search.cancelAll(),this.setState((function(t,r){var n=t.mode,o={mode:{type:"collapsed"},searchText:void 0,searching:!1,searchResult:void 0};return"collapsed"!==n.type&&e.saveSelection&&(o.confirmedSelection=n.selection,r.onSelectionChanged&&r.onSelectionChanged(n.selection)),o}))},SemanticTreeInput.prototype.renderOverlay=function(){var e=this,t=this.state.mode;return o.createElement(c.Overlay,{show:"collapsed"!==t.type,placement:"bottom",container:this.overlayHolder,target:function(){return a.findDOMNode(e.textInput)}},o.createElement(I,{},"collapsed"===t.type?i.div({}):i.div({className:x.dropdown},this.renderDropdownContent(t),this.renderDropdownFooter(t))))},SemanticTreeInput.prototype.updateForest=function(e,t,r){this.setState((function(r,n){return e?{searchResult:l.assign({},r.searchResult,{forest:t(r.searchResult.forest,r,n)})}:{forest:t(r.forest,r,n)}}),r)},SemanticTreeInput.prototype.renderDropdownContent=function(e){if("search"===e.type){if(this.state.searchText.length<3&&(!this.state.searchForce||!this.props.allowForceSuggestion))return i.span({className:x.searchMessage},"Minimum length of search term is 3 characters.");if(this.state.searching)return o.createElement(S.Spinner,{className:x.searchSpinner});if(this.state.searchResult.error)return o.createElement(y.ErrorNotification,{errorMessage:this.state.searchResult.error})}return this.renderScrollableDropdownContent(e)},SemanticTreeInput.prototype.renderScrollableDropdownContent=function(e){var t=null;if("search"===e.type){var r=this.state.searchResult,n=r.matchedCount,o=r.matchLimit,a=r.forest;if(o&&n===o)t=i.span({className:x.searchMessage},"Only first "+n+" matches are shown. Please refine your search.");else if(!a.root.children||0===a.root.children.length)return i.span({className:x.searchMessage},"No results found.")}return i.div({className:x.tree},this.renderTree(e),t)},SemanticTreeInput.prototype.renderDropdownFooter=function(e){var t=this,r=e.selection!==this.state.confirmedSelection;return i.div({className:x.dropdownFooter},o.createElement(c.Button,{className:x.dropdownButton,bsStyle:"danger",onClick:function(){return t.closeDropdown({saveSelection:!1})}},"Cancel"),o.createElement(c.Button,{className:x.dropdownButton,bsStyle:"success",disabled:!r,onClick:function(){return t.closeDropdown({saveSelection:!0})}},"Select"))},SemanticTreeInput.prototype.renderTree=function(e){var t=this,r="search"===e.type,n=r?this.state.searchResult.forest:this.state.forest,i=r&&this.state.searchText?this.state.searchText.toLowerCase():void 0,a={forest:n,isLeaf:function(e){return e.children?0===e.children.length&&!t.state.model.hasMoreChildren(e):void 0},childrenOf:function(e){return{children:e.children,loading:e.loading,hasMoreItems:t.state.model.hasMoreChildren(e)}},renderItem:function(e){return t.renderItem(e,i)},requestMore:function(e){var o=n.getKeyPath(e);t.requestChildren(o,r)},selectionMode:this.props.multipleSelection?C.MultipleFullSubtrees():C.SingleFullSubtree(),selection:e.selection,onSelectionChanged:function(e){t.setState((function(t){return"collapsed"===t.mode.type?{}:{mode:{type:t.mode.type,selection:e}}}),(function(){t.props.closeDropdownOnSelection&&t.closeDropdown({saveSelection:!0})}))},isExpanded:function(e){return e.expanded},onExpandedOrCollapsed:function(e,o){var i=n.getKeyPath(e);t.updateForest(r,(function(e){return e.updateNode(i,(function(e){return _.TreeNode.set(e,{expanded:o})}))}))}};return o.createElement(w.LazyTreeSelector,a)},SemanticTreeInput.prototype.renderItem=function(e,t){var r=e.label?e.label.value:e.iri.value,o=[r];if(t){var a=r.toLowerCase().indexOf(t);if(a>=0){var s=a+t.length;o=[r.substring(0,a),i.span({className:x.highlighted},r.substring(a,s)),r.substring(s)]}}return i.span.apply(i,n.__spreadArrays([{title:e.iri.value,className:e.error?x.error:void 0}],o))},SemanticTreeInput.prototype.requestChildren=function(e,t){var r,n=this;this.updateForest(t,(function(t,n){var o=_.queryMoreChildren((function(e){return n.model.loadMoreChildren(e)}),t,e),i=o[0],a=o[1];return r=a,i}),(function(){(t?n.search:n.cancellation).map(r).onValue((function(e){return n.updateForest(t,e)}))}))},SemanticTreeInput.prototype.restoreTreeFromLeafNodes=function(e){var t=e.map((function(e){var t=e.item,r=e.score,n=void 0===r?p.Rdf.literal("0"):r,o=e.label,i=e.hasChildren;if(t.isIri()&&o.isLiteral()){var a=i.isLiteral()&&"false"===i.value;return{iri:t,label:o,score:parseFloat(n.isLiteral()?n.value:""),children:[],reachedLimit:a}}})).filter((function(e){return void 0!==e}));return this.state.model.loadFromLeafs(t,{transitiveReduction:!0}).map((function(e){return T.KeyedForest.create(F.Node.keyOf,F.sealLazyExpanding(e))}))},SemanticTreeInput}(m.Component);t.SemanticTreeInput=N;var I=function(e){function OverlayProxy(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(OverlayProxy,e),OverlayProxy.prototype.render=function(){return o.Children.only(this.props.children)},OverlayProxy}(m.Component);t.default=N},1774:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(11),i=r(43);!function(e){e.set=function set(e,t){return o.__assign(o.__assign({},e),t)}}(n=t.SelectionNode||(t.SelectionNode={})),function(e){function isTerminal(e){return!e.children}function isLeaf(e){return isTerminal(e)||0===e.children.length}function select(t,r){for(var a=void 0,s=r.slice();s.length>0;){var l=s[0],c=t.keyOf(l),u=(t.nodes.get(c)||i.Set()).find((function(e){return t.getParent(e)===a}));if(!u)break;if(a=u,e.isTerminal(a))return t;s.shift()}if(0===s.length)return t;var d=s.reduceRight((function(e,t){return n.set(t,{children:e?[e]:[]})}),void 0);return t.updateChildren(t.getKeyPath(a),(function(e){return d?o.__spreadArrays(e,[d]):void 0}))}function makeTerminal(e,t){var removeChildren=function(){};return(e.nodes.get(t)||i.Set()).reduce((function(e,t){return e.updateChildren(e.getKeyPath(t),removeChildren)}),e)}function selectTerminal(e,t){var r=t[t.length-1];return makeTerminal(select(e,t),e.keyOf(r))}function excludeNode(e,t){var r=e.getParent(t);return e.updateChildren(e.getKeyPath(r),(function(e){return e.filter((function(e){return e!==t}))}))}e.empty=function empty(e){var t=o.__assign(o.__assign({},e.root),{children:[]});return e.setRoot(t)},e.isTerminal=isTerminal,e.isLeaf=isLeaf,e.leafs=function leafs(e){return e.nodes.map((function(e){return e.find(isLeaf)})).filter((function(t){return!(void 0===t||e.isRoot(t))})).toList()},e.nodesFromKey=function nodesFromKey(e,t){return e&&e.nodes.get(t)||i.Set()},e.setToSingleTerminal=function setToSingleTerminal(e,t){return e.updateChildren(e.getKeyPath(e.root),(function(){return[n.set(t,{children:void 0})]}))},e.select=select,e.makeTerminal=makeTerminal,e.selectTerminal=selectTerminal,e.unselect=function unselect(e,t){for(var r=e;;){var o=r.nodes.get(t);if(!o||0===o.size)return r;var i=o.first();if(r.isRoot(i))return isTerminal(r.root)?r.setRoot(n.set(r.root,{children:[]})):r;for(var a=r.getNodePath(i).slice(),s=a.pop(),l=0,c=a.reverse();l<c.length;l++){var u=c[l];if(r.isRoot(u))break;if(u.children&&u.children.length>1)break;s=u}r=excludeNode(r,s)}},e.selectAndCollapseToTerminal=function selectAndCollapseToTerminal(e,t,r){var n=selectTerminal(e,t.getNodePath(r)),o=t.getParent(r);return t.isRoot(o)?n:o.children.every((function(e){return n.nodes.has(t.keyOf(e))}))?selectAndCollapseToTerminal(n,t,o):n},e.materializeAndExclude=function materializeAndExclude(e,t,r,o){void 0===o&&(o={});var i=t.getParent(r);if(!i)return e;var a=t.getKeyPath(i),s=t.keyOf(r);if(0===(e=(e=function materializeTerminalChildren(e,t,r){if(!e.fromKeyPath(r)){var o=function getParentPath(e){if(0===e.length)throw new Error("Cannot make parent path from root path");return e.slice(0,e.length-1)}(r);e=materializeTerminalChildren(e,t,o)}var i=t.fromKeyPath(r),a=e.fromKeyPath(r);if(i&&isTerminal(a))return e.updateChildren(r,(function(){return i.children.map((function(e){return n.set(e,{children:void 0})}))}));return e}(e,t,a)).updateChildren(a,(function(t){return t.filter((function(t){return e.keyOf(t)!==s}))}))).fromKeyPath(a).children.length&&!o.leaveParentSelected){var l=t.fromKeyPath(a);e=materializeAndExclude(e,t,l,o)}return e},e.childOfParent=function childOfParent(e,t,r){if(!parent)return!1;for(var n=e.getParent(t);n;){if(e.keyOf(n)===r)return!0;n=e.getParent(n)}return!1}}(t.TreeSelection||(t.TreeSelection={}))},1887:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),o=r(43),i=function(){function KeyedForest(e,t){this.keyOf=e,this.root=t;var r=o.Map([[e(t),o.Set([t])]]).asMutable(),n=o.Map([[t,{parent:void 0,index:0}]]).asMutable();!function computeMappingAndPaths(e,t,r,n){if(!n.children)return;n.children.forEach((function(i,a){r.update(i,(function(t){if(t)throw new Error("Duplicate item '"+e(i)+"' exists in both '"+e(t.parent)+"' and '"+e(n)+"' parents");return{parent:n,index:a}})),t.update(e(i),o.Set(),(function(e){return e.add(i)})),computeMappingAndPaths(e,t,r,i)}))}(this.keyOf,r,n,t),this.nodes=r.asImmutable(),this.parents=n.asImmutable()}return KeyedForest.create=function(e,t){return new KeyedForest(e,t)},KeyedForest.prototype.isRoot=function(e){return e===this.root},KeyedForest.prototype.getFirst=function(e){var t=this.nodes.get(e);return t?t.first():void 0},KeyedForest.prototype.getParent=function(e){var t=this.parents.get(e);if(!t)throw new Error("Cannot get parent for node from another forest.");return t.parent},KeyedForest.prototype.getKeyPath=function(e){for(var t=[],r=e;r;){var n=this.parents.get(r);if(!n)throw new Error("Cannot compute path to node from another forest.");var o=n.parent;o&&t.unshift(this.keyOf(r)),r=o}return t},KeyedForest.prototype.fromKeyPath=function(e){for(var t=this.root,r=0,n=e;r<n.length;r++){var o=n[r],i=this.getChildIndex(t,o);if("number"!=typeof i)return;if(!(t=t.children[i]))break}return t},KeyedForest.prototype.getChildIndex=function(e,t){var r,n=this,o=this.nodes.get(t);if(o)return o.find((function(t){return(r=n.parents.get(t))&&r.parent===e})),r?r.index:void 0},KeyedForest.prototype.getNodePath=function(e){var t=[],r=e;do{t.unshift(r),r=this.parents.get(r).parent}while(r);return t},KeyedForest.prototype.setRoot=function(e){return new KeyedForest(this.keyOf,e)},KeyedForest.prototype.mapRoot=function(e){return this.setRoot(e(this.root))},KeyedForest.prototype.updateNode=function(e,t){var r=this.updateNodeAt(this.root,e,0,t);return this.setRoot(r)},KeyedForest.prototype.removeNode=function(e){var t=this;if(0===e.length)throw new Error("Cannot remove root node.");var r=e.length-1,o=e.slice(0,r);return this.updateNode(o,(function(o){var i=t.getChildIndex(o,e[r]),a=n.__spreadArrays(o.children);return a.splice(i,1),n.__assign(n.__assign({},o),{children:a})}))},KeyedForest.prototype.updateNodeAt=function(e,t,r,o){if(r===t.length)return o(e);var i=t[r],a=this.getChildIndex(e,i),s=e.children[a],l=n.__spreadArrays(e.children);return l.splice(a,1,this.updateNodeAt(s,t,r+1,o)),n.__assign(n.__assign({},e),{children:l})},KeyedForest.prototype.updateChildren=function(e,t){return this.updateNode(e,(function(e){return n.__assign(n.__assign({},e),{children:t(e.children)})}))},KeyedForest}();t.KeyedForest=i,t.mapBottomUp=function mapBottomUp(e,t){var mapNode=function(e){if(e.children){var r=e.children.map(mapNode);return t(n.__assign(n.__assign({},e),{children:r}))}return t(e)};return mapNode(e)}},1888:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(11),i=r(1774);!function(e){e[e.None=0]="None",e[e.Partial=1]="Partial",e[e.Full=2]="Full",e[e.FullGreyedOut=3]="FullGreyedOut"}(n=t.CheckState||(t.CheckState={}));var a={renderSelected:function(e,t,r,o,a){return a?n.Full:o?i.TreeSelection.isLeaf(o)?n.Full:n.Partial:n.None},change:function(e,t,r,n,o){var a=i.TreeSelection.empty(e);return n?a:i.TreeSelection.selectTerminal(a,e.getNodePath(t))}};t.SingleFullSubtree=function SingleFullSubtree(){return a};var s={renderSelected:function(e,t,r,o,i){return i?n.FullGreyedOut:a.renderSelected(e,t,r,o,i)},change:function(e,t,r,n,o){if(!o)return n?i.TreeSelection.unselect(r,e.keyOf(t)):i.TreeSelection.selectTerminal(r,e.getNodePath(t))}};t.MultipleFullSubtrees=function MultipleFullSubtrees(){return s};var l={renderSelected:a.renderSelected,change:function(e,t,r,n,o){if(o)return i.TreeSelection.materializeAndExclude(r,e,t);var a=e.keyOf(t);return n?i.TreeSelection.unselect(r,a):i.TreeSelection.selectAndCollapseToTerminal(r,e,t)}};t.MultiplePartialSubtrees=function MultiplePartialSubtrees(){return l};var c={isSelectedSubtree:function(e){return Boolean(e.isSubtreeRoot)},getSelectedSubtrees:function(e){var t=[];return e.nodes.forEach((function(e){e.forEach((function(e){e.isSubtreeRoot&&t.push(e)}))})),t},renderSelected:function(e,t,r,o,i){var s=a.renderSelected(e,t,r,o,i);return function findSubtreeParent(e,t){var r=t;for(;r;){if(r.isSubtreeRoot)return r;r=e.getParent(r)}return}(r,o)||i?s:n.None},change:function(e,t,r,n,a){if(n&&n.isSubtreeRoot){var s=e.keyOf(t);return i.TreeSelection.unselect(r,s)}var l=e.getKeyPath(t);return function findSubtreeInPath(e,t){for(var r=e.root,n=0,o=t;n<o.length;n++){var i=o[n];if(r.isSubtreeRoot)return r;var a=e.getChildIndex(r,i);if("number"!=typeof a)return;r=r.children[a]}return}(r,l)?n||a?i.TreeSelection.materializeAndExclude(r,e,t,{leaveParentSelected:!0}):i.TreeSelection.selectAndCollapseToTerminal(r,e,t):i.TreeSelection.selectTerminal(r,e.getNodePath(t)).updateNode(l,(function(e){return o.__assign(o.__assign({},e),{isSubtreeRoot:!0})}))}};t.PartialSubtrees=function PartialSubtrees(){return c}},1889:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(11),i=r(19);function queryMoreChildren(e,t,r){var o=t.fromKeyPath(r);return o.loading||o.error?[t,i.constant((function(e){return e}))]:[t.updateNode(r,(function(e){return n.set(e,{loading:!0})})),e(o).map((function(e){return function(t){return t.updateNode(r,(function(){return e.error&&console.error(e.error),n.set(e,{loading:!1})}))}}))]}!function(e){e.set=function set(e,t){return o.__assign(o.__assign({},e),t)}}(n=t.TreeNode||(t.TreeNode={})),t.queryMoreChildren=queryMoreChildren,t.mergeRemovingDuplicates=function mergeRemovingDuplicates(e,t,r){var n=Object.create(null);t.forEach((function(t){n[e(t)]=t}));for(var i=o.__spreadArrays(t),a=0,s=r;a<s.length;a++){var l=s[a],c=e(l);n[c]||(n[c]=l,i.push(l))}return i},t.loadPath=function loadPath(e,t,r,n){var a=0,s=r,l=o.__spreadArrays(s.getKeyPath(s.root));return i.repeat((function(){if(a>=n.length)return!1;var r=n[a],o=s.fromKeyPath(l);if(e(o)){var c=s.getKeyPath(o),u=queryMoreChildren(t,s,c);u[0];return u[1].map((function(e){return s=e(s),!0}))}var d=o.children;if(d&&d.find((function(e){return s.keyOf(e)===r})))return a++,l.push(r),i.constant(!0);return i.constantError(new Error("Failed to find child "+r+" on parent "+s.keyOf(o)))})).takeErrors(1).last().map((function(){return s})).toProperty()},t.expandPath=function expandPath(e,t){var expandNode=function(r,i){if(i>=t.length)return r;var a=t[i],s=e.getChildIndex(r,a),l=r.children[s],c=o.__spreadArrays(r.children);return c.splice(s,1,expandNode(l,i+1)),n.set(r,{children:c,expanded:!0})};return e.setRoot(expandNode(e.root,0))}},2084:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(11),i=r(43),a=r(19),s=r(16),l=r(23),c=r(61),u=r(2085),d=r(1887),p=r(1889);!function(e){e.rootKey="SparqlNode:root",e.keyOf=function(t){return t.iri?t.iri.value:e.rootKey},e.readyToLoadRoot={iri:l.Rdf.iri(e.rootKey),children:void 0,reachedLimit:!1},e.emptyRoot={iri:l.Rdf.iri(e.rootKey),children:[],reachedLimit:!0},e.readyToLoadForest=d.KeyedForest.create(e.keyOf,e.readyToLoadRoot),e.emptyForest=d.KeyedForest.create(e.keyOf,e.emptyRoot),e.set=function set(e,t){return o.__assign(o.__assign({},e),t)},e.getLabel=function getLabel(e){return e.label?e.label.value:e.iri.value}}(n=t.Node||(t.Node={}));var h=function(){function SparqlNodeModel(e){var t=e.rootsQuery,r=e.childrenQuery,n=e.parentsQuery,o=e.limit,i=e.sparqlOptions;this.rootsQuery=t,this.childrenQuery=r,this.parentsQuery=n,this.limit=o,this.sparqlOptions=i}return SparqlNodeModel.prototype.hasMoreChildren=function(e){return!e.error&&!e.reachedLimit},SparqlNodeModel.prototype.loadMoreChildren=function(e){var t=this,r=n.keyOf(e)===n.rootKey?this.rootsQuery:c.SparqlClient.setBindings(this.childrenQuery,{parent:e.iri}),o="number"==typeof this.limit;return o&&(r.limit=this.limit,r.offset=e.children?e.children.length:0),c.SparqlClient.select(r,this.sparqlOptions()).map((function(e){return{nodes:nodesFromQueryResult(e)}})).flatMapErrors((function(e){return a.constant({error:e})})).map((function(r){var i=r.nodes,a=r.error;if(a)return n.set(e,{error:a});var s=e.children?e.children:[],l=p.mergeRemovingDuplicates(n.keyOf,s,i);return n.set(e,{error:void 0,children:l,reachedLimit:!o||l.length===s.length||i.length<t.limit})})).toProperty()},SparqlNodeModel.prototype.loadFromLeafs=function(e,t){var r=i.List(e).groupBy((function(e){return e.iri.value})).map((function(e){return e.first()})).map((function(e){return{iri:e.iri,label:e.label,score:e.score,reachedLimit:e.reachedLimit,children:new Set}})).toArray();return 0===r.length?a.constant(n.readyToLoadRoot):function restoreGraphFromLeafs(e,t,r){return a.stream((function(n){var o,i=new Map(e.map((function(e){return[e.iri.value,e]}))),a=new Set(i.keys()),s=!1,onError=function(e){s=!0,n.error(e),n.end()},request=function(e){var n=c.SparqlClient.prepareParsedQuery(e.map((function(e){return{item:l.Rdf.iri(e)}})))(t);c.SparqlClient.select(n,r).map((function(t){return{result:t,requested:e}})).onValue(o).onError(onError)};return o=function(e){var t=e.result,r=e.requested;if(!s){for(var o=0,l=t.results.bindings;o<l.length;o++){var c=l[o],u=c.item,d=c.parent,p=c.parentLabel;if(u&&u.isIri()&&d&&d.isIri()){a.delete(u.value);var h=i.get(u.value),f=i.get(d.value);if(f)f.children.add(h);else{var m={iri:d,label:p&&p.isLiteral()?p:void 0,reachedLimit:!1,children:new Set([i.get(u.value)])};i.set(m.iri.value,m),a=a.add(m.iri.value)}}}for(var y=0,v=r;y<v.length;y++){var S=v[y];a.delete(S)}0===a.size?(n.emit(i),n.end()):request(Array.from(a.values()))}},request(e.map((function(e){return e.iri.value}))),function(){s=!0}})).toProperty()}(r,this.parentsQuery,this.sparqlOptions()).map((function(e){var r=Array.from(e.values());u.breakGraphCycles(r),t.transitiveReduction&&u.transitiveReduction(r);var o=function asImmutableForest(e){return Array.from(e).map((function(e){var t=s.orderBy(asImmutableForest(e.children),f),r=t.reduce((function(e,t){var r=t.score;return e+(void 0===r?0:r)}),0);return{iri:e.iri,label:e.label,children:t,reachedLimit:e.reachedLimit,score:r+(void 0===e.score?0:e.score)}}))}(u.findRoots(r));return n.set(n.readyToLoadRoot,{children:o})}))},SparqlNodeModel.prototype.loadParent=function(e){var t=[{item:l.Rdf.iri(e)}],r=c.SparqlClient.prepareParsedQuery(t)(this.parentsQuery);return c.SparqlClient.select(r,this.sparqlOptions()).flatMap((function(t){for(var r=0,o=t.results.bindings;r<o.length;r++){var i=o[r],s=i.item,l=i.parent;if(s&&s.value===e)return l&&l.isIri()?a.constant(l.value):a.constantError(new Error("parentsQuery returned tuple without 'parent' (or it isn't an IRI)"))}return a.constant(n.rootKey)})).toProperty()},SparqlNodeModel}();function nodesFromQueryResult(e){return e.results.bindings.map((function(e){var t=e.item,r=e.label,n=e.hasChildren;if(t&&t.isIri()){var o=r&&r.isLiteral()?r:void 0;return n&&"false"===n.value?{iri:t,label:o,children:[],reachedLimit:!0}:{iri:t,label:o,reachedLimit:!1}}})).filter((function(e){return void 0!==e}))}t.SparqlNodeModel=h,t.nodesFromQueryResult=nodesFromQueryResult,t.sealLazyExpanding=function sealLazyExpanding(e){return d.mapBottomUp(e,(function(e){var t=!e.reachedLimit&&e.children&&e.children.length>0?n.set(e,{reachedLimit:!0}):e;return t.reachedLimit&&!t.expanded?n.set(t,{expanded:!0}):t}))};var f=[function(e){return"number"==typeof e.score?-e.score:0},function(e){return e.label?e.label.value:e.iri.value}]},2085:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.breakGraphCycles=function breakGraphCycles(e){for(var t=new Set,r=new Set,n=[],o=e.slice(),_loop_1=function(){var e=o.pop();if(r.has(e))return"continue";t.has(e)?(t.delete(e),r.add(e)):(t.add(e),o.push(e),e.children.forEach((function(i){t.has(i)?n.push([e,i]):r.has(i)||o.push(i)})))};o.length>0;)_loop_1();for(var i=0,a=n;i<a.length;i++){var s=a[i],l=s[0],c=s[1];l.children.delete(c)}},t.transitiveReduction=function transitiveReduction(e){for(var t=[],r=new Set,_loop_2=function(e){e.children.forEach((function(n){r.clear(),function searchForRedundantEdges(e,n){r.add(n),n.children.forEach((function(n){r.has(n)||(e.children.has(n)&&t.push([e,n]),searchForRedundantEdges(e,n))}))}(e,n)}))},n=0,o=e;n<o.length;n++){_loop_2(o[n])}for(var i=0,a=t;i<a.length;i++){var s=a[i],l=s[0],c=s[1];l.children.delete(c)}},t.findRoots=function findRoots(e){var t=new Set(e);return e.forEach((function(e){e.children.forEach((function(e){return t.delete(e)}))})),t}},2086:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(11),i=r(1),a=r(1),s=r(43),l=r(7),c=r(2087),u=r(639),d=r(1774),p=r(1888),h=r(1322);!function(e){e[e.Node=1]="Node",e[e.Spinner=2]="Spinner",e[e.Anchor=3]="Anchor"}(n||(n={}));var f=c.List,m=function(e){function LazyTreeSelector(t,r){var n=e.call(this,t,r)||this;n.renderRow=function(e){var t=e.index,r=(e.isScrolling,e.key),a=e.style,s=n.state.entries[t],l=n.renderEntry(s,t),c=o.__assign(o.__assign({},a),{paddingLeft:20*s.depth});return i.createElement("div",{key:r,style:c},l)},n.onRowsRendered=function(e){n.overscanStartIndex=e.overscanStartIndex,n.overscanStopIndex=e.overscanStopIndex,n.requestItemsWithVisibleAnchors()};var a=computeEntries(n.props),s=a.entries,l=a.indices;return n.state={entries:s,indices:l},n}return o.__extends(LazyTreeSelector,e),LazyTreeSelector.prototype.componentWillReceiveProps=function(e){var t=this,r=computeEntries(e),n=r.entries,o=r.indices;this.setState({entries:n,indices:o},(function(){t.list.forceUpdateGrid(),t.requestItemsWithVisibleAnchors()}))},LazyTreeSelector.prototype.scrollToPath=function(e){var t=this.props.forest.fromKeyPath(e);if(t&&this.list){var r=this.state.indices.get(t);"number"==typeof r&&this.list.scrollToRow(r)}},LazyTreeSelector.prototype.render=function(){var e=this,t=this.props,r=t.className,n=t.style,o=t.itemHeight,a=t.renderEmpty,s=this.state.entries;return i.createElement("div",{className:l(h.component,r),style:n},i.createElement(c.AutoSizer,null,(function(t){var r=t.width,n=t.height;return i.createElement(f,{ref:function(t){return e.list=t},className:h.virtualizedList,width:r,height:n,rowCount:s.length,overscanRowCount:10,rowHeight:Math.max(o,30),noRowsRenderer:a,rowRenderer:e.renderRow,onRowsRendered:e.onRowsRendered,style:{overflowX:"auto",overflowY:"scroll"},containerStyle:{width:void 0,maxWidth:void 0,minHeight:n,overflowX:"unset",overflowY:"unset"}})})))},LazyTreeSelector.prototype.renderEntry=function(e,t){switch(e.type){case n.Node:return this.renderItem(e);case n.Spinner:case n.Anchor:return i.createElement(u.Spinner,{spinnerDelay:0,className:h.spinner})}},LazyTreeSelector.prototype.requestItemsWithVisibleAnchors=function(){if("number"==typeof this.overscanStartIndex&&"number"==typeof this.overscanStopIndex)for(var e=this.state.entries,t=Math.max(0,this.overscanStartIndex-10),r=Math.min(e.length,this.overscanStopIndex+10),o=t;o<r;o++){var i=e[o];i.type===n.Anchor&&this.props.requestMore(i.item)}},LazyTreeSelector.prototype.renderItem=function(e){var t,r=this,n=e.item,o=e.itemSelection,a=e.defaultSelection,s=e.expanded,c=!0===this.props.isLeaf(n),u=this.props.selectionMode.renderSelected(this.props.forest,n,this.props.selection,o,a);return i.createElement("div",{className:l((t={},t[h.item]=!0,t[h.itemExpanded]=s,t[h.itemCollapsed]=!s,t))},i.createElement("span",{className:h.expandToggle,style:{visibility:c?"collapse":void 0},onClick:function(){r.toggleExpanded(n,s),r.props.onItemClick&&r.props.onItemClick(n)}}),this.props.hideCheckboxes?null:i.createElement("input",{type:"checkbox",checked:u!==p.CheckState.None,disabled:u===p.CheckState.FullGreyedOut,onChange:function(e){return r.onItemCheckedChange(n,o,a,e)},ref:function(e){e&&(e.indeterminate=u===p.CheckState.Partial)}}),i.createElement("div",{className:h.itemContent,onClick:function(){return r.toggleExpanded(n,s)}},this.props.renderItem(n)))},LazyTreeSelector.prototype.toggleExpanded=function(e,t){var r=this.props,n=r.onExpandedOrCollapsed,o=r.childrenOf,i=r.requestMore;if(n(e,!t),!t){var a=o(e),s=a.loading,l=a.hasMoreItems;!s&&l&&i(e)}},LazyTreeSelector.prototype.onItemCheckedChange=function(e,t,r,n){if(this.props.onSelectionChanged){var o=this.props,i=o.forest,a=o.selectionMode,s=this.props.selection||d.TreeSelection.empty(i),l=a.change(i,e,s,t,r);l&&this.props.onSelectionChanged(l)}},LazyTreeSelector.defaultProps={itemHeight:30},LazyTreeSelector}(a.Component);function computeEntries(e){var t=[];describeChildren(e,e.forest.root,e.selection?e.selection.root:void 0,void 0,0,t);var r=s.Map().withMutations((function(e){t.forEach((function(t,r){t.type===n.Node&&e.set(t.item,r)}))}));return{entries:t,indices:r}}function describeChildren(e,t,r,o,i,a){if(t.children)for(var s=e.forest,l=e.selection,c=0,u=t.children;c<u.length;c++){var d=u[c],p=void 0;if(r){var h=s.keyOf(d),f=l.getChildIndex(r,h);p="number"==typeof f?r.children[f]:void 0}describeItem(e,d,p,o,i,a)}var m=e.childrenOf(t),y=m.loading,v=m.hasMoreItems;y?a.push({type:n.Spinner,depth:i}):v&&a.push({type:n.Anchor,depth:i,item:t})}function describeItem(e,t,r,o,i,a){var s=function isItemExpanded(e,t){var r=e.isExpanded(t);void 0===r&&(r=e.expandedByDefault);return void 0!==r&&r}(e,t);(a.push({type:n.Node,depth:i,item:t,itemSelection:r,defaultSelection:o,expanded:s}),s)&&describeChildren(e,t,r,r&&d.TreeSelection.isTerminal(r)?r:o,i+1,a)}t.LazyTreeSelector=m}}]);
//# sourceMappingURL=semantic-tree-input-58fb517611299c60e225.js.map