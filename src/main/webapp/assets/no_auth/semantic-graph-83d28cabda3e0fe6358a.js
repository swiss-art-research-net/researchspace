(window.webpackJsonp=window.webpackJsonp||[]).push([[474],{1331:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var n=r(11),a=r(1602),o=r(1),i=r(35),c=r(139),s=r(16),u=r(34),p=r(56),l=r(162),d=r(63),h=r(630),f=r(116),g=r(631),m=r(2817),y=r(2915),S=r(2222);e.SemanticGraphConfig=S.SemanticGraphConfig,r(1333);var G=function(t){function SemanticGraph(e,r){var n=t.call(this,e,r)||this;return n.cancellation=new u.Cancellation,n.fetching=n.cancellation.derive(),n.navigate=function(t){var e=t.cyTarget,r=n.context.semanticContext?n.context.semanticContext.repository:void 0,o=!(e.isParent()||e.hasClass("cy-expand-collapse-collapsed-node"));if(e.data("isIri")&&o){var i=t.cyTarget.data("node");n.props.openLinksInNewWindow?d.openResourceInNewWindow(i,{},r):d.navigateToResource(t.cyTarget.data("node"),{},r).onValue(a.identity)}},n.state={elements:[],noResults:!1},n}return n.__extends(SemanticGraph,t),SemanticGraph.prototype.componentDidMount=function(){this.fetchAndSetData(this.props)},SemanticGraph.prototype.componentWillReceiveProps=function(t){s.isEqual(t.query,this.props.query)||this.fetchAndSetData(t)},SemanticGraph.prototype.fetchAndSetData=function(t){var e=this;this.setState({error:void 0});var r=c({},{hidePredicates:SemanticGraph.DEFAULT_HIDE_PREDICATES},t);this.fetching=this.cancellation.deriveAndCancel(this.fetching);var n=this.context.semanticContext,a=this.fetching.map(y.getGraphDataWithLabels(r,{context:n}));a.onValue((function(t){e.catchCORSError(t),e.setState({elements:t,noResults:!t.length})})).onError((function(t){return e.setState({error:t})})).onEnd((function(){e.props.id&&l.trigger({eventType:l.BuiltInEvents.ComponentLoaded,source:e.props.id})})),this.props.id&&l.trigger({eventType:l.BuiltInEvents.ComponentLoading,source:this.props.id,data:a})},SemanticGraph.prototype.catchCORSError=function(t){var e=this,r=t.map((function(t){return t.data.thumbnail})).map((function(t){return new Promise((function(e,r){var n=new Image;n.onload=function(){e()},n.onerror=function(){r("Some images are not accessible or can't be rendered on canvas because of CORS or mixed content error (loading HTTP resource from HTTPS context)!")},n.crossOrigin="Anonymous",n.src=t}))}));Promise.all(r).then((function(){return e.setState({warning:void 0})})).catch((function(t){return e.setState({warning:t})}))},SemanticGraph.prototype.render=function(){if(this.state.noResults)return o.createElement(h.TemplateItem,{template:{source:this.props.noResultTemplate}});if(this.state.error)return o.createElement(f.ErrorNotification,{errorMessage:this.state.error});var t=this.state.warning?o.createElement(g.Alert,{alert:g.AlertType.WARNING,message:this.state.warning}):null,e=y.parseComponentConfig(SemanticGraph.DEFAULT_STYLE,this.props),r=c({},{elements:this.state.elements,onClick:this.navigate},SemanticGraph.getDefaultProps,e),n=o.createElement(m.Graph,r,this.props.children);return i.div({},t,n)},SemanticGraph.DEFAULT_STYLE=[{selector:"edge",style:{"target-arrow-shape":"triangle","target-arrow-color":"#bbb",content:"data(label)","text-valign":"center","text-halign":"center","text-outline-width":2,width:1,"text-outline-color":"white","font-size":"8px","curve-style":"bezier","text-rotation":"autorotate"}},{selector:"node",style:{"background-fit":"contain","background-color":"white","background-image":"data(thumbnail)",content:"data(label)",shape:"ellipse","text-valign":"bottom","text-halign":"center","text-outline-width":2,"text-outline-color":"white","font-size":"10px","border-color":"#bbb","border-width":1,width:40,height:40}},{selector:"node[?isLiteral]",style:{"background-fit":"contain","background-color":"#ddd","border-color":"#bbb","border-width":1,content:"data(label)",shape:"rectangle","text-valign":"center","text-halign":"center","padding-right":2,"padding-left":2,"padding-top":2,"padding-bottom":2,width:"label",height:"label","text-outline-color":"#ddd","font-size":"10px"}},{selector:"edge.cy-expand-collapse-meta-edge",style:{content:"",width:1,"line-color":"light-grey","line-style":"dotted","target-arrow-shape":"none","curve-style":"unbundled-bezier","control-point-distances":"0 0 0"}},{selector:"node.cy-expand-collapse-collapsed-node",style:{shape:"rectangle"}},{selector:"node:parent",style:{"text-valign":"top","border-opacity":.1}}],SemanticGraph.getDefaultProps={mouseZoom:!0,height:400},SemanticGraph.DEFAULT_HIDE_PREDICATES=["<http://schema.org/thumbnail>","<http://www.w3.org/2000/01/rdf-schema#label>"],SemanticGraph}(p.Component);e.SemanticGraph=G,e.default=G},2222:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var n=r(16);e.configWithHidePredicates=function configWithHidePredicates(t){return n.has(t,"hidePredicates")},e.configWithShowPredicates=function configWithShowPredicates(t){return n.has(t,"showPredicates")}},2817:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var n=r(11),a=r(1602),o=r(1),i=r(35),c=r(139),s=r(1733),u=r(1734),p=r(2209),l=r(33),d=r(16),h=r(23),f=r(144),g=r(1596);u.registerJquery(s);var m=function(t){function Graph(e){var r=t.call(this,e)||this;return r.HANDLEBARS_REGEX=/{{{?([^{}]+)}}}?/,r.setLayout=function(t){r.setState({layout:t})},r.runLayout=function(){r.state.cytoscape.map((function(t){return r.getElementsToLayout(t).makeLayout(r.state.layout).run()}))},p(u),r.state={cytoscape:l.Nothing(),layout:{name:"cose-bilkent",idealEdgeLength:100}},r}return n.__extends(Graph,t),Graph.prototype.getChildContext=function(){return{cytoscapeApi:{cytoscape:u,jQuery:s,instance:this.state.cytoscape,actions:{setLayout:this.setLayout,runLayout:this.runLayout}}}},Graph.prototype.componentDidMount=function(){var t=this.createCytoscapeInstance(this.props);this.replaceCytoscapeData(t,this.props.elements),this.setState({cytoscape:l.Just(t)})},Graph.prototype.componentWillReceiveProps=function(t){var e=this;d.isEqual(t.elements,this.props.elements)||this.state.cytoscape.map((function(r){return e.replaceCytoscapeData(r,t.elements)}))},Graph.prototype.componentWillUnmount=function(){this.state.cytoscape.map((function(t){return t.destroy()}))},Graph.prototype.render=function(){var t=this;return this.redraw(),i.div({},i.div({ref:Graph.CYTOSCAPE_CONTAINER_REF,style:{height:this.props.height,width:"100%",position:"relative"}}),this.state.cytoscape.map((function(e){return t.props.children})).getOrElse(null))},Graph.prototype.redraw=function(){this.state.cytoscape.map((function(t){t.resize(),t.fit()}))},Graph.prototype.getElementsToLayout=function(t){return t.filter((function(t,e){return!!e.isNode()||!(e.source().parent().id()===e.target().id()||e.target().parent().id()===e.source().id())}))},Graph.prototype.replaceCytoscapeData=function(t,e){t.remove("*"),t.add(e),0!==e.length&&(this.runLayout(),t.one("layoutstop",(function(){return t.trigger(g.DATA_LOADED_EVENT)})))},Graph.prototype.createCytoscapeInstance=function(t){var e=u(this.composeCytoscapeConfig(t)),r=t.onClick?t.onClick:a.identity;return e.on("tap","node",r),e.on("tap","edge",r),e},Graph.prototype.composeCytoscapeConfig=function(t){var e={container:this.refs.cytoscape,userZoomingEnabled:!1},r={style:this.compileStyles(t.graphStyle)};return c(e,this.props,r)},Graph.prototype.compileStyles=function(t){var e=this;return d.map(t,(function(t){var r=e.isCssStylesheet(t)?t.css:t.style;return{selector:e.compileStyleSelector(t.selector),style:e.compileHandlebarsForStyleValues(r)}}))},Graph.prototype.compileStyleSelector=function(t){var e=this;return t.replace(/property\(<(.*?)>\)/g,(function(t,r){return e.escapeJsRegexChars("-><"+r+">")})).replace(/literal\((.*?),\s*iri\(<(.*?)>\)\)/g,(function(t,e,r){return"'\""+e+'"^^<'+r+">'"})).replace(/iri\(<(.*?)>\)/g,(function(t,e){return"'<"+e+">'"})).replace(/literal\((.*?)\)/g,(function(t,e){return"'\""+e+'"^^'+h.vocabularies.xsd._string+"'"}))},Graph.prototype.compileHandlebarsForStyleValues=function(t){var e=this;return d.mapValues(t,(function(t){return e.HANDLEBARS_REGEX.test(t)?Graph.styleTemplateFunction(f.TemplateScope.default.compileWithoutRemote(t),t):t}))},Graph.prototype.isCssStylesheet=function(t){return d.has(t,"css")},Graph.prototype.escapeJsRegexChars=function(t){return t.replace(Graph.STYLE_METACHARS_REGEX,"\\$&")},Graph.CYTOSCAPE_CONTAINER_REF="cytoscape",Graph.childContextTypes=g.CytoscapeContextTypes,Graph.styleTemplateFunction=function(t,e){return function(e){return t(e.data())}},Graph.STYLE_METACHARS="[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",Graph.STYLE_METACHARS_REGEX=new RegExp("("+Graph.STYLE_METACHARS+")","g"),Graph}(o.Component);e.Graph=m,e.component=m,e.factory=o.createFactory(e.component),e.default=e.component},2915:function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});var n=r(16),a=r(43),o=r(19),i=r(16),c=r(23),s=r(61),u=r(140),p=r(1227),l=r(2222),d=c.Rdf.iri("GLOBAL_GROUP"),h=a.Set.of(d);function addLabelsToGraphData(t,e,r){return n.map(t,(function(t){return t.data.label=e.get(t.data.node),t.data.thumbnail=r.get(t.data.node)||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t}))}function getGraphData(t,e){return s.SparqlClient.construct(t.query,{context:e}).map(prepareGraphData(t))}function prepareGraphData(t){return function(e){var r=n.filter(e,function getTriplesFilterFunction(t){if(l.configWithShowPredicates(t)){var e=n.map(t.showPredicates,c.Rdf.fullIri);return function(t){return n.some(e,(function(e){return e.equals(t.p)}))}}if(l.configWithHidePredicates(t)){var r=n.map(t.hidePredicates,c.Rdf.fullIri);return function(t){return n.every(r,(function(e){return!1===e.equals(t.p)}))}}return function(){return!0}}(t)),o=function getGroups(t,e){return t.groupBy?function constructGroups(t,e){var r=n.filter(t,(function(t){return t.p.equals(e)}));return n.reduce(r,(function(t,e){var r=t.has(e.s)?t.get(e.s):a.Set();return t.set(e.s,r.add(e.o))}),a.Map().asMutable()).asImmutable()}(e,c.Rdf.fullIri(t.groupBy)):a.Map()}(t,e),i=function buildNodes(t,e,r){var o=n.reduce(t,(function(t,e){return t.add(e.s).add(e.o)}),a.Set());return r.reduce((function(t,e){return t.union(e)}),a.Set()).union(o).map((function(t){return function createGraphResourceNodes(t,e,r,n){return r?r.map((function(r){return createGraphNode(t,e,n,r)})):a.Set.of(createGraphNode(t,e,n))}(t,e,r.get(t),r)})).flatten().toArray()}(r,e,o);return function buildEgdes(t,e,r){return a.Set(t).flatMap((function(t){return function createGraphResourceEdges(t,e,r){return r.isEmpty()?a.Set.of(createGraphEdge(t.s.toString(),t.o.toString(),t.p,e)):function createEdgesWithGroups(t,e,r){var n=r.has(t.s)?r.get(t.s):h,a=r.has(t.o)?r.get(t.o):h,o=!n.intersect(a).isEmpty();return n.flatMap((function(r){return a.filterNot((function(t){return!t.equals(r)&&o})).map((function(n){return createGraphEdge(createNodeId(t.s,r),createNodeId(t.o,n),t.p,e)}))}))}(t,e,r)}(t,e,r)})).toArray()}(r,e,o).concat(i)}}function createGraphNode(t,e,r,n){void 0===n&&(n=void 0);var a=r.has(n)?r.get(n).first():void 0;return addPropertiesToTheElementData(e,{group:"nodes",data:{id:createNodeId(t,n),parent:n?createNodeId(n,a):void 0,node:t,resource:t.toString(),isIri:t.isIri(),isLiteral:t.isLiteral(),isBnode:t.isBnode()}})}function createNodeId(t,e){return void 0===e&&(e=void 0),e&&!e.equals(d)?e.toString()+t.toString():t.toString()}function createGraphEdge(t,e,r,n){return addPropertiesToTheElementData(n,{group:"edges",data:{id:t+r.toString()+e,node:r,resource:r.toString(),source:t,target:e}})}function addPropertiesToTheElementData(t,e){return n.reduce(t,(function(t,e){return e.s.equals(t.data.node)?function updateElementPropertyValue(t,e){var r=t.data[e.p.toString()]||[];return r.push(e.o),t.data[e.p.toString()]=r,t.data["->"+e.p.toString()]=r.join(" "),t}(t,e):t}),e)}e.parseComponentConfig=function parseComponentConfig(t,e){var r=n.cloneDeep(e);return i.has(e,"graphStyle")?r.graphStyle=function mergeStyles(t,e){return n.filter(t,(function(t){return!i.some(e,(function(e){return t.selector===e.selector}))})).concat(e)}(t,e.graphStyle):r.graphStyle=t,r},e.getGraphDataWithLabels=function getGraphDataWithLabels(t,e){var r=e.context,i=getGraphData(t,r),c=i.flatMap(function fetchLabels(t){return function(e){return function fetchLabelsForResources(t,e){var r=n.filter(t,(function(t){return t.data.node.isIri()})),a=n.map(r,(function(t){return t.data.node}));return u.getLabels(a,{context:e})}(e,t).map((function(t){return function getLabelsForLiterals(t){var e=t.filter((function(t){return t.data.node.isLiteral}));return a.Map(n.map(e,(function(t){return[t.data.node,t.data.node.value]})))}(e).merge(t)}))}}(r)),s=i.flatMap(function fetchThumbnails(t){return function(e){var r=n.filter(e,(function(t){return"nodes"===t.group&&t.data.node.isIri()})),a=n.map(r,(function(t){return t.data.node}));return p.getThumbnails(a,{context:t})}}(r));return o.combine([i,c,s],addLabelsToGraphData).toProperty()},e.addLabelsToGraphData=addLabelsToGraphData,e.getGraphData=getGraphData,e.prepareGraphData=prepareGraphData}}]);
//# sourceMappingURL=semantic-graph-83d28cabda3e0fe6358a.js.map