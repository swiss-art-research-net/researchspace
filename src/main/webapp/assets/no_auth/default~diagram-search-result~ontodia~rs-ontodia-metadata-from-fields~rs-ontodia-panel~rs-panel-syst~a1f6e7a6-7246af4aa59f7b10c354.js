(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{1844:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var i=a(11),r=a(19),n=a(43),l=a(1579),o=a(23),s=a(1562),d=a(1637);function convertPropertyToFieldValues(e){return l.isIriProperty(e)?e.values.map((function(e){var t=e.value;return s.FieldValue.fromLabeled({value:o.Rdf.iri(t)})})):l.isLiteralProperty(e)?convertLocalizedStringsToFieldValues(e.values):[]}function convertLocalizedStringsToFieldValues(e){return e.map((function(e){var t=e.value,a=e.language,i=e.datatype,r=a?o.Rdf.langLiteral(t,a):o.Rdf.literal(t,i?o.Rdf.iri(i.value):void 0);return s.FieldValue.fromLabeled({value:r})}))}function deleteLinkFromCompositeValue(e,t,a){var i=a.fieldByIri.get(e.linkTypeId);if(!t.fields.has(i.id))return t;var r=t.fields.update(i.id,(function(t){return s.FieldState.set(t,{values:t.values.filter((function(t){return s.FieldValue.asRdfNode(t).value!==e.targetId})).toList()})}));return s.CompositeValue.set(t,{fields:r})}t.fetchInitialModel=function fetchInitialModel(e,t,a){void 0===a&&(a=t.fieldByIri);var i={type:s.CompositeValue.type,subject:e,definitions:t.fieldByIri,fields:n.Map(),errors:s.FieldError.noErrors},l=a.toArray().map((function(t){return s.queryValues(t.selectPattern,e).map((function(e){var a=e.map((function(e){return s.FieldValue.fromLabeled(e)})),i=s.FieldState.set(s.FieldState.empty,{values:n.List(a)});return[t.id,i]}))}));return r.zip(l).map((function(e){var t=e.filter((function(e){e[0];return e[1].values.size>0}));return s.CompositeValue.set(i,{fields:n.Map(t)})})).toProperty()},t.getEntityMetadata=function getEntityMetadata(e,t){for(var a=0,i=e.types;a<i.length;a++){var r=i[a];if(t.get(r))return t.get(r)}},t.convertElementModelToCompositeValue=function convertElementModelToCompositeValue(e,t){var a=n.Map().withMutations((function(a){t.fieldByIri.forEach((function(i,r){var l=[];if(i.iri===t.typeField.iri)l=e.types.map((function(e){return s.FieldValue.fromLabeled({value:o.Rdf.iri(e)})}));else if(t.imageField&&i.iri===t.imageField.iri)l=e.image?[s.FieldValue.fromLabeled({value:o.Rdf.iri(e.image)})]:[];else if(i.iri===t.labelField.iri)l=convertLocalizedStringsToFieldValues(e.label.values);else{var d=e.properties[i.iri];d&&(l=convertPropertyToFieldValues(d))}a.set(r,{values:n.List(l),errors:s.FieldError.noErrors})}))}));return{type:s.CompositeValue.type,subject:o.Rdf.iri(e.id),definitions:t.fieldByIri,fields:a,errors:s.FieldError.noErrors}},t.convertCompositeValueToElementModel=function convertCompositeValueToElementModel(e,t){var a,r,n,o={};return e.fields.forEach((function(e,d){var u=t.fieldByIri.get(d);u.iri===t.typeField.iri?a=e.values.map(s.FieldValue.asRdfNode).filter((function(e){return e&&e.isIri()})).map((function(e){return e.value})).toArray():t.imageField&&u.iri===t.imageField.iri?n=e.values.map(s.FieldValue.asRdfNode).filter((function(e){return e&&e.isIri()})).map((function(e){return e.value})).first():u.iri===t.labelField.iri?r=e.values.map((function(e){if(s.FieldValue.isAtomic(e)&&e.value.isLiteral())return s.FieldValue.asRdfNode(e)})).toArray():e.values.forEach((function(e){if(s.FieldValue.isAtomic(e))if(e.value.isLiteral()){var t=s.FieldValue.asRdfNode(e),a=t.value,r=t.language,n=o[u.iri]||{type:"string",values:[]};l.isLiteralProperty(n)&&(n.values=i.__spreadArrays(n.values,[{value:a,language:r,datatype:u.xsdDatatype}])),o[u.iri]=n}else if(e.value.isIri()){a=s.FieldValue.asRdfNode(e).value,n=o[u.iri]||{type:"uri",values:[]};l.isIriProperty(n)&&(n.values=i.__spreadArrays(n.values,[{type:"uri",value:a}])),o[u.iri]=n}}))})),{id:e.subject.value,types:a||[],label:{values:r||[]},image:n,properties:o}},t.applyEventsToCompositeValue=function applyEventsToCompositeValue(e){var t,a=e.elementIri,r=e.state,l=e.metadata,u=e.initialModel,p=!1;return r.elements.forEach((function(e){if(e.deleted){(i=e.after).id===a&&(p=!0)}else{var i,r=e;(i=r.after).id===a&&(u=function applyElementModelToCompositeValue(e,t,a){var i=t.fields;return a.fieldByIri.forEach((function(t,r){if(!d.isObjectProperty(t,a)){var l=[];if(t.id===a.labelField.id)l=convertLocalizedStringsToFieldValues(e.label.values);else if(t.id===a.typeField.id)l=e.types.map((function(e){return s.FieldValue.fromLabeled({value:o.Rdf.iri(e)})}));else if(a.imageField&&t.id===a.imageField.id&&e.image)l=[s.FieldValue.fromLabeled({value:o.Rdf.iri(e.image)})];else{var u=e.properties[r];u&&(l=convertPropertyToFieldValues(u))}i=i.set(t.id,{values:n.List(l),errors:s.FieldError.noErrors})}})),s.CompositeValue.set(t,{fields:i})}(i,u,l),t=r.newIri!==u.subject.value?r.newIri:void 0)}})),r.links.forEach((function(e){if(e.deleted){(i=e.after).sourceId===a&&(u=deleteLinkFromCompositeValue(i,u,l))}else{var t=e.before,i=e.after;t&&t.sourceId===a&&(u=deleteLinkFromCompositeValue(t,u,l)),i.sourceId===a&&(u=function applyLinkModelToCompositeValue(e,t,a){var i=o.Rdf.iri(e.targetId),r=a.fieldByIri.get(e.linkTypeId);if(!r)return t;var n=t.fields.update(r.id,(function(e){return void 0===e&&(e=s.FieldState.empty),s.FieldState.set(e,{values:e.values.push(s.FieldValue.fromLabeled({value:i}))})}));return s.CompositeValue.set(t,{fields:n})}(i,u,l))}})),u.fields.forEach((function(e,t){var a=u.fields.update(t,(function(e){var t=e.values.filter((function(e){var t=s.FieldValue.asRdfNode(e).value,a=r.elements.get(t);return!(a&&a.deleted)})).toList();return s.FieldState.set(e,{values:t})}));u=s.CompositeValue.set(u,{fields:a})})),t&&(u=i.__assign(i.__assign({},u),{subject:new o.Rdf.Iri(t)})),p?s.FieldValue.empty:u}},1987:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var i=a(11),r=a(19),n=a(1579),l=a(23),o=a(61),s=a(140),d=a(1562),u=a(1751),p=a(1637),f=a(1844),c=function(){function FieldBasedMetadataApi(e){this.entityMetadata=e}return FieldBasedMetadataApi.prototype.generateNewElement=function(e,t){return i.__awaiter(this,void 0,Promise,(function(){var a,r,o;return i.__generator(this,(function(d){switch(d.label){case 0:return e&&0!==e.length&&(a=e[0]),a&&a!==n.PLACEHOLDER_ELEMENT_TYPE?[4,u.observableToCancellablePromise(s.getLabel(l.Rdf.iri(a)),t)]:[3,2];case 1:return r=d.sent(),[3,3];case 2:r="Entity",d.label=3;case 3:return o={id:"",types:i.__spreadArrays(e),label:{values:[{value:"New "+r,language:""}]},properties:{}},[2,i.__assign(i.__assign({},o),{id:this.generateIriForModel(o)})]}}))}))},FieldBasedMetadataApi.prototype.generateIriForModel=function(e){var t;if(e.types.length>0){var a=e.types[0];a!==n.PLACEHOLDER_ELEMENT_TYPE&&(t=this.entityMetadata.get(a))}if(t){var r=f.convertElementModelToCompositeValue(i.__assign(i.__assign({},e),{id:""}),t);return d.generateSubjectByTemplate(t.newSubjectTemplate,void 0,r).value}return"http://researchspace.org/NewEntity-"+Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)},FieldBasedMetadataApi.prototype.canDropOnCanvas=function(e,t){return this.typesOfElementsDraggedFrom(e,t).then((function(e){return e.length>0}))},FieldBasedMetadataApi.prototype.canDropOnElement=function(e,t,a){return this.possibleLinkTypes(e,t,a).then((function(e){return e.length>0}))},FieldBasedMetadataApi.prototype.possibleLinkTypes=function(e,t,a){var l=r.combine({outgoing:this.getPossibleLinkTypes(e,t),incoming:this.getPossibleLinkTypes(t,e)},(function(e){var t=e.outgoing,a=e.incoming;return i.__spreadArrays(t.map((function(e){return{linkTypeIri:e,direction:n.LinkDirection.out}})),a.map((function(e){return{linkTypeIri:e,direction:n.LinkDirection.in}})))}));return u.observableToCancellablePromise(l,a)},FieldBasedMetadataApi.prototype.getPossibleLinkTypes=function(e,t){var a=f.getEntityMetadata(e,this.entityMetadata),i=f.getEntityMetadata(t,this.entityMetadata);if(!a||!i)return r.constant([]);var n=new y;return n.addAll(e.types),n.addAll(t.types),n.query().map((function(i){var r=new Set;return a.fieldByIri.forEach((function(n,l){p.isObjectProperty(n,a)&&hasCompatibleType(n.domain,e.types,i)&&hasCompatibleType(n.range,t.types,i)&&r.add(l)})),Array.from(r)}))},FieldBasedMetadataApi.prototype.typesOfElementsDraggedFrom=function(e,t){var a=this,i=f.getEntityMetadata(e,this.entityMetadata);if(!i)return Promise.resolve([]);var r=new y;r.addAll(e.types);var n=r.query().map((function(t){var r=new Set;return i.fieldByIri.forEach((function(n){if(p.isObjectProperty(n,i)&&hasCompatibleType(n.domain,e.types,t))for(var l=0,o=n.range;l<o.length;l++){var s=o[l].value;a.entityMetadata.has(s)&&r.add(s)}})),a.entityMetadata.forEach((function(i){i.fieldByIri.forEach((function(n){if(p.isObjectProperty(n,i)&&hasCompatibleType(n.range,e.types,t))for(var l=0,o=n.domain;l<o.length;l++){var s=o[l].value;a.entityMetadata.has(s)&&r.add(s)}}))})),Array.from(r)}));return u.observableToCancellablePromise(n,t)},FieldBasedMetadataApi.prototype.propertiesForType=function(e,t){return Promise.resolve([])},FieldBasedMetadataApi.prototype.canDeleteElement=function(e,t){var a=f.getEntityMetadata(e,this.entityMetadata);return Promise.resolve(Boolean(a))},FieldBasedMetadataApi.prototype.filterConstructibleTypes=function(e,t){var a=new Set;return this.entityMetadata.forEach((function(t,i){e.has(i)&&a.add(i)})),Promise.resolve(a)},FieldBasedMetadataApi.prototype.canEditElement=function(e,t){var a=f.getEntityMetadata(e,this.entityMetadata);return Promise.resolve(Boolean(a))},FieldBasedMetadataApi.prototype.canLinkElement=function(e,t){var a=f.getEntityMetadata(e,this.entityMetadata);return Promise.resolve(Boolean(a))},FieldBasedMetadataApi.prototype.canDeleteLink=function(e,t,a,i){var r=f.getEntityMetadata(t,this.entityMetadata);return Promise.resolve(Boolean(r)&&r.fieldByIri.has(e.linkTypeId))},FieldBasedMetadataApi.prototype.canEditLink=function(e,t,a,i){var r=f.getEntityMetadata(t,this.entityMetadata);return Promise.resolve(Boolean(r)&&r.fieldByIri.has(e.linkTypeId))},FieldBasedMetadataApi}();t.FieldBasedMetadataApi=c;var y=function(){function BaseTypeClosureRequest(){this.derivedTypes=new Set}return BaseTypeClosureRequest.prototype.addAll=function(e){for(var t=0,a=e;t<a.length;t++){var i=a[t];this.derivedTypes.add(i)}},BaseTypeClosureRequest.prototype.query=function(){var e=[];this.derivedTypes.forEach((function(t){e.push({type:l.Rdf.iri(t)})}));var t=o.SparqlClient.prepareParsedQuery(e)(BaseTypeClosureRequest.BASE_TYPES_QUERY);return o.SparqlClient.select(t).map((function(e){for(var t=e.results,a=new Map,i=0,r=t.bindings;i<r.length;i++){var n=r[i],l=n.type.value,o=n.base.value,s=a.get(l);s||(s=new Set,a.set(l,s)),s.add(o)}return a}))},BaseTypeClosureRequest.BASE_TYPES_QUERY=o.SparqlUtil.parseQuerySync("PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT REDUCED ?type ?base WHERE { ?type rdfs:subClassOf* ?base }"),BaseTypeClosureRequest}();function hasCompatibleType(e,t,a){for(var i=0,r=t;i<r.length;i++)for(var n=r[i],l=a.get(n),o=0,s=e;o<s.length;o++){var d=s[o];if(l.has(d.value))return!0}return!1}t.BaseTypeClosureRequest=y,t.hasCompatibleType=hasCompatibleType}}]);
//# sourceMappingURL=default~diagram-search-result~ontodia~rs-ontodia-metadata-from-fields~rs-ontodia-panel~rs-panel-syst~a1f6e7a6-7246af4aa59f7b10c354.js.map