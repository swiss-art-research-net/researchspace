(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{1700:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a,i=r(11),o=r(19),l=r(43),d=r(23),c=r(61),u=r(1581);!function(e){e[e.ExactMatch=1]="ExactMatch",e[e.NarrowerMatch=2]="NarrowerMatch",e[e.MatchChild=3]="MatchChild"}(n=t.AlignKind||(t.AlignKind={})),function(e){function set(e,t){return i.__assign(i.__assign({},e),t)}e.rootKey="AlignmentNode:root",e.keyOf=function(t){return t.base?u.Node.keyOf(t.base):t.aligned?u.Node.keyOf(t.aligned):e.rootKey},e.empty={alignKind:n.ExactMatch,excludeFromAlignment:l.Set(),children:[]},e.readyToLoadBaseForest=u.KeyedForest.create(e.keyOf,i.__assign(i.__assign({},e.empty),{base:u.Node.readyToLoadRoot})),e.set=set,e.getMatchTarget=function getMatchTarget(e,t){return e.alignKind===n.ExactMatch?e:t.getParent(e)},e.setExactMatch=function setExactMatch(e,t,r){var n=e.children.filter((function(e){return e.base}));return t.children&&(n=mergeChildren(n,asMatchChildren(t.children,r))),set(e,{aligned:t,excludeFromAlignment:r,children:n})},e.addNarrowMatches=function addNarrowMatches(e,t){return set(e,{children:mergeChildren(e.children,t)})},e.unalign=function unalign(t){if(t.aligned){if(t.alignKind===n.ExactMatch)return e.set(t,{aligned:void 0,children:t.children.filter((function(e){return e.alignKind!==n.MatchChild}))});if(t.alignKind===n.NarrowerMatch)return}return t}}(a=t.AlignmentNode||(t.AlignmentNode={}));var s=function(){function AlignmentNodeModel(e){var t=e.baseModel,r=e.alignedModel,n=e.baseNodeQuery,a=e.alignNodeQuery;this.baseModel=t,this.alignedModel=r,this.baseNodeQuery=n,this.alignNodeQuery=a}return AlignmentNodeModel.prototype.hasMoreChildren=function(e){return e.base&&this.baseModel.hasMoreChildren(e.base)||e.aligned&&this.alignedModel.hasMoreChildren(e.aligned)},AlignmentNodeModel.prototype.loadMoreChildren=function(e){var t=e.base,r=e.aligned;return t||r?o.combine({base:t&&!t.reachedLimit?this.baseModel.loadMoreChildren(t):o.constant(void 0),aligned:r&&!r.reachedLimit?this.alignedModel.loadMoreChildren(r):o.constant(void 0)}).map((function(t){var r=e;if(t.base){var n=t.base.children.map(asBaseNode);r=a.set(r,{base:t.base,children:mergeChildren(r.children,n)})}if(t.aligned){var i=asMatchChildren(t.aligned.children,e.excludeFromAlignment);r=a.set(r,{aligned:t.aligned,children:mergeChildren(r.children,i)})}var o=r.base&&r.base.error||r.aligned&&r.aligned.error||void 0;return r=a.set(r,{error:o})})).flatMapErrors((function(t){return o.constant(a.set(e,{error:t}))})).take(1).toProperty():o.constant(e)},AlignmentNodeModel.prototype.loadState=function(e){var t=e.matches.keySeq().toArray().map(d.Rdf.iri),r=[];if(e.matches.forEach((function(e){e.forEach((function(e){return r.push(e.iri)}))})),0===r.length)return o.constant({source:a.readyToLoadBaseForest,target:a.readyToLoadBaseForest});return o.combine({sourceData:this.loadSkeleton({iris:r,useBaseModel:!1}),targetData:this.loadSkeleton({iris:t,useBaseModel:!0})}).map((function(t){var r=t.sourceData,i=t.targetData;return{source:u.KeyedForest.create(a.keyOf,r.tree),target:function matchTargetNodes(t,r){var i=u.KeyedForest.create(a.keyOf,t);return e.matches.forEach((function(e,t){var o=e.find((function(e){return e.kind===n.ExactMatch})),l=e.filter((function(e){return e.kind===n.NarrowerMatch}));i.nodes.get(t).forEach((function(e){i=i.updateNode(i.getKeyPath(e),(function(e){var t=e;return o&&(t=a.setExactMatch(t,r.get(o.iri.value),o.excluded)),t=a.addNarrowMatches(t,l.map((function(e){return asNarrowMatch(r.get(e.iri.value),e.excluded)})))}))}))})),i}(i.tree,r.leafs)}})).toProperty()},AlignmentNodeModel.prototype.loadSkeleton=function(e){var t=e.useBaseModel?this.baseModel:this.alignedModel,r=e.useBaseModel?this.baseNodeQuery:this.alignNodeQuery;return function loadNodesUsingNodeQuery(e,t,r){var n=e.map((function(e){return{item:e}})),a=c.SparqlClient.prepareParsedQuery(n)(t);return c.SparqlClient.select(a,r).map((function(e){var t=u.nodesFromQueryResult(e);return l.Map(t.map((function(e){return[e.iri.value,e]})))}))}(e.iris,r,t.sparqlOptions()).flatMap((function(e){return t.loadFromLeafs(e.toArray(),{transitiveReduction:!1}).map(asBaseNode).map((function(t){return{leafs:e,tree:t}}))}))},AlignmentNodeModel}();function asBaseNode(e){return a.set(a.empty,{base:e,children:(e.children||[]).map(asBaseNode)})}function asMatchChildren(e,t){return(e||[]).filter((function(e){return!t.has(u.Node.keyOf(e))})).map((function(e){return a.set(a.empty,{aligned:e,alignKind:n.MatchChild,excludeFromAlignment:t,children:asMatchChildren(e.children,t)})}))}function asNarrowMatch(e,t){return a.set(a.empty,{aligned:e,alignKind:n.NarrowerMatch,children:asMatchChildren(e.children,t),excludeFromAlignment:t})}function mergeChildren(e,t){var r=u.mergeRemovingDuplicates(a.keyOf,e,t);return r.sort(compareAlignmentNodesByLabel),r}function compareAlignmentNodesByLabel(e,t){return getNodeLabel(e).localeCompare(getNodeLabel(t))}function getNodeLabel(e){var t=e.base||e.aligned;return t&&t.label?t.label.value:""}t.AlignmentNodeModel=s,t.unalignAll=function unalignAll(e,t,r){for(var i=e,_loop_1=function(){var e=function findFirstAlignmentTarget(e,t,r){var a=l.Set(),i=e.nodes.get(t,a).find((function(e){return e.alignKind===n.NarrowerMatch}));if(i)return i;return e.nodes.get(r,a).find((function(e){return e.aligned&&u.Node.keyOf(e.aligned)===t&&e.alignKind===n.ExactMatch}))}(i,t,r);if(!e)return"break";var o=a.unalign(e),d=i.getKeyPath(e);i=o?i.updateNode(d,(function(){return o})):i.removeNode(d)};;){if("break"===_loop_1())break}return i},t.validateAlignment=function validateAlignment(e,t,r,n){return{valid:!0}},t.asNarrowMatch=asNarrowMatch,t.findExcludedChildren=function findExcludedChildren(e,t,r){var n=r.keyOf;return l.Set().withMutations((function(a){var visit=function(e,t){if(!u.TreeSelection.isTerminal(t))for(var i=0,o=e.children;i<o.length;i++){var l=o[i],d=n(l),c=r.getChildIndex(t,d);if("number"==typeof c){var s=t.children[c];visit(l,s)}else a.add(d)}};visit(e,t)}))}},1990:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(43),a=r(33),i=r(23),o=i.vocabularies.rdfs,l=i.vocabularies.rdf,d=r(1624),c=r(1700);function groupMatches(e){return n.Map().withMutations((function(t){e.nodes.forEach((function(r,a){r.forEach((function(r){var a=r.alignKind;if(r.aligned&&(a===c.AlignKind.ExactMatch||a===c.AlignKind.NarrowerMatch)){var i=c.AlignmentNode.getMatchTarget(r,e),o=i.base.iri.value;t.update(o,(function(e){var t=e||n.Map(),o=r.aligned.iri.value;return t.has(o)?t:t.set(o,{kind:a,targetAligned:r,targetBase:i})}))}}))}))}))}t.groupMatches=groupMatches,t.exportAlignment=function exportAlignment(e,t){return{matches:groupMatches(e).map((function(e){return e.map((function(e){var t=e.kind,r=e.targetAligned;return{kind:t,iri:r.aligned.iri,excluded:r.excludeFromAlignment}})).toArray()})).toMap(),metadata:t}},t.serializeAlignment=function serializeAlignment(e){var t=e.metadata.iri.getOrElse(i.Rdf.BASE_IRI),r=[];return e.matches.forEach((function(e,t){for(var n=i.Rdf.iri(t),_loop_1=function(e){var t=i.Rdf.bnode(),a=e.kind===c.AlignKind.ExactMatch?d.rso.PX_exact_match:d.rso.PX_narrow_match;r.push(i.Rdf.triple(e.iri,a,t)),r.push(i.Rdf.triple(t,d.rso.PX_match_target,n)),e.excluded.forEach((function(e){r.push(i.Rdf.triple(t,d.rso.PX_match_excludes,i.Rdf.iri(e)))}))},a=0,o=e;a<o.length;a++){_loop_1(o[a])}})),r.push(i.Rdf.triple(t,l.type,d.rso.Alignment),i.Rdf.triple(t,o.label,i.Rdf.literal(e.metadata.label)),i.Rdf.triple(t,o.comment,i.Rdf.literal(e.metadata.description)),i.Rdf.triple(t,d.rso.PX_source_terminology,e.metadata.source),i.Rdf.triple(t,d.rso.PX_target_terminology,e.metadata.target)),i.Rdf.graph(r)},t.deserializeAlignment=function deserializeAlignment(e){var t=n.Map().asMutable(),r={};return e.triples.forEach((function(l){var u=l.s,s=l.p,h=l.o,g=s.equals(d.rso.PX_exact_match)||s.equals(d.rso.PX_narrow_match);if(u.isIri()&&g){var f=i.Rdf.pg(h,e),m=s.equals(d.rso.PX_exact_match)?c.AlignKind.ExactMatch:c.AlignKind.NarrowerMatch,p=i.Rdf.getValuesFromPropertyPath([d.rso.PX_match_target],f);if(1!==p.length)return void console.warn("Skipping alignment match source "+u+" with multiple target nodes.");var M=n.Set(i.Rdf.getValuesFromPropertyPath([d.rso.PX_match_excludes],f).filter((function(e){return e.isIri()})).map((function(e){return e.value})));t.update(p[0].value,(function(e){var t=e||[];return t.push({kind:m,iri:u,excluded:M}),t}))}else s.equals(o.label)&&u.isIri()?(r.iri=a.Just(u),r.label=h.value):s.equals(o.comment)?r.description=h.value:s.equals(d.rso.PX_source_terminology)&&h.isIri()?r.source=h:s.equals(d.rso.PX_target_terminology)&&h.isIri()&&(r.target=h)})),{matches:t.asImmutable(),metadata:r}}},2346:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=r(118),i=r(1624),o=function(e){function AlignmentService(t){return e.call(this,i.rso.AlignmentContainer.value)||this}return n.__extends(AlignmentService,e),AlignmentService}(a.LdpService);t.AlignmentService=o}}]);
//# sourceMappingURL=default~rs-alignment-tool~rs-alignment-tool-create-alignment-action-ef8cdffe7d0a22433f62.js.map