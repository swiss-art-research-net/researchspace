(window.webpackJsonp=window.webpackJsonp||[]).push([[498],{1355:function(e,r,t){Object.defineProperty(r,"__esModule",{value:!0});var n=t(11),o=t(1),i=t(16),a=t(33),u=t(23),s=t(61),d=t(214),l=t(1562),m=t(1569),p=t(1823),c=u.Rdf.iri(u.vocabularies.VocabPlatform._NAMESPACE+"FormQuerySubject"),f=function(e){function FormQuery(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(FormQuery,e),FormQuery.prototype.render=function(){var e=this;return o.createElement(m.SemanticSearchContext.Consumer,null,(function(r){return o.createElement(y,n.__assign({},e.props,{context:r}))}))},FormQuery}(o.Component);r.FormQuery=f;var y=function(e){function FormQueryInner(r){var t,m,c,f,y=e.call(this,r)||this;return y.onKeyDown=function(e){13===e.keyCode&&y.executeSearch()},y.setFormRef=function(e){y.form=e},y.onFormChanged=function(e){y.setState({model:e})},y.onFormLoaded=function(e){var r=y.props.queryTemplate,t=[];i.each(r.arguments,(function(r,n){!function validateArgumentAndField(e,r,t,n){if(!t)return void n.push({kind:l.ErrorKind.Configuration,message:"Missing field definition or input for argument '"+e+"'"});var o=u.XsdDataTypeValidation.parseXsdDatatype(r.type);o?u.XsdDataTypeValidation.sameXsdDatatype(o.iri,t.xsdDatatype)||n.push({kind:l.ErrorKind.Configuration,message:"Mismatched argument type "+o.iri+" and field type "+t.xsdDatatype}):n.push({kind:l.ErrorKind.Configuration,message:"Invalid XSD datatype '"+r.type+"' for argument '"+e+"'"})}(n,r,e.definitions.get(n),t)})),y.setState({model:l.CompositeValue.set(e,{errors:e.errors.concat(t)})})},y.onFormStateChanged=function(e){y.setState({modelState:e})},y.mapChildren=function(e){return o.Children.map(e,(function(e){if(!d.isValidChild(e))return e;var r=e.type,t=e.props;return"button"===r&&"submit"===t.name?o.cloneElement(e,{disabled:!y.canSubmit(y.state.model),onClick:y.executeSearch}):t.children&&t.children.length>0?o.cloneElement(e,{},y.mapChildren(t.children)):e}))},y.executeSearch=function(){var e=y.form.validate(y.state.model);if(y.setState({model:e}),y.canSubmit(e)){y.props.domainField&&p.setSearchDomain("<"+l.FieldValue.asRdfNode(e.fields.get(y.props.domainField).values.first()).value+">",y.props.context);var r=function parametrizeQueryFromForm(e,r){var t=s.SparqlUtil.parseQuery(e.queryString);if("query"!==t.type||"SELECT"!==t.queryType)throw new Error("Query must be SELECT SPARQL query");var n=e.arguments,o={};return t=Object.keys(n).reduce((function(e,t){var i=n[t],a=r.fields.get(t).values,u=r.definitions.get(t).maxOccurs;if(0===a.size){if(i.optional)return e;throw new Error("No field value for query argument "+t)}if(1===u||1===a.size){var d=l.FieldValue.asRdfNode(a.first());if(!d){if(i.optional)return e;throw new Error("Empty field value for query argument "+t)}return o[t]=d,e}var m=[];return a.forEach((function(e){var r,n=l.FieldValue.asRdfNode(e);if(!n){if(i.optional)return;throw new Error("Empty field value for query argument "+t)}m.push(((r={})[t]=n,r))})),s.SparqlClient.prepareParsedQuery(m)(e)}),t),s.SparqlClient.setBindings(t,o)}(y.props.queryTemplate,e);return y.props.context.setBaseQuery(a.Just(r))}},y.state={definitions:(t={queryTemplate:y.props.queryTemplate,defs:y.props.fields,multi:y.props.multi},m=t.queryTemplate,c=t.defs,f=t.multi,c.map(l.normalizeFieldDefinition).map((function(e){var r=m.arguments[e.id];return r?n.__assign(n.__assign({},e),{maxOccurs:f?e.maxOccurs:1,minOccurs:r.optional?0:1}):e})))},y}return n.__extends(FormQueryInner,e),FormQueryInner.prototype.componentWillReceiveProps=function(e){var r=e.context;r.searchProfileStore.isJust&&r.domain.isNothing&&p.setSearchDomain(e.domain,r)},FormQueryInner.prototype.render=function(){return o.createElement(l.SemanticForm,{ref:this.setFormRef,fields:this.state.definitions,model:this.state.model||l.FieldValue.fromLabeled({value:c}),onChanged:this.onFormChanged,onLoaded:this.onFormLoaded,onUpdated:this.onFormStateChanged},o.createElement("div",{onKeyDown:this.onKeyDown},this.mapChildren(this.props.children)))},FormQueryInner.prototype.canSubmit=function(e){return this.state.modelState===l.DataState.Ready&&l.readyToSubmit(e,(function(e){return!0}))},FormQueryInner}(o.Component);r.default=f}}]);
//# sourceMappingURL=semantic-search-form-query-a05e6a096c7ddb32b230.js.map