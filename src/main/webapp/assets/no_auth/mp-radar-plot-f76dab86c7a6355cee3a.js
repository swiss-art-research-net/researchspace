(window.webpackJsonp=window.webpackJsonp||[]).push([[372],{1346:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),o=r(1),i=r(16),a=r(72),s=r(34),c=r(56),l=r(120),u=r(61),d=r(327),p=r(630),m=r(2924),y=r(2925),h=r(1347),f=function(e){function RadarPlot(t,r){var n=e.call(this,t,r)||this;return n.cancellation=new s.Cancellation,n.uniquePrefix=i.uniqueId("RadarPlot-"),n.showPopover=function(e,t,r,i){var s=n.props.templates[e],c=o.createElement(a.Overlay,{key:e+":"+t,show:!0,rootClose:!0,onHide:function(){n.setState({popover:void 0})},placement:"bottom",target:i},o.createElement(a.Popover,{id:"radar-plot-popover",title:""+r},o.createElement("div",{style:{width:n.props.popoverWidth}},s?o.createElement(p.TemplateItem,{template:{source:s,options:{iri:t,label:r}}}):o.createElement("i",null,"No info available"))));n.setState({popover:c})},n.state={layout:n.props.items?y.computeLayout(n.props):void 0},n}return n.__extends(RadarPlot,e),RadarPlot.prototype.render=function(){var e=this.props,t=e.width,r=e.height;return o.createElement("div",{className:h.component},this.renderSvg(Number(t),Number(r)))},RadarPlot.prototype.componentDidMount=function(){this.props.query&&this.reloadItems(this.props)},RadarPlot.prototype.componentWillReceiveProps=function(e){e.query!==this.props.query&&(this.setState({loadedItems:void 0,layout:void 0}),this.reloadItems(e))},RadarPlot.prototype.reloadItems=function(e){var t=this;this.cancellation.map(function loadItems(e,t){return u.SparqlClient.select(e,{context:t}).map((function(e){for(var t=[],r=0,n=e.results.bindings;r<n.length;r++){var o=n[r],i=o.iri,a=o.subsector,s=o.ring,c=o.cluster,l=o.label,u=o.distance,d=o.color;if(i&&a&&u){var p=Number(u.value);Number.isFinite(p)||console.warn("Invalid distance for item '"+i+"'"),t.push({iri:i.value,subsector:a.value,ring:s.value,cluster:c?c.value:void 0,label:l?l.value:i.value,distance:Number.isFinite(p)?p:0,color:d?d.value:void 0})}}return t}))}(e.query,this.context.semanticContext)).observe({value:function(e){t.setState((function(t,r){return{loadedItems:e,layout:y.computeLayout(n.__assign(n.__assign({},r),{items:e}))}}))},error:function(e){return console.error(e)}})},RadarPlot.prototype.renderSvg=function(e,t){var r=this.props.itemRadius,n=this.state,i=n.layout,a=n.popover;if(!i)return o.createElement("div",{style:{width:e,height:t}},o.createElement(d.Spinner,null));var s=i.orderedSubsectors,c=Math.min(t/8,50),u=c,p={x:e/2,y:t-u},y={x:e/2,y:t-u},h=m.Vector.subtract(y,{x:2*c,y:2*c}),directionFromIndex=function(e){var t=e/s.length,r=m.approximateUniformEllipticAngle(t,y.x,y.y),n=-1*Math.PI*(1-r);return m.Vector.fromAngle(n)},f=r,getItemPosition=function(e){return function computeItemPosition(e,t,r,n,o,i){var a=t.sectorLayouts[e.subsector].startIndex,s=t.ringIndices[e.ring],c=t.normalizedPositions[e.iri],l=c.x,u=c.y,d=(s+u)/t.rings.length,p=m.Vector.scale(o,d),y=m.approximateEllipsePerimeter(p.x,p.y)/2/t.orderedSubsectors.length,h=Math.min(1,i/y),f=m.Scalar.lerp(h,1-h,l),x=r(a+f),g=m.ellipsePointFromDirection(x,o),v=m.Vector.length(g)/t.rings.length,b=(Math.min(i,v/2),m.Vector.scale(m.Vector.normalize(g),s*v+m.Scalar.lerp(i,v-i,u)));return m.Vector.add(n,b)}(e,i,directionFromIndex,p,h,f)},parseStyle=function(e){return l.ModuleRegistry.parseReactStyleFromCss(e)},g=parseStyle(this.props.sectorLabelStyle),S=parseStyle(this.props.subsectorLabelStyle),I=parseStyle(this.props.ringLabelStyle),w=parseStyle(this.props.itemLabelStyle);return o.createElement("svg",{width:e,height:t},o.createElement(v,{layout:i,center:p,outerRadius:h}),o.createElement(x,{layout:i,sectorLabelStyle:g,subsectorLabelStyle:S,showPopover:this.showPopover,directionFromIndex,uniquePrefix:this.uniquePrefix,center:p,outerRadius:y,height:c}),o.createElement(b,{layout:i,labelStyle:I,showPopover:this.showPopover,directionFromIndex,center:p,innerSubHeaderRadius:h,ringLabelHeight:u}),o.createElement(P,{layout:i,showPopover:this.showPopover,getItemPosition,itemRadius:r}),o.createElement(E,{layout:i,labelStyle:w,showPopover:this.showPopover,directionFromIndex,getItemPosition,itemRadius:r}),a)},RadarPlot.defaultProps={clusters:[],templates:{},itemRadius:15,popoverWidth:200},RadarPlot}(c.Component);t.RadarPlot=f;var x=function(e){function Headers(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(Headers,e),Headers.prototype.render=function(){var e=this.props,t=e.layout,r=e.sectorLabelStyle,n=e.subsectorLabelStyle,i=e.showPopover,a=e.directionFromIndex,s=e.uniquePrefix,c=e.center,l=e.outerRadius,u=e.height,d=t.sectors,p=(t.subsectorsBySector,t.orderedSubsectors),y=t.sectorLayouts,f=t.sectorColors,x=m.Vector.subtract(l,{x:u,y:u}),v=m.Vector.subtract(x,{x:u,y:u});return o.createElement("g",{className:h.headers},d.map((function(e,t){var n=y[e.iri],l=n.startIndex,d=n.endIndex;return o.createElement(g,{key:e.iri,onTriggerPopover:function(t){i("sector",e.iri,e.label,t)},className:h.sectorHeader,style:r,shortId:s+"-sector-"+t,startDirection:a(l),endDirection:a(d),center:c,innerRadius:x,headerHeight:u,label:e.label,color:f[e.iri]})})),p.map((function(e,t){var r=y[e.iri],l=r.startIndex,d=r.endIndex;return o.createElement(g,{key:e.iri,onTriggerPopover:function(t){i("subsector",e.iri,e.label,t)},className:h.subsectorHeader,style:n,shortId:s+"-subsector-"+t,startDirection:a(l),endDirection:a(d),center:c,innerRadius:v,headerHeight:u,label:e.label,color:f[e.iri]})})))},Headers}(c.Component),g=function(e){function SectorHeader(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(SectorHeader,e),SectorHeader.prototype.render=function(){var e=this.props,t=e.onTriggerPopover,r=e.className,n=e.style,i=e.shortId,a=e.startDirection,s=e.endDirection,c=e.center,l=e.innerRadius,u=e.headerHeight,d=e.label,p=e.color,y=m.Vector.add(c,m.ellipsePointFromDirection(a,l)),f=m.Vector.add(c,m.ellipsePointFromDirection(m.Vector.lerp(a,s,.5),l)),x=m.Vector.add(c,m.ellipsePointFromDirection(s,l)),g=m.Vector.add(l,{x:u,y:u}),v=m.Vector.add(c,m.ellipsePointFromDirection(a,g)),b=m.Vector.add(c,m.ellipsePointFromDirection(s,g)),triggerOnHeader=function(e){var r=e.currentTarget;if(r instanceof Element){var n=r.querySelector("."+h.sectorPopoverTarget);n&&t(n)}},P=i+"-labelPath";return o.createElement("g",{className:r,onMouseEnter:triggerOnHeader,onClick:triggerOnHeader},o.createElement("defs",null,o.createElement("path",{id:P,d:"\n              M "+(y.x+v.x)/2+"\n                "+(y.y+v.y)/2+"\n\n              A "+(l.x+g.x)/2+"\n                "+(l.y+g.y)/2+"\n                0 0 1\n                "+(x.x+b.x)/2+"\n                "+(x.y+b.y)/2+"\n            "})),o.createElement("path",{fill:p,d:"\n            M "+v.x+" "+v.y+"\n            A "+g.x+" "+g.y+" 0 0 1 "+b.x+" "+b.y+"\n            L "+x.x+" "+x.y+"\n            A "+l.x+" "+l.y+" 0 0 0 "+y.x+" "+y.y+"\n            Z\n          "}),o.createElement("circle",{className:h.sectorPopoverTarget,cx:f.x,cy:f.y,r:1}),o.createElement("text",{fontSize:.75*u,textAnchor:"middle",style:n},o.createElement("textPath",{xlinkHref:"#"+P,dominantBaseline:"central",startOffset:"50%"},d)))},SectorHeader}(c.Component),v=function(e){function Background(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(Background,e),Background.prototype.render=function(){var e=this,t=this.props,r=t.layout,n=t.center,i=t.outerRadius,a=m.Vector.scale(i,1/r.rings.length);return o.createElement("g",{className:h.background},r.rings.map((function(t,r){var o=m.Vector.scale(a,r),i=m.Vector.scale(a,r+1);return e.renderRing(t,n,o,i)})))},Background.prototype.renderRing=function(e,t,r,n){return o.createElement("path",{key:e.iri,className:h.ringArea,style:{fill:e.color},d:"\n          M "+(t.x-n.x)+" "+t.y+"\n          A "+n.x+" "+n.y+" 0 0 1 "+(t.x+n.x)+" "+t.y+"\n          L "+(t.x+r.x)+" "+t.y+"\n          A "+r.x+" "+r.y+" 0 0 0 "+(t.x-r.x)+" "+t.y+"\n          Z\n        "})},Background}(c.Component),b=function(e){function Grid(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(Grid,e),Grid.prototype.render=function(){var e=this.props,t=e.layout,r=e.labelStyle,n=e.showPopover,i=e.directionFromIndex,a=e.center,s=e.innerSubHeaderRadius,c=e.ringLabelHeight,l=t.sectors,u=t.subsectorsBySector,d=t.sectorLayouts,p=t.rings,lineEndFromIndex=function(e){var t=m.ellipsePointFromDirection(i(e),s);return m.Vector.add(a,t)},y=m.Vector.scale(s,1/p.length);return o.createElement("g",{className:h.grid},p.map((function(e,t){var i=m.Vector.scale(y,t),onTriggerPopover=function(t){n("ring",e.iri,e.label,t.currentTarget)};return o.createElement("g",{key:e.iri},0===t?null:o.createElement("path",{className:h.ringLine,d:"\n                    M "+(a.x-i.x)+" "+a.y+"\n                    A "+i.x+" "+i.y+" 0 0 1 "+(a.x+i.x)+" "+a.y+"\n                  "}),o.createElement("text",{className:h.ringLabel,x:a.x-i.x-y.x/2,y:a.y+c/2,style:r,textAnchor:"middle",alignmentBaseline:"central",fontSize:.3*c,onMouseEnter:onTriggerPopover,onClick:onTriggerPopover},e.label))})),l.map((function(e,t){var r=lineEndFromIndex(d[e.iri].startIndex),n=u[e.iri];return o.createElement("g",{key:e.iri},0===t?null:o.createElement("line",{className:h.sectorLine,x1:a.x,y1:a.y,x2:r.x,y2:r.y}),n.map((function(e,t){if(0===t)return null;var r=lineEndFromIndex(d[e.iri].startIndex);return o.createElement("line",{className:h.subsectorLine,key:e.iri,x1:a.x,y1:a.y,x2:r.x,y2:r.y})})))})),o.createElement("line",{className:h.sectorLine,x1:a.x-s.x,y1:a.y,x2:a.x+s.x,y2:a.y}))},Grid}(c.Component),P=function(e){function Clusters(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(Clusters,e),Clusters.prototype.render=function(){var e=this.props,t=e.layout,r=(e.showPopover,e.getItemPosition),n=e.itemRadius,i=t.clusters,a=t.clusterColors,s=t.items;return o.createElement("g",{className:h.clusters},i.map((function(e){var t=s.filter((function(t){return t.cluster===e.iri})).map(r);if(t.length<2)return null;var i=m.convexHullOf(t),c=1.3*n,orthogonalClockwise=function(e){return{x:-e.y,y:e.x}},l="M "+i.map((function(e,t){var r=0===t?i.length-1:t-1,n=(t+1)%i.length,o=i[r],a=i[n],s=m.Vector.scale(orthogonalClockwise(m.Vector.normalize(m.Vector.subtract(e,o))),c),l=m.Vector.scale(orthogonalClockwise(m.Vector.normalize(m.Vector.subtract(a,e))),c),u=m.Vector.add(e,s),d=m.Vector.add(e,l),p=m.Vector.add(m.Vector.lerp(e,o,1/3),s),y=m.Vector.add(m.Vector.lerp(e,a,1/3),l);return p.x+" "+p.y+" L "+u.x+" "+u.y+" A "+c+" "+c+" 0 0 0 "+d.x+" "+d.y+" L "+y.x+" "+y.y})).join(" L ")+" Z",u=a[e.iri];return o.createElement("path",{key:e.iri,className:h.cluster,d:l,fill:u,stroke:u})})))},Clusters}(c.Component),E=function(e){function Items(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(Items,e),Items.prototype.render=function(){var e=this.props,t=e.layout,r=e.labelStyle,n=e.showPopover,i=(e.directionFromIndex,e.getItemPosition),a=e.itemRadius,s=t.orderedSubsectors,c=t.itemsBySubsector,l=(t.normalizedPositions,t.sectorColors);return o.createElement("g",{className:h.items},s.map((function(e,s){var u=c[e.iri]||[];return 0===u.length?null:o.createElement("g",{key:e.iri},u.map((function(s){var c=i(s),u=s.cluster?t.clustersByIri[s.cluster]:void 0,d=s.color?s.color:u&&u.color?u.color:l[e.iri];return function renderItem(e,t,r,n,i,a){var s=t.x,c=t.y;return o.createElement("g",{className:h.item,key:e.iri,onMouseEnter:a,onClick:a},o.createElement("circle",{cx:s,cy:c,r,fill:n}),o.createElement("text",{x:s,y:c,style:i,textAnchor:"middle",dominantBaseline:"central",fontSize:r/2},e.label))}(s,c,a,d,r,(function(e){n("point",s.iri,s.label,e.currentTarget)}))})))})))},Items}(c.Component);t.default=f},2924:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(16);!function(e){function length(e){return Math.sqrt(e.x*e.x+e.y*e.y)}e.add=function add(e,t){return{x:e.x+t.x,y:e.y+t.y}},e.subtract=function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}},e.scale=function scale(e,t){return{x:e.x*t,y:e.y*t}},e.lerp=function lerp(e,t,r){var n=1-r;return{x:n*e.x+r*t.x,y:n*e.y+r*t.y}},e.length=length,e.normalize=function normalize(e){var t=1/length(e);return{x:e.x*t,y:e.y*t}},e.cross=function cross(e,t){return e.x*t.y-e.y*t.x},e.fromAngle=function fromAngle(e){return{x:Math.cos(e),y:Math.sin(e)}}}(n=t.Vector||(t.Vector={})),function(e){e.lerp=function lerp(e,t,r){return e*(1-r)+t*r}}(t.Scalar||(t.Scalar={})),t.ellipsePointFromDirection=function ellipsePointFromDirection(e,t){var r=e.x,n=e.y,o=r/t.x,i=n/t.y,a=Math.sqrt(1/(o*o+i*i));return{x:r*a,y:n*a}},t.approximateUniformEllipticAngle=function approximateUniformEllipticAngle(e,t,r){if(t<r)return e<.5?approximateUniformEllipticAngle(e+.5,r,t)-.5:approximateUniformEllipticAngle(e-.5,r,t)+.5;var n=2*(e-.5);return.5*(1+Math.sign(n)*Math.pow(Math.abs(n),r/t))},t.approximateEllipsePerimeter=function approximateEllipsePerimeter(e,t){return Math.PI*(e+t)},t.convexHullOf=function convexHullOf(e){var t=o.maxBy(e,(function(e){return e.y})).y,r=o.minBy(e.filter((function(e){return e.y===t})),(function(e){return e.x})),i=o.orderBy(e,(function(e){var t=n.subtract(e,r);return Math.atan2(-t.y,t.x)}));i.splice(i.indexOf(r),1);for(var a=[r,i.shift()],s=0,c=i;s<c.length;s++){var l=c[s],u=void 0;do{var d=a[a.length-1],p=a[a.length-2],m=n.subtract(d,p),y=n.subtract(l,p);(u=n.cross(m,y)>0)&&a.pop()}while(u);a.push(l)}return a}},2925:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),o=r(16),i=r(1591);function computeItemsLayout(e,t,r){for(var n={},i=new a(0),_loop_1=function(e){var a=t[e.iri]||[];r.forEach((function(e,t){var r=a.filter((function(t){return t.ring===e.iri})),s=function computeItemsRange(e){for(var t=1/0,r=-1/0,n=0,o=e;n<o.length;n++){var i=o[n];t=Math.min(t,i.distance),r=Math.max(r,i.distance)}t===r&&(t-=1,r+=1);return{minDistance:t,maxDistance:r}}(r),c=s.minDistance,l=s.maxDistance,u=o.orderBy(r,(function(e){return e.distance}));i.shuffle(u).forEach((function(e,t){n[e.iri]={x:r.length<=1?.5:t/(r.length-1),y:(e.distance-c)/(l-c)}}))}))},s=0,c=e;s<c.length;s++){_loop_1(c[s])}return n}t.computeLayout=function computeLayout(e){for(var t=e.sectors,r=e.subsectors,n=e.rings,a=e.clusters,s=e.items,c=o.groupBy(r,(function(e){return e.sector})),l=o.flatten(t.map((function(e){return c[e.iri]}))),u=o.groupBy(s,(function(e){return e.subsector})),d={},p=0,m=0,y=t;m<y.length;m++){for(var h=y[m],f=p,x=c[h.iri],g=0,v=c[h.iri];g<v.length;g++){d[v[g].iri]={parentSector:h.iri,startIndex:p,endIndex:p+1},p++}0===x.length&&p++,d[h.iri]={parentSector:void 0,startIndex:f,endIndex:p}}var b={};t.forEach((function(e,r){var n=e.color?i.hcl(e.color):function defaultSectorColor(e,t){var r=(.2+1*(e+.5)/t)%1;return i.hcl(360*r,40,65)}(r,t.length);b[e.iri]=n.toString();var o=c[e.iri]||[];o.forEach((function(e,t){var r=e.color?e.color:function defaultSubsectorColor(e,t,r){var n=e.h,o=e.c,a=e.l,s=1-(t+1)/r;return i.hcl(n,o,a*(1+.5*s))}(n,t,o.length).toString();b[e.iri]=r}))}));var P={};n.forEach((function(e,t){return P[e.iri]=t}));var E={};a.forEach((function(e,t){E[e.iri]=e.color||function defaultClusterColor(e,t){var r=(.4+1*(e+.5)/t)%1;return i.hcl(360*r,20,65)}(t,a.length).toString()}));for(var S=0,I=s;S<I.length;S++){var w=I[S],R=d[w.subsector];if(!R||!R.parentSector)throw new Error("Unknown subsector <"+w.subsector+"> for item <"+w.iri+">");if(!(w.ring in P))throw new Error("Unknown ring <"+w.ring+"> for item <"+w.iri+">")}return{sectors:t,orderedSubsectors:l,subsectorsBySector:c,items:s,itemsBySubsector:u,sectorLayouts:d,sectorColors:b,rings:n,ringIndices:P,clusters:a,clustersByIri:o.keyBy(a,(function(e){return e.iri})),clusterColors:E,normalizedPositions:computeItemsLayout(l,u,n)}};var a=function(){function LcgRandom(e){this.seed=e,this.a=1664525,this.c=1013904223,this.range=Math.pow(2,32)}return LcgRandom.prototype.nextInteger=function(e){this.seed=(this.seed*this.a+this.c)%this.range;var t=this.seed/this.range;return Math.floor(t*e)},LcgRandom.prototype.shuffle=function(e){for(var t=n.__spreadArrays(e),r=0;r<e.length;r++){var o=e.length-r,i=r+this.nextInteger(o),a=t.splice(i,1)[0];t.splice(r,0,a)}return t},LcgRandom}()}}]);
//# sourceMappingURL=mp-radar-plot-f76dab86c7a6355cee3a.js.map