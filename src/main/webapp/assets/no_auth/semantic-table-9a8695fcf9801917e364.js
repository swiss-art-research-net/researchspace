(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{1245:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),o=a(35),i=a(0),s=a(16),l=a(1625),u=a(33),p=a(34),c=a(61),m=a(56),f=a(162),d=a(327),h=a(630),b=a(116),g=a(2011);var v=function(e){function SemanticTable(t,a){var n=e.call(this,t,a)||this;return n.cancellation=new p.Cancellation,n.querying=n.cancellation.derive(),n.TABLE_REF="table",n.prepareConfigAndExecuteQuery=function(e,t){n.setState({isLoading:!0,error:void 0}),n.querying=n.cancellation.deriveAndCancel(n.querying);var a=n.querying.map(c.SparqlClient.select(e.query,{context:t.semanticContext})).onValue((function(e){return n.setState({data:e,isLoading:!1})})).onError((function(e){return n.setState({isLoading:!1,error:e})})).onEnd((function(){n.props.id&&f.trigger({eventType:f.BuiltInEvents.ComponentLoaded,source:n.props.id})}));n.props.id&&f.trigger({eventType:f.BuiltInEvents.ComponentLoading,source:n.props.id,data:a})},n.state={isLoading:!0},n}return n.__extends(SemanticTable,e),SemanticTable.prototype.getSelected=function(){return this.refs[this.TABLE_REF].getSelected()},SemanticTable.prototype.shouldComponentUpdate=function(e,t){return t.isLoading!==this.state.isLoading||!s.isEqual(e,this.props)},SemanticTable.prototype.componentWillReceiveProps=function(e,t){e.query!==this.props.query&&this.prepareConfigAndExecuteQuery(e,t)},SemanticTable.prototype.componentDidMount=function(){this.prepareConfigAndExecuteQuery(this.props,this.context)},SemanticTable.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticTable.prototype.render=function(){return this.state.error?r.createElement(b.ErrorNotification,{errorMessage:this.state.error}):o.div({className:"semantic-table-holder"},this.state.isLoading?r.createElement(d.Spinner):this.state.data&&!c.SparqlUtil.isSelectResultEmpty(this.state.data)?this.renderTable():r.createElement(h.TemplateItem,{template:{source:this.props.noResultTemplate}}))},SemanticTable.prototype.renderTable=function(){var e,t={tupleTemplate:u.fromNullable((e=this.props,s.has(e,"tupleTemplate")?this.props.tupleTemplate:null)),options:this.props.options,showLabels:this.props.showLabels,prefetchLabels:this.props.prefetchLabels};t=this.handleDeprecatedLayout(t);var a=this.props,o=a.currentPage,i=a.onControlledPropChange,p=n.__rest(a,["currentPage","onControlledPropChange"]),c={currentPage:o,onPageChange:i?function(e){return i({currentPage:e})}:void 0};return r.createElement(g.Table,n.__assign(n.__assign(n.__assign({},p),c),{layout:u.fromNullable(t),numberOfDisplayedRows:u.fromNullable(this.props.numberOfDisplayedRows),data:l.Right(this.state.data),ref:this.TABLE_REF}))},SemanticTable.prototype.handleDeprecatedLayout=function(e){return s.has(this.props,"layout")&&(console.warn("layout property in semantic-table is deprecated, please use flat properties instead"),e.tupleTemplate=u.fromNullable(this.props.layout.tupleTemplate),e.options=this.props.layout.options),e},SemanticTable.propTypes=n.__assign(n.__assign({},m.Component.propTypes),{onControlledPropChange:i.func}),SemanticTable}(m.Component);t.SemanticTable=v,t.default=v},2011:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),o=a(2400),i=a(16),s=a(43),l=a(34),u=a(56),p=a(23),c=a(338),m=a(140),f=a(630),d=a(327),h=a(116),b=a(2544),g=a(2545);a(1309);var v=function(e){function Table(t,a){var n=e.call(this,t,a)||this;return n.cancellation=new l.Cancellation,n.state={buffer:new C(s.Map(),n.cancellation,(function(e){return m.getLabels(e.toArray(),{context:n.context.semanticContext})}),(function(){return n.forceUpdate()}))},n}return n.__extends(Table,e),Table.prototype.componentDidMount=function(){var e=this;this.setState((function(t){return e.updateStateFromProps(e.props,t)}))},Table.prototype.componentWillReceiveProps=function(e){var t=this;this.setState((function(a){return t.updateStateFromProps(e,a)}))},Table.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},Table.prototype.updateStateFromProps=function(e,t){var a=!0,n=!0;if(e.layout.isJust){var r=e.layout.get();void 0!==r.showLabels&&(a=r.showLabels),void 0!==r.prefetchLabels&&(n=r.prefetchLabels)}var o={get showLabels(){return a},get preferchLabels(){return n},getLabel:function(e){return a&&n?t.buffer.result.get(e):void 0}},i=this.buildConfig(e,o);if(n){var l=function findReferencedResources(e,t){return s.Set().withMutations((function(a){for(var n=0,r=e.results;n<r.length;n++)for(var o=r[n],i=0,s=e.columnMetadata;i<s.length;i++){var l=s[i];if(l.variableName){var u=o[l.variableName];u instanceof p.Rdf.Iri&&!t.has(u)&&a.add(u)}}}))}(i,t.buffer.targets);t.buffer.load(l)}return{buffer:t.buffer,griddleConfig:i}},Table.prototype.buildConfig=function(e,t){var a=this,o={externalCurrentPage:e.currentPage,onPageChange:e.onPageChange},i={resultsPerPage:e.numberOfDisplayedRows.getOrElse(10),showFilter:!0,useGriddleStyles:!1,tableClassName:"table",sortAscendingComponent:r.createElement("span",{className:"fa fa-sort-alpha-asc"}),sortDescendingComponent:r.createElement("span",{className:"fa fa-sort-alpha-desc"}),useCustomPagerComponent:!0,customPagerComponent:b.Pagination,customPagerComponentOptions:o,useCustomFilterer:!0,customFilterer:makeCellFilterer(t)},s=e.data.fold((function(n){return a.getGriddlePropsForFlatDataArray(i,n,e,t)}),(function(n){return a.getGriddlePropsForSparqlResult(i,n,e,t)}));if(makeSortNonMutating(s.results),e.layout.isJust){var l=e.layout.get(),u=l.options,p=l.tupleTemplate;s=n.__assign(n.__assign({},s),u),p.isJust&&(s=this.useCustomLayout(s,p.get(),t))}return s},Table.prototype.render=function(){return r.createElement("div",{className:"researchspace-table-widget-holder"},this.renderTableData())},Table.prototype.renderTableData=function(){var e=this.state,t=e.buffer,a=e.griddleConfig;return t.error?r.createElement(h.ErrorNotification,{errorMessage:t.error}):t.loading||!a?r.createElement(d.Spinner,{}):r.createElement(o,a)},Table.prototype.getGriddlePropsForSparqlResult=function(e,t,a,r){var o=this.buildColumnsMetadata(t.head.vars,a,r);return n.__assign(n.__assign({},e),{results:this.prepareSparqlResultData(t,o),columns:i(o).filter("visible").map("columnName").value(),columnMetadata:o})},Table.prototype.getGriddlePropsForFlatDataArray=function(e,t,a,r){var o=i.reduce(t,(function(e,t){return i.union(e,Object.keys(t))}),[]),s=this.buildColumnsMetadata(o,a,r);return n.__assign(n.__assign({},e),{results:this.prepareFlatData(t,s),columns:i(s).filter("visible").map("columnName").value(),columnMetadata:s})},Table.prototype.useCustomLayout=function(e,t,a){var o=function(e){function class_1(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(class_1,e),class_1.prototype.render=function(){return r.createElement(f.TemplateItem,{template:{source:void 0!==t?t:"No Template defined",options:this.props.data}})},class_1}(u.Component);return n.__assign(n.__assign({},e),{useCustomRowComponent:!0,customRowComponentClassName:"griddle-custom-row",customRowComponent:o})},Table.prototype.prepareFlatData=function(e,t){var a=this,n=this.getAdditionalColumns(t);return e.map((function(e){for(var t=0,r=n;t<r.length;t++){var o=r[t];a.defineAdditionalColumnProperty(o,e,"")}return e}))},Table.prototype.prepareSparqlResultData=function(e,t){var a=this,n=this.getAdditionalColumns(t);return e.results.bindings.map((function(e){for(var t=0,r=n;t<r.length;t++){var o=r[t];a.defineAdditionalColumnProperty(o,e,void 0)}return e}))},Table.prototype.buildColumnsMetadata=function(e,t,a){return i.isEmpty(t.columnConfiguration)?this.defaultColumnsMetadata(e,t,a):this.customColumnsMetadata(t,a)},Table.prototype.defaultColumnsMetadata=function(e,t,a){var n=this;return e.map((function(e,t){return{displayName:e,columnName:e,variableName:e,visible:!0,order:t,customComponent:n.makeCellTemplateComponent(void 0,a),customCompareFn:makeNullableLastComparator(makeCellComparator(a))}}))},Table.prototype.customColumnsMetadata=function(e,t){var a=this,n=function makeUniqueColumnNameGenerator(){var e=new Set;return function(t){for(var a=t,n=1;e.has(a);)a="__"+t+"-"+n,n++;return e.add(a),a}}();return i.map(e.columnConfiguration,(function(e,r){var o=void 0===e.variableName?"mp-custom-column":e.variableName;return{columnName:n(o),displayName:e.displayName,variableName:e.variableName,customComponent:a.makeCellComponentClass(e,t),visible:!0,order:r,customCompareFn:makeNullableLastComparator(makeCellComparator(t))}}))},Table.prototype.makeCellComponentClass=function(e,t){return e.cellComponent?e.cellComponent:this.makeCellTemplateComponent(void 0!==e.cellTemplate?e.cellTemplate:void 0,t)},Table.prototype.getAdditionalColumns=function(e){return e.filter((function(e){return e.columnName!==e.variableName}))},Table.prototype.defineAdditionalColumnProperty=function(e,t,a){e.columnName!==e.variableName&&(void 0===e.variableName?t[e.columnName]=a:Object.defineProperty(t,e.columnName,{enumerable:!0,get:function(){return t[e.variableName]}}))},Table.prototype.makeCellTemplateComponent=function(e,t){var a=this.props,o=a.showLiteralDatatype,s=a.linkParams,l=a.showCopyToClipboardButton,p=i.isString(e)?String(e):void 0;return function(e){function class_2(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(class_2,e),class_2.prototype.render=function(){if(!1===i.isUndefined(p))return r.createElement(f.TemplateItem,{template:{source:p,options:this.props.rowData}});if(isPrimitiveDatatype(this.props.data))return r.createElement("span",{},this.props.data);var e=t.showLabels,a=t.preferchLabels;return r.createElement(g.RdfValueDisplay,{data:this.props.data,label:t.getLabel(this.props.data),fetchLabel:e&&!a,fetchContext:this.context.semanticContext,showLiteralDatatype:o,linkParams:s,showCopyToClipboardButton:l})},class_2}(u.Component)},Table}(u.Component);function isPrimitiveDatatype(e){return i.isString(e)||i.isBoolean(e)||i.isNumber(e)||i.isNull(e)||i.isUndefined(e)}function makeCellFilterer(e){return function(t,a){var n=a.toLowerCase();return t.filter((function(t){if("object"!=typeof t)return!1;for(var a in t)if(Object.hasOwnProperty.call(t,a)){var r=t[a];if(isPrimitiveDatatype(r)){if(String(r).toLowerCase().indexOf(n)>=0)return!0}else if(r instanceof p.Rdf.Node){var o=r.isIri()?e.getLabel(r):void 0;if(o&&o.toLowerCase().indexOf(n)>=0)return!0;if(r.value.toLowerCase().indexOf(n)>=0)return!0}}return!1}))}}function makeCellComparator(e){return function(t,a){if(isPrimitiveDatatype(t)&&isPrimitiveDatatype(a))return t<a?-1:t>a?1:0;if(t instanceof p.Rdf.Node&&a instanceof p.Rdf.Node)return function compareRdfNodes(e,t,a){if(e.isLiteral()&&t.isLiteral()&&c.default.NUMERIC_TYPES.has(e.datatype)&&c.default.NUMERIC_TYPES.has(t.datatype)){var n=Number(e.value),r=Number(t.value);if(!Number.isNaN(n)&&!Number.isNaN(r))return n<r?-1:n>r?1:0}var o=e.isIri()&&a.getLabel(e)||e.value,i=t.isIri()&&a.getLabel(t)||t.value;return o.localeCompare(i)}(t,a,e);var n=getCellDataKind(t),r=getCellDataKind(a);return n<r?-1:n>r?1:0}}function makeNullableLastComparator(e){return function(t,a){var n=null==t,r=null==a;return n&&r?0:n?-1:r?1:e(t,a)}}function getCellDataKind(e){return isPrimitiveDatatype(e)?0:e instanceof p.Rdf.Node?1:2}t.Table=v,t._makeCellFilterer=makeCellFilterer,t._makeCellComparator=makeCellComparator;var NON_MUTATING_ARRAY_SORT=function(e){var t=n.__spreadArrays(this);return t.sort(e),makeSortNonMutating(t),t};function makeSortNonMutating(e){var t=NON_MUTATING_ARRAY_SORT;Object.defineProperty(e,"sort",{enumerable:!1,value:t})}var C=function(){function KeyedBufferPool(e,t,a,n){this.cancellation=t,this.onLoad=a,this.onCompleted=n,this.activeCount=0,this._targets=e.keySeq().toSet(),this._result=e}return Object.defineProperty(KeyedBufferPool.prototype,"targets",{get:function(){return this._targets},enumerable:!0,configurable:!0}),Object.defineProperty(KeyedBufferPool.prototype,"result",{get:function(){return this._result},enumerable:!0,configurable:!0}),Object.defineProperty(KeyedBufferPool.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),Object.defineProperty(KeyedBufferPool.prototype,"loading",{get:function(){return this.activeCount>0},enumerable:!0,configurable:!0}),KeyedBufferPool.prototype.load=function(e){var t=this;0!==e.size&&(this.activeCount++,this._targets=this._targets.merge(e),this.cancellation.map(this.onLoad(e)).observe({value:function(e){t._result=t._result.merge(e)},error:function(e){t._error=e},end:function(){t.activeCount--,0!==t.activeCount||t.cancellation.aborted||t.onCompleted()}}))},KeyedBufferPool}();t.default=v},2544:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),o=a(35),i=function(e){function Pagination(t){var a=e.call(this,t)||this;return a.pageChange=function(e){a.setPage(parseInt(e.target.getAttribute("data-value")))},a}return n.__extends(Pagination,e),Pagination.prototype.componentDidMount=function(){this.updateCurrentPageIfRequested(this.props)},Pagination.prototype.componentWillUpdate=function(e){this.props.onPageChange&&e.externalCurrentPage!==this.props.externalCurrentPage&&this.updateCurrentPageIfRequested(e)},Pagination.prototype.updateCurrentPageIfRequested=function(e){"number"==typeof e.externalCurrentPage&&e.externalCurrentPage!==e.currentPage&&this.setPage(e.externalCurrentPage)},Pagination.prototype.setPage=function(e){this.props.setPage(e),this.props.onPageChange&&this.props.onPageChange(e)},Pagination.prototype.render=function(){if(this.props.maxPage>1){var e=o.li({className:0==this.props.currentPage?"disabled":""},o.a({onClick:this.props.previous},o.span({},"«"))),t=o.li({className:this.props.currentPage==this.props.maxPage-1?"disabled":""},o.a({onClick:this.props.next},o.span({},"»"))),a=Math.max(this.props.currentPage-5,0),n=Math.min(a+11,this.props.maxPage);this.props.maxPage>=11&&n-a<=10&&(a=n-11);for(var r=[],i=a;i<n;i++){var s=this.props.currentPage==i?"active":"";r.push(o.li({key:i,className:s},o.a({"data-value":i,onClick:this.pageChange},i+1)))}return o.nav({},o.ul({className:"pagination"},e,r,t))}return o.nav({})},Pagination.defaultProps={maxPage:0,currentPage:0},Pagination}(r.Component);t.Pagination=i},2545:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var n=a(11),r=a(1),o=a(23),i=a(633),s=a(61),l=a(140),u=a(2057),p=function(e){function RdfValueDisplay(t){var a=e.call(this,t)||this;return a.state={label:t.label},a}return n.__extends(RdfValueDisplay,e),RdfValueDisplay.prototype.componentDidMount=function(){this.fetchLabelForIri(this.props)},RdfValueDisplay.prototype.componentWillReceiveProps=function(e){e.data.equals(this.props.data)&&e.fetchLabel===this.props.fetchLabel||this.fetchLabelForIri(e)},RdfValueDisplay.prototype.fetchLabelForIri=function(e){var t=this,a=e.data;a instanceof o.Rdf.Iri&&(this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),void 0===e.label&&e.fetchLabel?(this.setState({label:" "}),this.subscription=l.getLabel(a,{context:e.fetchContext}).observe({value:function(e){return t.setState({label:e})},error:function(){return t.setState({label:a.value})}})):this.setState({label:e.label}))},RdfValueDisplay.prototype.componentWillUnmount=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)},RdfValueDisplay.prototype.render=function(){var e=this.props.className,t=this.state.label,a=function renderRdfNode(e,t){var a=e.data;if(a.isIri()){var n="string"==typeof t?t:a.value,o=r.createElement(i.ResourceLink,{className:e.className,"data-rdfa-about":a.value,resource:a,title:n,params:e.linkParams},n);return e.showCopyToClipboardButton?r.createElement("span",null,o,r.createElement(u.CopyToClipboardComponent,{text:a.value},r.createElement("button",{className:"btn btn-link btn-xs",title:"Copy IRI"},r.createElement("i",{className:"fa fa-clipboard text-muted"})))):o}if(a.isLiteral()){var l=e.showLiteralDatatype?r.createElement("i",null," ("+s.SparqlUtil.compactIriUsingPrefix(a.datatype)+")"):void 0;return r.createElement("span",null,a.value,l)}return a.isBnode()?a.value:null}(this.props,t);return r.createElement("span",{className:e},a)},RdfValueDisplay}(r.Component);t.RdfValueDisplay=p}}]);
//# sourceMappingURL=semantic-table-9a8695fcf9801917e364.js.map