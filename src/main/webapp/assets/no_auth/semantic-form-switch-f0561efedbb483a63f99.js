(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{1254:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),o=i(1),r=i(43),a=i(34),s=i(1208),l=i(1619),p=i(1217),c=i(214),u=i(1231),d=i(1553),h=i(1232),f=i(1689),m=i(23),w=i(327),v=i(1620),y=function(e){function FormSwitch(t,i){var n=e.call(this,t,i)||this;return n.cancellation=new a.Cancellation,n.switchOperations=n.cancellation.derive(),n.fieldValuesMap=new Map,n.shouldReload=!1,n.onChangeCaseType=function(e){var t=n.props.value,i=n.getHandler(),o=i.selectCaseForValue(t,n.chosenType),r=i.cases.get(e.target.value);n.chosenType=r,n.fieldValuesMap.set(o.type.value,n.props.value),n.props.updateValue((function(){return n.fieldValuesMap.get(r.type.value)||d.FieldValue.empty}))},n.onCaseInputMount=function(e){n.refToInput=e},n.chosenType=n.getHandler().cases.first(),n.isLoading=d.FieldValue.isAtomic(t.value),n}return n.__extends(FormSwitch,e),FormSwitch.prototype.getHandler=function(){if(!(this.props.handler instanceof S))throw new Error("Invalid value handler for FormSwitch");return this.props.handler},FormSwitch.prototype.dataState=function(){return this.isLoading?d.DataState.Loading:this.refToInput?this.refToInput.dataState():d.DataState.Ready},FormSwitch.prototype.componentDidMount=function(){d.FieldValue.isAtomic(this.props.value)&&(this.shouldReload=!0),this.tryLoadSwitch(this.props)},FormSwitch.prototype.componentWillReceiveProps=function(e){this.props.value!==e.value&&(this.shouldReload=!0),this.tryLoadSwitch(e)},FormSwitch.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},FormSwitch.prototype.tryLoadSwitch=function(e){e.dataState===d.DataState.Ready&&this.shouldReload&&(this.shouldReload=!1,this.loadSwitch(e))},FormSwitch.prototype.loadSwitch=function(e){var t=this;if(this.switchOperations=this.cancellation.deriveAndCancel(this.switchOperations),d.FieldValue.isAtomic(e.value)){var i=d.FieldValue.asRdfNode(e.value),n=this.getHandler();i.isIri()?n.typeDefinition?(this.isLoading=!0,this.switchOperations.map(f.queryValues(n.typeDefinition.selectPattern,i)).observe({value:function(e){var i=r.Set(e.map((function(e){return e.value}))),o=n.cases.find((function(e){return i.has(e.type)}));o&&(t.isLoading=!1,t.chosenType=o),t.props.updateValue((function(t){return o?t:d.FieldValue.replaceError(t,{kind:d.ErrorKind.Loading,message:"Cannot choose an switch case for set of types "+e.map((function(e){return e.value.toString()})).join(", ")})}))}})):this.props.updateValue((function(e){return d.FieldValue.replaceError(e,{kind:d.ErrorKind.Configuration,message:'Failed find a definition for switch-on-field "'+t.props.switchOnField+'"'})})):this.props.updateValue((function(e){return d.FieldValue.replaceError(e,{kind:d.ErrorKind.Loading,message:"Cannot choose a switch case for non-IRI value "+i})}))}else this.isLoading&&(this.isLoading=!1,this.props.updateValue((function(e){return e})))},FormSwitch.prototype.render=function(){if(this.isLoading)return o.createElement(w.Spinner,null);var e=this.props.value,t=this.getHandler().selectCaseForValue(e,this.chosenType);return o.createElement("div",{className:"form-switch"},this.renderSwitch(t),this.renderCase(t))},FormSwitch.prototype.renderSwitch=function(e){var t=this.getHandler();if(0!==t.cases.size)return o.createElement("div",{className:"form-switch__content"},o.createElement("select",{className:"form-switch__select",onChange:this.onChangeCaseType,value:e.type.value},t.cases.toArray().map((function(e){return o.createElement("option",{key:e.type.value,value:e.type.value},e.label)}))))},FormSwitch.prototype.renderCase=function(e){if(0!==this.getHandler().cases.size){var t,i,n=this.props,r=n.dataState,a=n.definition,s=n.updateValue,l={value:n.value,handler:e.handler,dataState:r,definition:a,updateValue:(t=s,i=e.type,function(e){t((function(t){var n=e(t);return d.FieldValue.isComposite(n)?d.CompositeValue.set(n,{discriminator:i}):n}))}),key:e.type.value,ref:this.onCaseInputMount};return o.cloneElement(e.composite,l)}},FormSwitch.makeHandler=function(e){return new S(e)},FormSwitch.inputKind=v.InputKind.FormSwitch,FormSwitch}(l.SingleValueInput);t.FormSwitch=y;var S=function(){function FormSwitchHandler(e){this.switchOnField=e.baseInputProps.switchOnField,this.cases=function computeCases(e){var t=e.definition,i=e.baseInputProps;return r.OrderedMap().withMutations((function(e){o.Children.forEach(i.children,(function(n){if(!c.componentHasType(n,u.default)){var r="object"==typeof n?n.type:void 0;throw new Error("Invalid type of component: "+(r||typeof n))}var a=function assertCaseCompositeInput(e,t){if(1!==o.Children.count(t.props.children))throw new Error("Expected only a single child for <semantic-form-switch-case>");var i=o.Children.only(t.props.children);if(!c.componentHasType(i,p.CompositeInput))throw new Error("Expected a single <semantic-form-composite-input> as a child");if(i.props.for!==e)throw new Error("Expected child <semantic-form-composite-input> to have property ref='"+e+"'");return i}(t.id,n),s=function findSwitchedOnHiddenInput(e,t){var i,n=!1;if(o.Children.forEach(t,(function(t){c.componentHasType(t,h.default)&&t.props.for===e&&t.props.defaultValue&&(n=void 0!==i,i=t)})),!i||n){throw new Error("Expected single input for <semantic-form-hidden-input for='"+e+"' default-value='special type'></semantic-form-hidden-input>")}return i}(i.switchOnField,a.props.children).props.defaultValue;e.set(s,{type:m.Rdf.iri(s),label:n.props.label,handler:l.SingleValueInput.getHandlerOrDefault(a.type,{definition:t,baseInputProps:a.props}),composite:a})}))}))}(e),this.typeDefinition=this.getTypeDefinition()}return FormSwitchHandler.prototype.getTypeDefinition=function(){for(var e=0,t=this.cases.first().composite.props.fields;e<t.length;e++){var i=t[e];if(i.id===this.switchOnField)return s.normalizeFieldDefinition(i)}},FormSwitchHandler.prototype.selectCaseForValue=function(e,t){if(0===this.cases.size||!d.FieldValue.isComposite(e)||!e.discriminator)return t;var i=this.cases.get(e.discriminator.value);return i||console.warn("Trying to render form switch value with unknown discriminator: "+e.discriminator),i||t},FormSwitchHandler.prototype.validate=function(e){return d.FieldValue.isComposite(e)?this.selectCaseForValue(e,this.cases.first()).handler.validate(e):l.SingleValueInput.defaultHandler.validate(e)},FormSwitchHandler.prototype.finalize=function(e,t){return d.FieldValue.isComposite(e)?this.selectCaseForValue(e,this.cases.first()).handler.finalize(e,t):l.SingleValueInput.defaultHandler.finalize(e,t)},FormSwitchHandler}();l.SingleValueInput.assertStatic(y),t.default=y}}]);
//# sourceMappingURL=semantic-form-switch-f0561efedbb483a63f99.js.map