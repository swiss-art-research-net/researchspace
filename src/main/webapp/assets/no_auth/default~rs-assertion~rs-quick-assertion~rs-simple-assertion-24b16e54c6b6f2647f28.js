(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{2342:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var s=n(11),a=n(16),i=n(1),l=n(72),o=n(19),r=n(43),u=n(33),p=n(23),f=n(120),c=n(144),m=n(56),d=n(630),g=n(1214),v=n(1562),h=n(1258),C=n(1588),b=n(1481),y=function(e){function AssertionsComponent(t,n){var s=e.call(this,t,n)||this;return s.noBeliefs=function(){var e=a.some(s.state.newValues.map((function(e){return u.fromNullable(s.props.beliefs.get(e)).map((function(e){return"No Opinion"===e.belief.value})).getOrElse(!0)})),(function(e){return!0===e}));return s.props.beliefs.isEmpty()||e||s.props.beliefs.every((function(e){return"No Opinion"===e.belief.value}))},s.assertionHeader=function(e,t){return i.createElement("div",{className:b.header},i.createElement("div",{className:b.subject},i.createElement(g.ResourceLabel,{iri:e.value})),i.createElement("div",{className:b.field},v.getPreferredLabel(t.label)))},s.onBeliefChange=function(e){e.isCanonical&&"No Opinion"===e.belief.value?s.props.onBeliefsChange(s.props.beliefs.remove(e.targetValue)):s.props.onBeliefsChange(s.props.beliefs.set(e.targetValue,e))},s.removeBelief=function(e){s.setState({newValues:a.filter(s.state.newValues,(function(t){return!t.equals(e.targetValue)}))}),s.props.onBeliefsChange(s.props.beliefs.remove(e.targetValue))},s.getBeliefValue=function(e,t){var n=AssertionsComponent.deserializeBeliefValue(s.props.field,e);return s.props.beliefs.has(n)?s.props.beliefs.get(n):AssertionsComponent.getDefaultBelief(s.props.target,s.props.field,n,t,"default")},s.toggleAddNewValue=function(e){e&&e.preventDefault(),s.setState((function(e){return{addingNewValue:!e.addingNewValue}}))},s.postAction=function(e){s.toggleAddNewValue()},s.state={addingNewValue:t.quickAssertion||!1,newValues:t.beliefs.filter((function(e){return!e.isCanonical})).keySeq().toJS(),formTemplate:u.Nothing()},s}return s.__extends(AssertionsComponent,e),AssertionsComponent.prototype.getChildContext=function(){var t=e.prototype.getChildContext.call(this);return s.__assign(s.__assign({},t),{templateDataContext:this.state.capturedDataContext,changeBelief:this.onBeliefChange,removeBelief:this.removeBelief,getBeliefValue:this.getBeliefValue})},AssertionsComponent.prototype.componentDidMount=function(){var e=this,t=this.context.templateDataContext,n=c.CapturedContext.inheritAndCapture(t);this.appliedTemplateScope.compile(this.props.formTemplate).then((function(s){return f.ModuleRegistry.parseHtmlToReact(s({field:e.props.field},{capturer:n,parentContext:t}))})).then((function(t){e.setState({formTemplate:u.Just(t),capturedDataContext:n.getResult()})}))},AssertionsComponent.prototype.render=function(){var e=this.props,t=e.target,n=e.valueTemplate,s=e.field,o=e.title,r="\n      <div>\n        {{#each fields as |field|}}\n            {{#each field.values as |value|}}\n              <div data-flex-layout='row center-center' class="+b.valuesRow+">\n                <div data-flex-self='right'>\n                  "+n+"\n                </div>\n                <div data-flex-self='right'>\n                  <rs-argument-simple-belief-selector for-value='{{value.value.value}}' is-canonical='{{#if ../../isNotCanonical}}false{{else}}true{{/if}}'>\n                  </rs-argument-simple-belief-selector>\n                </div>\n              </div>\n            {{/each}}\n        {{/each}}\n      </div>\n",u=a.cloneDeep(s);return u.values=this.state.newValues.map((function(e){return{value:e}})),u.minOccurs=1,u.maxOccurs=1,i.createElement(l.Panel,{header:o},this.assertionHeader(t,u),i.createElement("hr",null),this.noBeliefs()?i.createElement(l.Alert,{bsStyle:"warning"},i.createElement("p",null,i.createElement("i",{className:"fa fa-exclamation-triangle"}),i.createElement("strong",null,"Please add an opinion to at least one value!")," Opinions are required for newly asserted values.")):null,i.createElement(m.SemanticContextProvider,{repository:"default"},i.createElement(h.FieldBasedVisualization,{subject:t.value,template:r,fields:[u]})),i.createElement("hr",null),i.createElement(d.TemplateItem,{template:{source:r,options:{fields:[v.normalizeFieldDefinition(a.cloneDeep(u))],isNotCanonical:!0}}}),a.isEmpty(u.values)?null:i.createElement("hr",null),this.state.addingNewValue&&this.state.formTemplate.isJust?i.createElement(m.SemanticContextProvider,{repository:"default"},i.createElement(v.ResourceEditorForm,{newSubjectTemplate:t.value,fields:[u],persistence:this,browserPersistence:!1,postAction:this.postAction},i.createElement("div",{"data-flex-layout":"column justify-stretch",className:b.valueHolder},i.createElement("div",null,this.state.formTemplate.getOrElse(null)),i.createElement("div",{className:b.actions,"data-flex-layout":"row top-right"},i.createElement("button",{className:"btn btn-danger",onClick:this.toggleAddNewValue},"Cancel"),i.createElement("button",{name:"submit",className:"btn btn-success"},"Submit"))))):i.createElement("div",{"data-flex-layout":"row center-right"},i.createElement(l.Button,{bsStyle:"link",onClick:this.toggleAddNewValue},"Add an alternative value ...")))},AssertionsComponent.prototype.remove=function(e){},AssertionsComponent.prototype.persist=function(e,t){var n=this;return this.persistCompositeValue(e,t).map((function(e){if(n.props.quickAssertion){var t=e.map((function(e){var t=AssertionsComponent.getDefaultBelief(n.props.target,n.props.field,e,!1,"default");return t.belief.value=C.SimpleBeliefValue.Agree,[e,t]}));n.props.onBeliefsChange(r.Map(t))}n.props.onBeliefsChange(n.props.beliefs.set(e[0],AssertionsComponent.getDefaultBelief(n.props.target,n.props.field,e[0],!1,"default"))),n.setState((function(t){return{newValues:t.newValues.concat(e)}}))}))},AssertionsComponent.prototype.persistCompositeValue=function(e,t){var n=this,s=v.computeModelDiff(v.FieldValue.empty,t);if(s.length>1){var i=a.find(s,(function(e){return e.subject.equals(n.props.target)})),l=a.filter(s,(function(e){return!e.subject.equals(n.props.target)}));return(new v.LdpPersistence).persistModelUpdates(l[0].subject,l).map((function(){return i.inserted}))}return o.constant(a.flatten(s.map((function(e){return e.inserted}))))},AssertionsComponent.defaultProps={quickAssertion:!1},AssertionsComponent.childContextTypes=s.__assign(s.__assign(s.__assign({},m.Component.childContextTypes),C.ArgumentsContextTypes),m.TemplateContextTypes),AssertionsComponent.deserializeBeliefValue=function(e,t){return p.vocabularies.xsd.anyURI.value===e.xsdDatatype?p.Rdf.iri(t):p.Rdf.literal(t,p.Rdf.iri(e.xsdDatatype))},AssertionsComponent.getDefaultBelief=function(e,t,n,s,a){return{iri:u.Nothing(),beliefType:C.AssertedBeliefTypeKind,target:e,field:t,targetValue:n,isCanonical:s,originRepository:a,belief:{type:"simple",value:C.SimpleBeliefValue.NoOpinion}}},AssertionsComponent}(m.Component);t.AssertionsComponent=y,t.default=y}}]);
//# sourceMappingURL=default~rs-assertion~rs-quick-assertion~rs-simple-assertion-24b16e54c6b6f2647f28.js.map