(window.webpackJsonp=window.webpackJsonp||[]).push([[371],{1453:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0});var r=a(11),n=a(1),l=a(16),i=a(72),o=a(56),u=a(23),p=a(61),c=a(116),y=a(117),s=a(34),m=a(1290),f=a(1212),d=a(327),g=a(1221),h=function(e){function QueryCatalogTemplate(t,a){var r=e.call(this,t,a)||this;r.cancellation=new s.Cancellation,r.applyingTemplate=r.cancellation.derive(),r.fetchAndSetQuery=function(){r.state.fetchingQuery||r.context.queryEditorContext&&(r.applyingTemplate.cancelAll(),r.applyingTemplate=r.cancellation.derive(),r.applyingTemplate.map(r.fetchTemplateWithQuery()).observe({value:function(e){var t=e[0],a=e[1];Boolean(t.args.find((function(e){return void 0!==e.defaultValue})))?r.showParametrizationDialog((function(e){r.setQuery({query:a,template:t,parametrize:e})})):r.setQuery({query:a,template:t,parametrize:!1}),r.setState({fetchingQuery:!1})},error:function(e){c.addNotification({level:"error",message:"Failed to fetch query template"},e),r.setState({fetchingQuery:!1})}}),r.setState({fetchingQuery:!0}))},r.state={};var n=r.context.semanticContext;return r.queryTemplateService=m.QueryTemplateService(n),r.queryService=f.QueryService(n),r}return r.__extends(QueryCatalogTemplate,e),QueryCatalogTemplate.prototype.render=function(){return n.createElement("div",{onClick:this.fetchAndSetQuery},this.props.children,this.state.fetchingQuery?n.createElement(d.Spinner,{spinnerDelay:0}):null)},QueryCatalogTemplate.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},QueryCatalogTemplate.prototype.showParametrizationDialog=function(e){var t="query-parametrization-dialog",onHide=function(){return y.getOverlaySystem().hide(t)};y.getOverlaySystem().show(t,n.createElement(i.Modal,{onHide,show:!0,style:{textAlign:"center"}},n.createElement(i.Modal.Header,null,n.createElement(i.Modal.Title,null,"Do you want to apply the default arguments?")),n.createElement(i.Modal.Body,null,n.createElement(i.Button,{bsStyle:"primary",onClick:function(){onHide(),e(!0)}},"Apply"),n.createElement(i.Button,{bsStyle:"default",style:{marginLeft:5},onClick:function(){onHide(),e(!1)}},"Don't Apply"))))},QueryCatalogTemplate.prototype.setQuery=function(e){var t=e.query,a=e.template,r=e.parametrize,n=t.value;if(r)try{n=p.SparqlUtil.serializeQuery(function applyDefaultArguments(e,t){var a=p.SparqlUtil.parseQuery(e.value),r=t.args.filter((function(e){return Boolean(e.defaultValue)}));if(0===r.length)return a;var n=l.mapValues(l.keyBy(r,(function(e){return e.variable})),(function(e){return e.defaultValue}));return p.SparqlClient.setBindings(a,n)}(t,a))}catch(e){c.addNotification({level:"warning",message:"Failed to substitute default values for query template arguments"},e)}this.context.queryEditorContext.setQuery(n)},QueryCatalogTemplate.prototype.fetchTemplateWithQuery=function(){var e=this;return this.queryTemplateService.getQueryTemplate(u.Rdf.iri(this.props.iri)).flatMap((function(t){var a=t.template,r=t.queryIri;return e.queryService.getQuery(u.Rdf.iri(r)).map((function(e){return[a,e]}))})).toProperty()},QueryCatalogTemplate.contextTypes=r.__assign(r.__assign({},o.ContextTypes),g.ContextTypes),QueryCatalogTemplate}(o.Component);t.QueryCatalogTemplate=h,t.default=h}}]);
//# sourceMappingURL=mp-query-catalog-template-467f7d8707fc36757ba4.js.map