(window.webpackJsonp=window.webpackJsonp||[]).push([[470],{1314:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),n=r(1),i=r(35),o=r(16),s=r(16),l=r(34),p=r(56),u=r(162),c=r(23),d=r(61),g=r(140),h=r(214),f=r(116),m=r(327),y=r(630),v=r(2561),b=r(1876);t.SemanticChartConfig=b.SemanticChartConfig;var C=r(2562);r(1315);var S={chartjs:C.ChartJsRenderer},x=function(e){function SemanticChart(t,r){var a=e.call(this,t,r)||this;return a.cancellation=new l.Cancellation,a.query=h.Action(),a.loadQueryData=function(e){var t=a.context.semanticContext,r=d.SparqlClient.select(e.query,{context:t});return r.onValue((function(t){a.setState({queryResult:t,isLoading:!1}),a.buildRendererProps(e,t)})),r.onError((function(e){a.setState({errorMessage:e,isLoading:!1})})),r.onEnd((function(){a.props.id&&u.trigger({eventType:u.BuiltInEvents.ComponentLoaded,source:a.props.id})})),a.props.id&&u.trigger({eventType:u.BuiltInEvents.ComponentLoading,source:a.props.id,data:r}),r},a.state={isLoading:!0},a.cancellation.map(a.query.$property.debounce(300)).flatMap(a.loadQueryData).onValue((function(){})),a}return a.__extends(SemanticChart,e),SemanticChart.prototype.componentDidMount=function(){v.ChartRendererExtension.loadAndUpdate(this,this.cancellation),this.query(this.props)},SemanticChart.prototype.componentWillReceiveProps=function(e){e.query!==this.props.query?(this.setState({isLoading:!0,errorMessage:void 0}),this.query(e)):e.type!==this.props.type&&(this.state.queryResult?this.buildRendererProps(e,this.state.queryResult):this.query(e))},SemanticChart.prototype.componentWillUnmount=function(){this.cancellation.cancelAll()},SemanticChart.prototype.buildRendererProps=function(e,t){var r=this,a=buildData(e,t);(function fetchLabels(e){for(var t=[],r=0,a=e.sets;r<a.length;r++){var n=a[r];n.iri&&t.push(n.iri);for(var i=0,o=n.points;i<o.length;i++){var s=o[i];if(s){var l=b.extractKey(n,s);l&&l.isIri()&&t.push(l)}}}if(e.categories)for(var p=0,u=e.categories;p<u.length;p++){var c=u[p];c.isIri()&&t.push(c)}return g.getLabels(t).map((function(e){return e.mapKeys((function(e){return e.value})).toObject()}))})(a).onValue((function(n){r.setState({queryResult:t,rendererProps:{config:e,data:a,labels:n},errorMessage:void 0,isLoading:!1})})).onError((function(e){r.setState({queryResult:t,rendererProps:void 0,errorMessage:e,isLoading:!1})}))},SemanticChart.prototype.componentWillUpdate=function(){this.root&&(this.root.style.width=this.root.clientWidth+"px",this.root.style.height=this.root.clientHeight+"px")},SemanticChart.prototype.componentDidUpdate=function(){this.root&&(this.root.style.width=null,this.root.style.height=null)},SemanticChart.prototype.render=function(){var e=this;if(v.ChartRendererExtension.isLoading()||this.state.isLoading)return n.createElement(m.Spinner);if(this.state.errorMessage)return i.div({},n.createElement(f.ErrorNotification,{errorMessage:this.state.errorMessage}));if(this.state.rendererProps){if(d.SparqlUtil.isSelectResultEmpty(this.state.queryResult))return n.createElement(y.TemplateItem,{template:{source:this.props.noResultTemplate}});var t=this.state.rendererProps.config,r=a.__assign(a.__assign({},S),v.ChartRendererExtension.get()),o=r[t.provider]||r.chartjs,s={className:"semantic-chart","data-type":this.state.selectedType,ref:function(t){e.root=t}};return i.div(s,this.props.children,n.createElement(o,{className:"semantic-chart__renderer",config:t,builtData:this.state.rendererProps.data,labels:this.state.rendererProps.labels}))}return i.div({className:"semantic-chart"},this.props.children)},SemanticChart}(p.Component);function buildData(e,t){var r=t.results.bindings,a=e.multiDataSet?s(r).map((function(t){var r=t[e.multiDataSet.dataSetVariable];return{id:r.value,iri:r.isIri()?r:null,name:r.isLiteral()?r.value:null,mapping:e.multiDataSet}})).uniqBy((function(e){return e.id})).sortBy((function(e){return e.id})).value():e.sets.map((function(e){return{mapping:e,iri:"string"==typeof e.dataSetIRI?c.Rdf.iri(e.dataSetIRI):e.dataSetIRI,name:e.dataSetName}})),n=("line"===e.type||"bubble"===e.type)&&!a.some((function(e){return Boolean(e.mapping.category)})),i="pie"===e.type||"donut"===e.type;if(n||i){for(var _loop_1=function(e){e.points=r.filter((function(t){return b.isSetContainsPoint(e,t)&&b.valueExists(e,t)}))},l=0,p=a;l<p.length;l++){_loop_1(p[l])}return{sets:a}}return function buildCategorialDataInPlace(e,t){for(var r=[],a={},n=0,i=t;n<i.length;n++)for(var s=i[n],l=0,p=e;l<p.length;l++){var u=p[l];if(y=b.extractKey(s,u)){var c=y.toString(),d=a[c];d||(d=a[c]=[],r.push(y)),b.isSetContainsPoint(s,u)&&b.valueExists(s,u)&&d.push(u)}}for(var g=0,h=t;g<h.length;g++){(s=h[g]).points=[]}for(var f=0,m=r;f<m.length;f++)for(var y=m[f],v=a[y.toString()],_loop_2=function(e){var t=o.find(v,(function(t){return b.isSetContainsPoint(e,t)&&b.valueExists(e,t)}));e.points.push(t||null)},C=0,S=t;C<S.length;C++){s=S[C];_loop_2(s)}return{sets:t,categories:r}}(r,a)}t.SemanticChart=x,t.buildData=buildData;var k=r(1876);t.DataSetMappings=k.DataSetMappings,t.ChartType=k.ChartType,t.ProviderSpecificStyle=k.ProviderSpecificStyle,t.DataSet=k.DataSet,t.default=x},1876:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(33),n=r(16);function extractValue(e,t){return t[e.mapping.value||e.mapping.y]}t.propertyValue=function propertyValue(e,t){return e&&e[t]?a.of(e[t].value):a.Nothing()},t.labeled=function labeled(e,t){if(!e)return"";if(e.isIri()){var r=t[e.value];if(r)return r}return e.value},t.extractKey=function extractKey(e,t){return t[e.mapping.category||e.mapping.x]},t.extractValue=extractValue,t.valueExists=function valueExists(e,t){var r=extractValue(e,t);return!n.isUndefined(r)&&!n.isNull(r)},t.isSetContainsPoint=function isSetContainsPoint(e,t){return!e.id||t[e.mapping.dataSetVariable].value===e.id},t.parseNumeric=function parseNumeric(e){var t=parseFloat(e);return Number.isNaN(t)?a.Nothing():a.Just(t)},t.TOOLTIP_ID="mp-semantic-chart-tooltip",t.DEFAULT_TOOLTIP_MARKUP='<div>\n  {{#*inline "@marker"}}\n    {{#ifCond style "||" class}}\n      <svg xmlns="http://www.w3.org/2000/svg"\n        style="display: inline-block; margin-right: 10px;"\n        width="10" height="10">\n        <rect width="10" height="10"\n          style="{{style}}"\n          class="{{class}}" />\n      </svg>\n    {{/ifCond}}\n  {{/inline}}\n  {{#if category}}\n    <div>\n      {{> @marker style=category.markerStyle class=category.markerClass}}\n      {{#if category.iri}}\n        <semantic-link iri=\'{{category.iri}}\'>\n          {{category.label}}\n        </semantic-link>\n      {{else}}\n        {{category.label}}\n      {{/if}}\n    </div>\n  {{/if}}\n  <ul class="list-unstyled">\n    {{#each points}}\n      <li>\n        {{> @marker style=markerStyle class=markerClass}}\n        {{#if iri}}\n          <semantic-link iri="{{iri}}">{{label}}</semantic-link>: {{value}}\n        {{else}}\n          {{label}}: {{value}}\n        {{/if}}\n      </li>\n    {{/each}}\n  </ul>\n</div>'},2561:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(120);t.ChartRendererExtension=new a.ExtensionPoint},2562:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var a=r(11),n=r(16),i=r(43),o=r(1),s=r(1877),l=r(2563),p=r(630),u=r(1886),c=r(1876),d={line:l.Line,bar:l.Bar,radar:l.Radar,pie:l.Pie,donut:l.Doughnut,bubble:l.Bubble},g=function(e){function ChartJsRenderer(t){var r=e.call(this,t)||this;return r.redrawChart=!1,r.onChartMount=function(e){r.chart=e},r.onTooltipHide=function(){r.setState({tooltip:void 0})},r.updateTooltip=function(e){var t=r.state.tooltip;if(r.props.config.disableTooltips)t&&r.setState({tooltip:void 0});else if(t&&t.caretX===e.caretX&&t.caretY===e.caretY)0===e.opacity?r.setState({tooltip:a.__assign(a.__assign({},t),{hovering:!1})}):t.hovering||r.setState({tooltip:a.__assign(a.__assign({},t),{hovering:!0})});else if(0!==e.opacity){var n,i;switch(e.yAlign){case"top":n="bottom",i="left"===e.xAlign?"start":"right"===e.xAlign?"end":"center";break;case"bottom":n="top",i="left"===e.xAlign?"start":"right"===e.xAlign?"end":"center";break;case"center":n="left"===e.xAlign?"right":"right"===e.xAlign?"left":"bottom",i="center"}var o=r.chart.chartInstance.canvas,s=o.offsetLeft,l=o.offsetTop;r.setState({tooltip:{hovering:!0,caretX:e.caretX,caretY:e.caretY,data:r.mapped.makeTooltip(e.dataPoints.map((function(e){return{setIndex:e.datasetIndex,pointIndex:e.index}}))),props:{id:c.TOOLTIP_ID,targetLeft:s+e.caretX,targetTop:l+e.caretY,popoverSide:n,arrowAlignment:i}}})}},r.state={hiddenCategories:i.Set()},r}return a.__extends(ChartJsRenderer,e),ChartJsRenderer.prototype.componentWillReceiveProps=function(e){e.builtData!==this.props.builtData&&(this.redrawChart=!0)},ChartJsRenderer.prototype.mapCircularData=function(e,t){var r=this;if(0===e.sets.length)return{data:{datasets:[],labels:[]},options:{},makeTooltip:function(){return{points:[]}}};var a,n=e.sets[0],i=n.points.map((function(e){return e[n.mapping.category||n.mapping.x]})),o=i.map((function(e){return c.labeled(e,t)})),l=e.sets.map((function(e,r){return{label:e.name||c.labeled(e.iri,t),data:e.points.map((function(t){return c.propertyValue(t,e.mapping.value||e.mapping.y).map(parseFloat).getOrElse(0)})),backgroundColor:e.points.map((function(t,r){return c.propertyValue(t,e.mapping.color).getOrElse(function getDefaultColor(e){return defaultPalette(e,1)}(r))}))}})),p={};return 1===e.sets.length?(p=this.legendOptions((function(e){var t=e.getDatasetMeta(0),a=s.Chart.defaults.doughnut.legend.labels.generateLabels(e);return i.forEach((function(e,n){var i=r.state.hiddenCategories.has(e);a[n].category=e,a[n].hidden=i,t.data[n].hidden=i})),a}),(function(e,t,r){s.Chart.defaults.doughnut.legend.onClick.call(r,e,t)})),a=function(e){var t=e[0],r=t.setIndex,a=t.pointIndex,s=l[r],p={bindings:n.points[a],iri:n.iri?n.iri.value:void 0,label:s.label,value:s.data[a]};return{category:{iri:i[a].value,label:o[a],markerStyle:"fill: "+s.backgroundColor[a]},points:[p]}}):a=function(t){return{points:t.map((function(t){var r=t.setIndex,a=t.pointIndex,n=l[r];return{bindings:e.sets[r].points[a],iri:i[a].value,label:o[a],value:n.data[a],markerStyle:"fill: "+n.backgroundColor[a]}}))}},{data:{labels:o,datasets:l},options:p,makeTooltip:a}},ChartJsRenderer.prototype.mapCategorialData=function(e,t){var r=1===e.sets.length?this.mapSingleCategorialSet(e,t):this.mapMultipleCategorialSets(e,t),a=this.props.config.type;return"line"===a||"bar"===a?n.merge(r.options,{scales:{xAxes:[{ticks:{autoSkip:!1}}],yAxes:[{ticks:{beginAtZero:!0}}]}}):"radar"===a&&n.merge(r.options,{scale:{ticks:{beginAtZero:!0}}}),r},ChartJsRenderer.prototype.mapSingleCategorialSet=function(e,t){var r=this,a=this.props.config.type,o=e.sets[0],s=e.categories.map((function(e,t){return{category:e,index:t}})).filter((function(e){var t=e.category;return!r.state.hiddenCategories.has(t)})),l=s.map((function(e){return e.index})),p=i.Set(l),u={label:o.name||c.labeled(o.iri,t),data:o.points.filter((function(e,t){return p.has(t)})).map((function(e){var t=c.propertyValue(e,o.mapping.x).chain(c.parseNumeric),r=c.propertyValue(e,o.mapping.y||o.mapping.value).chain(c.parseNumeric),n=c.propertyValue(e,o.mapping.z).chain(c.parseNumeric);return"bubble"===a?{x:t.getOrElse(0),y:r.getOrElse(0),r:n.getOrElse(10)}:r.getOrElse(null)})),borderWidth:1},d=l.map((function(e){return defaultPalette(e,.6)})),g=l.map((function(e){return defaultPalette(e,1)}));if("bar"===a||"bubble"===a){var h=u;h.backgroundColor=d,h.borderColor=g}else n.merge(u,{borderColor:"lightgray",fill:!1,pointRadius:5,pointHitRadius:7}),u.pointBackgroundColor=g;var f={labels:s.map((function(e){var r=e.category;return c.labeled(r,t)})),datasets:[u]};return{data:f,options:this.singleCategorialSetLegendOptions(e,t),makeTooltip:function(e){var t=e[0].pointIndex,r=u.data[t],a={bindings:o.points[t],iri:o.iri?o.iri.value:void 0,label:u.label,value:"number"==typeof r?r:"number"==typeof r.r?"("+r.x+", "+r.y+", "+r.r+")":"("+r.x+", "+r.y+")"};return{category:{iri:s[t].category.value,label:f.labels[t],markerStyle:"fill: "+g[t]},points:[a]}}}},ChartJsRenderer.prototype.singleCategorialSetLegendOptions=function(e,t){var r=this,a=e.categories.map((function(e,a){return{text:c.labeled(e,t),fillStyle:defaultPalette(a,.6),hidden:r.state.hiddenCategories.has(e),category:e}}));return this.legendOptions((function(e){return a}),(function(e,t){t.hidden=!t.hidden}))},ChartJsRenderer.prototype.legendOptions=function(e,t){var r=this;return{legend:{labels:{generateLabels:e},onClick:function(e,a){var n=a.hidden;t(e,a,this),function(e,t){r.setState({hiddenCategories:t?r.state.hiddenCategories.remove(e):r.state.hiddenCategories.add(e)})}(a.category,n)}}}},ChartJsRenderer.prototype.mapMultipleCategorialSets=function(e,t){var r=this,a={labels:e.categories.map((function(e){return c.labeled(e,t)})),datasets:e.sets.map((function(e,a){var i=getLinearSeriesDefaultStyle(a,"bar"===r.props.config.type?.6:.2);return n.merge({label:e.name||c.labeled(e.iri,t),data:e.points.map((function(t){return c.propertyValue(t,e.mapping.value||e.mapping.y).map(parseFloat).getOrElse(0)}))},i)}))};return{data:a,options:{},makeTooltip:function(t){var r=t[0].pointIndex;return{category:{iri:e.categories[r].value,label:a.labels[r]},points:t.map((function(t){var r=t.setIndex,n=t.pointIndex,i=e.sets[r],o=a.datasets[r];return{bindings:i.points[n],iri:i.iri?i.iri.value:void 0,label:o.label,value:o.data[n],markerStyle:"fill: "+o.borderColor}}))}}}},ChartJsRenderer.prototype.mapNumericalData=function(e,t){var r=this,a=e.sets.map((function(e,a){var i={label:e.name||c.labeled(e.iri,t),data:e.points.map((function(t){var r=c.propertyValue(t,e.mapping.x||e.mapping.category).chain(c.parseNumeric),a=c.propertyValue(t,e.mapping.y||e.mapping.value).chain(c.parseNumeric);return{x:r.getOrElse(0),y:a.getOrElse(0),r:c.propertyValue(t,e.mapping.z).chain(c.parseNumeric).getOrElse(10)}}))};return n.merge(i,getLinearSeriesDefaultStyle(a,"bar"===r.props.config.type?.6:.2))})),i="line"===this.props.config.type?{scales:{xAxes:[{type:"linear",position:"bottom"}]}}:{};return{data:{datasets:a},options:i,makeTooltip:function(t){return{points:t.map((function(t){var r=t.setIndex,n=t.pointIndex,i=e.sets[r],o=a[r],s=o.data[n];return{bindings:i.points[n],iri:i.iri?i.iri.value:void 0,label:o.label,value:"number"==typeof s.r?"("+s.x+","+s.y+","+s.r+")":"("+s.x+","+s.y+")",markerStyle:"fill: "+o.borderColor}}))}}}},ChartJsRenderer.prototype.render=function(){var e,t=this.props,r=t.config,i=t.builtData,s=t.labels,l=this.state.tooltip,g="line"===r.type||"bubble"===r.type,h="bar"===r.type||"radar"===r.type;if("pie"===r.type||"donut"===r.type)e=this.mapCircularData(i,s);else if(h||g&&i.categories)e=this.mapCategorialData(i,s);else{if(!g||i.categories)throw Error("Unsupported chart type '"+r.type+"'");e=this.mapNumericalData(i,s)}this.mapped=e;var f=e.data,m=e.options,y=n.find(r.styles,(function(e){return"chartjs"===e.provider})),v={responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1,mode:"index",position:"nearest",custom:this.updateTooltip}},b={data:f,options:n.merge(m,v),width:r.dimensions&&0!==r.dimensions.width?r.dimensions.width:void 0,height:r.dimensions&&0!==r.dimensions.height?r.dimensions.height:400};return y&&y.style&&n.merge(b,y.style),this.redrawChart&&(b.redraw=!0,this.redrawChart=!1),o.createElement("div",{className:this.props.className,style:{width:b.width,height:b.height}},o.createElement(d[r.type],a.__assign(a.__assign({},b),{ref:this.onChartMount})),l?o.createElement(u.TargetedPopover,a.__assign({key:l.caretX+";"+l.caretY,onHide:l.hovering?void 0:this.onTooltipHide},l.props),o.createElement(p.TemplateItem,{template:{source:r.tooltipTemplate||c.DEFAULT_TOOLTIP_MARKUP,options:l.data}})):null)},ChartJsRenderer}(o.Component);function defaultPalette(e,t){return"hsla("+45*(e%8)+",75%,70%,"+t+")"}function getLinearSeriesDefaultStyle(e,t){return{backgroundColor:defaultPalette(e,t),borderColor:defaultPalette(e,1),borderWidth:1,pointBackgroundColor:defaultPalette(e,1),pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:defaultPalette(e,1)}}t.ChartJsRenderer=g}}]);
//# sourceMappingURL=semantic-chart-2622d1519c286f9abe0a.js.map